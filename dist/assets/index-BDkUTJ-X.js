function dP(t,e){for(var r=0;r<e.length;r++){const l=e[r];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in t)){const f=Object.getOwnPropertyDescriptor(l,u);f&&Object.defineProperty(t,u,f.get?f:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const f of u)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function r(u){const f={};return u.integrity&&(f.integrity=u.integrity),u.referrerPolicy&&(f.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?f.credentials="include":u.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function l(u){if(u.ep)return;u.ep=!0;const f=r(u);fetch(u.href,f)}})();function s1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Gx={exports:{}},ey={},Hx={exports:{}},fr={};var EE;function W4(){if(EE)return fr;EE=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),g=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),s=Symbol.for("react.suspense"),S=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),j=Symbol.iterator;function O(ke){return ke===null||typeof ke!="object"?null:(ke=j&&ke[j]||ke["@@iterator"],typeof ke=="function"?ke:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,U={};function q(ke,Ve,bt){this.props=ke,this.context=Ve,this.refs=U,this.updater=bt||L}q.prototype.isReactComponent={},q.prototype.setState=function(ke,Ve){if(typeof ke!="object"&&typeof ke!="function"&&ke!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ke,Ve,"setState")},q.prototype.forceUpdate=function(ke){this.updater.enqueueForceUpdate(this,ke,"forceUpdate")};function Q(){}Q.prototype=q.prototype;function J(ke,Ve,bt){this.props=ke,this.context=Ve,this.refs=U,this.updater=bt||L}var Y=J.prototype=new Q;Y.constructor=J,W(Y,q.prototype),Y.isPureReactComponent=!0;var ie=Array.isArray,_e=Object.prototype.hasOwnProperty,Se={current:null},Ie={key:!0,ref:!0,__self:!0,__source:!0};function Ue(ke,Ve,bt){var wt,Yt={},Mt=null,ct=null;if(Ve!=null)for(wt in Ve.ref!==void 0&&(ct=Ve.ref),Ve.key!==void 0&&(Mt=""+Ve.key),Ve)_e.call(Ve,wt)&&!Ie.hasOwnProperty(wt)&&(Yt[wt]=Ve[wt]);var Nt=arguments.length-2;if(Nt===1)Yt.children=bt;else if(1<Nt){for(var xn=Array(Nt),un=0;un<Nt;un++)xn[un]=arguments[un+2];Yt.children=xn}if(ke&&ke.defaultProps)for(wt in Nt=ke.defaultProps,Nt)Yt[wt]===void 0&&(Yt[wt]=Nt[wt]);return{$$typeof:t,type:ke,key:Mt,ref:ct,props:Yt,_owner:Se.current}}function Je(ke,Ve){return{$$typeof:t,type:ke.type,key:Ve,ref:ke.ref,props:ke.props,_owner:ke._owner}}function Me(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===t}function lt(ke){var Ve={"=":"=0",":":"=2"};return"$"+ke.replace(/[=:]/g,function(bt){return Ve[bt]})}var ft=/\/+/g;function mt(ke,Ve){return typeof ke=="object"&&ke!==null&&ke.key!=null?lt(""+ke.key):Ve.toString(36)}function gt(ke,Ve,bt,wt,Yt){var Mt=typeof ke;(Mt==="undefined"||Mt==="boolean")&&(ke=null);var ct=!1;if(ke===null)ct=!0;else switch(Mt){case"string":case"number":ct=!0;break;case"object":switch(ke.$$typeof){case t:case e:ct=!0}}if(ct)return ct=ke,Yt=Yt(ct),ke=wt===""?"."+mt(ct,0):wt,ie(Yt)?(bt="",ke!=null&&(bt=ke.replace(ft,"$&/")+"/"),gt(Yt,Ve,bt,"",function(un){return un})):Yt!=null&&(Me(Yt)&&(Yt=Je(Yt,bt+(!Yt.key||ct&&ct.key===Yt.key?"":(""+Yt.key).replace(ft,"$&/")+"/")+ke)),Ve.push(Yt)),1;if(ct=0,wt=wt===""?".":wt+":",ie(ke))for(var Nt=0;Nt<ke.length;Nt++){Mt=ke[Nt];var xn=wt+mt(Mt,Nt);ct+=gt(Mt,Ve,bt,xn,Yt)}else if(xn=O(ke),typeof xn=="function")for(ke=xn.call(ke),Nt=0;!(Mt=ke.next()).done;)Mt=Mt.value,xn=wt+mt(Mt,Nt++),ct+=gt(Mt,Ve,bt,xn,Yt);else if(Mt==="object")throw Ve=String(ke),Error("Objects are not valid as a React child (found: "+(Ve==="[object Object]"?"object with keys {"+Object.keys(ke).join(", ")+"}":Ve)+"). If you meant to render a collection of children, use an array instead.");return ct}function Lt(ke,Ve,bt){if(ke==null)return ke;var wt=[],Yt=0;return gt(ke,wt,"","",function(Mt){return Ve.call(bt,Mt,Yt++)}),wt}function it(ke){if(ke._status===-1){var Ve=ke._result;Ve=Ve(),Ve.then(function(bt){(ke._status===0||ke._status===-1)&&(ke._status=1,ke._result=bt)},function(bt){(ke._status===0||ke._status===-1)&&(ke._status=2,ke._result=bt)}),ke._status===-1&&(ke._status=0,ke._result=Ve)}if(ke._status===1)return ke._result.default;throw ke._result}var We={current:null},Le={transition:null},we={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:Le,ReactCurrentOwner:Se};function st(){throw Error("act(...) is not supported in production builds of React.")}return fr.Children={map:Lt,forEach:function(ke,Ve,bt){Lt(ke,function(){Ve.apply(this,arguments)},bt)},count:function(ke){var Ve=0;return Lt(ke,function(){Ve++}),Ve},toArray:function(ke){return Lt(ke,function(Ve){return Ve})||[]},only:function(ke){if(!Me(ke))throw Error("React.Children.only expected to receive a single React element child.");return ke}},fr.Component=q,fr.Fragment=r,fr.Profiler=u,fr.PureComponent=J,fr.StrictMode=l,fr.Suspense=s,fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=we,fr.act=st,fr.cloneElement=function(ke,Ve,bt){if(ke==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ke+".");var wt=W({},ke.props),Yt=ke.key,Mt=ke.ref,ct=ke._owner;if(Ve!=null){if(Ve.ref!==void 0&&(Mt=Ve.ref,ct=Se.current),Ve.key!==void 0&&(Yt=""+Ve.key),ke.type&&ke.type.defaultProps)var Nt=ke.type.defaultProps;for(xn in Ve)_e.call(Ve,xn)&&!Ie.hasOwnProperty(xn)&&(wt[xn]=Ve[xn]===void 0&&Nt!==void 0?Nt[xn]:Ve[xn])}var xn=arguments.length-2;if(xn===1)wt.children=bt;else if(1<xn){Nt=Array(xn);for(var un=0;un<xn;un++)Nt[un]=arguments[un+2];wt.children=Nt}return{$$typeof:t,type:ke.type,key:Yt,ref:Mt,props:wt,_owner:ct}},fr.createContext=function(ke){return ke={$$typeof:g,_currentValue:ke,_currentValue2:ke,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ke.Provider={$$typeof:f,_context:ke},ke.Consumer=ke},fr.createElement=Ue,fr.createFactory=function(ke){var Ve=Ue.bind(null,ke);return Ve.type=ke,Ve},fr.createRef=function(){return{current:null}},fr.forwardRef=function(ke){return{$$typeof:w,render:ke}},fr.isValidElement=Me,fr.lazy=function(ke){return{$$typeof:A,_payload:{_status:-1,_result:ke},_init:it}},fr.memo=function(ke,Ve){return{$$typeof:S,type:ke,compare:Ve===void 0?null:Ve}},fr.startTransition=function(ke){var Ve=Le.transition;Le.transition={};try{ke()}finally{Le.transition=Ve}},fr.unstable_act=st,fr.useCallback=function(ke,Ve){return We.current.useCallback(ke,Ve)},fr.useContext=function(ke){return We.current.useContext(ke)},fr.useDebugValue=function(){},fr.useDeferredValue=function(ke){return We.current.useDeferredValue(ke)},fr.useEffect=function(ke,Ve){return We.current.useEffect(ke,Ve)},fr.useId=function(){return We.current.useId()},fr.useImperativeHandle=function(ke,Ve,bt){return We.current.useImperativeHandle(ke,Ve,bt)},fr.useInsertionEffect=function(ke,Ve){return We.current.useInsertionEffect(ke,Ve)},fr.useLayoutEffect=function(ke,Ve){return We.current.useLayoutEffect(ke,Ve)},fr.useMemo=function(ke,Ve){return We.current.useMemo(ke,Ve)},fr.useReducer=function(ke,Ve,bt){return We.current.useReducer(ke,Ve,bt)},fr.useRef=function(ke){return We.current.useRef(ke)},fr.useState=function(ke){return We.current.useState(ke)},fr.useSyncExternalStore=function(ke,Ve,bt){return We.current.useSyncExternalStore(ke,Ve,bt)},fr.useTransition=function(){return We.current.useTransition()},fr.version="18.3.1",fr}var CE;function a0(){return CE||(CE=1,Hx.exports=W4()),Hx.exports}var kE;function Z4(){if(kE)return ey;kE=1;var t=a0(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,u=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function g(w,s,S){var A,j={},O=null,L=null;S!==void 0&&(O=""+S),s.key!==void 0&&(O=""+s.key),s.ref!==void 0&&(L=s.ref);for(A in s)l.call(s,A)&&!f.hasOwnProperty(A)&&(j[A]=s[A]);if(w&&w.defaultProps)for(A in s=w.defaultProps,s)j[A]===void 0&&(j[A]=s[A]);return{$$typeof:e,type:w,key:O,ref:L,props:j,_owner:u.current}}return ey.Fragment=r,ey.jsx=g,ey.jsxs=g,ey}var AE;function K4(){return AE||(AE=1,Gx.exports=Z4()),Gx.exports}var v=K4(),ev={},qx={exports:{}},ca={},Wx={exports:{}},Zx={};var PE;function X4(){return PE||(PE=1,(function(t){function e(Le,we){var st=Le.length;Le.push(we);e:for(;0<st;){var ke=st-1>>>1,Ve=Le[ke];if(0<u(Ve,we))Le[ke]=we,Le[st]=Ve,st=ke;else break e}}function r(Le){return Le.length===0?null:Le[0]}function l(Le){if(Le.length===0)return null;var we=Le[0],st=Le.pop();if(st!==we){Le[0]=st;e:for(var ke=0,Ve=Le.length,bt=Ve>>>1;ke<bt;){var wt=2*(ke+1)-1,Yt=Le[wt],Mt=wt+1,ct=Le[Mt];if(0>u(Yt,st))Mt<Ve&&0>u(ct,Yt)?(Le[ke]=ct,Le[Mt]=st,ke=Mt):(Le[ke]=Yt,Le[wt]=st,ke=wt);else if(Mt<Ve&&0>u(ct,st))Le[ke]=ct,Le[Mt]=st,ke=Mt;else break e}}return we}function u(Le,we){var st=Le.sortIndex-we.sortIndex;return st!==0?st:Le.id-we.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;t.unstable_now=function(){return f.now()}}else{var g=Date,w=g.now();t.unstable_now=function(){return g.now()-w}}var s=[],S=[],A=1,j=null,O=3,L=!1,W=!1,U=!1,q=typeof setTimeout=="function"?setTimeout:null,Q=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Y(Le){for(var we=r(S);we!==null;){if(we.callback===null)l(S);else if(we.startTime<=Le)l(S),we.sortIndex=we.expirationTime,e(s,we);else break;we=r(S)}}function ie(Le){if(U=!1,Y(Le),!W)if(r(s)!==null)W=!0,it(_e);else{var we=r(S);we!==null&&We(ie,we.startTime-Le)}}function _e(Le,we){W=!1,U&&(U=!1,Q(Ue),Ue=-1),L=!0;var st=O;try{for(Y(we),j=r(s);j!==null&&(!(j.expirationTime>we)||Le&&!lt());){var ke=j.callback;if(typeof ke=="function"){j.callback=null,O=j.priorityLevel;var Ve=ke(j.expirationTime<=we);we=t.unstable_now(),typeof Ve=="function"?j.callback=Ve:j===r(s)&&l(s),Y(we)}else l(s);j=r(s)}if(j!==null)var bt=!0;else{var wt=r(S);wt!==null&&We(ie,wt.startTime-we),bt=!1}return bt}finally{j=null,O=st,L=!1}}var Se=!1,Ie=null,Ue=-1,Je=5,Me=-1;function lt(){return!(t.unstable_now()-Me<Je)}function ft(){if(Ie!==null){var Le=t.unstable_now();Me=Le;var we=!0;try{we=Ie(!0,Le)}finally{we?mt():(Se=!1,Ie=null)}}else Se=!1}var mt;if(typeof J=="function")mt=function(){J(ft)};else if(typeof MessageChannel<"u"){var gt=new MessageChannel,Lt=gt.port2;gt.port1.onmessage=ft,mt=function(){Lt.postMessage(null)}}else mt=function(){q(ft,0)};function it(Le){Ie=Le,Se||(Se=!0,mt())}function We(Le,we){Ue=q(function(){Le(t.unstable_now())},we)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Le){Le.callback=null},t.unstable_continueExecution=function(){W||L||(W=!0,it(_e))},t.unstable_forceFrameRate=function(Le){0>Le||125<Le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Je=0<Le?Math.floor(1e3/Le):5},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_getFirstCallbackNode=function(){return r(s)},t.unstable_next=function(Le){switch(O){case 1:case 2:case 3:var we=3;break;default:we=O}var st=O;O=we;try{return Le()}finally{O=st}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Le,we){switch(Le){case 1:case 2:case 3:case 4:case 5:break;default:Le=3}var st=O;O=Le;try{return we()}finally{O=st}},t.unstable_scheduleCallback=function(Le,we,st){var ke=t.unstable_now();switch(typeof st=="object"&&st!==null?(st=st.delay,st=typeof st=="number"&&0<st?ke+st:ke):st=ke,Le){case 1:var Ve=-1;break;case 2:Ve=250;break;case 5:Ve=1073741823;break;case 4:Ve=1e4;break;default:Ve=5e3}return Ve=st+Ve,Le={id:A++,callback:we,priorityLevel:Le,startTime:st,expirationTime:Ve,sortIndex:-1},st>ke?(Le.sortIndex=st,e(S,Le),r(s)===null&&Le===r(S)&&(U?(Q(Ue),Ue=-1):U=!0,We(ie,st-ke))):(Le.sortIndex=Ve,e(s,Le),W||L||(W=!0,it(_e))),Le},t.unstable_shouldYield=lt,t.unstable_wrapCallback=function(Le){var we=O;return function(){var st=O;O=we;try{return Le.apply(this,arguments)}finally{O=st}}}})(Zx)),Zx}var ME;function Y4(){return ME||(ME=1,Wx.exports=X4()),Wx.exports}var IE;function J4(){if(IE)return ca;IE=1;var t=a0(),e=Y4();function r(d){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+d,E=1;E<arguments.length;E++)m+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,u={};function f(d,m){g(d,m),g(d+"Capture",m)}function g(d,m){for(u[d]=m,d=0;d<m.length;d++)l.add(m[d])}var w=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),s=Object.prototype.hasOwnProperty,S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},j={};function O(d){return s.call(j,d)?!0:s.call(A,d)?!1:S.test(d)?j[d]=!0:(A[d]=!0,!1)}function L(d,m,E,R){if(E!==null&&E.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return R?!1:E!==null?!E.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function W(d,m,E,R){if(m===null||typeof m>"u"||L(d,m,E,R))return!0;if(R)return!1;if(E!==null)switch(E.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function U(d,m,E,R,F,Z,oe){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=R,this.attributeNamespace=F,this.mustUseProperty=E,this.propertyName=d,this.type=m,this.sanitizeURL=Z,this.removeEmptyString=oe}var q={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){q[d]=new U(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var m=d[0];q[m]=new U(m,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){q[d]=new U(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){q[d]=new U(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){q[d]=new U(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){q[d]=new U(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){q[d]=new U(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){q[d]=new U(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){q[d]=new U(d,5,!1,d.toLowerCase(),null,!1,!1)});var Q=/[\-:]([a-z])/g;function J(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var m=d.replace(Q,J);q[m]=new U(m,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var m=d.replace(Q,J);q[m]=new U(m,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var m=d.replace(Q,J);q[m]=new U(m,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){q[d]=new U(d,1,!1,d.toLowerCase(),null,!1,!1)}),q.xlinkHref=new U("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){q[d]=new U(d,1,!1,d.toLowerCase(),null,!0,!0)});function Y(d,m,E,R){var F=q.hasOwnProperty(m)?q[m]:null;(F!==null?F.type!==0:R||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(W(m,E,F,R)&&(E=null),R||F===null?O(m)&&(E===null?d.removeAttribute(m):d.setAttribute(m,""+E)):F.mustUseProperty?d[F.propertyName]=E===null?F.type===3?!1:"":E:(m=F.attributeName,R=F.attributeNamespace,E===null?d.removeAttribute(m):(F=F.type,E=F===3||F===4&&E===!0?"":""+E,R?d.setAttributeNS(R,m,E):d.setAttribute(m,E))))}var ie=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_e=Symbol.for("react.element"),Se=Symbol.for("react.portal"),Ie=Symbol.for("react.fragment"),Ue=Symbol.for("react.strict_mode"),Je=Symbol.for("react.profiler"),Me=Symbol.for("react.provider"),lt=Symbol.for("react.context"),ft=Symbol.for("react.forward_ref"),mt=Symbol.for("react.suspense"),gt=Symbol.for("react.suspense_list"),Lt=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),We=Symbol.for("react.offscreen"),Le=Symbol.iterator;function we(d){return d===null||typeof d!="object"?null:(d=Le&&d[Le]||d["@@iterator"],typeof d=="function"?d:null)}var st=Object.assign,ke;function Ve(d){if(ke===void 0)try{throw Error()}catch(E){var m=E.stack.trim().match(/\n( *(at )?)/);ke=m&&m[1]||""}return`
`+ke+d}var bt=!1;function wt(d,m){if(!d||bt)return"";bt=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ot){var R=ot}Reflect.construct(d,[],m)}else{try{m.call()}catch(ot){R=ot}d.call(m.prototype)}else{try{throw Error()}catch(ot){R=ot}d()}}catch(ot){if(ot&&R&&typeof ot.stack=="string"){for(var F=ot.stack.split(`
`),Z=R.stack.split(`
`),oe=F.length-1,Ae=Z.length-1;1<=oe&&0<=Ae&&F[oe]!==Z[Ae];)Ae--;for(;1<=oe&&0<=Ae;oe--,Ae--)if(F[oe]!==Z[Ae]){if(oe!==1||Ae!==1)do if(oe--,Ae--,0>Ae||F[oe]!==Z[Ae]){var Fe=`
`+F[oe].replace(" at new "," at ");return d.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",d.displayName)),Fe}while(1<=oe&&0<=Ae);break}}}finally{bt=!1,Error.prepareStackTrace=E}return(d=d?d.displayName||d.name:"")?Ve(d):""}function Yt(d){switch(d.tag){case 5:return Ve(d.type);case 16:return Ve("Lazy");case 13:return Ve("Suspense");case 19:return Ve("SuspenseList");case 0:case 2:case 15:return d=wt(d.type,!1),d;case 11:return d=wt(d.type.render,!1),d;case 1:return d=wt(d.type,!0),d;default:return""}}function Mt(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Ie:return"Fragment";case Se:return"Portal";case Je:return"Profiler";case Ue:return"StrictMode";case mt:return"Suspense";case gt:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case lt:return(d.displayName||"Context")+".Consumer";case Me:return(d._context.displayName||"Context")+".Provider";case ft:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Lt:return m=d.displayName||null,m!==null?m:Mt(d.type)||"Memo";case it:m=d._payload,d=d._init;try{return Mt(d(m))}catch{}}return null}function ct(d){var m=d.type;switch(d.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=m.render,d=d.displayName||d.name||"",m.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Mt(m);case 8:return m===Ue?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Nt(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function xn(d){var m=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function un(d){var m=xn(d)?"checked":"value",E=Object.getOwnPropertyDescriptor(d.constructor.prototype,m),R=""+d[m];if(!d.hasOwnProperty(m)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var F=E.get,Z=E.set;return Object.defineProperty(d,m,{configurable:!0,get:function(){return F.call(this)},set:function(oe){R=""+oe,Z.call(this,oe)}}),Object.defineProperty(d,m,{enumerable:E.enumerable}),{getValue:function(){return R},setValue:function(oe){R=""+oe},stopTracking:function(){d._valueTracker=null,delete d[m]}}}}function Rn(d){d._valueTracker||(d._valueTracker=un(d))}function sn(d){if(!d)return!1;var m=d._valueTracker;if(!m)return!0;var E=m.getValue(),R="";return d&&(R=xn(d)?d.checked?"true":"false":d.value),d=R,d!==E?(m.setValue(d),!0):!1}function kr(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function vr(d,m){var E=m.checked;return st({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??d._wrapperState.initialChecked})}function Es(d,m){var E=m.defaultValue==null?"":m.defaultValue,R=m.checked!=null?m.checked:m.defaultChecked;E=Nt(m.value!=null?m.value:E),d._wrapperState={initialChecked:R,initialValue:E,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Jn(d,m){m=m.checked,m!=null&&Y(d,"checked",m,!1)}function Ar(d,m){Jn(d,m);var E=Nt(m.value),R=m.type;if(E!=null)R==="number"?(E===0&&d.value===""||d.value!=E)&&(d.value=""+E):d.value!==""+E&&(d.value=""+E);else if(R==="submit"||R==="reset"){d.removeAttribute("value");return}m.hasOwnProperty("value")?wi(d,m.type,E):m.hasOwnProperty("defaultValue")&&wi(d,m.type,Nt(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(d.defaultChecked=!!m.defaultChecked)}function io(d,m,E){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var R=m.type;if(!(R!=="submit"&&R!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+d._wrapperState.initialValue,E||m===d.value||(d.value=m),d.defaultValue=m}E=d.name,E!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,E!==""&&(d.name=E)}function wi(d,m,E){(m!=="number"||kr(d.ownerDocument)!==d)&&(E==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+E&&(d.defaultValue=""+E))}var Xr=Array.isArray;function ii(d,m,E,R){if(d=d.options,m){m={};for(var F=0;F<E.length;F++)m["$"+E[F]]=!0;for(E=0;E<d.length;E++)F=m.hasOwnProperty("$"+d[E].value),d[E].selected!==F&&(d[E].selected=F),F&&R&&(d[E].defaultSelected=!0)}else{for(E=""+Nt(E),m=null,F=0;F<d.length;F++){if(d[F].value===E){d[F].selected=!0,R&&(d[F].defaultSelected=!0);return}m!==null||d[F].disabled||(m=d[F])}m!==null&&(m.selected=!0)}}function cs(d,m){if(m.dangerouslySetInnerHTML!=null)throw Error(r(91));return st({},m,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Ki(d,m){var E=m.value;if(E==null){if(E=m.children,m=m.defaultValue,E!=null){if(m!=null)throw Error(r(92));if(Xr(E)){if(1<E.length)throw Error(r(93));E=E[0]}m=E}m==null&&(m=""),E=m}d._wrapperState={initialValue:Nt(E)}}function zs(d,m){var E=Nt(m.value),R=Nt(m.defaultValue);E!=null&&(E=""+E,E!==d.value&&(d.value=E),m.defaultValue==null&&d.defaultValue!==E&&(d.defaultValue=E)),R!=null&&(d.defaultValue=""+R)}function Cs(d){var m=d.textContent;m===d._wrapperState.initialValue&&m!==""&&m!==null&&(d.value=m)}function Gr(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function us(d,m){return d==null||d==="http://www.w3.org/1999/xhtml"?Gr(m):d==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var bi,Bs=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,E,R,F){MSApp.execUnsafeLocalFunction(function(){return d(m,E,R,F)})}:d})(function(d,m){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=m;else{for(bi=bi||document.createElement("div"),bi.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=bi.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;m.firstChild;)d.appendChild(m.firstChild)}});function Xi(d,m){if(m){var E=d.firstChild;if(E&&E===d.lastChild&&E.nodeType===3){E.nodeValue=m;return}}d.textContent=m}var Mi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ko=["Webkit","ms","Moz","O"];Object.keys(Mi).forEach(function(d){ko.forEach(function(m){m=m+d.charAt(0).toUpperCase()+d.substring(1),Mi[m]=Mi[d]})});function so(d,m,E){return m==null||typeof m=="boolean"||m===""?"":E||typeof m!="number"||m===0||Mi.hasOwnProperty(d)&&Mi[d]?(""+m).trim():m+"px"}function Ii(d,m){d=d.style;for(var E in m)if(m.hasOwnProperty(E)){var R=E.indexOf("--")===0,F=so(E,m[E],R);E==="float"&&(E="cssFloat"),R?d.setProperty(E,F):d[E]=F}}var ds=st({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function si(d,m){if(m){if(ds[d]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(r(137,d));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(r(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(r(61))}if(m.style!=null&&typeof m.style!="object")throw Error(r(62))}}function Fs(d,m){if(d.indexOf("-")===-1)return typeof m.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oo=null;function Ao(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var be=null,re=null,se=null;function de(d){if(d=Mc(d)){if(typeof be!="function")throw Error(r(280));var m=d.stateNode;m&&(m=Ed(m),be(d.stateNode,d.type,m))}}function Te(d){re?se?se.push(d):se=[d]:re=d}function xe(){if(re){var d=re,m=se;if(se=re=null,de(d),m)for(d=0;d<m.length;d++)de(m[d])}}function ze(d,m){return d(m)}function Be(){}var Oe=!1;function Ze(d,m,E){if(Oe)return d(m,E);Oe=!0;try{return ze(d,m,E)}finally{Oe=!1,(re!==null||se!==null)&&(Be(),xe())}}function St(d,m){var E=d.stateNode;if(E===null)return null;var R=Ed(E);if(R===null)return null;E=R[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(d=d.type,R=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!R;break e;default:d=!1}if(d)return null;if(E&&typeof E!="function")throw Error(r(231,m,typeof E));return E}var jt=!1;if(w)try{var xt={};Object.defineProperty(xt,"passive",{get:function(){jt=!0}}),window.addEventListener("test",xt,xt),window.removeEventListener("test",xt,xt)}catch{jt=!1}function bn(d,m,E,R,F,Z,oe,Ae,Fe){var ot=Array.prototype.slice.call(arguments,3);try{m.apply(E,ot)}catch(Ot){this.onError(Ot)}}var Pn=!1,An=null,Nn=!1,qn=null,Br={onError:function(d){Pn=!0,An=d}};function oi(d,m,E,R,F,Z,oe,Ae,Fe){Pn=!1,An=null,bn.apply(Br,arguments)}function Yi(d,m,E,R,F,Z,oe,Ae,Fe){if(oi.apply(this,arguments),Pn){if(Pn){var ot=An;Pn=!1,An=null}else throw Error(r(198));Nn||(Nn=!0,qn=ot)}}function Dr(d){var m=d,E=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,(m.flags&4098)!==0&&(E=m.return),d=m.return;while(d)}return m.tag===3?E:null}function Po(d){if(d.tag===13){var m=d.memoizedState;if(m===null&&(d=d.alternate,d!==null&&(m=d.memoizedState)),m!==null)return m.dehydrated}return null}function Ti(d){if(Dr(d)!==d)throw Error(r(188))}function hs(d){var m=d.alternate;if(!m){if(m=Dr(d),m===null)throw Error(r(188));return m!==d?null:d}for(var E=d,R=m;;){var F=E.return;if(F===null)break;var Z=F.alternate;if(Z===null){if(R=F.return,R!==null){E=R;continue}break}if(F.child===Z.child){for(Z=F.child;Z;){if(Z===E)return Ti(F),d;if(Z===R)return Ti(F),m;Z=Z.sibling}throw Error(r(188))}if(E.return!==R.return)E=F,R=Z;else{for(var oe=!1,Ae=F.child;Ae;){if(Ae===E){oe=!0,E=F,R=Z;break}if(Ae===R){oe=!0,R=F,E=Z;break}Ae=Ae.sibling}if(!oe){for(Ae=Z.child;Ae;){if(Ae===E){oe=!0,E=Z,R=F;break}if(Ae===R){oe=!0,R=Z,E=F;break}Ae=Ae.sibling}if(!oe)throw Error(r(189))}}if(E.alternate!==R)throw Error(r(190))}if(E.tag!==3)throw Error(r(188));return E.stateNode.current===E?d:m}function vl(d){return d=hs(d),d!==null?lp(d):null}function lp(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var m=lp(d);if(m!==null)return m;d=d.sibling}return null}var Sh=e.unstable_scheduleCallback,sr=e.unstable_cancelCallback,Eh=e.unstable_shouldYield,lu=e.unstable_requestPaint,Hr=e.unstable_now,od=e.unstable_getCurrentPriorityLevel,ao=e.unstable_ImmediatePriority,Wo=e.unstable_UserBlockingPriority,sc=e.unstable_NormalPriority,Ch=e.unstable_LowPriority,za=e.unstable_IdlePriority,lo=null,ks=null;function ht(d){if(ks&&typeof ks.onCommitFiberRoot=="function")try{ks.onCommitFiberRoot(lo,d,void 0,(d.current.flags&128)===128)}catch{}}var Si=Math.clz32?Math.clz32:cp,ai=Math.log,Ri=Math.LN2;function cp(d){return d>>>=0,d===0?32:31-(ai(d)/Ri|0)|0}var Vs=64,oc=4194304;function ac(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function fa(d,m){var E=d.pendingLanes;if(E===0)return 0;var R=0,F=d.suspendedLanes,Z=d.pingedLanes,oe=E&268435455;if(oe!==0){var Ae=oe&~F;Ae!==0?R=ac(Ae):(Z&=oe,Z!==0&&(R=ac(Z)))}else oe=E&~F,oe!==0?R=ac(oe):Z!==0&&(R=ac(Z));if(R===0)return 0;if(m!==0&&m!==R&&(m&F)===0&&(F=R&-R,Z=m&-m,F>=Z||F===16&&(Z&4194240)!==0))return m;if((R&4)!==0&&(R|=E&16),m=d.entangledLanes,m!==0)for(d=d.entanglements,m&=R;0<m;)E=31-Si(m),F=1<<E,R|=d[E],m&=~F;return R}function Gt(d,m){switch(d){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zn(d,m){for(var E=d.suspendedLanes,R=d.pingedLanes,F=d.expirationTimes,Z=d.pendingLanes;0<Z;){var oe=31-Si(Z),Ae=1<<oe,Fe=F[oe];Fe===-1?((Ae&E)===0||(Ae&R)!==0)&&(F[oe]=Gt(Ae,m)):Fe<=m&&(d.expiredLanes|=Ae),Z&=~Ae}}function $n(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function As(){var d=Vs;return Vs<<=1,(Vs&4194240)===0&&(Vs=64),d}function Us(d){for(var m=[],E=0;31>E;E++)m.push(d);return m}function jn(d,m,E){d.pendingLanes|=m,m!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,m=31-Si(m),d[m]=E}function $s(d,m){var E=d.pendingLanes&~m;d.pendingLanes=m,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=m,d.mutableReadLanes&=m,d.entangledLanes&=m,m=d.entanglements;var R=d.eventTimes;for(d=d.expirationTimes;0<E;){var F=31-Si(E),Z=1<<F;m[F]=0,R[F]=-1,d[F]=-1,E&=~Z}}function xl(d,m){var E=d.entangledLanes|=m;for(d=d.entanglements;E;){var R=31-Si(E),F=1<<R;F&m|d[R]&m&&(d[R]|=m),E&=~F}}var or=0;function Gs(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var Pr,ad,Zo,lc,cc,cu=!1,uu=[],co=null,uo=null,Mo=null,Ko=new Map,Ni=new Map,xr=[],kh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ld(d,m){switch(d){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":uo=null;break;case"mouseover":case"mouseout":Mo=null;break;case"pointerover":case"pointerout":Ko.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ni.delete(m.pointerId)}}function ji(d,m,E,R,F,Z){return d===null||d.nativeEvent!==Z?(d={blockedOn:m,domEventName:E,eventSystemFlags:R,nativeEvent:Z,targetContainers:[F]},m!==null&&(m=Mc(m),m!==null&&ad(m)),d):(d.eventSystemFlags|=R,m=d.targetContainers,F!==null&&m.indexOf(F)===-1&&m.push(F),d)}function ho(d,m,E,R,F){switch(m){case"focusin":return co=ji(co,d,m,E,R,F),!0;case"dragenter":return uo=ji(uo,d,m,E,R,F),!0;case"mouseover":return Mo=ji(Mo,d,m,E,R,F),!0;case"pointerover":var Z=F.pointerId;return Ko.set(Z,ji(Ko.get(Z)||null,d,m,E,R,F)),!0;case"gotpointercapture":return Z=F.pointerId,Ni.set(Z,ji(Ni.get(Z)||null,d,m,E,R,F)),!0}return!1}function Ah(d){var m=Ns(d.target);if(m!==null){var E=Dr(m);if(E!==null){if(m=E.tag,m===13){if(m=Po(E),m!==null){d.blockedOn=m,cc(d.priority,function(){Zo(E)});return}}else if(m===3&&E.stateNode.current.memoizedState.isDehydrated){d.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Ba(d){if(d.blockedOn!==null)return!1;for(var m=d.targetContainers;0<m.length;){var E=Mh(d.domEventName,d.eventSystemFlags,m[0],d.nativeEvent);if(E===null){E=d.nativeEvent;var R=new E.constructor(E.type,E);oo=R,E.target.dispatchEvent(R),oo=null}else return m=Mc(E),m!==null&&ad(m),d.blockedOn=E,!1;m.shift()}return!0}function Ur(d,m,E){Ba(d)&&E.delete(m)}function du(){cu=!1,co!==null&&Ba(co)&&(co=null),uo!==null&&Ba(uo)&&(uo=null),Mo!==null&&Ba(Mo)&&(Mo=null),Ko.forEach(Ur),Ni.forEach(Ur)}function wl(d,m){d.blockedOn===m&&(d.blockedOn=null,cu||(cu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,du)))}function Io(d){function m(F){return wl(F,d)}if(0<uu.length){wl(uu[0],d);for(var E=1;E<uu.length;E++){var R=uu[E];R.blockedOn===d&&(R.blockedOn=null)}}for(co!==null&&wl(co,d),uo!==null&&wl(uo,d),Mo!==null&&wl(Mo,d),Ko.forEach(m),Ni.forEach(m),E=0;E<xr.length;E++)R=xr[E],R.blockedOn===d&&(R.blockedOn=null);for(;0<xr.length&&(E=xr[0],E.blockedOn===null);)Ah(E),E.blockedOn===null&&xr.shift()}var Yr=ie.ReactCurrentBatchConfig,uc=!0;function Ph(d,m,E,R){var F=or,Z=Yr.transition;Yr.transition=null;try{or=1,Xo(d,m,E,R)}finally{or=F,Yr.transition=Z}}function pa(d,m,E,R){var F=or,Z=Yr.transition;Yr.transition=null;try{or=4,Xo(d,m,E,R)}finally{or=F,Yr.transition=Z}}function Xo(d,m,E,R){if(uc){var F=Mh(d,m,E,R);if(F===null)Tc(d,m,R,bl,E),ld(d,R);else if(ho(F,d,m,E,R))R.stopPropagation();else if(ld(d,R),m&4&&-1<kh.indexOf(d)){for(;F!==null;){var Z=Mc(F);if(Z!==null&&Pr(Z),Z=Mh(d,m,E,R),Z===null&&Tc(d,m,R,bl,E),Z===F)break;F=Z}F!==null&&R.stopPropagation()}else Tc(d,m,R,null,E)}}var bl=null;function Mh(d,m,E,R){if(bl=null,d=Ao(R),d=Ns(d),d!==null)if(m=Dr(d),m===null)d=null;else if(E=m.tag,E===13){if(d=Po(m),d!==null)return d;d=null}else if(E===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;d=null}else m!==d&&(d=null);return bl=d,null}function cd(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(od()){case ao:return 1;case Wo:return 4;case sc:case Ch:return 16;case za:return 536870912;default:return 16}default:return 16}}var Hs=null,fo=null,dc=null;function Fa(){if(dc)return dc;var d,m=fo,E=m.length,R,F="value"in Hs?Hs.value:Hs.textContent,Z=F.length;for(d=0;d<E&&m[d]===F[d];d++);var oe=E-d;for(R=1;R<=oe&&m[E-R]===F[Z-R];R++);return dc=F.slice(d,1<R?1-R:void 0)}function po(d){var m=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&m===13&&(d=13)):d=m,d===10&&(d=13),32<=d||d===13?d:0}function Va(){return!0}function Yo(){return!1}function Ji(d){function m(E,R,F,Z,oe){this._reactName=E,this._targetInst=F,this.type=R,this.nativeEvent=Z,this.target=oe,this.currentTarget=null;for(var Ae in d)d.hasOwnProperty(Ae)&&(E=d[Ae],this[Ae]=E?E(Z):Z[Ae]);return this.isDefaultPrevented=(Z.defaultPrevented!=null?Z.defaultPrevented:Z.returnValue===!1)?Va:Yo,this.isPropagationStopped=Yo,this}return st(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=Va)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=Va)},persist:function(){},isPersistent:Va}),m}var Ro={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tl=Ji(Ro),hc=st({},Ro,{view:0,detail:0}),ud=Ji(hc),hu,fu,Jo,er=st({},hc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Jo&&(Jo&&d.type==="mousemove"?(hu=d.screenX-Jo.screenX,fu=d.screenY-Jo.screenY):fu=hu=0,Jo=d),hu)},movementY:function(d){return"movementY"in d?d.movementY:fu}}),up=Ji(er),Ih=st({},er,{dataTransfer:0}),dp=Ji(Ih),Rh=st({},hc,{relatedTarget:0}),dd=Ji(Rh),Nh=st({},Ro,{animationName:0,elapsedTime:0,pseudoElement:0}),fc=Ji(Nh),hd=st({},Ro,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),pc=Ji(hd),ma=st({},Ro,{data:0}),Ua=Ji(ma),fd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jh(d){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(d):(d=pu[d])?!!m[d]:!1}function mu(){return jh}var pd=st({},hc,{key:function(d){if(d.key){var m=fd[d.key]||d.key;if(m!=="Unidentified")return m}return d.type==="keypress"?(d=po(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?hp[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(d){return d.type==="keypress"?po(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?po(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),md=Ji(pd),Dh=st({},er,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qn=Ji(Dh),gu=st({},hc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),fp=Ji(gu),Lh=st({},Ro,{propertyName:0,elapsedTime:0,pseudoElement:0}),pp=Ji(Lh),Sl=st({},er,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Oh=Ji(Sl),ig=[9,13,27,32],zh=w&&"CompositionEvent"in window,yu=null;w&&"documentMode"in document&&(yu=document.documentMode);var Bh=w&&"TextEvent"in window&&!yu,gd=w&&(!zh||yu&&8<yu&&11>=yu),yd=" ",_u=!1;function Fh(d,m){switch(d){case"keyup":return ig.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vh(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var mc=!1;function vu(d,m){switch(d){case"compositionend":return Vh(m);case"keypress":return m.which!==32?null:(_u=!0,yd);case"textInput":return d=m.data,d===yd&&_u?null:d;default:return null}}function gc(d,m){if(mc)return d==="compositionend"||!zh&&Fh(d,m)?(d=Fa(),dc=fo=Hs=null,mc=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return gd&&m.locale!=="ko"?null:m.data;default:return null}}var Uh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yc(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m==="input"?!!Uh[d.type]:m==="textarea"}function _d(d,m,E,R){Te(R),m=Is(m,"onChange"),0<m.length&&(E=new Tl("onChange","change",null,E,R),d.push({event:E,listeners:m}))}var Ps=null,$a=null;function $h(d){Pl(d,0)}function El(d){var m=Rl(d);if(sn(m))return d}function mp(d,m){if(d==="change")return m}var vd=!1;if(w){var Gh;if(w){var xu="oninput"in document;if(!xu){var wu=document.createElement("div");wu.setAttribute("oninput","return;"),xu=typeof wu.oninput=="function"}Gh=xu}else Gh=!1;vd=Gh&&(!document.documentMode||9<document.documentMode)}function _c(){Ps&&(Ps.detachEvent("onpropertychange",Hh),$a=Ps=null)}function Hh(d){if(d.propertyName==="value"&&El($a)){var m=[];_d(m,$a,d,Ao(d)),Ze($h,m)}}function qh(d,m,E){d==="focusin"?(_c(),Ps=m,$a=E,Ps.attachEvent("onpropertychange",Hh)):d==="focusout"&&_c()}function sg(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return El($a)}function Wh(d,m){if(d==="click")return El(m)}function gp(d,m){if(d==="input"||d==="change")return El(m)}function bu(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var mo=typeof Object.is=="function"?Object.is:bu;function Ga(d,m){if(mo(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var E=Object.keys(d),R=Object.keys(m);if(E.length!==R.length)return!1;for(R=0;R<E.length;R++){var F=E[R];if(!s.call(m,F)||!mo(d[F],m[F]))return!1}return!0}function Zh(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Cl(d,m){var E=Zh(d);d=0;for(var R;E;){if(E.nodeType===3){if(R=d+E.textContent.length,d<=m&&R>=m)return{node:E,offset:m-d};d=R}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Zh(E)}}function yp(d,m){return d&&m?d===m?!0:d&&d.nodeType===3?!1:m&&m.nodeType===3?yp(d,m.parentNode):"contains"in d?d.contains(m):d.compareDocumentPosition?!!(d.compareDocumentPosition(m)&16):!1:!1}function _p(){for(var d=window,m=kr();m instanceof d.HTMLIFrameElement;){try{var E=typeof m.contentWindow.location.href=="string"}catch{E=!1}if(E)d=m.contentWindow;else break;m=kr(d.document)}return m}function Kh(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m&&(m==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||m==="textarea"||d.contentEditable==="true")}function og(d){var m=_p(),E=d.focusedElem,R=d.selectionRange;if(m!==E&&E&&E.ownerDocument&&yp(E.ownerDocument.documentElement,E)){if(R!==null&&Kh(E)){if(m=R.start,d=R.end,d===void 0&&(d=m),"selectionStart"in E)E.selectionStart=m,E.selectionEnd=Math.min(d,E.value.length);else if(d=(m=E.ownerDocument||document)&&m.defaultView||window,d.getSelection){d=d.getSelection();var F=E.textContent.length,Z=Math.min(R.start,F);R=R.end===void 0?Z:Math.min(R.end,F),!d.extend&&Z>R&&(F=R,R=Z,Z=F),F=Cl(E,Z);var oe=Cl(E,R);F&&oe&&(d.rangeCount!==1||d.anchorNode!==F.node||d.anchorOffset!==F.offset||d.focusNode!==oe.node||d.focusOffset!==oe.offset)&&(m=m.createRange(),m.setStart(F.node,F.offset),d.removeAllRanges(),Z>R?(d.addRange(m),d.extend(oe.node,oe.offset)):(m.setEnd(oe.node,oe.offset),d.addRange(m)))}}for(m=[],d=E;d=d.parentNode;)d.nodeType===1&&m.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<m.length;E++)d=m[E],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var ag=w&&"documentMode"in document&&11>=document.documentMode,kl=null,vc=null,Qo=null,xd=!1;function Xh(d,m,E){var R=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;xd||kl==null||kl!==kr(R)||(R=kl,"selectionStart"in R&&Kh(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),Qo&&Ga(Qo,R)||(Qo=R,R=Is(vc,"onSelect"),0<R.length&&(m=new Tl("onSelect","select",null,m,E),d.push({event:m,listeners:R}),m.target=kl)))}function go(d,m){var E={};return E[d.toLowerCase()]=m.toLowerCase(),E["Webkit"+d]="webkit"+m,E["Moz"+d]="moz"+m,E}var ga={animationend:go("Animation","AnimationEnd"),animationiteration:go("Animation","AnimationIteration"),animationstart:go("Animation","AnimationStart"),transitionend:go("Transition","TransitionEnd")},Ms={},xc={};w&&(xc=document.createElement("div").style,"AnimationEvent"in window||(delete ga.animationend.animation,delete ga.animationiteration.animation,delete ga.animationstart.animation),"TransitionEvent"in window||delete ga.transitionend.transition);function Tu(d){if(Ms[d])return Ms[d];if(!ga[d])return d;var m=ga[d],E;for(E in m)if(m.hasOwnProperty(E)&&E in xc)return Ms[d]=m[E];return d}var Ha=Tu("animationend"),Al=Tu("animationiteration"),Su=Tu("animationstart"),Eu=Tu("transitionend"),tr=new Map,wc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ya(d,m){tr.set(d,m),f(m,[d])}for(var bc=0;bc<wc.length;bc++){var qa=wc[bc],vp=qa.toLowerCase(),wd=qa[0].toUpperCase()+qa.slice(1);ya(vp,"on"+wd)}ya(Ha,"onAnimationEnd"),ya(Al,"onAnimationIteration"),ya(Su,"onAnimationStart"),ya("dblclick","onDoubleClick"),ya("focusin","onFocus"),ya("focusout","onBlur"),ya(Eu,"onTransitionEnd"),g("onMouseEnter",["mouseout","mouseover"]),g("onMouseLeave",["mouseout","mouseover"]),g("onPointerEnter",["pointerout","pointerover"]),g("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xp=new Set("cancel close invalid load scroll toggle".split(" ").concat(qs));function Cu(d,m,E){var R=d.type||"unknown-event";d.currentTarget=E,Yi(R,m,void 0,d),d.currentTarget=null}function Pl(d,m){m=(m&4)!==0;for(var E=0;E<d.length;E++){var R=d[E],F=R.event;R=R.listeners;e:{var Z=void 0;if(m)for(var oe=R.length-1;0<=oe;oe--){var Ae=R[oe],Fe=Ae.instance,ot=Ae.currentTarget;if(Ae=Ae.listener,Fe!==Z&&F.isPropagationStopped())break e;Cu(F,Ae,ot),Z=Fe}else for(oe=0;oe<R.length;oe++){if(Ae=R[oe],Fe=Ae.instance,ot=Ae.currentTarget,Ae=Ae.listener,Fe!==Z&&F.isPropagationStopped())break e;Cu(F,Ae,ot),Z=Fe}}}if(Nn)throw d=qn,Nn=!1,qn=null,d}function yr(d,m){var E=m[Sd];E===void 0&&(E=m[Sd]=new Set);var R=d+"__bubble";E.has(R)||(Au(m,d,2,!1),E.add(R))}function ku(d,m,E){var R=0;m&&(R|=4),Au(E,d,R,m)}var Wa="_reactListening"+Math.random().toString(36).slice(2);function _a(d){if(!d[Wa]){d[Wa]=!0,l.forEach(function(E){E!=="selectionchange"&&(xp.has(E)||ku(E,!1,d),ku(E,!0,d))});var m=d.nodeType===9?d:d.ownerDocument;m===null||m[Wa]||(m[Wa]=!0,ku("selectionchange",!1,m))}}function Au(d,m,E,R){switch(cd(m)){case 1:var F=Ph;break;case 4:F=pa;break;default:F=Xo}E=F.bind(null,m,E,d),F=void 0,!jt||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(F=!0),R?F!==void 0?d.addEventListener(m,E,{capture:!0,passive:F}):d.addEventListener(m,E,!0):F!==void 0?d.addEventListener(m,E,{passive:F}):d.addEventListener(m,E,!1)}function Tc(d,m,E,R,F){var Z=R;if((m&1)===0&&(m&2)===0&&R!==null)e:for(;;){if(R===null)return;var oe=R.tag;if(oe===3||oe===4){var Ae=R.stateNode.containerInfo;if(Ae===F||Ae.nodeType===8&&Ae.parentNode===F)break;if(oe===4)for(oe=R.return;oe!==null;){var Fe=oe.tag;if((Fe===3||Fe===4)&&(Fe=oe.stateNode.containerInfo,Fe===F||Fe.nodeType===8&&Fe.parentNode===F))return;oe=oe.return}for(;Ae!==null;){if(oe=Ns(Ae),oe===null)return;if(Fe=oe.tag,Fe===5||Fe===6){R=Z=oe;continue e}Ae=Ae.parentNode}}R=R.return}Ze(function(){var ot=Z,Ot=Ao(E),zt=[];e:{var It=tr.get(d);if(It!==void 0){var on=Tl,pn=d;switch(d){case"keypress":if(po(E)===0)break e;case"keydown":case"keyup":on=md;break;case"focusin":pn="focus",on=dd;break;case"focusout":pn="blur",on=dd;break;case"beforeblur":case"afterblur":on=dd;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":on=up;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":on=dp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":on=fp;break;case Ha:case Al:case Su:on=fc;break;case Eu:on=pp;break;case"scroll":on=ud;break;case"wheel":on=Oh;break;case"copy":case"cut":case"paste":on=pc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":on=Qn}var mn=(m&4)!==0,_i=!mn&&d==="scroll",tt=mn?It!==null?It+"Capture":null:It;mn=[];for(var He=ot,rt;He!==null;){rt=He;var $t=rt.stateNode;if(rt.tag===5&&$t!==null&&(rt=$t,tt!==null&&($t=St(He,tt),$t!=null&&mn.push(Ft(He,$t,rt)))),_i)break;He=He.return}0<mn.length&&(It=new on(It,pn,null,E,Ot),zt.push({event:It,listeners:mn}))}}if((m&7)===0){e:{if(It=d==="mouseover"||d==="pointerover",on=d==="mouseout"||d==="pointerout",It&&E!==oo&&(pn=E.relatedTarget||E.fromElement)&&(Ns(pn)||pn[No]))break e;if((on||It)&&(It=Ot.window===Ot?Ot:(It=Ot.ownerDocument)?It.defaultView||It.parentWindow:window,on?(pn=E.relatedTarget||E.toElement,on=ot,pn=pn?Ns(pn):null,pn!==null&&(_i=Dr(pn),pn!==_i||pn.tag!==5&&pn.tag!==6)&&(pn=null)):(on=null,pn=ot),on!==pn)){if(mn=up,$t="onMouseLeave",tt="onMouseEnter",He="mouse",(d==="pointerout"||d==="pointerover")&&(mn=Qn,$t="onPointerLeave",tt="onPointerEnter",He="pointer"),_i=on==null?It:Rl(on),rt=pn==null?It:Rl(pn),It=new mn($t,He+"leave",on,E,Ot),It.target=_i,It.relatedTarget=rt,$t=null,Ns(Ot)===ot&&(mn=new mn(tt,He+"enter",pn,E,Ot),mn.target=rt,mn.relatedTarget=_i,$t=mn),_i=$t,on&&pn)t:{for(mn=on,tt=pn,He=0,rt=mn;rt;rt=Ml(rt))He++;for(rt=0,$t=tt;$t;$t=Ml($t))rt++;for(;0<He-rt;)mn=Ml(mn),He--;for(;0<rt-He;)tt=Ml(tt),rt--;for(;He--;){if(mn===tt||tt!==null&&mn===tt.alternate)break t;mn=Ml(mn),tt=Ml(tt)}mn=null}else mn=null;on!==null&&Sc(zt,It,on,mn,!1),pn!==null&&_i!==null&&Sc(zt,_i,pn,mn,!0)}}e:{if(It=ot?Rl(ot):window,on=It.nodeName&&It.nodeName.toLowerCase(),on==="select"||on==="input"&&It.type==="file")var gn=mp;else if(yc(It))if(vd)gn=gp;else{gn=sg;var Cn=qh}else(on=It.nodeName)&&on.toLowerCase()==="input"&&(It.type==="checkbox"||It.type==="radio")&&(gn=Wh);if(gn&&(gn=gn(d,ot))){_d(zt,gn,E,Ot);break e}Cn&&Cn(d,It,ot),d==="focusout"&&(Cn=It._wrapperState)&&Cn.controlled&&It.type==="number"&&wi(It,"number",It.value)}switch(Cn=ot?Rl(ot):window,d){case"focusin":(yc(Cn)||Cn.contentEditable==="true")&&(kl=Cn,vc=ot,Qo=null);break;case"focusout":Qo=vc=kl=null;break;case"mousedown":xd=!0;break;case"contextmenu":case"mouseup":case"dragend":xd=!1,Xh(zt,E,Ot);break;case"selectionchange":if(ag)break;case"keydown":case"keyup":Xh(zt,E,Ot)}var kn;if(zh)e:{switch(d){case"compositionstart":var Hn="onCompositionStart";break e;case"compositionend":Hn="onCompositionEnd";break e;case"compositionupdate":Hn="onCompositionUpdate";break e}Hn=void 0}else mc?Fh(d,E)&&(Hn="onCompositionEnd"):d==="keydown"&&E.keyCode===229&&(Hn="onCompositionStart");Hn&&(gd&&E.locale!=="ko"&&(mc||Hn!=="onCompositionStart"?Hn==="onCompositionEnd"&&mc&&(kn=Fa()):(Hs=Ot,fo="value"in Hs?Hs.value:Hs.textContent,mc=!0)),Cn=Is(ot,Hn),0<Cn.length&&(Hn=new Ua(Hn,d,null,E,Ot),zt.push({event:Hn,listeners:Cn}),kn?Hn.data=kn:(kn=Vh(E),kn!==null&&(Hn.data=kn)))),(kn=Bh?vu(d,E):gc(d,E))&&(ot=Is(ot,"onBeforeInput"),0<ot.length&&(Ot=new Ua("onBeforeInput","beforeinput",null,E,Ot),zt.push({event:Ot,listeners:ot}),Ot.data=kn))}Pl(zt,m)})}function Ft(d,m,E){return{instance:d,listener:m,currentTarget:E}}function Is(d,m){for(var E=m+"Capture",R=[];d!==null;){var F=d,Z=F.stateNode;F.tag===5&&Z!==null&&(F=Z,Z=St(d,E),Z!=null&&R.unshift(Ft(d,Z,F)),Z=St(d,m),Z!=null&&R.push(Ft(d,Z,F))),d=d.return}return R}function Ml(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function Sc(d,m,E,R,F){for(var Z=m._reactName,oe=[];E!==null&&E!==R;){var Ae=E,Fe=Ae.alternate,ot=Ae.stateNode;if(Fe!==null&&Fe===R)break;Ae.tag===5&&ot!==null&&(Ae=ot,F?(Fe=St(E,Z),Fe!=null&&oe.unshift(Ft(E,Fe,Ae))):F||(Fe=St(E,Z),Fe!=null&&oe.push(Ft(E,Fe,Ae)))),E=E.return}oe.length!==0&&d.push({event:m,listeners:oe})}var Pu=/\r\n?/g,Di=/\u0000|\uFFFD/g;function Ec(d){return(typeof d=="string"?d:""+d).replace(Pu,`
`).replace(Di,"")}function Il(d,m,E){if(m=Ec(m),Ec(d)!==m&&E)throw Error(r(425))}function Cc(){}var kc=null,bd=null;function Ac(d,m){return d==="textarea"||d==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Za=typeof setTimeout=="function"?setTimeout:void 0,Yh=typeof clearTimeout=="function"?clearTimeout:void 0,wp=typeof Promise=="function"?Promise:void 0,bp=typeof queueMicrotask=="function"?queueMicrotask:typeof wp<"u"?function(d){return wp.resolve(null).then(d).catch(Pc)}:Za;function Pc(d){setTimeout(function(){throw d})}function Mu(d,m){var E=m,R=0;do{var F=E.nextSibling;if(d.removeChild(E),F&&F.nodeType===8)if(E=F.data,E==="/$"){if(R===0){d.removeChild(F),Io(m);return}R--}else E!=="$"&&E!=="$?"&&E!=="$!"||R++;E=F}while(E);Io(m)}function ea(d){for(;d!=null;d=d.nextSibling){var m=d.nodeType;if(m===1||m===3)break;if(m===8){if(m=d.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return d}function Td(d){d=d.previousSibling;for(var m=0;d;){if(d.nodeType===8){var E=d.data;if(E==="$"||E==="$!"||E==="$?"){if(m===0)return d;m--}else E==="/$"&&m++}d=d.previousSibling}return null}var va=Math.random().toString(36).slice(2),Rs="__reactFiber$"+va,xa="__reactProps$"+va,No="__reactContainer$"+va,Sd="__reactEvents$"+va,Jh="__reactListeners$"+va,Tp="__reactHandles$"+va;function Ns(d){var m=d[Rs];if(m)return m;for(var E=d.parentNode;E;){if(m=E[No]||E[Rs]){if(E=m.alternate,m.child!==null||E!==null&&E.child!==null)for(d=Td(d);d!==null;){if(E=d[Rs])return E;d=Td(d)}return m}d=E,E=d.parentNode}return null}function Mc(d){return d=d[Rs]||d[No],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Rl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(r(33))}function Ed(d){return d[xa]||null}var Cd=[],Ka=-1;function wa(d){return{current:d}}function Lr(d){0>Ka||(d.current=Cd[Ka],Cd[Ka]=null,Ka--)}function Kn(d,m){Ka++,Cd[Ka]=d.current,d.current=m}var Xa={},Gi=wa(Xa),js=wa(!1),Nl=Xa;function Hi(d,m){var E=d.type.contextTypes;if(!E)return Xa;var R=d.stateNode;if(R&&R.__reactInternalMemoizedUnmaskedChildContext===m)return R.__reactInternalMemoizedMaskedChildContext;var F={},Z;for(Z in E)F[Z]=m[Z];return R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=m,d.__reactInternalMemoizedMaskedChildContext=F),F}function fs(d){return d=d.childContextTypes,d!=null}function kd(){Lr(js),Lr(Gi)}function yo(d,m,E){if(Gi.current!==Xa)throw Error(r(168));Kn(Gi,m),Kn(js,E)}function jo(d,m,E){var R=d.stateNode;if(m=m.childContextTypes,typeof R.getChildContext!="function")return E;R=R.getChildContext();for(var F in R)if(!(F in m))throw Error(r(108,ct(d)||"Unknown",F));return st({},E,R)}function ta(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||Xa,Nl=Gi.current,Kn(Gi,d),Kn(js,js.current),!0}function Iu(d,m,E){var R=d.stateNode;if(!R)throw Error(r(169));E?(d=jo(d,m,Nl),R.__reactInternalMemoizedMergedChildContext=d,Lr(js),Lr(Gi),Kn(Gi,d)):Lr(js),Kn(js,E)}var Ut=null,Ic=!1,Ru=!1;function jl(d){Ut===null?Ut=[d]:Ut.push(d)}function Dl(d){Ic=!0,jl(d)}function Bt(){if(!Ru&&Ut!==null){Ru=!0;var d=0,m=or;try{var E=Ut;for(or=1;d<E.length;d++){var R=E[d];do R=R(!0);while(R!==null)}Ut=null,Ic=!1}catch(F){throw Ut!==null&&(Ut=Ut.slice(d+1)),Sh(ao,Bt),F}finally{or=m,Ru=!1}}return null}var Ya=[],Rc=0,Nu=null,Nc=0,Ws=[],Zs=0,Ll=null,ba=1,Do="";function Ta(d,m){Ya[Rc++]=Nc,Ya[Rc++]=Nu,Nu=d,Nc=m}function Ad(d,m,E){Ws[Zs++]=ba,Ws[Zs++]=Do,Ws[Zs++]=Ll,Ll=d;var R=ba;d=Do;var F=32-Si(R)-1;R&=~(1<<F),E+=1;var Z=32-Si(m)+F;if(30<Z){var oe=F-F%5;Z=(R&(1<<oe)-1).toString(32),R>>=oe,F-=oe,ba=1<<32-Si(m)+F|E<<F|R,Do=Z+d}else ba=1<<Z|E<<F|R,Do=d}function Ja(d){d.return!==null&&(Ta(d,1),Ad(d,1,0))}function y(d){for(;d===Nu;)Nu=Ya[--Rc],Ya[Rc]=null,Nc=Ya[--Rc],Ya[Rc]=null;for(;d===Ll;)Ll=Ws[--Zs],Ws[Zs]=null,Do=Ws[--Zs],Ws[Zs]=null,ba=Ws[--Zs],Ws[Zs]=null}var a=null,h=null,x=!1,T=null;function k(d,m){var E=ts(5,null,null,0);E.elementType="DELETED",E.stateNode=m,E.return=d,m=d.deletions,m===null?(d.deletions=[E],d.flags|=16):m.push(E)}function N(d,m){switch(d.tag){case 5:var E=d.type;return m=m.nodeType!==1||E.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(d.stateNode=m,a=d,h=ea(m.firstChild),!0):!1;case 6:return m=d.pendingProps===""||m.nodeType!==3?null:m,m!==null?(d.stateNode=m,a=d,h=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(E=Ll!==null?{id:ba,overflow:Do}:null,d.memoizedState={dehydrated:m,treeContext:E,retryLane:1073741824},E=ts(18,null,null,0),E.stateNode=m,E.return=d,d.child=E,a=d,h=null,!0):!1;default:return!1}}function D(d){return(d.mode&1)!==0&&(d.flags&128)===0}function B(d){if(x){var m=h;if(m){var E=m;if(!N(d,m)){if(D(d))throw Error(r(418));m=ea(E.nextSibling);var R=a;m&&N(d,m)?k(R,E):(d.flags=d.flags&-4097|2,x=!1,a=d)}}else{if(D(d))throw Error(r(418));d.flags=d.flags&-4097|2,x=!1,a=d}}}function H(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;a=d}function G(d){if(d!==a)return!1;if(!x)return H(d),x=!0,!1;var m;if((m=d.tag!==3)&&!(m=d.tag!==5)&&(m=d.type,m=m!=="head"&&m!=="body"&&!Ac(d.type,d.memoizedProps)),m&&(m=h)){if(D(d))throw ee(),Error(r(418));for(;m;)k(d,m),m=ea(m.nextSibling)}if(H(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));e:{for(d=d.nextSibling,m=0;d;){if(d.nodeType===8){var E=d.data;if(E==="/$"){if(m===0){h=ea(d.nextSibling);break e}m--}else E!=="$"&&E!=="$!"&&E!=="$?"||m++}d=d.nextSibling}h=null}}else h=a?ea(d.stateNode.nextSibling):null;return!0}function ee(){for(var d=h;d;)d=ea(d.nextSibling)}function ae(){h=a=null,x=!1}function ue(d){T===null?T=[d]:T.push(d)}var fe=ie.ReactCurrentBatchConfig;function he(d,m,E){if(d=E.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(r(309));var R=E.stateNode}if(!R)throw Error(r(147,d));var F=R,Z=""+d;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===Z?m.ref:(m=function(oe){var Ae=F.refs;oe===null?delete Ae[Z]:Ae[Z]=oe},m._stringRef=Z,m)}if(typeof d!="string")throw Error(r(284));if(!E._owner)throw Error(r(290,d))}return d}function pe(d,m){throw d=Object.prototype.toString.call(m),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d))}function te(d){var m=d._init;return m(d._payload)}function ce(d){function m(tt,He){if(d){var rt=tt.deletions;rt===null?(tt.deletions=[He],tt.flags|=16):rt.push(He)}}function E(tt,He){if(!d)return null;for(;He!==null;)m(tt,He),He=He.sibling;return null}function R(tt,He){for(tt=new Map;He!==null;)He.key!==null?tt.set(He.key,He):tt.set(He.index,He),He=He.sibling;return tt}function F(tt,He){return tt=Gc(tt,He),tt.index=0,tt.sibling=null,tt}function Z(tt,He,rt){return tt.index=rt,d?(rt=tt.alternate,rt!==null?(rt=rt.index,rt<He?(tt.flags|=2,He):rt):(tt.flags|=2,He)):(tt.flags|=1048576,He)}function oe(tt){return d&&tt.alternate===null&&(tt.flags|=2),tt}function Ae(tt,He,rt,$t){return He===null||He.tag!==6?(He=Ig(rt,tt.mode,$t),He.return=tt,He):(He=F(He,rt),He.return=tt,He)}function Fe(tt,He,rt,$t){var gn=rt.type;return gn===Ie?Ot(tt,He,rt.props.children,$t,rt.key):He!==null&&(He.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===it&&te(gn)===He.type)?($t=F(He,rt.props),$t.ref=he(tt,He,rt),$t.return=tt,$t):($t=Hp(rt.type,rt.key,rt.props,null,tt.mode,$t),$t.ref=he(tt,He,rt),$t.return=tt,$t)}function ot(tt,He,rt,$t){return He===null||He.tag!==4||He.stateNode.containerInfo!==rt.containerInfo||He.stateNode.implementation!==rt.implementation?(He=Rg(rt,tt.mode,$t),He.return=tt,He):(He=F(He,rt.children||[]),He.return=tt,He)}function Ot(tt,He,rt,$t,gn){return He===null||He.tag!==7?(He=qu(rt,tt.mode,$t,gn),He.return=tt,He):(He=F(He,rt),He.return=tt,He)}function zt(tt,He,rt){if(typeof He=="string"&&He!==""||typeof He=="number")return He=Ig(""+He,tt.mode,rt),He.return=tt,He;if(typeof He=="object"&&He!==null){switch(He.$$typeof){case _e:return rt=Hp(He.type,He.key,He.props,null,tt.mode,rt),rt.ref=he(tt,null,He),rt.return=tt,rt;case Se:return He=Rg(He,tt.mode,rt),He.return=tt,He;case it:var $t=He._init;return zt(tt,$t(He._payload),rt)}if(Xr(He)||we(He))return He=qu(He,tt.mode,rt,null),He.return=tt,He;pe(tt,He)}return null}function It(tt,He,rt,$t){var gn=He!==null?He.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number")return gn!==null?null:Ae(tt,He,""+rt,$t);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case _e:return rt.key===gn?Fe(tt,He,rt,$t):null;case Se:return rt.key===gn?ot(tt,He,rt,$t):null;case it:return gn=rt._init,It(tt,He,gn(rt._payload),$t)}if(Xr(rt)||we(rt))return gn!==null?null:Ot(tt,He,rt,$t,null);pe(tt,rt)}return null}function on(tt,He,rt,$t,gn){if(typeof $t=="string"&&$t!==""||typeof $t=="number")return tt=tt.get(rt)||null,Ae(He,tt,""+$t,gn);if(typeof $t=="object"&&$t!==null){switch($t.$$typeof){case _e:return tt=tt.get($t.key===null?rt:$t.key)||null,Fe(He,tt,$t,gn);case Se:return tt=tt.get($t.key===null?rt:$t.key)||null,ot(He,tt,$t,gn);case it:var Cn=$t._init;return on(tt,He,rt,Cn($t._payload),gn)}if(Xr($t)||we($t))return tt=tt.get(rt)||null,Ot(He,tt,$t,gn,null);pe(He,$t)}return null}function pn(tt,He,rt,$t){for(var gn=null,Cn=null,kn=He,Hn=He=0,ns=null;kn!==null&&Hn<rt.length;Hn++){kn.index>Hn?(ns=kn,kn=null):ns=kn.sibling;var dr=It(tt,kn,rt[Hn],$t);if(dr===null){kn===null&&(kn=ns);break}d&&kn&&dr.alternate===null&&m(tt,kn),He=Z(dr,He,Hn),Cn===null?gn=dr:Cn.sibling=dr,Cn=dr,kn=ns}if(Hn===rt.length)return E(tt,kn),x&&Ta(tt,Hn),gn;if(kn===null){for(;Hn<rt.length;Hn++)kn=zt(tt,rt[Hn],$t),kn!==null&&(He=Z(kn,He,Hn),Cn===null?gn=kn:Cn.sibling=kn,Cn=kn);return x&&Ta(tt,Hn),gn}for(kn=R(tt,kn);Hn<rt.length;Hn++)ns=on(kn,tt,Hn,rt[Hn],$t),ns!==null&&(d&&ns.alternate!==null&&kn.delete(ns.key===null?Hn:ns.key),He=Z(ns,He,Hn),Cn===null?gn=ns:Cn.sibling=ns,Cn=ns);return d&&kn.forEach(function(oa){return m(tt,oa)}),x&&Ta(tt,Hn),gn}function mn(tt,He,rt,$t){var gn=we(rt);if(typeof gn!="function")throw Error(r(150));if(rt=gn.call(rt),rt==null)throw Error(r(151));for(var Cn=gn=null,kn=He,Hn=He=0,ns=null,dr=rt.next();kn!==null&&!dr.done;Hn++,dr=rt.next()){kn.index>Hn?(ns=kn,kn=null):ns=kn.sibling;var oa=It(tt,kn,dr.value,$t);if(oa===null){kn===null&&(kn=ns);break}d&&kn&&oa.alternate===null&&m(tt,kn),He=Z(oa,He,Hn),Cn===null?gn=oa:Cn.sibling=oa,Cn=oa,kn=ns}if(dr.done)return E(tt,kn),x&&Ta(tt,Hn),gn;if(kn===null){for(;!dr.done;Hn++,dr=rt.next())dr=zt(tt,dr.value,$t),dr!==null&&(He=Z(dr,He,Hn),Cn===null?gn=dr:Cn.sibling=dr,Cn=dr);return x&&Ta(tt,Hn),gn}for(kn=R(tt,kn);!dr.done;Hn++,dr=rt.next())dr=on(kn,tt,Hn,dr.value,$t),dr!==null&&(d&&dr.alternate!==null&&kn.delete(dr.key===null?Hn:dr.key),He=Z(dr,He,Hn),Cn===null?gn=dr:Cn.sibling=dr,Cn=dr);return d&&kn.forEach(function(j_){return m(tt,j_)}),x&&Ta(tt,Hn),gn}function _i(tt,He,rt,$t){if(typeof rt=="object"&&rt!==null&&rt.type===Ie&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case _e:e:{for(var gn=rt.key,Cn=He;Cn!==null;){if(Cn.key===gn){if(gn=rt.type,gn===Ie){if(Cn.tag===7){E(tt,Cn.sibling),He=F(Cn,rt.props.children),He.return=tt,tt=He;break e}}else if(Cn.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===it&&te(gn)===Cn.type){E(tt,Cn.sibling),He=F(Cn,rt.props),He.ref=he(tt,Cn,rt),He.return=tt,tt=He;break e}E(tt,Cn);break}else m(tt,Cn);Cn=Cn.sibling}rt.type===Ie?(He=qu(rt.props.children,tt.mode,$t,rt.key),He.return=tt,tt=He):($t=Hp(rt.type,rt.key,rt.props,null,tt.mode,$t),$t.ref=he(tt,He,rt),$t.return=tt,tt=$t)}return oe(tt);case Se:e:{for(Cn=rt.key;He!==null;){if(He.key===Cn)if(He.tag===4&&He.stateNode.containerInfo===rt.containerInfo&&He.stateNode.implementation===rt.implementation){E(tt,He.sibling),He=F(He,rt.children||[]),He.return=tt,tt=He;break e}else{E(tt,He);break}else m(tt,He);He=He.sibling}He=Rg(rt,tt.mode,$t),He.return=tt,tt=He}return oe(tt);case it:return Cn=rt._init,_i(tt,He,Cn(rt._payload),$t)}if(Xr(rt))return pn(tt,He,rt,$t);if(we(rt))return mn(tt,He,rt,$t);pe(tt,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"?(rt=""+rt,He!==null&&He.tag===6?(E(tt,He.sibling),He=F(He,rt),He.return=tt,tt=He):(E(tt,He),He=Ig(rt,tt.mode,$t),He.return=tt,tt=He),oe(tt)):E(tt,He)}return _i}var ye=ce(!0),ve=ce(!1),Ne=wa(null),De=null,je=null,Ge=null;function $e(){Ge=je=De=null}function Ye(d){var m=Ne.current;Lr(Ne),d._currentValue=m}function kt(d,m,E){for(;d!==null;){var R=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,R!==null&&(R.childLanes|=m)):R!==null&&(R.childLanes&m)!==m&&(R.childLanes|=m),d===E)break;d=d.return}}function qe(d,m){De=d,Ge=je=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&m)!==0&&(Qi=!0),d.firstContext=null)}function at(d){var m=d._currentValue;if(Ge!==d)if(d={context:d,memoizedValue:m,next:null},je===null){if(De===null)throw Error(r(308));je=d,De.dependencies={lanes:0,firstContext:d}}else je=je.next=d;return m}var Qe=null;function Et(d){Qe===null?Qe=[d]:Qe.push(d)}function Xe(d,m,E,R){var F=m.interleaved;return F===null?(E.next=E,Et(m)):(E.next=F.next,F.next=E),m.interleaved=E,ut(d,R)}function ut(d,m){d.lanes|=m;var E=d.alternate;for(E!==null&&(E.lanes|=m),E=d,d=d.return;d!==null;)d.childLanes|=m,E=d.alternate,E!==null&&(E.childLanes|=m),E=d,d=d.return;return E.tag===3?E.stateNode:null}var Tt=!1;function vt(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function At(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function tn(d,m){return{eventTime:d,lane:m,tag:0,payload:null,callback:null,next:null}}function _n(d,m,E){var R=d.updateQueue;if(R===null)return null;if(R=R.shared,(fn&2)!==0){var F=R.pending;return F===null?m.next=m:(m.next=F.next,F.next=m),R.pending=m,ut(d,E)}return F=R.interleaved,F===null?(m.next=m,Et(R)):(m.next=F.next,F.next=m),R.interleaved=m,ut(d,E)}function Zt(d,m,E){if(m=m.updateQueue,m!==null&&(m=m.shared,(E&4194240)!==0)){var R=m.lanes;R&=d.pendingLanes,E|=R,m.lanes=E,xl(d,E)}}function hn(d,m){var E=d.updateQueue,R=d.alternate;if(R!==null&&(R=R.updateQueue,E===R)){var F=null,Z=null;if(E=E.firstBaseUpdate,E!==null){do{var oe={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};Z===null?F=Z=oe:Z=Z.next=oe,E=E.next}while(E!==null);Z===null?F=Z=m:Z=Z.next=m}else F=Z=m;E={baseState:R.baseState,firstBaseUpdate:F,lastBaseUpdate:Z,shared:R.shared,effects:R.effects},d.updateQueue=E;return}d=E.lastBaseUpdate,d===null?E.firstBaseUpdate=m:d.next=m,E.lastBaseUpdate=m}function zn(d,m,E,R){var F=d.updateQueue;Tt=!1;var Z=F.firstBaseUpdate,oe=F.lastBaseUpdate,Ae=F.shared.pending;if(Ae!==null){F.shared.pending=null;var Fe=Ae,ot=Fe.next;Fe.next=null,oe===null?Z=ot:oe.next=ot,oe=Fe;var Ot=d.alternate;Ot!==null&&(Ot=Ot.updateQueue,Ae=Ot.lastBaseUpdate,Ae!==oe&&(Ae===null?Ot.firstBaseUpdate=ot:Ae.next=ot,Ot.lastBaseUpdate=Fe))}if(Z!==null){var zt=F.baseState;oe=0,Ot=ot=Fe=null,Ae=Z;do{var It=Ae.lane,on=Ae.eventTime;if((R&It)===It){Ot!==null&&(Ot=Ot.next={eventTime:on,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var pn=d,mn=Ae;switch(It=m,on=E,mn.tag){case 1:if(pn=mn.payload,typeof pn=="function"){zt=pn.call(on,zt,It);break e}zt=pn;break e;case 3:pn.flags=pn.flags&-65537|128;case 0:if(pn=mn.payload,It=typeof pn=="function"?pn.call(on,zt,It):pn,It==null)break e;zt=st({},zt,It);break e;case 2:Tt=!0}}Ae.callback!==null&&Ae.lane!==0&&(d.flags|=64,It=F.effects,It===null?F.effects=[Ae]:It.push(Ae))}else on={eventTime:on,lane:It,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Ot===null?(ot=Ot=on,Fe=zt):Ot=Ot.next=on,oe|=It;if(Ae=Ae.next,Ae===null){if(Ae=F.shared.pending,Ae===null)break;It=Ae,Ae=It.next,It.next=null,F.lastBaseUpdate=It,F.shared.pending=null}}while(!0);if(Ot===null&&(Fe=zt),F.baseState=Fe,F.firstBaseUpdate=ot,F.lastBaseUpdate=Ot,m=F.shared.interleaved,m!==null){F=m;do oe|=F.lane,F=F.next;while(F!==m)}else Z===null&&(F.shared.lanes=0);Qr|=oe,d.lanes=oe,d.memoizedState=zt}}function Gn(d,m,E){if(d=m.effects,m.effects=null,d!==null)for(m=0;m<d.length;m++){var R=d[m],F=R.callback;if(F!==null){if(R.callback=null,R=E,typeof F!="function")throw Error(r(191,F));F.call(R)}}}var nn={},Wn=wa(nn),lr=wa(nn),cr=wa(nn);function ir(d){if(d===nn)throw Error(r(174));return d}function Li(d,m){switch(Kn(cr,m),Kn(lr,d),Kn(Wn,nn),d=m.nodeType,d){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:us(null,"");break;default:d=d===8?m.parentNode:m,m=d.namespaceURI||null,d=d.tagName,m=us(m,d)}Lr(Wn),Kn(Wn,m)}function qr(){Lr(Wn),Lr(lr),Lr(cr)}function Ks(d){ir(cr.current);var m=ir(Wn.current),E=us(m,d.type);m!==E&&(Kn(lr,d),Kn(Wn,E))}function _o(d){lr.current===d&&(Lr(Wn),Lr(lr))}var Mn=wa(0);function mr(d){for(var m=d;m!==null;){if(m.tag===13){var E=m.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var nr=[];function Wr(){for(var d=0;d<nr.length;d++)nr[d]._workInProgressVersionPrimary=null;nr.length=0}var Oi=ie.ReactCurrentDispatcher,wr=ie.ReactCurrentBatchConfig,pi=0,Or=null,Fr=null,Jr=null,vo=!1,xo=!1,Lo=0,Pd=0;function mi(){throw Error(r(321))}function ju(d,m){if(m===null)return!1;for(var E=0;E<m.length&&E<d.length;E++)if(!mo(d[E],m[E]))return!1;return!0}function Sp(d,m,E,R,F,Z){if(pi=Z,Or=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Oi.current=d===null||d.memoizedState===null?x_:w_,d=E(R,F),xo){Z=0;do{if(xo=!1,Lo=0,25<=Z)throw Error(r(301));Z+=1,Jr=Fr=null,m.updateQueue=null,Oi.current=Ea,d=E(R,F)}while(xo)}if(Oi.current=ps,m=Fr!==null&&Fr.next!==null,pi=0,Jr=Fr=Or=null,vo=!1,m)throw Error(r(300));return d}function Ep(){var d=Lo!==0;return Lo=0,d}function Qa(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jr===null?Or.memoizedState=Jr=d:Jr=Jr.next=d,Jr}function wo(){if(Fr===null){var d=Or.alternate;d=d!==null?d.memoizedState:null}else d=Fr.next;var m=Jr===null?Or.memoizedState:Jr.next;if(m!==null)Jr=m,Fr=d;else{if(d===null)throw Error(r(310));Fr=d,d={memoizedState:Fr.memoizedState,baseState:Fr.baseState,baseQueue:Fr.baseQueue,queue:Fr.queue,next:null},Jr===null?Or.memoizedState=Jr=d:Jr=Jr.next=d}return Jr}function jc(d,m){return typeof m=="function"?m(d):m}function Cp(d){var m=wo(),E=m.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=Fr,F=R.baseQueue,Z=E.pending;if(Z!==null){if(F!==null){var oe=F.next;F.next=Z.next,Z.next=oe}R.baseQueue=F=Z,E.pending=null}if(F!==null){Z=F.next,R=R.baseState;var Ae=oe=null,Fe=null,ot=Z;do{var Ot=ot.lane;if((pi&Ot)===Ot)Fe!==null&&(Fe=Fe.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),R=ot.hasEagerState?ot.eagerState:d(R,ot.action);else{var zt={lane:Ot,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Fe===null?(Ae=Fe=zt,oe=R):Fe=Fe.next=zt,Or.lanes|=Ot,Qr|=Ot}ot=ot.next}while(ot!==null&&ot!==Z);Fe===null?oe=R:Fe.next=Ae,mo(R,m.memoizedState)||(Qi=!0),m.memoizedState=R,m.baseState=oe,m.baseQueue=Fe,E.lastRenderedState=R}if(d=E.interleaved,d!==null){F=d;do Z=F.lane,Or.lanes|=Z,Qr|=Z,F=F.next;while(F!==d)}else F===null&&(E.lanes=0);return[m.memoizedState,E.dispatch]}function Qh(d){var m=wo(),E=m.queue;if(E===null)throw Error(r(311));E.lastRenderedReducer=d;var R=E.dispatch,F=E.pending,Z=m.memoizedState;if(F!==null){E.pending=null;var oe=F=F.next;do Z=d(Z,oe.action),oe=oe.next;while(oe!==F);mo(Z,m.memoizedState)||(Qi=!0),m.memoizedState=Z,m.baseQueue===null&&(m.baseState=Z),E.lastRenderedState=Z}return[Z,R]}function ef(){}function el(d,m){var E=Or,R=wo(),F=m(),Z=!mo(R.memoizedState,F);if(Z&&(R.memoizedState=F,Qi=!0),R=R.queue,tl(cg.bind(null,E,R,d),[d]),R.getSnapshot!==m||Z||Jr!==null&&Jr.memoizedState.tag&1){if(E.flags|=2048,Du(9,lg.bind(null,E,R,F,m),void 0,null),Bi===null)throw Error(r(349));(pi&30)!==0||tf(E,m,F)}return F}function tf(d,m,E){d.flags|=16384,d={getSnapshot:m,value:E},m=Or.updateQueue,m===null?(m={lastEffect:null,stores:null},Or.updateQueue=m,m.stores=[d]):(E=m.stores,E===null?m.stores=[d]:E.push(d))}function lg(d,m,E,R){m.value=E,m.getSnapshot=R,f_(m)&&p_(d)}function cg(d,m,E){return E(function(){f_(m)&&p_(d)})}function f_(d){var m=d.getSnapshot;d=d.value;try{var E=m();return!mo(d,E)}catch{return!0}}function p_(d){var m=ut(d,1);m!==null&&Pa(m,d,1,-1)}function m_(d){var m=Qa();return typeof d=="function"&&(d=d()),m.memoizedState=m.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jc,lastRenderedState:d},m.queue=d,d=d.dispatch=li.bind(null,Or,d),[m.memoizedState,d]}function Du(d,m,E,R){return d={tag:d,create:m,destroy:E,deps:R,next:null},m=Or.updateQueue,m===null?(m={lastEffect:null,stores:null},Or.updateQueue=m,m.lastEffect=d.next=d):(E=m.lastEffect,E===null?m.lastEffect=d.next=d:(R=E.next,E.next=d,d.next=R,m.lastEffect=d)),d}function Md(){return wo().memoizedState}function Ol(d,m,E,R){var F=Qa();Or.flags|=d,F.memoizedState=Du(1|m,E,void 0,R===void 0?null:R)}function na(d,m,E,R){var F=wo();R=R===void 0?null:R;var Z=void 0;if(Fr!==null){var oe=Fr.memoizedState;if(Z=oe.destroy,R!==null&&ju(R,oe.deps)){F.memoizedState=Du(m,E,Z,R);return}}Or.flags|=d,F.memoizedState=Du(1|m,E,Z,R)}function ra(d,m){return Ol(8390656,8,d,m)}function tl(d,m){return na(2048,8,d,m)}function zl(d,m){return na(4,2,d,m)}function Dc(d,m){return na(4,4,d,m)}function g_(d,m){if(typeof m=="function")return d=d(),m(d),function(){m(null)};if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function y_(d,m,E){return E=E!=null?E.concat([d]):null,na(4,4,g_.bind(null,m,d),E)}function ug(){}function __(d,m){var E=wo();m=m===void 0?null:m;var R=E.memoizedState;return R!==null&&m!==null&&ju(m,R[1])?R[0]:(E.memoizedState=[d,m],d)}function dg(d,m){var E=wo();m=m===void 0?null:m;var R=E.memoizedState;return R!==null&&m!==null&&ju(m,R[1])?R[0]:(d=d(),E.memoizedState=[d,m],d)}function hg(d,m,E){return(pi&21)===0?(d.baseState&&(d.baseState=!1,Qi=!0),d.memoizedState=E):(mo(E,m)||(E=As(),Or.lanes|=E,Qr|=E,d.baseState=!0),m)}function Sa(d,m){var E=or;or=E!==0&&4>E?E:4,d(!0);var R=wr.transition;wr.transition={};try{d(!1),m()}finally{or=E,wr.transition=R}}function v_(){return wo().memoizedState}function ix(d,m,E){var R=al(d);if(E={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null},ln(d))Bl(m,E);else if(E=Xe(d,m,E,R),E!==null){var F=Js();Pa(E,d,R,F),nf(E,m,R)}}function li(d,m,E){var R=al(d),F={lane:R,action:E,hasEagerState:!1,eagerState:null,next:null};if(ln(d))Bl(m,F);else{var Z=d.alternate;if(d.lanes===0&&(Z===null||Z.lanes===0)&&(Z=m.lastRenderedReducer,Z!==null))try{var oe=m.lastRenderedState,Ae=Z(oe,E);if(F.hasEagerState=!0,F.eagerState=Ae,mo(Ae,oe)){var Fe=m.interleaved;Fe===null?(F.next=F,Et(m)):(F.next=Fe.next,Fe.next=F),m.interleaved=F;return}}catch{}E=Xe(d,m,F,R),E!==null&&(F=Js(),Pa(E,d,R,F),nf(E,m,R))}}function ln(d){var m=d.alternate;return d===Or||m!==null&&m===Or}function Bl(d,m){xo=vo=!0;var E=d.pending;E===null?m.next=m:(m.next=E.next,E.next=m),d.pending=m}function nf(d,m,E){if((E&4194240)!==0){var R=m.lanes;R&=d.pendingLanes,E|=R,m.lanes=E,xl(d,E)}}var ps={readContext:at,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useInsertionEffect:mi,useLayoutEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useMutableSource:mi,useSyncExternalStore:mi,useId:mi,unstable_isNewReconciler:!1},x_={readContext:at,useCallback:function(d,m){return Qa().memoizedState=[d,m===void 0?null:m],d},useContext:at,useEffect:ra,useImperativeHandle:function(d,m,E){return E=E!=null?E.concat([d]):null,Ol(4194308,4,g_.bind(null,m,d),E)},useLayoutEffect:function(d,m){return Ol(4194308,4,d,m)},useInsertionEffect:function(d,m){return Ol(4,2,d,m)},useMemo:function(d,m){var E=Qa();return m=m===void 0?null:m,d=d(),E.memoizedState=[d,m],d},useReducer:function(d,m,E){var R=Qa();return m=E!==void 0?E(m):m,R.memoizedState=R.baseState=m,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:m},R.queue=d,d=d.dispatch=ix.bind(null,Or,d),[R.memoizedState,d]},useRef:function(d){var m=Qa();return d={current:d},m.memoizedState=d},useState:m_,useDebugValue:ug,useDeferredValue:function(d){return Qa().memoizedState=d},useTransition:function(){var d=m_(!1),m=d[0];return d=Sa.bind(null,d[1]),Qa().memoizedState=d,[m,d]},useMutableSource:function(){},useSyncExternalStore:function(d,m,E){var R=Or,F=Qa();if(x){if(E===void 0)throw Error(r(407));E=E()}else{if(E=m(),Bi===null)throw Error(r(349));(pi&30)!==0||tf(R,m,E)}F.memoizedState=E;var Z={value:E,getSnapshot:m};return F.queue=Z,ra(cg.bind(null,R,Z,d),[d]),R.flags|=2048,Du(9,lg.bind(null,R,Z,E,m),void 0,null),E},useId:function(){var d=Qa(),m=Bi.identifierPrefix;if(x){var E=Do,R=ba;E=(R&~(1<<32-Si(R)-1)).toString(32)+E,m=":"+m+"R"+E,E=Lo++,0<E&&(m+="H"+E.toString(32)),m+=":"}else E=Pd++,m=":"+m+"r"+E.toString(32)+":";return d.memoizedState=m},unstable_isNewReconciler:!1},w_={readContext:at,useCallback:__,useContext:at,useEffect:tl,useImperativeHandle:y_,useInsertionEffect:zl,useLayoutEffect:Dc,useMemo:dg,useReducer:Cp,useRef:Md,useState:function(){return Cp(jc)},useDebugValue:ug,useDeferredValue:function(d){var m=wo();return hg(m,Fr.memoizedState,d)},useTransition:function(){var d=Cp(jc)[0],m=wo().memoizedState;return[d,m]},useMutableSource:ef,useSyncExternalStore:el,useId:v_,unstable_isNewReconciler:!1},Ea={readContext:at,useCallback:__,useContext:at,useEffect:tl,useImperativeHandle:y_,useInsertionEffect:zl,useLayoutEffect:Dc,useMemo:dg,useReducer:Qh,useRef:Md,useState:function(){return Qh(jc)},useDebugValue:ug,useDeferredValue:function(d){var m=wo();return Fr===null?m.memoizedState=d:hg(m,Fr.memoizedState,d)},useTransition:function(){var d=Qh(jc)[0],m=wo().memoizedState;return[d,m]},useMutableSource:ef,useSyncExternalStore:el,useId:v_,unstable_isNewReconciler:!1};function Oo(d,m){if(d&&d.defaultProps){m=st({},m),d=d.defaultProps;for(var E in d)m[E]===void 0&&(m[E]=d[E]);return m}return m}function Fl(d,m,E,R){m=d.memoizedState,E=E(R,m),E=E==null?m:st({},m,E),d.memoizedState=E,d.lanes===0&&(d.updateQueue.baseState=E)}var Lc={isMounted:function(d){return(d=d._reactInternals)?Dr(d)===d:!1},enqueueSetState:function(d,m,E){d=d._reactInternals;var R=Js(),F=al(d),Z=tn(R,F);Z.payload=m,E!=null&&(Z.callback=E),m=_n(d,Z,F),m!==null&&(Pa(m,d,F,R),Zt(m,d,F))},enqueueReplaceState:function(d,m,E){d=d._reactInternals;var R=Js(),F=al(d),Z=tn(R,F);Z.tag=1,Z.payload=m,E!=null&&(Z.callback=E),m=_n(d,Z,F),m!==null&&(Pa(m,d,F,R),Zt(m,d,F))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var E=Js(),R=al(d),F=tn(E,R);F.tag=2,m!=null&&(F.callback=m),m=_n(d,F,R),m!==null&&(Pa(m,d,R,E),Zt(m,d,R))}};function Oc(d,m,E,R,F,Z,oe){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(R,Z,oe):m.prototype&&m.prototype.isPureReactComponent?!Ga(E,R)||!Ga(F,Z):!0}function kp(d,m,E){var R=!1,F=Xa,Z=m.contextType;return typeof Z=="object"&&Z!==null?Z=at(Z):(F=fs(m)?Nl:Gi.current,R=m.contextTypes,Z=(R=R!=null)?Hi(d,F):Xa),m=new m(E,Z),d.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Lc,d.stateNode=m,m._reactInternals=d,R&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=F,d.__reactInternalMemoizedMaskedChildContext=Z),m}function rf(d,m,E,R){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(E,R),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(E,R),m.state!==d&&Lc.enqueueReplaceState(m,m.state,null)}function Ap(d,m,E,R){var F=d.stateNode;F.props=E,F.state=d.memoizedState,F.refs={},vt(d);var Z=m.contextType;typeof Z=="object"&&Z!==null?F.context=at(Z):(Z=fs(m)?Nl:Gi.current,F.context=Hi(d,Z)),F.state=d.memoizedState,Z=m.getDerivedStateFromProps,typeof Z=="function"&&(Fl(d,m,Z,E),F.state=d.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof F.getSnapshotBeforeUpdate=="function"||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(m=F.state,typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount(),m!==F.state&&Lc.enqueueReplaceState(F,F.state,null),zn(d,E,F,R),F.state=d.memoizedState),typeof F.componentDidMount=="function"&&(d.flags|=4194308)}function Lu(d,m){try{var E="",R=m;do E+=Yt(R),R=R.return;while(R);var F=E}catch(Z){F=`
Error generating stack: `+Z.message+`
`+Z.stack}return{value:d,source:m,stack:F,digest:null}}function fg(d,m,E){return{value:d,source:null,stack:E??null,digest:m??null}}function sf(d,m){try{console.error(m.value)}catch(E){setTimeout(function(){throw E})}}var b_=typeof WeakMap=="function"?WeakMap:Map;function Id(d,m,E){E=tn(-1,E),E.tag=3,E.payload={element:null};var R=m.value;return E.callback=function(){mf||(mf=!0,Tg=R),sf(d,m)},E}function Ou(d,m,E){E=tn(-1,E),E.tag=3;var R=d.type.getDerivedStateFromError;if(typeof R=="function"){var F=m.value;E.payload=function(){return R(F)},E.callback=function(){sf(d,m)}}var Z=d.stateNode;return Z!==null&&typeof Z.componentDidCatch=="function"&&(E.callback=function(){sf(d,m),typeof R!="function"&&(Ls===null?Ls=new Set([this]):Ls.add(this));var oe=m.stack;this.componentDidCatch(m.value,{componentStack:oe!==null?oe:""})}),E}function nl(d,m,E){var R=d.pingCache;if(R===null){R=d.pingCache=new b_;var F=new Set;R.set(m,F)}else F=R.get(m),F===void 0&&(F=new Set,R.set(m,F));F.has(E)||(F.add(E),d=Mg.bind(null,d,m,E),m.then(d,d))}function Pp(d){do{var m;if((m=d.tag===13)&&(m=d.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return d;d=d.return}while(d!==null);return null}function pg(d,m,E,R,F){return(d.mode&1)===0?(d===m?d.flags|=65536:(d.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(m=tn(-1,1),m.tag=2,_n(E,m,1))),E.lanes|=1),d):(d.flags|=65536,d.lanes=F,d)}var of=ie.ReactCurrentOwner,Qi=!1;function Vr(d,m,E,R){m.child=d===null?ve(m,null,E,R):ye(m,d.child,E,R)}function Rd(d,m,E,R,F){E=E.render;var Z=m.ref;return qe(m,F),R=Sp(d,m,E,R,Z,F),E=Ep(),d!==null&&!Qi?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~F,rl(d,m,F)):(x&&E&&Ja(m),m.flags|=1,Vr(d,m,R,F),m.child)}function ms(d,m,E,R,F){if(d===null){var Z=E.type;return typeof Z=="function"&&!Hu(Z)&&Z.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(m.tag=15,m.type=Z,zo(d,m,Z,R,F)):(d=Hp(E.type,null,R,m,m.mode,F),d.ref=m.ref,d.return=m,m.child=d)}if(Z=d.child,(d.lanes&F)===0){var oe=Z.memoizedProps;if(E=E.compare,E=E!==null?E:Ga,E(oe,R)&&d.ref===m.ref)return rl(d,m,F)}return m.flags|=1,d=Gc(Z,R),d.ref=m.ref,d.return=m,m.child=d}function zo(d,m,E,R,F){if(d!==null){var Z=d.memoizedProps;if(Ga(Z,R)&&d.ref===m.ref)if(Qi=!1,m.pendingProps=R=Z,(d.lanes&F)!==0)(d.flags&131072)!==0&&(Qi=!0);else return m.lanes=d.lanes,rl(d,m,F)}return Ip(d,m,E,R,F)}function Mp(d,m,E){var R=m.pendingProps,F=R.children,Z=d!==null?d.memoizedState:null;if(R.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kn(es,ci),ci|=E;else{if((E&1073741824)===0)return d=Z!==null?Z.baseLanes|E:E,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:d,cachePool:null,transitions:null},m.updateQueue=null,Kn(es,ci),ci|=d,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},R=Z!==null?Z.baseLanes:E,Kn(es,ci),ci|=R}else Z!==null?(R=Z.baseLanes|E,m.memoizedState=null):R=E,Kn(es,ci),ci|=R;return Vr(d,m,F,E),m.child}function Zr(d,m){var E=m.ref;(d===null&&E!==null||d!==null&&d.ref!==E)&&(m.flags|=512,m.flags|=2097152)}function Ip(d,m,E,R,F){var Z=fs(E)?Nl:Gi.current;return Z=Hi(m,Z),qe(m,F),E=Sp(d,m,E,R,Z,F),R=Ep(),d!==null&&!Qi?(m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~F,rl(d,m,F)):(x&&R&&Ja(m),m.flags|=1,Vr(d,m,E,F),m.child)}function Nd(d,m,E,R,F){if(fs(E)){var Z=!0;ta(m)}else Z=!1;if(qe(m,F),m.stateNode===null)lf(d,m),kp(m,E,R),Ap(m,E,R,F),R=!0;else if(d===null){var oe=m.stateNode,Ae=m.memoizedProps;oe.props=Ae;var Fe=oe.context,ot=E.contextType;typeof ot=="object"&&ot!==null?ot=at(ot):(ot=fs(E)?Nl:Gi.current,ot=Hi(m,ot));var Ot=E.getDerivedStateFromProps,zt=typeof Ot=="function"||typeof oe.getSnapshotBeforeUpdate=="function";zt||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(Ae!==R||Fe!==ot)&&rf(m,oe,R,ot),Tt=!1;var It=m.memoizedState;oe.state=It,zn(m,R,oe,F),Fe=m.memoizedState,Ae!==R||It!==Fe||js.current||Tt?(typeof Ot=="function"&&(Fl(m,E,Ot,R),Fe=m.memoizedState),(Ae=Tt||Oc(m,E,Ae,R,It,Fe,ot))?(zt||typeof oe.UNSAFE_componentWillMount!="function"&&typeof oe.componentWillMount!="function"||(typeof oe.componentWillMount=="function"&&oe.componentWillMount(),typeof oe.UNSAFE_componentWillMount=="function"&&oe.UNSAFE_componentWillMount()),typeof oe.componentDidMount=="function"&&(m.flags|=4194308)):(typeof oe.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=R,m.memoizedState=Fe),oe.props=R,oe.state=Fe,oe.context=ot,R=Ae):(typeof oe.componentDidMount=="function"&&(m.flags|=4194308),R=!1)}else{oe=m.stateNode,At(d,m),Ae=m.memoizedProps,ot=m.type===m.elementType?Ae:Oo(m.type,Ae),oe.props=ot,zt=m.pendingProps,It=oe.context,Fe=E.contextType,typeof Fe=="object"&&Fe!==null?Fe=at(Fe):(Fe=fs(E)?Nl:Gi.current,Fe=Hi(m,Fe));var on=E.getDerivedStateFromProps;(Ot=typeof on=="function"||typeof oe.getSnapshotBeforeUpdate=="function")||typeof oe.UNSAFE_componentWillReceiveProps!="function"&&typeof oe.componentWillReceiveProps!="function"||(Ae!==zt||It!==Fe)&&rf(m,oe,R,Fe),Tt=!1,It=m.memoizedState,oe.state=It,zn(m,R,oe,F);var pn=m.memoizedState;Ae!==zt||It!==pn||js.current||Tt?(typeof on=="function"&&(Fl(m,E,on,R),pn=m.memoizedState),(ot=Tt||Oc(m,E,ot,R,It,pn,Fe)||!1)?(Ot||typeof oe.UNSAFE_componentWillUpdate!="function"&&typeof oe.componentWillUpdate!="function"||(typeof oe.componentWillUpdate=="function"&&oe.componentWillUpdate(R,pn,Fe),typeof oe.UNSAFE_componentWillUpdate=="function"&&oe.UNSAFE_componentWillUpdate(R,pn,Fe)),typeof oe.componentDidUpdate=="function"&&(m.flags|=4),typeof oe.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof oe.componentDidUpdate!="function"||Ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||Ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=1024),m.memoizedProps=R,m.memoizedState=pn),oe.props=R,oe.state=pn,oe.context=Fe,R=ot):(typeof oe.componentDidUpdate!="function"||Ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=4),typeof oe.getSnapshotBeforeUpdate!="function"||Ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=1024),R=!1)}return Bo(d,m,E,R,Z,F)}function Bo(d,m,E,R,F,Z){Zr(d,m);var oe=(m.flags&128)!==0;if(!R&&!oe)return F&&Iu(m,E,!1),rl(d,m,Z);R=m.stateNode,of.current=m;var Ae=oe&&typeof E.getDerivedStateFromError!="function"?null:R.render();return m.flags|=1,d!==null&&oe?(m.child=ye(m,d.child,null,Z),m.child=ye(m,null,Ae,Z)):Vr(d,m,Ae,Z),m.memoizedState=R.state,F&&Iu(m,E,!0),m.child}function T_(d){var m=d.stateNode;m.pendingContext?yo(d,m.pendingContext,m.pendingContext!==m.context):m.context&&yo(d,m.context,!1),Li(d,m.containerInfo)}function S_(d,m,E,R,F){return ae(),ue(F),m.flags|=256,Vr(d,m,E,R),m.child}var Rp={dehydrated:null,treeContext:null,retryLane:0};function Np(d){return{baseLanes:d,cachePool:null,transitions:null}}function zc(d,m,E){var R=m.pendingProps,F=Mn.current,Z=!1,oe=(m.flags&128)!==0,Ae;if((Ae=oe)||(Ae=d!==null&&d.memoizedState===null?!1:(F&2)!==0),Ae?(Z=!0,m.flags&=-129):(d===null||d.memoizedState!==null)&&(F|=1),Kn(Mn,F&1),d===null)return B(m),d=m.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((m.mode&1)===0?m.lanes=1:d.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(oe=R.children,d=R.fallback,Z?(R=m.mode,Z=m.child,oe={mode:"hidden",children:oe},(R&1)===0&&Z!==null?(Z.childLanes=0,Z.pendingProps=oe):Z=qp(oe,R,0,null),d=qu(d,R,E,null),Z.return=m,d.return=m,Z.sibling=d,m.child=Z,m.child.memoizedState=Np(E),m.memoizedState=Rp,d):jp(m,oe));if(F=d.memoizedState,F!==null&&(Ae=F.dehydrated,Ae!==null))return E_(d,m,oe,R,Ae,F,E);if(Z){Z=R.fallback,oe=m.mode,F=d.child,Ae=F.sibling;var Fe={mode:"hidden",children:R.children};return(oe&1)===0&&m.child!==F?(R=m.child,R.childLanes=0,R.pendingProps=Fe,m.deletions=null):(R=Gc(F,Fe),R.subtreeFlags=F.subtreeFlags&14680064),Ae!==null?Z=Gc(Ae,Z):(Z=qu(Z,oe,E,null),Z.flags|=2),Z.return=m,R.return=m,R.sibling=Z,m.child=R,R=Z,Z=m.child,oe=d.child.memoizedState,oe=oe===null?Np(E):{baseLanes:oe.baseLanes|E,cachePool:null,transitions:oe.transitions},Z.memoizedState=oe,Z.childLanes=d.childLanes&~E,m.memoizedState=Rp,R}return Z=d.child,d=Z.sibling,R=Gc(Z,{mode:"visible",children:R.children}),(m.mode&1)===0&&(R.lanes=E),R.return=m,R.sibling=null,d!==null&&(E=m.deletions,E===null?(m.deletions=[d],m.flags|=16):E.push(d)),m.child=R,m.memoizedState=null,R}function jp(d,m){return m=qp({mode:"visible",children:m},d.mode,0,null),m.return=d,d.child=m}function af(d,m,E,R){return R!==null&&ue(R),ye(m,d.child,null,E),d=jp(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function E_(d,m,E,R,F,Z,oe){if(E)return m.flags&256?(m.flags&=-257,R=fg(Error(r(422))),af(d,m,oe,R)):m.memoizedState!==null?(m.child=d.child,m.flags|=128,null):(Z=R.fallback,F=m.mode,R=qp({mode:"visible",children:R.children},F,0,null),Z=qu(Z,F,oe,null),Z.flags|=2,R.return=m,Z.return=m,R.sibling=Z,m.child=R,(m.mode&1)!==0&&ye(m,d.child,null,oe),m.child.memoizedState=Np(oe),m.memoizedState=Rp,Z);if((m.mode&1)===0)return af(d,m,oe,null);if(F.data==="$!"){if(R=F.nextSibling&&F.nextSibling.dataset,R)var Ae=R.dgst;return R=Ae,Z=Error(r(419)),R=fg(Z,R,void 0),af(d,m,oe,R)}if(Ae=(oe&d.childLanes)!==0,Qi||Ae){if(R=Bi,R!==null){switch(oe&-oe){case 4:F=2;break;case 16:F=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:F=32;break;case 536870912:F=268435456;break;default:F=0}F=(F&(R.suspendedLanes|oe))!==0?0:F,F!==0&&F!==Z.retryLane&&(Z.retryLane=F,ut(d,F),Pa(R,d,F,-1))}return Cg(),R=fg(Error(r(421))),af(d,m,oe,R)}return F.data==="$?"?(m.flags|=128,m.child=d.child,m=ux.bind(null,d),F._reactRetry=m,null):(d=Z.treeContext,h=ea(F.nextSibling),a=m,x=!0,T=null,d!==null&&(Ws[Zs++]=ba,Ws[Zs++]=Do,Ws[Zs++]=Ll,ba=d.id,Do=d.overflow,Ll=m),m=jp(m,R.children),m.flags|=4096,m)}function mg(d,m,E){d.lanes|=m;var R=d.alternate;R!==null&&(R.lanes|=m),kt(d.return,m,E)}function gg(d,m,E,R,F){var Z=d.memoizedState;Z===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:R,tail:E,tailMode:F}:(Z.isBackwards=m,Z.rendering=null,Z.renderingStartTime=0,Z.last=R,Z.tail=E,Z.tailMode=F)}function C_(d,m,E){var R=m.pendingProps,F=R.revealOrder,Z=R.tail;if(Vr(d,m,R.children,E),R=Mn.current,(R&2)!==0)R=R&1|2,m.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&mg(d,E,m);else if(d.tag===19)mg(d,E,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}R&=1}if(Kn(Mn,R),(m.mode&1)===0)m.memoizedState=null;else switch(F){case"forwards":for(E=m.child,F=null;E!==null;)d=E.alternate,d!==null&&mr(d)===null&&(F=E),E=E.sibling;E=F,E===null?(F=m.child,m.child=null):(F=E.sibling,E.sibling=null),gg(m,!1,F,E,Z);break;case"backwards":for(E=null,F=m.child,m.child=null;F!==null;){if(d=F.alternate,d!==null&&mr(d)===null){m.child=F;break}d=F.sibling,F.sibling=E,E=F,F=d}gg(m,!0,E,null,Z);break;case"together":gg(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function lf(d,m){(m.mode&1)===0&&d!==null&&(d.alternate=null,m.alternate=null,m.flags|=2)}function rl(d,m,E){if(d!==null&&(m.dependencies=d.dependencies),Qr|=m.lanes,(E&m.childLanes)===0)return null;if(d!==null&&m.child!==d.child)throw Error(r(153));if(m.child!==null){for(d=m.child,E=Gc(d,d.pendingProps),m.child=E,E.return=m;d.sibling!==null;)d=d.sibling,E=E.sibling=Gc(d,d.pendingProps),E.return=m;E.sibling=null}return m.child}function cf(d,m,E){switch(m.tag){case 3:T_(m),ae();break;case 5:Ks(m);break;case 1:fs(m.type)&&ta(m);break;case 4:Li(m,m.stateNode.containerInfo);break;case 10:var R=m.type._context,F=m.memoizedProps.value;Kn(Ne,R._currentValue),R._currentValue=F;break;case 13:if(R=m.memoizedState,R!==null)return R.dehydrated!==null?(Kn(Mn,Mn.current&1),m.flags|=128,null):(E&m.child.childLanes)!==0?zc(d,m,E):(Kn(Mn,Mn.current&1),d=rl(d,m,E),d!==null?d.sibling:null);Kn(Mn,Mn.current&1);break;case 19:if(R=(E&m.childLanes)!==0,(d.flags&128)!==0){if(R)return C_(d,m,E);m.flags|=128}if(F=m.memoizedState,F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),Kn(Mn,Mn.current),R)break;return null;case 22:case 23:return m.lanes=0,Mp(d,m,E)}return rl(d,m,E)}var Dp,uf,Lp,gs;Dp=function(d,m){for(var E=m.child;E!==null;){if(E.tag===5||E.tag===6)d.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===m)break;for(;E.sibling===null;){if(E.return===null||E.return===m)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},uf=function(){},Lp=function(d,m,E,R){var F=d.memoizedProps;if(F!==R){d=m.stateNode,ir(Wn.current);var Z=null;switch(E){case"input":F=vr(d,F),R=vr(d,R),Z=[];break;case"select":F=st({},F,{value:void 0}),R=st({},R,{value:void 0}),Z=[];break;case"textarea":F=cs(d,F),R=cs(d,R),Z=[];break;default:typeof F.onClick!="function"&&typeof R.onClick=="function"&&(d.onclick=Cc)}si(E,R);var oe;E=null;for(ot in F)if(!R.hasOwnProperty(ot)&&F.hasOwnProperty(ot)&&F[ot]!=null)if(ot==="style"){var Ae=F[ot];for(oe in Ae)Ae.hasOwnProperty(oe)&&(E||(E={}),E[oe]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(u.hasOwnProperty(ot)?Z||(Z=[]):(Z=Z||[]).push(ot,null));for(ot in R){var Fe=R[ot];if(Ae=F?.[ot],R.hasOwnProperty(ot)&&Fe!==Ae&&(Fe!=null||Ae!=null))if(ot==="style")if(Ae){for(oe in Ae)!Ae.hasOwnProperty(oe)||Fe&&Fe.hasOwnProperty(oe)||(E||(E={}),E[oe]="");for(oe in Fe)Fe.hasOwnProperty(oe)&&Ae[oe]!==Fe[oe]&&(E||(E={}),E[oe]=Fe[oe])}else E||(Z||(Z=[]),Z.push(ot,E)),E=Fe;else ot==="dangerouslySetInnerHTML"?(Fe=Fe?Fe.__html:void 0,Ae=Ae?Ae.__html:void 0,Fe!=null&&Ae!==Fe&&(Z=Z||[]).push(ot,Fe)):ot==="children"?typeof Fe!="string"&&typeof Fe!="number"||(Z=Z||[]).push(ot,""+Fe):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(u.hasOwnProperty(ot)?(Fe!=null&&ot==="onScroll"&&yr("scroll",d),Z||Ae===Fe||(Z=[])):(Z=Z||[]).push(ot,Fe))}E&&(Z=Z||[]).push("style",E);var ot=Z;(m.updateQueue=ot)&&(m.flags|=4)}},gs=function(d,m,E,R){E!==R&&(m.flags|=4)};function zu(d,m){if(!x)switch(d.tailMode){case"hidden":m=d.tail;for(var E=null;m!==null;)m.alternate!==null&&(E=m),m=m.sibling;E===null?d.tail=null:E.sibling=null;break;case"collapsed":E=d.tail;for(var R=null;E!==null;)E.alternate!==null&&(R=E),E=E.sibling;R===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:R.sibling=null}}function ys(d){var m=d.alternate!==null&&d.alternate.child===d.child,E=0,R=0;if(m)for(var F=d.child;F!==null;)E|=F.lanes|F.childLanes,R|=F.subtreeFlags&14680064,R|=F.flags&14680064,F.return=d,F=F.sibling;else for(F=d.child;F!==null;)E|=F.lanes|F.childLanes,R|=F.subtreeFlags,R|=F.flags,F.return=d,F=F.sibling;return d.subtreeFlags|=R,d.childLanes=E,m}function il(d,m,E){var R=m.pendingProps;switch(y(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ys(m),null;case 1:return fs(m.type)&&kd(),ys(m),null;case 3:return R=m.stateNode,qr(),Lr(js),Lr(Gi),Wr(),R.pendingContext&&(R.context=R.pendingContext,R.pendingContext=null),(d===null||d.child===null)&&(G(m)?m.flags|=4:d===null||d.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,T!==null&&(Ul(T),T=null))),uf(d,m),ys(m),null;case 5:_o(m);var F=ir(cr.current);if(E=m.type,d!==null&&m.stateNode!=null)Lp(d,m,E,R,F),d.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!R){if(m.stateNode===null)throw Error(r(166));return ys(m),null}if(d=ir(Wn.current),G(m)){R=m.stateNode,E=m.type;var Z=m.memoizedProps;switch(R[Rs]=m,R[xa]=Z,d=(m.mode&1)!==0,E){case"dialog":yr("cancel",R),yr("close",R);break;case"iframe":case"object":case"embed":yr("load",R);break;case"video":case"audio":for(F=0;F<qs.length;F++)yr(qs[F],R);break;case"source":yr("error",R);break;case"img":case"image":case"link":yr("error",R),yr("load",R);break;case"details":yr("toggle",R);break;case"input":Es(R,Z),yr("invalid",R);break;case"select":R._wrapperState={wasMultiple:!!Z.multiple},yr("invalid",R);break;case"textarea":Ki(R,Z),yr("invalid",R)}si(E,Z),F=null;for(var oe in Z)if(Z.hasOwnProperty(oe)){var Ae=Z[oe];oe==="children"?typeof Ae=="string"?R.textContent!==Ae&&(Z.suppressHydrationWarning!==!0&&Il(R.textContent,Ae,d),F=["children",Ae]):typeof Ae=="number"&&R.textContent!==""+Ae&&(Z.suppressHydrationWarning!==!0&&Il(R.textContent,Ae,d),F=["children",""+Ae]):u.hasOwnProperty(oe)&&Ae!=null&&oe==="onScroll"&&yr("scroll",R)}switch(E){case"input":Rn(R),io(R,Z,!0);break;case"textarea":Rn(R),Cs(R);break;case"select":case"option":break;default:typeof Z.onClick=="function"&&(R.onclick=Cc)}R=F,m.updateQueue=R,R!==null&&(m.flags|=4)}else{oe=F.nodeType===9?F:F.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Gr(E)),d==="http://www.w3.org/1999/xhtml"?E==="script"?(d=oe.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof R.is=="string"?d=oe.createElement(E,{is:R.is}):(d=oe.createElement(E),E==="select"&&(oe=d,R.multiple?oe.multiple=!0:R.size&&(oe.size=R.size))):d=oe.createElementNS(d,E),d[Rs]=m,d[xa]=R,Dp(d,m,!1,!1),m.stateNode=d;e:{switch(oe=Fs(E,R),E){case"dialog":yr("cancel",d),yr("close",d),F=R;break;case"iframe":case"object":case"embed":yr("load",d),F=R;break;case"video":case"audio":for(F=0;F<qs.length;F++)yr(qs[F],d);F=R;break;case"source":yr("error",d),F=R;break;case"img":case"image":case"link":yr("error",d),yr("load",d),F=R;break;case"details":yr("toggle",d),F=R;break;case"input":Es(d,R),F=vr(d,R),yr("invalid",d);break;case"option":F=R;break;case"select":d._wrapperState={wasMultiple:!!R.multiple},F=st({},R,{value:void 0}),yr("invalid",d);break;case"textarea":Ki(d,R),F=cs(d,R),yr("invalid",d);break;default:F=R}si(E,F),Ae=F;for(Z in Ae)if(Ae.hasOwnProperty(Z)){var Fe=Ae[Z];Z==="style"?Ii(d,Fe):Z==="dangerouslySetInnerHTML"?(Fe=Fe?Fe.__html:void 0,Fe!=null&&Bs(d,Fe)):Z==="children"?typeof Fe=="string"?(E!=="textarea"||Fe!=="")&&Xi(d,Fe):typeof Fe=="number"&&Xi(d,""+Fe):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(u.hasOwnProperty(Z)?Fe!=null&&Z==="onScroll"&&yr("scroll",d):Fe!=null&&Y(d,Z,Fe,oe))}switch(E){case"input":Rn(d),io(d,R,!1);break;case"textarea":Rn(d),Cs(d);break;case"option":R.value!=null&&d.setAttribute("value",""+Nt(R.value));break;case"select":d.multiple=!!R.multiple,Z=R.value,Z!=null?ii(d,!!R.multiple,Z,!1):R.defaultValue!=null&&ii(d,!!R.multiple,R.defaultValue,!0);break;default:typeof F.onClick=="function"&&(d.onclick=Cc)}switch(E){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}}R&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return ys(m),null;case 6:if(d&&m.stateNode!=null)gs(d,m,d.memoizedProps,R);else{if(typeof R!="string"&&m.stateNode===null)throw Error(r(166));if(E=ir(cr.current),ir(Wn.current),G(m)){if(R=m.stateNode,E=m.memoizedProps,R[Rs]=m,(Z=R.nodeValue!==E)&&(d=a,d!==null))switch(d.tag){case 3:Il(R.nodeValue,E,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Il(R.nodeValue,E,(d.mode&1)!==0)}Z&&(m.flags|=4)}else R=(E.nodeType===9?E:E.ownerDocument).createTextNode(R),R[Rs]=m,m.stateNode=R}return ys(m),null;case 13:if(Lr(Mn),R=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(x&&h!==null&&(m.mode&1)!==0&&(m.flags&128)===0)ee(),ae(),m.flags|=98560,Z=!1;else if(Z=G(m),R!==null&&R.dehydrated!==null){if(d===null){if(!Z)throw Error(r(318));if(Z=m.memoizedState,Z=Z!==null?Z.dehydrated:null,!Z)throw Error(r(317));Z[Rs]=m}else ae(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ys(m),Z=!1}else T!==null&&(Ul(T),T=null),Z=!0;if(!Z)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=E,m):(R=R!==null,R!==(d!==null&&d.memoizedState!==null)&&R&&(m.child.flags|=8192,(m.mode&1)!==0&&(d===null||(Mn.current&1)!==0?ur===0&&(ur=3):Cg())),m.updateQueue!==null&&(m.flags|=4),ys(m),null);case 4:return qr(),uf(d,m),d===null&&_a(m.stateNode.containerInfo),ys(m),null;case 10:return Ye(m.type._context),ys(m),null;case 17:return fs(m.type)&&kd(),ys(m),null;case 19:if(Lr(Mn),Z=m.memoizedState,Z===null)return ys(m),null;if(R=(m.flags&128)!==0,oe=Z.rendering,oe===null)if(R)zu(Z,!1);else{if(ur!==0||d!==null&&(d.flags&128)!==0)for(d=m.child;d!==null;){if(oe=mr(d),oe!==null){for(m.flags|=128,zu(Z,!1),R=oe.updateQueue,R!==null&&(m.updateQueue=R,m.flags|=4),m.subtreeFlags=0,R=E,E=m.child;E!==null;)Z=E,d=R,Z.flags&=14680066,oe=Z.alternate,oe===null?(Z.childLanes=0,Z.lanes=d,Z.child=null,Z.subtreeFlags=0,Z.memoizedProps=null,Z.memoizedState=null,Z.updateQueue=null,Z.dependencies=null,Z.stateNode=null):(Z.childLanes=oe.childLanes,Z.lanes=oe.lanes,Z.child=oe.child,Z.subtreeFlags=0,Z.deletions=null,Z.memoizedProps=oe.memoizedProps,Z.memoizedState=oe.memoizedState,Z.updateQueue=oe.updateQueue,Z.type=oe.type,d=oe.dependencies,Z.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),E=E.sibling;return Kn(Mn,Mn.current&1|2),m.child}d=d.sibling}Z.tail!==null&&Hr()>Bd&&(m.flags|=128,R=!0,zu(Z,!1),m.lanes=4194304)}else{if(!R)if(d=mr(oe),d!==null){if(m.flags|=128,R=!0,E=d.updateQueue,E!==null&&(m.updateQueue=E,m.flags|=4),zu(Z,!0),Z.tail===null&&Z.tailMode==="hidden"&&!oe.alternate&&!x)return ys(m),null}else 2*Hr()-Z.renderingStartTime>Bd&&E!==1073741824&&(m.flags|=128,R=!0,zu(Z,!1),m.lanes=4194304);Z.isBackwards?(oe.sibling=m.child,m.child=oe):(E=Z.last,E!==null?E.sibling=oe:m.child=oe,Z.last=oe)}return Z.tail!==null?(m=Z.tail,Z.rendering=m,Z.tail=m.sibling,Z.renderingStartTime=Hr(),m.sibling=null,E=Mn.current,Kn(Mn,R?E&1|2:E&1),m):(ys(m),null);case 22:case 23:return $p(),R=m.memoizedState!==null,d!==null&&d.memoizedState!==null!==R&&(m.flags|=8192),R&&(m.mode&1)!==0?(ci&1073741824)!==0&&(ys(m),m.subtreeFlags&6&&(m.flags|=8192)):ys(m),null;case 24:return null;case 25:return null}throw Error(r(156,m.tag))}function sx(d,m){switch(y(m),m.tag){case 1:return fs(m.type)&&kd(),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return qr(),Lr(js),Lr(Gi),Wr(),d=m.flags,(d&65536)!==0&&(d&128)===0?(m.flags=d&-65537|128,m):null;case 5:return _o(m),null;case 13:if(Lr(Mn),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(r(340));ae()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return Lr(Mn),null;case 4:return qr(),null;case 10:return Ye(m.type._context),null;case 22:case 23:return $p(),null;case 24:return null;default:return null}}var sl=!1,zi=!1,ia=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function jd(d,m){var E=d.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(R){yi(d,m,R)}else E.current=null}function Dd(d,m,E){try{E()}catch(R){yi(d,m,R)}}var yg=!1;function ox(d,m){if(kc=uc,d=_p(),Kh(d)){if("selectionStart"in d)var E={start:d.selectionStart,end:d.selectionEnd};else e:{E=(E=d.ownerDocument)&&E.defaultView||window;var R=E.getSelection&&E.getSelection();if(R&&R.rangeCount!==0){E=R.anchorNode;var F=R.anchorOffset,Z=R.focusNode;R=R.focusOffset;try{E.nodeType,Z.nodeType}catch{E=null;break e}var oe=0,Ae=-1,Fe=-1,ot=0,Ot=0,zt=d,It=null;t:for(;;){for(var on;zt!==E||F!==0&&zt.nodeType!==3||(Ae=oe+F),zt!==Z||R!==0&&zt.nodeType!==3||(Fe=oe+R),zt.nodeType===3&&(oe+=zt.nodeValue.length),(on=zt.firstChild)!==null;)It=zt,zt=on;for(;;){if(zt===d)break t;if(It===E&&++ot===F&&(Ae=oe),It===Z&&++Ot===R&&(Fe=oe),(on=zt.nextSibling)!==null)break;zt=It,It=zt.parentNode}zt=on}E=Ae===-1||Fe===-1?null:{start:Ae,end:Fe}}else E=null}E=E||{start:0,end:0}}else E=null;for(bd={focusedElem:d,selectionRange:E},uc=!1,Qt=m;Qt!==null;)if(m=Qt,d=m.child,(m.subtreeFlags&1028)!==0&&d!==null)d.return=m,Qt=d;else for(;Qt!==null;){m=Qt;try{var pn=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(pn!==null){var mn=pn.memoizedProps,_i=pn.memoizedState,tt=m.stateNode,He=tt.getSnapshotBeforeUpdate(m.elementType===m.type?mn:Oo(m.type,mn),_i);tt.__reactInternalSnapshotBeforeUpdate=He}break;case 3:var rt=m.stateNode.containerInfo;rt.nodeType===1?rt.textContent="":rt.nodeType===9&&rt.documentElement&&rt.removeChild(rt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch($t){yi(m,m.return,$t)}if(d=m.sibling,d!==null){d.return=m.return,Qt=d;break}Qt=m.return}return pn=yg,yg=!1,pn}function Bu(d,m,E){var R=m.updateQueue;if(R=R!==null?R.lastEffect:null,R!==null){var F=R=R.next;do{if((F.tag&d)===d){var Z=F.destroy;F.destroy=void 0,Z!==void 0&&Dd(m,E,Z)}F=F.next}while(F!==R)}}function Fo(d,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var E=m=m.next;do{if((E.tag&d)===d){var R=E.create;E.destroy=R()}E=E.next}while(E!==m)}}function Vl(d){var m=d.ref;if(m!==null){var E=d.stateNode;d.tag,d=E,typeof m=="function"?m(d):m.current=d}}function _g(d){var m=d.alternate;m!==null&&(d.alternate=null,_g(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&(delete m[Rs],delete m[xa],delete m[Sd],delete m[Jh],delete m[Tp])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function vg(d){return d.tag===5||d.tag===3||d.tag===4}function k_(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||vg(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Ld(d,m,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,m?E.nodeType===8?E.parentNode.insertBefore(d,m):E.insertBefore(d,m):(E.nodeType===8?(m=E.parentNode,m.insertBefore(d,E)):(m=E,m.appendChild(d)),E=E._reactRootContainer,E!=null||m.onclick!==null||(m.onclick=Cc));else if(R!==4&&(d=d.child,d!==null))for(Ld(d,m,E),d=d.sibling;d!==null;)Ld(d,m,E),d=d.sibling}function df(d,m,E){var R=d.tag;if(R===5||R===6)d=d.stateNode,m?E.insertBefore(d,m):E.appendChild(d);else if(R!==4&&(d=d.child,d!==null))for(df(d,m,E),d=d.sibling;d!==null;)df(d,m,E),d=d.sibling}var gi=null,Ds=!1;function sa(d,m,E){for(E=E.child;E!==null;)hf(d,m,E),E=E.sibling}function hf(d,m,E){if(ks&&typeof ks.onCommitFiberUnmount=="function")try{ks.onCommitFiberUnmount(lo,E)}catch{}switch(E.tag){case 5:zi||jd(E,m);case 6:var R=gi,F=Ds;gi=null,sa(d,m,E),gi=R,Ds=F,gi!==null&&(Ds?(d=gi,E=E.stateNode,d.nodeType===8?d.parentNode.removeChild(E):d.removeChild(E)):gi.removeChild(E.stateNode));break;case 18:gi!==null&&(Ds?(d=gi,E=E.stateNode,d.nodeType===8?Mu(d.parentNode,E):d.nodeType===1&&Mu(d,E),Io(d)):Mu(gi,E.stateNode));break;case 4:R=gi,F=Ds,gi=E.stateNode.containerInfo,Ds=!0,sa(d,m,E),gi=R,Ds=F;break;case 0:case 11:case 14:case 15:if(!zi&&(R=E.updateQueue,R!==null&&(R=R.lastEffect,R!==null))){F=R=R.next;do{var Z=F,oe=Z.destroy;Z=Z.tag,oe!==void 0&&((Z&2)!==0||(Z&4)!==0)&&Dd(E,m,oe),F=F.next}while(F!==R)}sa(d,m,E);break;case 1:if(!zi&&(jd(E,m),R=E.stateNode,typeof R.componentWillUnmount=="function"))try{R.props=E.memoizedProps,R.state=E.memoizedState,R.componentWillUnmount()}catch(Ae){yi(E,m,Ae)}sa(d,m,E);break;case 21:sa(d,m,E);break;case 22:E.mode&1?(zi=(R=zi)||E.memoizedState!==null,sa(d,m,E),zi=R):sa(d,m,E);break;default:sa(d,m,E)}}function xg(d){var m=d.updateQueue;if(m!==null){d.updateQueue=null;var E=d.stateNode;E===null&&(E=d.stateNode=new ia),m.forEach(function(R){var F=dx.bind(null,d,R);E.has(R)||(E.add(R),R.then(F,F))})}}function Xs(d,m){var E=m.deletions;if(E!==null)for(var R=0;R<E.length;R++){var F=E[R];try{var Z=d,oe=m,Ae=oe;e:for(;Ae!==null;){switch(Ae.tag){case 5:gi=Ae.stateNode,Ds=!1;break e;case 3:gi=Ae.stateNode.containerInfo,Ds=!0;break e;case 4:gi=Ae.stateNode.containerInfo,Ds=!0;break e}Ae=Ae.return}if(gi===null)throw Error(r(160));hf(Z,oe,F),gi=null,Ds=!1;var Fe=F.alternate;Fe!==null&&(Fe.return=null),F.return=null}catch(ot){yi(F,m,ot)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)Op(m,d),m=m.sibling}function Op(d,m){var E=d.alternate,R=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Xs(m,d),Ca(d),R&4){try{Bu(3,d,d.return),Fo(3,d)}catch(mn){yi(d,d.return,mn)}try{Bu(5,d,d.return)}catch(mn){yi(d,d.return,mn)}}break;case 1:Xs(m,d),Ca(d),R&512&&E!==null&&jd(E,E.return);break;case 5:if(Xs(m,d),Ca(d),R&512&&E!==null&&jd(E,E.return),d.flags&32){var F=d.stateNode;try{Xi(F,"")}catch(mn){yi(d,d.return,mn)}}if(R&4&&(F=d.stateNode,F!=null)){var Z=d.memoizedProps,oe=E!==null?E.memoizedProps:Z,Ae=d.type,Fe=d.updateQueue;if(d.updateQueue=null,Fe!==null)try{Ae==="input"&&Z.type==="radio"&&Z.name!=null&&Jn(F,Z),Fs(Ae,oe);var ot=Fs(Ae,Z);for(oe=0;oe<Fe.length;oe+=2){var Ot=Fe[oe],zt=Fe[oe+1];Ot==="style"?Ii(F,zt):Ot==="dangerouslySetInnerHTML"?Bs(F,zt):Ot==="children"?Xi(F,zt):Y(F,Ot,zt,ot)}switch(Ae){case"input":Ar(F,Z);break;case"textarea":zs(F,Z);break;case"select":var It=F._wrapperState.wasMultiple;F._wrapperState.wasMultiple=!!Z.multiple;var on=Z.value;on!=null?ii(F,!!Z.multiple,on,!1):It!==!!Z.multiple&&(Z.defaultValue!=null?ii(F,!!Z.multiple,Z.defaultValue,!0):ii(F,!!Z.multiple,Z.multiple?[]:"",!1))}F[xa]=Z}catch(mn){yi(d,d.return,mn)}}break;case 6:if(Xs(m,d),Ca(d),R&4){if(d.stateNode===null)throw Error(r(162));F=d.stateNode,Z=d.memoizedProps;try{F.nodeValue=Z}catch(mn){yi(d,d.return,mn)}}break;case 3:if(Xs(m,d),Ca(d),R&4&&E!==null&&E.memoizedState.isDehydrated)try{Io(m.containerInfo)}catch(mn){yi(d,d.return,mn)}break;case 4:Xs(m,d),Ca(d);break;case 13:Xs(m,d),Ca(d),F=d.child,F.flags&8192&&(Z=F.memoizedState!==null,F.stateNode.isHidden=Z,!Z||F.alternate!==null&&F.alternate.memoizedState!==null||(pf=Hr())),R&4&&xg(d);break;case 22:if(Ot=E!==null&&E.memoizedState!==null,d.mode&1?(zi=(ot=zi)||Ot,Xs(m,d),zi=ot):Xs(m,d),Ca(d),R&8192){if(ot=d.memoizedState!==null,(d.stateNode.isHidden=ot)&&!Ot&&(d.mode&1)!==0)for(Qt=d,Ot=d.child;Ot!==null;){for(zt=Qt=Ot;Qt!==null;){switch(It=Qt,on=It.child,It.tag){case 0:case 11:case 14:case 15:Bu(4,It,It.return);break;case 1:jd(It,It.return);var pn=It.stateNode;if(typeof pn.componentWillUnmount=="function"){R=It,E=It.return;try{m=R,pn.props=m.memoizedProps,pn.state=m.memoizedState,pn.componentWillUnmount()}catch(mn){yi(R,E,mn)}}break;case 5:jd(It,It.return);break;case 22:if(It.memoizedState!==null){bg(zt);continue}}on!==null?(on.return=It,Qt=on):bg(zt)}Ot=Ot.sibling}e:for(Ot=null,zt=d;;){if(zt.tag===5){if(Ot===null){Ot=zt;try{F=zt.stateNode,ot?(Z=F.style,typeof Z.setProperty=="function"?Z.setProperty("display","none","important"):Z.display="none"):(Ae=zt.stateNode,Fe=zt.memoizedProps.style,oe=Fe!=null&&Fe.hasOwnProperty("display")?Fe.display:null,Ae.style.display=so("display",oe))}catch(mn){yi(d,d.return,mn)}}}else if(zt.tag===6){if(Ot===null)try{zt.stateNode.nodeValue=ot?"":zt.memoizedProps}catch(mn){yi(d,d.return,mn)}}else if((zt.tag!==22&&zt.tag!==23||zt.memoizedState===null||zt===d)&&zt.child!==null){zt.child.return=zt,zt=zt.child;continue}if(zt===d)break e;for(;zt.sibling===null;){if(zt.return===null||zt.return===d)break e;Ot===zt&&(Ot=null),zt=zt.return}Ot===zt&&(Ot=null),zt.sibling.return=zt.return,zt=zt.sibling}}break;case 19:Xs(m,d),Ca(d),R&4&&xg(d);break;case 21:break;default:Xs(m,d),Ca(d)}}function Ca(d){var m=d.flags;if(m&2){try{e:{for(var E=d.return;E!==null;){if(vg(E)){var R=E;break e}E=E.return}throw Error(r(160))}switch(R.tag){case 5:var F=R.stateNode;R.flags&32&&(Xi(F,""),R.flags&=-33);var Z=k_(d);df(d,Z,F);break;case 3:case 4:var oe=R.stateNode.containerInfo,Ae=k_(d);Ld(d,Ae,oe);break;default:throw Error(r(161))}}catch(Fe){yi(d,d.return,Fe)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function Od(d,m,E){Qt=d,wg(d)}function wg(d,m,E){for(var R=(d.mode&1)!==0;Qt!==null;){var F=Qt,Z=F.child;if(F.tag===22&&R){var oe=F.memoizedState!==null||sl;if(!oe){var Ae=F.alternate,Fe=Ae!==null&&Ae.memoizedState!==null||zi;Ae=sl;var ot=zi;if(sl=oe,(zi=Fe)&&!ot)for(Qt=F;Qt!==null;)oe=Qt,Fe=oe.child,oe.tag===22&&oe.memoizedState!==null?A_(F):Fe!==null?(Fe.return=oe,Qt=Fe):A_(F);for(;Z!==null;)Qt=Z,wg(Z),Z=Z.sibling;Qt=F,sl=Ae,zi=ot}zp(d)}else(F.subtreeFlags&8772)!==0&&Z!==null?(Z.return=F,Qt=Z):zp(d)}}function zp(d){for(;Qt!==null;){var m=Qt;if((m.flags&8772)!==0){var E=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:zi||Fo(5,m);break;case 1:var R=m.stateNode;if(m.flags&4&&!zi)if(E===null)R.componentDidMount();else{var F=m.elementType===m.type?E.memoizedProps:Oo(m.type,E.memoizedProps);R.componentDidUpdate(F,E.memoizedState,R.__reactInternalSnapshotBeforeUpdate)}var Z=m.updateQueue;Z!==null&&Gn(m,Z,R);break;case 3:var oe=m.updateQueue;if(oe!==null){if(E=null,m.child!==null)switch(m.child.tag){case 5:E=m.child.stateNode;break;case 1:E=m.child.stateNode}Gn(m,oe,E)}break;case 5:var Ae=m.stateNode;if(E===null&&m.flags&4){E=Ae;var Fe=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Fe.autoFocus&&E.focus();break;case"img":Fe.src&&(E.src=Fe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ot=m.alternate;if(ot!==null){var Ot=ot.memoizedState;if(Ot!==null){var zt=Ot.dehydrated;zt!==null&&Io(zt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}zi||m.flags&512&&Vl(m)}catch(It){yi(m,m.return,It)}}if(m===d){Qt=null;break}if(E=m.sibling,E!==null){E.return=m.return,Qt=E;break}Qt=m.return}}function bg(d){for(;Qt!==null;){var m=Qt;if(m===d){Qt=null;break}var E=m.sibling;if(E!==null){E.return=m.return,Qt=E;break}Qt=m.return}}function A_(d){for(;Qt!==null;){var m=Qt;try{switch(m.tag){case 0:case 11:case 15:var E=m.return;try{Fo(4,m)}catch(Fe){yi(m,E,Fe)}break;case 1:var R=m.stateNode;if(typeof R.componentDidMount=="function"){var F=m.return;try{R.componentDidMount()}catch(Fe){yi(m,F,Fe)}}var Z=m.return;try{Vl(m)}catch(Fe){yi(m,Z,Fe)}break;case 5:var oe=m.return;try{Vl(m)}catch(Fe){yi(m,oe,Fe)}}}catch(Fe){yi(m,m.return,Fe)}if(m===d){Qt=null;break}var Ae=m.sibling;if(Ae!==null){Ae.return=m.return,Qt=Ae;break}Qt=m.return}}var ax=Math.ceil,Bc=ie.ReactCurrentDispatcher,Bp=ie.ReactCurrentOwner,qi=ie.ReactCurrentBatchConfig,fn=0,Bi=null,Mr=null,$r=0,ci=0,es=wa(0),ur=0,zd=null,Qr=0,ff=0,Fc=0,Fu=null,Ys=null,pf=0,Bd=1/0,ka=null,mf=!1,Tg=null,Ls=null,ol=!1,Aa=null,Vu=0,Uu=0,Fp=null,Vp=-1,gf=0;function Js(){return(fn&6)!==0?Hr():Vp!==-1?Vp:Vp=Hr()}function al(d){return(d.mode&1)===0?1:(fn&2)!==0&&$r!==0?$r&-$r:fe.transition!==null?(gf===0&&(gf=As()),gf):(d=or,d!==0||(d=window.event,d=d===void 0?16:cd(d.type)),d)}function Pa(d,m,E,R){if(50<Uu)throw Uu=0,Fp=null,Error(r(185));jn(d,E,R),((fn&2)===0||d!==Bi)&&(d===Bi&&((fn&2)===0&&(ff|=E),ur===4&&Vc(d,$r)),Os(d,R),E===1&&fn===0&&(m.mode&1)===0&&(Bd=Hr()+500,Ic&&Bt()))}function Os(d,m){var E=d.callbackNode;Zn(d,m);var R=fa(d,d===Bi?$r:0);if(R===0)E!==null&&sr(E),d.callbackNode=null,d.callbackPriority=0;else if(m=R&-R,d.callbackPriority!==m){if(E!=null&&sr(E),m===1)d.tag===0?Dl($u.bind(null,d)):jl($u.bind(null,d)),bp(function(){(fn&6)===0&&Bt()}),E=null;else{switch(Gs(R)){case 1:E=ao;break;case 4:E=Wo;break;case 16:E=sc;break;case 536870912:E=za;break;default:E=sc}E=_f(E,Sg.bind(null,d))}d.callbackPriority=m,d.callbackNode=E}}function Sg(d,m){if(Vp=-1,gf=0,(fn&6)!==0)throw Error(r(327));var E=d.callbackNode;if(bo()&&d.callbackNode!==E)return null;var R=fa(d,d===Bi?$r:0);if(R===0)return null;if((R&30)!==0||(R&d.expiredLanes)!==0||m)m=yf(d,R);else{m=R;var F=fn;fn|=2;var Z=Eg();(Bi!==d||$r!==m)&&(ka=null,Bd=Hr()+500,Gu(d,m));do try{cx();break}catch(Ae){M_(d,Ae)}while(!0);$e(),Bc.current=Z,fn=F,Mr!==null?m=0:(Bi=null,$r=0,m=ur)}if(m!==0){if(m===2&&(F=$n(d),F!==0&&(R=F,m=Up(d,F))),m===1)throw E=zd,Gu(d,0),Vc(d,R),Os(d,Hr()),E;if(m===6)Vc(d,R);else{if(F=d.current.alternate,(R&30)===0&&!P_(F)&&(m=yf(d,R),m===2&&(Z=$n(d),Z!==0&&(R=Z,m=Up(d,Z))),m===1))throw E=zd,Gu(d,0),Vc(d,R),Os(d,Hr()),E;switch(d.finishedWork=F,d.finishedLanes=R,m){case 0:case 1:throw Error(r(345));case 2:$c(d,Ys,ka);break;case 3:if(Vc(d,R),(R&130023424)===R&&(m=pf+500-Hr(),10<m)){if(fa(d,0)!==0)break;if(F=d.suspendedLanes,(F&R)!==R){Js(),d.pingedLanes|=d.suspendedLanes&F;break}d.timeoutHandle=Za($c.bind(null,d,Ys,ka),m);break}$c(d,Ys,ka);break;case 4:if(Vc(d,R),(R&4194240)===R)break;for(m=d.eventTimes,F=-1;0<R;){var oe=31-Si(R);Z=1<<oe,oe=m[oe],oe>F&&(F=oe),R&=~Z}if(R=F,R=Hr()-R,R=(120>R?120:480>R?480:1080>R?1080:1920>R?1920:3e3>R?3e3:4320>R?4320:1960*ax(R/1960))-R,10<R){d.timeoutHandle=Za($c.bind(null,d,Ys,ka),R);break}$c(d,Ys,ka);break;case 5:$c(d,Ys,ka);break;default:throw Error(r(329))}}}return Os(d,Hr()),d.callbackNode===E?Sg.bind(null,d):null}function Up(d,m){var E=Fu;return d.current.memoizedState.isDehydrated&&(Gu(d,m).flags|=256),d=yf(d,m),d!==2&&(m=Ys,Ys=E,m!==null&&Ul(m)),d}function Ul(d){Ys===null?Ys=d:Ys.push.apply(Ys,d)}function P_(d){for(var m=d;;){if(m.flags&16384){var E=m.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var R=0;R<E.length;R++){var F=E[R],Z=F.getSnapshot;F=F.value;try{if(!mo(Z(),F))return!1}catch{return!1}}}if(E=m.child,m.subtreeFlags&16384&&E!==null)E.return=m,m=E;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Vc(d,m){for(m&=~Fc,m&=~ff,d.suspendedLanes|=m,d.pingedLanes&=~m,d=d.expirationTimes;0<m;){var E=31-Si(m),R=1<<E;d[E]=-1,m&=~R}}function $u(d){if((fn&6)!==0)throw Error(r(327));bo();var m=fa(d,0);if((m&1)===0)return Os(d,Hr()),null;var E=yf(d,m);if(d.tag!==0&&E===2){var R=$n(d);R!==0&&(m=R,E=Up(d,R))}if(E===1)throw E=zd,Gu(d,0),Vc(d,m),Os(d,Hr()),E;if(E===6)throw Error(r(345));return d.finishedWork=d.current.alternate,d.finishedLanes=m,$c(d,Ys,ka),Os(d,Hr()),null}function Fd(d,m){var E=fn;fn|=1;try{return d(m)}finally{fn=E,fn===0&&(Bd=Hr()+500,Ic&&Bt())}}function Uc(d){Aa!==null&&Aa.tag===0&&(fn&6)===0&&bo();var m=fn;fn|=1;var E=qi.transition,R=or;try{if(qi.transition=null,or=1,d)return d()}finally{or=R,qi.transition=E,fn=m,(fn&6)===0&&Bt()}}function $p(){ci=es.current,Lr(es)}function Gu(d,m){d.finishedWork=null,d.finishedLanes=0;var E=d.timeoutHandle;if(E!==-1&&(d.timeoutHandle=-1,Yh(E)),Mr!==null)for(E=Mr.return;E!==null;){var R=E;switch(y(R),R.tag){case 1:R=R.type.childContextTypes,R!=null&&kd();break;case 3:qr(),Lr(js),Lr(Gi),Wr();break;case 5:_o(R);break;case 4:qr();break;case 13:Lr(Mn);break;case 19:Lr(Mn);break;case 10:Ye(R.type._context);break;case 22:case 23:$p()}E=E.return}if(Bi=d,Mr=d=Gc(d.current,null),$r=ci=m,ur=0,zd=null,Fc=ff=Qr=0,Ys=Fu=null,Qe!==null){for(m=0;m<Qe.length;m++)if(E=Qe[m],R=E.interleaved,R!==null){E.interleaved=null;var F=R.next,Z=E.pending;if(Z!==null){var oe=Z.next;Z.next=F,R.next=oe}E.pending=R}Qe=null}return d}function M_(d,m){do{var E=Mr;try{if($e(),Oi.current=ps,vo){for(var R=Or.memoizedState;R!==null;){var F=R.queue;F!==null&&(F.pending=null),R=R.next}vo=!1}if(pi=0,Jr=Fr=Or=null,xo=!1,Lo=0,Bp.current=null,E===null||E.return===null){ur=1,zd=m,Mr=null;break}e:{var Z=d,oe=E.return,Ae=E,Fe=m;if(m=$r,Ae.flags|=32768,Fe!==null&&typeof Fe=="object"&&typeof Fe.then=="function"){var ot=Fe,Ot=Ae,zt=Ot.tag;if((Ot.mode&1)===0&&(zt===0||zt===11||zt===15)){var It=Ot.alternate;It?(Ot.updateQueue=It.updateQueue,Ot.memoizedState=It.memoizedState,Ot.lanes=It.lanes):(Ot.updateQueue=null,Ot.memoizedState=null)}var on=Pp(oe);if(on!==null){on.flags&=-257,pg(on,oe,Ae,Z,m),on.mode&1&&nl(Z,ot,m),m=on,Fe=ot;var pn=m.updateQueue;if(pn===null){var mn=new Set;mn.add(Fe),m.updateQueue=mn}else pn.add(Fe);break e}else{if((m&1)===0){nl(Z,ot,m),Cg();break e}Fe=Error(r(426))}}else if(x&&Ae.mode&1){var _i=Pp(oe);if(_i!==null){(_i.flags&65536)===0&&(_i.flags|=256),pg(_i,oe,Ae,Z,m),ue(Lu(Fe,Ae));break e}}Z=Fe=Lu(Fe,Ae),ur!==4&&(ur=2),Fu===null?Fu=[Z]:Fu.push(Z),Z=oe;do{switch(Z.tag){case 3:Z.flags|=65536,m&=-m,Z.lanes|=m;var tt=Id(Z,Fe,m);hn(Z,tt);break e;case 1:Ae=Fe;var He=Z.type,rt=Z.stateNode;if((Z.flags&128)===0&&(typeof He.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(Ls===null||!Ls.has(rt)))){Z.flags|=65536,m&=-m,Z.lanes|=m;var $t=Ou(Z,Ae,m);hn(Z,$t);break e}}Z=Z.return}while(Z!==null)}Ag(E)}catch(gn){m=gn,Mr===E&&E!==null&&(Mr=E=E.return);continue}break}while(!0)}function Eg(){var d=Bc.current;return Bc.current=ps,d===null?ps:d}function Cg(){(ur===0||ur===3||ur===2)&&(ur=4),Bi===null||(Qr&268435455)===0&&(ff&268435455)===0||Vc(Bi,$r)}function yf(d,m){var E=fn;fn|=2;var R=Eg();(Bi!==d||$r!==m)&&(ka=null,Gu(d,m));do try{lx();break}catch(F){M_(d,F)}while(!0);if($e(),fn=E,Bc.current=R,Mr!==null)throw Error(r(261));return Bi=null,$r=0,ur}function lx(){for(;Mr!==null;)kg(Mr)}function cx(){for(;Mr!==null&&!Eh();)kg(Mr)}function kg(d){var m=Gp(d.alternate,d,ci);d.memoizedProps=d.pendingProps,m===null?Ag(d):Mr=m,Bp.current=null}function Ag(d){var m=d;do{var E=m.alternate;if(d=m.return,(m.flags&32768)===0){if(E=il(E,m,ci),E!==null){Mr=E;return}}else{if(E=sx(E,m),E!==null){E.flags&=32767,Mr=E;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{ur=6,Mr=null;return}}if(m=m.sibling,m!==null){Mr=m;return}Mr=m=d}while(m!==null);ur===0&&(ur=5)}function $c(d,m,E){var R=or,F=qi.transition;try{qi.transition=null,or=1,Pg(d,m,E,R)}finally{qi.transition=F,or=R}return null}function Pg(d,m,E,R){do bo();while(Aa!==null);if((fn&6)!==0)throw Error(r(327));E=d.finishedWork;var F=d.finishedLanes;if(E===null)return null;if(d.finishedWork=null,d.finishedLanes=0,E===d.current)throw Error(r(177));d.callbackNode=null,d.callbackPriority=0;var Z=E.lanes|E.childLanes;if($s(d,Z),d===Bi&&(Mr=Bi=null,$r=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||ol||(ol=!0,_f(sc,function(){return bo(),null})),Z=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||Z){Z=qi.transition,qi.transition=null;var oe=or;or=1;var Ae=fn;fn|=4,Bp.current=null,ox(d,E),Op(E,d),og(bd),uc=!!kc,bd=kc=null,d.current=E,Od(E),lu(),fn=Ae,or=oe,qi.transition=Z}else d.current=E;if(ol&&(ol=!1,Aa=d,Vu=F),Z=d.pendingLanes,Z===0&&(Ls=null),ht(E.stateNode),Os(d,Hr()),m!==null)for(R=d.onRecoverableError,E=0;E<m.length;E++)F=m[E],R(F.value,{componentStack:F.stack,digest:F.digest});if(mf)throw mf=!1,d=Tg,Tg=null,d;return(Vu&1)!==0&&d.tag!==0&&bo(),Z=d.pendingLanes,(Z&1)!==0?d===Fp?Uu++:(Uu=0,Fp=d):Uu=0,Bt(),null}function bo(){if(Aa!==null){var d=Gs(Vu),m=qi.transition,E=or;try{if(qi.transition=null,or=16>d?16:d,Aa===null)var R=!1;else{if(d=Aa,Aa=null,Vu=0,(fn&6)!==0)throw Error(r(331));var F=fn;for(fn|=4,Qt=d.current;Qt!==null;){var Z=Qt,oe=Z.child;if((Qt.flags&16)!==0){var Ae=Z.deletions;if(Ae!==null){for(var Fe=0;Fe<Ae.length;Fe++){var ot=Ae[Fe];for(Qt=ot;Qt!==null;){var Ot=Qt;switch(Ot.tag){case 0:case 11:case 15:Bu(8,Ot,Z)}var zt=Ot.child;if(zt!==null)zt.return=Ot,Qt=zt;else for(;Qt!==null;){Ot=Qt;var It=Ot.sibling,on=Ot.return;if(_g(Ot),Ot===ot){Qt=null;break}if(It!==null){It.return=on,Qt=It;break}Qt=on}}}var pn=Z.alternate;if(pn!==null){var mn=pn.child;if(mn!==null){pn.child=null;do{var _i=mn.sibling;mn.sibling=null,mn=_i}while(mn!==null)}}Qt=Z}}if((Z.subtreeFlags&2064)!==0&&oe!==null)oe.return=Z,Qt=oe;else e:for(;Qt!==null;){if(Z=Qt,(Z.flags&2048)!==0)switch(Z.tag){case 0:case 11:case 15:Bu(9,Z,Z.return)}var tt=Z.sibling;if(tt!==null){tt.return=Z.return,Qt=tt;break e}Qt=Z.return}}var He=d.current;for(Qt=He;Qt!==null;){oe=Qt;var rt=oe.child;if((oe.subtreeFlags&2064)!==0&&rt!==null)rt.return=oe,Qt=rt;else e:for(oe=He;Qt!==null;){if(Ae=Qt,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:Fo(9,Ae)}}catch(gn){yi(Ae,Ae.return,gn)}if(Ae===oe){Qt=null;break e}var $t=Ae.sibling;if($t!==null){$t.return=Ae.return,Qt=$t;break e}Qt=Ae.return}}if(fn=F,Bt(),ks&&typeof ks.onPostCommitFiberRoot=="function")try{ks.onPostCommitFiberRoot(lo,d)}catch{}R=!0}return R}finally{or=E,qi.transition=m}}return!1}function Qs(d,m,E){m=Lu(E,m),m=Id(d,m,1),d=_n(d,m,1),m=Js(),d!==null&&(jn(d,1,m),Os(d,m))}function yi(d,m,E){if(d.tag===3)Qs(d,d,E);else for(;m!==null;){if(m.tag===3){Qs(m,d,E);break}else if(m.tag===1){var R=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Ls===null||!Ls.has(R))){d=Lu(E,d),d=Ou(m,d,1),m=_n(m,d,1),d=Js(),m!==null&&(jn(m,1,d),Os(m,d));break}}m=m.return}}function Mg(d,m,E){var R=d.pingCache;R!==null&&R.delete(m),m=Js(),d.pingedLanes|=d.suspendedLanes&E,Bi===d&&($r&E)===E&&(ur===4||ur===3&&($r&130023424)===$r&&500>Hr()-pf?Gu(d,0):Fc|=E),Os(d,m)}function I_(d,m){m===0&&((d.mode&1)===0?m=1:(m=oc,oc<<=1,(oc&130023424)===0&&(oc=4194304)));var E=Js();d=ut(d,m),d!==null&&(jn(d,m,E),Os(d,E))}function ux(d){var m=d.memoizedState,E=0;m!==null&&(E=m.retryLane),I_(d,E)}function dx(d,m){var E=0;switch(d.tag){case 13:var R=d.stateNode,F=d.memoizedState;F!==null&&(E=F.retryLane);break;case 19:R=d.stateNode;break;default:throw Error(r(314))}R!==null&&R.delete(m),I_(d,E)}var Gp;Gp=function(d,m,E){if(d!==null)if(d.memoizedProps!==m.pendingProps||js.current)Qi=!0;else{if((d.lanes&E)===0&&(m.flags&128)===0)return Qi=!1,cf(d,m,E);Qi=(d.flags&131072)!==0}else Qi=!1,x&&(m.flags&1048576)!==0&&Ad(m,Nc,m.index);switch(m.lanes=0,m.tag){case 2:var R=m.type;lf(d,m),d=m.pendingProps;var F=Hi(m,Gi.current);qe(m,E),F=Sp(null,m,R,d,F,E);var Z=Ep();return m.flags|=1,typeof F=="object"&&F!==null&&typeof F.render=="function"&&F.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,fs(R)?(Z=!0,ta(m)):Z=!1,m.memoizedState=F.state!==null&&F.state!==void 0?F.state:null,vt(m),F.updater=Lc,m.stateNode=F,F._reactInternals=m,Ap(m,R,d,E),m=Bo(null,m,R,!0,Z,E)):(m.tag=0,x&&Z&&Ja(m),Vr(null,m,F,E),m=m.child),m;case 16:R=m.elementType;e:{switch(lf(d,m),d=m.pendingProps,F=R._init,R=F(R._payload),m.type=R,F=m.tag=hx(R),d=Oo(R,d),F){case 0:m=Ip(null,m,R,d,E);break e;case 1:m=Nd(null,m,R,d,E);break e;case 11:m=Rd(null,m,R,d,E);break e;case 14:m=ms(null,m,R,Oo(R.type,d),E);break e}throw Error(r(306,R,""))}return m;case 0:return R=m.type,F=m.pendingProps,F=m.elementType===R?F:Oo(R,F),Ip(d,m,R,F,E);case 1:return R=m.type,F=m.pendingProps,F=m.elementType===R?F:Oo(R,F),Nd(d,m,R,F,E);case 3:e:{if(T_(m),d===null)throw Error(r(387));R=m.pendingProps,Z=m.memoizedState,F=Z.element,At(d,m),zn(m,R,null,E);var oe=m.memoizedState;if(R=oe.element,Z.isDehydrated)if(Z={element:R,isDehydrated:!1,cache:oe.cache,pendingSuspenseBoundaries:oe.pendingSuspenseBoundaries,transitions:oe.transitions},m.updateQueue.baseState=Z,m.memoizedState=Z,m.flags&256){F=Lu(Error(r(423)),m),m=S_(d,m,R,E,F);break e}else if(R!==F){F=Lu(Error(r(424)),m),m=S_(d,m,R,E,F);break e}else for(h=ea(m.stateNode.containerInfo.firstChild),a=m,x=!0,T=null,E=ve(m,null,R,E),m.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if(ae(),R===F){m=rl(d,m,E);break e}Vr(d,m,R,E)}m=m.child}return m;case 5:return Ks(m),d===null&&B(m),R=m.type,F=m.pendingProps,Z=d!==null?d.memoizedProps:null,oe=F.children,Ac(R,F)?oe=null:Z!==null&&Ac(R,Z)&&(m.flags|=32),Zr(d,m),Vr(d,m,oe,E),m.child;case 6:return d===null&&B(m),null;case 13:return zc(d,m,E);case 4:return Li(m,m.stateNode.containerInfo),R=m.pendingProps,d===null?m.child=ye(m,null,R,E):Vr(d,m,R,E),m.child;case 11:return R=m.type,F=m.pendingProps,F=m.elementType===R?F:Oo(R,F),Rd(d,m,R,F,E);case 7:return Vr(d,m,m.pendingProps,E),m.child;case 8:return Vr(d,m,m.pendingProps.children,E),m.child;case 12:return Vr(d,m,m.pendingProps.children,E),m.child;case 10:e:{if(R=m.type._context,F=m.pendingProps,Z=m.memoizedProps,oe=F.value,Kn(Ne,R._currentValue),R._currentValue=oe,Z!==null)if(mo(Z.value,oe)){if(Z.children===F.children&&!js.current){m=rl(d,m,E);break e}}else for(Z=m.child,Z!==null&&(Z.return=m);Z!==null;){var Ae=Z.dependencies;if(Ae!==null){oe=Z.child;for(var Fe=Ae.firstContext;Fe!==null;){if(Fe.context===R){if(Z.tag===1){Fe=tn(-1,E&-E),Fe.tag=2;var ot=Z.updateQueue;if(ot!==null){ot=ot.shared;var Ot=ot.pending;Ot===null?Fe.next=Fe:(Fe.next=Ot.next,Ot.next=Fe),ot.pending=Fe}}Z.lanes|=E,Fe=Z.alternate,Fe!==null&&(Fe.lanes|=E),kt(Z.return,E,m),Ae.lanes|=E;break}Fe=Fe.next}}else if(Z.tag===10)oe=Z.type===m.type?null:Z.child;else if(Z.tag===18){if(oe=Z.return,oe===null)throw Error(r(341));oe.lanes|=E,Ae=oe.alternate,Ae!==null&&(Ae.lanes|=E),kt(oe,E,m),oe=Z.sibling}else oe=Z.child;if(oe!==null)oe.return=Z;else for(oe=Z;oe!==null;){if(oe===m){oe=null;break}if(Z=oe.sibling,Z!==null){Z.return=oe.return,oe=Z;break}oe=oe.return}Z=oe}Vr(d,m,F.children,E),m=m.child}return m;case 9:return F=m.type,R=m.pendingProps.children,qe(m,E),F=at(F),R=R(F),m.flags|=1,Vr(d,m,R,E),m.child;case 14:return R=m.type,F=Oo(R,m.pendingProps),F=Oo(R.type,F),ms(d,m,R,F,E);case 15:return zo(d,m,m.type,m.pendingProps,E);case 17:return R=m.type,F=m.pendingProps,F=m.elementType===R?F:Oo(R,F),lf(d,m),m.tag=1,fs(R)?(d=!0,ta(m)):d=!1,qe(m,E),kp(m,R,F),Ap(m,R,F,E),Bo(null,m,R,!0,d,E);case 19:return C_(d,m,E);case 22:return Mp(d,m,E)}throw Error(r(156,m.tag))};function _f(d,m){return Sh(d,m)}function R_(d,m,E,R){this.tag=d,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(d,m,E,R){return new R_(d,m,E,R)}function Hu(d){return d=d.prototype,!(!d||!d.isReactComponent)}function hx(d){if(typeof d=="function")return Hu(d)?1:0;if(d!=null){if(d=d.$$typeof,d===ft)return 11;if(d===Lt)return 14}return 2}function Gc(d,m){var E=d.alternate;return E===null?(E=ts(d.tag,m,d.key,d.mode),E.elementType=d.elementType,E.type=d.type,E.stateNode=d.stateNode,E.alternate=d,d.alternate=E):(E.pendingProps=m,E.type=d.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=d.flags&14680064,E.childLanes=d.childLanes,E.lanes=d.lanes,E.child=d.child,E.memoizedProps=d.memoizedProps,E.memoizedState=d.memoizedState,E.updateQueue=d.updateQueue,m=d.dependencies,E.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},E.sibling=d.sibling,E.index=d.index,E.ref=d.ref,E}function Hp(d,m,E,R,F,Z){var oe=2;if(R=d,typeof d=="function")Hu(d)&&(oe=1);else if(typeof d=="string")oe=5;else e:switch(d){case Ie:return qu(E.children,F,Z,m);case Ue:oe=8,F|=8;break;case Je:return d=ts(12,E,m,F|2),d.elementType=Je,d.lanes=Z,d;case mt:return d=ts(13,E,m,F),d.elementType=mt,d.lanes=Z,d;case gt:return d=ts(19,E,m,F),d.elementType=gt,d.lanes=Z,d;case We:return qp(E,F,Z,m);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Me:oe=10;break e;case lt:oe=9;break e;case ft:oe=11;break e;case Lt:oe=14;break e;case it:oe=16,R=null;break e}throw Error(r(130,d==null?d:typeof d,""))}return m=ts(oe,E,m,F),m.elementType=d,m.type=R,m.lanes=Z,m}function qu(d,m,E,R){return d=ts(7,d,R,m),d.lanes=E,d}function qp(d,m,E,R){return d=ts(22,d,R,m),d.elementType=We,d.lanes=E,d.stateNode={isHidden:!1},d}function Ig(d,m,E){return d=ts(6,d,null,m),d.lanes=E,d}function Rg(d,m,E){return m=ts(4,d.children!==null?d.children:[],d.key,m),m.lanes=E,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}function Ng(d,m,E,R,F){this.tag=m,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Us(0),this.expirationTimes=Us(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Us(0),this.identifierPrefix=R,this.onRecoverableError=F,this.mutableSourceEagerHydrationData=null}function jg(d,m,E,R,F,Z,oe,Ae,Fe){return d=new Ng(d,m,E,Ae,Fe),m===1?(m=1,Z===!0&&(m|=8)):m=0,Z=ts(3,null,null,m),d.current=Z,Z.stateNode=d,Z.memoizedState={element:R,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},vt(Z),d}function Vd(d,m,E){var R=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Se,key:R==null?null:""+R,children:d,containerInfo:m,implementation:E}}function N_(d){if(!d)return Xa;d=d._reactInternals;e:{if(Dr(d)!==d||d.tag!==1)throw Error(r(170));var m=d;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(fs(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(r(171))}if(d.tag===1){var E=d.type;if(fs(E))return jo(d,E,m)}return m}function ei(d,m,E,R,F,Z,oe,Ae,Fe){return d=jg(E,R,!0,d,F,Z,oe,Ae,Fe),d.context=N_(null),E=d.current,R=Js(),F=al(E),Z=tn(R,F),Z.callback=m??null,_n(E,Z,F),d.current.lanes=F,jn(d,F,R),Os(d,R),d}function Wu(d,m,E,R){var F=m.current,Z=Js(),oe=al(F);return E=N_(E),m.context===null?m.context=E:m.pendingContext=E,m=tn(Z,oe),m.payload={element:d},R=R===void 0?null:R,R!==null&&(m.callback=R),d=_n(F,m,oe),d!==null&&(Pa(d,F,oe,Z),Zt(d,F,oe)),oe}function vf(d){return d=d.current,d.child?(d.child.tag===5,d.child.stateNode):null}function xf(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var E=d.retryLane;d.retryLane=E!==0&&E<m?E:m}}function Ud(d,m){xf(d,m),(d=d.alternate)&&xf(d,m)}function wf(){return null}var Dg=typeof reportError=="function"?reportError:function(d){console.error(d)};function Wp(d){this._internalRoot=d}Hc.prototype.render=Wp.prototype.render=function(d){var m=this._internalRoot;if(m===null)throw Error(r(409));Wu(d,m,null,null)},Hc.prototype.unmount=Wp.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var m=d.containerInfo;Uc(function(){Wu(null,d,null,null)}),m[No]=null}};function Hc(d){this._internalRoot=d}Hc.prototype.unstable_scheduleHydration=function(d){if(d){var m=lc();d={blockedOn:null,target:d,priority:m};for(var E=0;E<xr.length&&m!==0&&m<xr[E].priority;E++);xr.splice(E,0,d),E===0&&Ah(d)}};function bf(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function $d(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function Zp(){}function fx(d,m,E,R,F){if(F){if(typeof R=="function"){var Z=R;R=function(){var ot=vf(oe);Z.call(ot)}}var oe=ei(m,R,d,0,null,!1,!1,"",Zp);return d._reactRootContainer=oe,d[No]=oe.current,_a(d.nodeType===8?d.parentNode:d),Uc(),oe}for(;F=d.lastChild;)d.removeChild(F);if(typeof R=="function"){var Ae=R;R=function(){var ot=vf(Fe);Ae.call(ot)}}var Fe=jg(d,0,!1,null,null,!1,!1,"",Zp);return d._reactRootContainer=Fe,d[No]=Fe.current,_a(d.nodeType===8?d.parentNode:d),Uc(function(){Wu(m,Fe,E,R)}),Fe}function Tf(d,m,E,R,F){var Z=E._reactRootContainer;if(Z){var oe=Z;if(typeof F=="function"){var Ae=F;F=function(){var Fe=vf(oe);Ae.call(Fe)}}Wu(m,oe,d,F)}else oe=fx(E,m,d,F,R);return vf(oe)}Pr=function(d){switch(d.tag){case 3:var m=d.stateNode;if(m.current.memoizedState.isDehydrated){var E=ac(m.pendingLanes);E!==0&&(xl(m,E|1),Os(m,Hr()),(fn&6)===0&&(Bd=Hr()+500,Bt()))}break;case 13:Uc(function(){var R=ut(d,1);if(R!==null){var F=Js();Pa(R,d,1,F)}}),Ud(d,1)}},ad=function(d){if(d.tag===13){var m=ut(d,134217728);if(m!==null){var E=Js();Pa(m,d,134217728,E)}Ud(d,134217728)}},Zo=function(d){if(d.tag===13){var m=al(d),E=ut(d,m);if(E!==null){var R=Js();Pa(E,d,m,R)}Ud(d,m)}},lc=function(){return or},cc=function(d,m){var E=or;try{return or=d,m()}finally{or=E}},be=function(d,m,E){switch(m){case"input":if(Ar(d,E),m=E.name,E.type==="radio"&&m!=null){for(E=d;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<E.length;m++){var R=E[m];if(R!==d&&R.form===d.form){var F=Ed(R);if(!F)throw Error(r(90));sn(R),Ar(R,F)}}}break;case"textarea":zs(d,E);break;case"select":m=E.value,m!=null&&ii(d,!!E.multiple,m,!1)}},ze=Fd,Be=Uc;var Sf={usingClientEntryPoint:!1,Events:[Mc,Rl,Ed,Te,xe,Fd]},Ef={findFiberByHostInstance:Ns,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Lg={bundleType:Ef.bundleType,version:Ef.version,rendererPackageName:Ef.rendererPackageName,rendererConfig:Ef.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ie.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=vl(d),d===null?null:d.stateNode},findFiberByHostInstance:Ef.findFiberByHostInstance||wf,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Kp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Kp.isDisabled&&Kp.supportsFiber)try{lo=Kp.inject(Lg),ks=Kp}catch{}}return ca.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sf,ca.createPortal=function(d,m){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bf(m))throw Error(r(200));return Vd(d,m,null,E)},ca.createRoot=function(d,m){if(!bf(d))throw Error(r(299));var E=!1,R="",F=Dg;return m!=null&&(m.unstable_strictMode===!0&&(E=!0),m.identifierPrefix!==void 0&&(R=m.identifierPrefix),m.onRecoverableError!==void 0&&(F=m.onRecoverableError)),m=jg(d,1,!1,null,null,E,!1,R,F),d[No]=m.current,_a(d.nodeType===8?d.parentNode:d),new Wp(m)},ca.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=vl(m),d=d===null?null:d.stateNode,d},ca.flushSync=function(d){return Uc(d)},ca.hydrate=function(d,m,E){if(!$d(m))throw Error(r(200));return Tf(null,d,m,!0,E)},ca.hydrateRoot=function(d,m,E){if(!bf(d))throw Error(r(405));var R=E!=null&&E.hydratedSources||null,F=!1,Z="",oe=Dg;if(E!=null&&(E.unstable_strictMode===!0&&(F=!0),E.identifierPrefix!==void 0&&(Z=E.identifierPrefix),E.onRecoverableError!==void 0&&(oe=E.onRecoverableError)),m=ei(m,null,d,1,E??null,F,!1,Z,oe),d[No]=m.current,_a(d),R)for(d=0;d<R.length;d++)E=R[d],F=E._getVersion,F=F(E._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[E,F]:m.mutableSourceEagerHydrationData.push(E,F);return new Hc(m)},ca.render=function(d,m,E){if(!$d(m))throw Error(r(200));return Tf(null,d,m,!1,E)},ca.unmountComponentAtNode=function(d){if(!$d(d))throw Error(r(40));return d._reactRootContainer?(Uc(function(){Tf(null,null,d,!1,function(){d._reactRootContainer=null,d[No]=null})}),!0):!1},ca.unstable_batchedUpdates=Fd,ca.unstable_renderSubtreeIntoContainer=function(d,m,E,R){if(!$d(E))throw Error(r(200));if(d==null||d._reactInternals===void 0)throw Error(r(38));return Tf(d,m,E,!1,R)},ca.version="18.3.1-next-f1338f8080-20240426",ca}var RE;function hP(){if(RE)return qx.exports;RE=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),qx.exports=J4(),qx.exports}var NE;function Q4(){if(NE)return ev;NE=1;var t=hP();return ev.createRoot=t.createRoot,ev.hydrateRoot=t.hydrateRoot,ev}var ym=Q4(),I=a0();const Kt=s1(I),l0=dP({__proto__:null,default:Kt},[I]),eL=1,tL=1e6;let Kx=0;function nL(){return Kx=(Kx+1)%Number.MAX_SAFE_INTEGER,Kx.toString()}const Xx=new Map,jE=t=>{if(Xx.has(t))return;const e=setTimeout(()=>{Xx.delete(t),gy({type:"REMOVE_TOAST",toastId:t})},tL);Xx.set(t,e)},rL=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,eL)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===e.toast.id?{...r,...e.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=e;return r?jE(r):t.toasts.forEach(l=>{jE(l.id)}),{...t,toasts:t.toasts.map(l=>l.id===r||r===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==e.toastId)}}},xv=[];let wv={toasts:[]};function gy(t){wv=rL(wv,t),xv.forEach(e=>{e(wv)})}function iL({...t}){const e=nL(),r=u=>gy({type:"UPDATE_TOAST",toast:{...u,id:e}}),l=()=>gy({type:"DISMISS_TOAST",toastId:e});return gy({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:u=>{u||l()}}}),{id:e,dismiss:l,update:r}}function sL(){const[t,e]=I.useState(wv);return I.useEffect(()=>(xv.push(e),()=>{const r=xv.indexOf(e);r>-1&&xv.splice(r,1)}),[t]),{...t,toast:iL,dismiss:r=>gy({type:"DISMISS_TOAST",toastId:r})}}var xh=hP();const fP=s1(xh);function Xt(t,e,{checkForDefaultPrevented:r=!0}={}){return function(u){if(t?.(u),r===!1||!u.defaultPrevented)return e?.(u)}}function DE(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function id(...t){return e=>{let r=!1;const l=t.map(u=>{const f=DE(u,e);return!r&&typeof f=="function"&&(r=!0),f});if(r)return()=>{for(let u=0;u<l.length;u++){const f=l[u];typeof f=="function"?f():DE(t[u],null)}}}}function ar(...t){return I.useCallback(id(...t),t)}function oL(t,e){const r=I.createContext(e),l=f=>{const{children:g,...w}=f,s=I.useMemo(()=>w,Object.values(w));return v.jsx(r.Provider,{value:s,children:g})};l.displayName=t+"Provider";function u(f){const g=I.useContext(r);if(g)return g;if(e!==void 0)return e;throw new Error(`\`${f}\` must be used within \`${t}\``)}return[l,u]}function gl(t,e=[]){let r=[];function l(f,g){const w=I.createContext(g),s=r.length;r=[...r,g];const S=j=>{const{scope:O,children:L,...W}=j,U=O?.[t]?.[s]||w,q=I.useMemo(()=>W,Object.values(W));return v.jsx(U.Provider,{value:q,children:L})};S.displayName=f+"Provider";function A(j,O){const L=O?.[t]?.[s]||w,W=I.useContext(L);if(W)return W;if(g!==void 0)return g;throw new Error(`\`${j}\` must be used within \`${f}\``)}return[S,A]}const u=()=>{const f=r.map(g=>I.createContext(g));return function(w){const s=w?.[t]||f;return I.useMemo(()=>({[`__scope${t}`]:{...w,[t]:s}}),[w,s])}};return u.scopeName=t,[l,aL(u,...e)]}function aL(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const l=t.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const g=l.reduce((w,{useScope:s,scopeName:S})=>{const j=s(f)[`__scope${S}`];return{...w,...j}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:g}),[g])}};return r.scopeName=e.scopeName,r}function LE(t){const e=lL(t),r=I.forwardRef((l,u)=>{const{children:f,...g}=l,w=I.Children.toArray(f),s=w.find(uL);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}function lL(t){const e=I.forwardRef((r,l)=>{const{children:u,...f}=r;if(I.isValidElement(u)){const g=hL(u),w=dL(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var cL=Symbol("radix.slottable");function uL(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===cL}function dL(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function hL(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function c0(t){const e=t+"CollectionProvider",[r,l]=gl(e),[u,f]=r(e,{collectionRef:{current:null},itemMap:new Map}),g=U=>{const{scope:q,children:Q}=U,J=Kt.useRef(null),Y=Kt.useRef(new Map).current;return v.jsx(u,{scope:q,itemMap:Y,collectionRef:J,children:Q})};g.displayName=e;const w=t+"CollectionSlot",s=LE(w),S=Kt.forwardRef((U,q)=>{const{scope:Q,children:J}=U,Y=f(w,Q),ie=ar(q,Y.collectionRef);return v.jsx(s,{ref:ie,children:J})});S.displayName=w;const A=t+"CollectionItemSlot",j="data-radix-collection-item",O=LE(A),L=Kt.forwardRef((U,q)=>{const{scope:Q,children:J,...Y}=U,ie=Kt.useRef(null),_e=ar(q,ie),Se=f(A,Q);return Kt.useEffect(()=>(Se.itemMap.set(ie,{ref:ie,...Y}),()=>{Se.itemMap.delete(ie)})),v.jsx(O,{[j]:"",ref:_e,children:J})});L.displayName=A;function W(U){const q=f(t+"CollectionConsumer",U);return Kt.useCallback(()=>{const J=q.collectionRef.current;if(!J)return[];const Y=Array.from(J.querySelectorAll(`[${j}]`));return Array.from(q.itemMap.values()).sort((Se,Ie)=>Y.indexOf(Se.ref.current)-Y.indexOf(Ie.ref.current))},[q.collectionRef,q.itemMap])}return[{Provider:g,Slot:S,ItemSlot:L},W,l]}function fL(t){const e=pL(t),r=I.forwardRef((l,u)=>{const{children:f,...g}=l,w=I.Children.toArray(f),s=w.find(gL);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}function pL(t){const e=I.forwardRef((r,l)=>{const{children:u,...f}=r;if(I.isValidElement(u)){const g=_L(u),w=yL(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var mL=Symbol("radix.slottable");function gL(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===mL}function yL(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function _L(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var vL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],In=vL.reduce((t,e)=>{const r=fL(`Primitive.${e}`),l=I.forwardRef((u,f)=>{const{asChild:g,...w}=u,s=g?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(s,{...w,ref:f})});return l.displayName=`Primitive.${e}`,{...t,[e]:l}},{});function o1(t,e){t&&xh.flushSync(()=>t.dispatchEvent(e))}function $i(t){const e=I.useRef(t);return I.useEffect(()=>{e.current=t}),I.useMemo(()=>(...r)=>e.current?.(...r),[])}function xL(t,e=globalThis?.document){const r=$i(t);I.useEffect(()=>{const l=u=>{u.key==="Escape"&&r(u)};return e.addEventListener("keydown",l,{capture:!0}),()=>e.removeEventListener("keydown",l,{capture:!0})},[r,e])}var wL="DismissableLayer",Hw="dismissableLayer.update",bL="dismissableLayer.pointerDownOutside",TL="dismissableLayer.focusOutside",OE,pP=I.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),qm=I.forwardRef((t,e)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:f,onInteractOutside:g,onDismiss:w,...s}=t,S=I.useContext(pP),[A,j]=I.useState(null),O=A?.ownerDocument??globalThis?.document,[,L]=I.useState({}),W=ar(e,Ie=>j(Ie)),U=Array.from(S.layers),[q]=[...S.layersWithOutsidePointerEventsDisabled].slice(-1),Q=U.indexOf(q),J=A?U.indexOf(A):-1,Y=S.layersWithOutsidePointerEventsDisabled.size>0,ie=J>=Q,_e=EL(Ie=>{const Ue=Ie.target,Je=[...S.branches].some(Me=>Me.contains(Ue));!ie||Je||(u?.(Ie),g?.(Ie),Ie.defaultPrevented||w?.())},O),Se=CL(Ie=>{const Ue=Ie.target;[...S.branches].some(Me=>Me.contains(Ue))||(f?.(Ie),g?.(Ie),Ie.defaultPrevented||w?.())},O);return xL(Ie=>{J===S.layers.size-1&&(l?.(Ie),!Ie.defaultPrevented&&w&&(Ie.preventDefault(),w()))},O),I.useEffect(()=>{if(A)return r&&(S.layersWithOutsidePointerEventsDisabled.size===0&&(OE=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),S.layersWithOutsidePointerEventsDisabled.add(A)),S.layers.add(A),zE(),()=>{r&&S.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=OE)}},[A,O,r,S]),I.useEffect(()=>()=>{A&&(S.layers.delete(A),S.layersWithOutsidePointerEventsDisabled.delete(A),zE())},[A,S]),I.useEffect(()=>{const Ie=()=>L({});return document.addEventListener(Hw,Ie),()=>document.removeEventListener(Hw,Ie)},[]),v.jsx(In.div,{...s,ref:W,style:{pointerEvents:Y?ie?"auto":"none":void 0,...t.style},onFocusCapture:Xt(t.onFocusCapture,Se.onFocusCapture),onBlurCapture:Xt(t.onBlurCapture,Se.onBlurCapture),onPointerDownCapture:Xt(t.onPointerDownCapture,_e.onPointerDownCapture)})});qm.displayName=wL;var SL="DismissableLayerBranch",mP=I.forwardRef((t,e)=>{const r=I.useContext(pP),l=I.useRef(null),u=ar(e,l);return I.useEffect(()=>{const f=l.current;if(f)return r.branches.add(f),()=>{r.branches.delete(f)}},[r.branches]),v.jsx(In.div,{...t,ref:u})});mP.displayName=SL;function EL(t,e=globalThis?.document){const r=$i(t),l=I.useRef(!1),u=I.useRef(()=>{});return I.useEffect(()=>{const f=w=>{if(w.target&&!l.current){let s=function(){gP(bL,r,S,{discrete:!0})};const S={originalEvent:w};w.pointerType==="touch"?(e.removeEventListener("click",u.current),u.current=s,e.addEventListener("click",u.current,{once:!0})):s()}else e.removeEventListener("click",u.current);l.current=!1},g=window.setTimeout(()=>{e.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(g),e.removeEventListener("pointerdown",f),e.removeEventListener("click",u.current)}},[e,r]),{onPointerDownCapture:()=>l.current=!0}}function CL(t,e=globalThis?.document){const r=$i(t),l=I.useRef(!1);return I.useEffect(()=>{const u=f=>{f.target&&!l.current&&gP(TL,r,{originalEvent:f},{discrete:!1})};return e.addEventListener("focusin",u),()=>e.removeEventListener("focusin",u)},[e,r]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function zE(){const t=new CustomEvent(Hw);document.dispatchEvent(t)}function gP(t,e,r,{discrete:l}){const u=r.originalEvent.target,f=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:r});e&&u.addEventListener(t,e,{once:!0}),l?o1(u,f):u.dispatchEvent(f)}var kL=qm,AL=mP,Zi=globalThis?.document?I.useLayoutEffect:()=>{},PL="Portal",Xy=I.forwardRef((t,e)=>{const{container:r,...l}=t,[u,f]=I.useState(!1);Zi(()=>f(!0),[]);const g=r||u&&globalThis?.document?.body;return g?fP.createPortal(v.jsx(In.div,{...l,ref:e}),g):null});Xy.displayName=PL;function ML(t,e){return I.useReducer((r,l)=>e[r][l]??r,t)}var Ho=t=>{const{present:e,children:r}=t,l=IL(e),u=typeof r=="function"?r({present:l.isPresent}):I.Children.only(r),f=ar(l.ref,RL(u));return typeof r=="function"||l.isPresent?I.cloneElement(u,{ref:f}):null};Ho.displayName="Presence";function IL(t){const[e,r]=I.useState(),l=I.useRef(null),u=I.useRef(t),f=I.useRef("none"),g=t?"mounted":"unmounted",[w,s]=ML(g,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return I.useEffect(()=>{const S=tv(l.current);f.current=w==="mounted"?S:"none"},[w]),Zi(()=>{const S=l.current,A=u.current;if(A!==t){const O=f.current,L=tv(S);t?s("MOUNT"):L==="none"||S?.display==="none"?s("UNMOUNT"):s(A&&O!==L?"ANIMATION_OUT":"UNMOUNT"),u.current=t}},[t,s]),Zi(()=>{if(e){let S;const A=e.ownerDocument.defaultView??window,j=L=>{const U=tv(l.current).includes(CSS.escape(L.animationName));if(L.target===e&&U&&(s("ANIMATION_END"),!u.current)){const q=e.style.animationFillMode;e.style.animationFillMode="forwards",S=A.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=q)})}},O=L=>{L.target===e&&(f.current=tv(l.current))};return e.addEventListener("animationstart",O),e.addEventListener("animationcancel",j),e.addEventListener("animationend",j),()=>{A.clearTimeout(S),e.removeEventListener("animationstart",O),e.removeEventListener("animationcancel",j),e.removeEventListener("animationend",j)}}else s("ANIMATION_END")},[e,s]),{isPresent:["mounted","unmountSuspended"].includes(w),ref:I.useCallback(S=>{l.current=S?getComputedStyle(S):null,r(S)},[])}}function tv(t){return t?.animationName||"none"}function RL(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var NL=l0[" useInsertionEffect ".trim().toString()]||Zi;function hh({prop:t,defaultProp:e,onChange:r=()=>{},caller:l}){const[u,f,g]=jL({defaultProp:e,onChange:r}),w=t!==void 0,s=w?t:u;{const A=I.useRef(t!==void 0);I.useEffect(()=>{const j=A.current;j!==w&&console.warn(`${l} is changing from ${j?"controlled":"uncontrolled"} to ${w?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),A.current=w},[w,l])}const S=I.useCallback(A=>{if(w){const j=DL(A)?A(t):A;j!==t&&g.current?.(j)}else f(A)},[w,t,f,g]);return[s,S]}function jL({defaultProp:t,onChange:e}){const[r,l]=I.useState(t),u=I.useRef(r),f=I.useRef(e);return NL(()=>{f.current=e},[e]),I.useEffect(()=>{u.current!==r&&(f.current?.(r),u.current=r)},[r,u]),[r,l,f]}function DL(t){return typeof t=="function"}var yP=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),LL="VisuallyHidden",u0=I.forwardRef((t,e)=>v.jsx(In.span,{...t,ref:e,style:{...yP,...t.style}}));u0.displayName=LL;var OL=u0,a1="ToastProvider",[l1,zL,BL]=c0("Toast"),[_P]=gl("Toast",[BL]),[FL,d0]=_P(a1),vP=t=>{const{__scopeToast:e,label:r="Notification",duration:l=5e3,swipeDirection:u="right",swipeThreshold:f=50,children:g}=t,[w,s]=I.useState(null),[S,A]=I.useState(0),j=I.useRef(!1),O=I.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${a1}\`. Expected non-empty \`string\`.`),v.jsx(l1.Provider,{scope:e,children:v.jsx(FL,{scope:e,label:r,duration:l,swipeDirection:u,swipeThreshold:f,toastCount:S,viewport:w,onViewportChange:s,onToastAdd:I.useCallback(()=>A(L=>L+1),[]),onToastRemove:I.useCallback(()=>A(L=>L-1),[]),isFocusedToastEscapeKeyDownRef:j,isClosePausedRef:O,children:g})})};vP.displayName=a1;var xP="ToastViewport",VL=["F8"],qw="toast.viewportPause",Ww="toast.viewportResume",wP=I.forwardRef((t,e)=>{const{__scopeToast:r,hotkey:l=VL,label:u="Notifications ({hotkey})",...f}=t,g=d0(xP,r),w=zL(r),s=I.useRef(null),S=I.useRef(null),A=I.useRef(null),j=I.useRef(null),O=ar(e,j,g.onViewportChange),L=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),W=g.toastCount>0;I.useEffect(()=>{const q=Q=>{l.length!==0&&l.every(Y=>Q[Y]||Q.code===Y)&&j.current?.focus()};return document.addEventListener("keydown",q),()=>document.removeEventListener("keydown",q)},[l]),I.useEffect(()=>{const q=s.current,Q=j.current;if(W&&q&&Q){const J=()=>{if(!g.isClosePausedRef.current){const Se=new CustomEvent(qw);Q.dispatchEvent(Se),g.isClosePausedRef.current=!0}},Y=()=>{if(g.isClosePausedRef.current){const Se=new CustomEvent(Ww);Q.dispatchEvent(Se),g.isClosePausedRef.current=!1}},ie=Se=>{!q.contains(Se.relatedTarget)&&Y()},_e=()=>{q.contains(document.activeElement)||Y()};return q.addEventListener("focusin",J),q.addEventListener("focusout",ie),q.addEventListener("pointermove",J),q.addEventListener("pointerleave",_e),window.addEventListener("blur",J),window.addEventListener("focus",Y),()=>{q.removeEventListener("focusin",J),q.removeEventListener("focusout",ie),q.removeEventListener("pointermove",J),q.removeEventListener("pointerleave",_e),window.removeEventListener("blur",J),window.removeEventListener("focus",Y)}}},[W,g.isClosePausedRef]);const U=I.useCallback(({tabbingDirection:q})=>{const J=w().map(Y=>{const ie=Y.ref.current,_e=[ie,...e5(ie)];return q==="forwards"?_e:_e.reverse()});return(q==="forwards"?J.reverse():J).flat()},[w]);return I.useEffect(()=>{const q=j.current;if(q){const Q=J=>{const Y=J.altKey||J.ctrlKey||J.metaKey;if(J.key==="Tab"&&!Y){const _e=document.activeElement,Se=J.shiftKey;if(J.target===q&&Se){S.current?.focus();return}const Je=U({tabbingDirection:Se?"backwards":"forwards"}),Me=Je.findIndex(lt=>lt===_e);Yx(Je.slice(Me+1))?J.preventDefault():Se?S.current?.focus():A.current?.focus()}};return q.addEventListener("keydown",Q),()=>q.removeEventListener("keydown",Q)}},[w,U]),v.jsxs(AL,{ref:s,role:"region","aria-label":u.replace("{hotkey}",L),tabIndex:-1,style:{pointerEvents:W?void 0:"none"},children:[W&&v.jsx(Zw,{ref:S,onFocusFromOutsideViewport:()=>{const q=U({tabbingDirection:"forwards"});Yx(q)}}),v.jsx(l1.Slot,{scope:r,children:v.jsx(In.ol,{tabIndex:-1,...f,ref:O})}),W&&v.jsx(Zw,{ref:A,onFocusFromOutsideViewport:()=>{const q=U({tabbingDirection:"backwards"});Yx(q)}})]})});wP.displayName=xP;var bP="ToastFocusProxy",Zw=I.forwardRef((t,e)=>{const{__scopeToast:r,onFocusFromOutsideViewport:l,...u}=t,f=d0(bP,r);return v.jsx(u0,{tabIndex:0,...u,ref:e,style:{position:"fixed"},onFocus:g=>{const w=g.relatedTarget;!f.viewport?.contains(w)&&l()}})});Zw.displayName=bP;var Yy="Toast",UL="toast.swipeStart",$L="toast.swipeMove",GL="toast.swipeCancel",HL="toast.swipeEnd",TP=I.forwardRef((t,e)=>{const{forceMount:r,open:l,defaultOpen:u,onOpenChange:f,...g}=t,[w,s]=hh({prop:l,defaultProp:u??!0,onChange:f,caller:Yy});return v.jsx(Ho,{present:r||w,children:v.jsx(ZL,{open:w,...g,ref:e,onClose:()=>s(!1),onPause:$i(t.onPause),onResume:$i(t.onResume),onSwipeStart:Xt(t.onSwipeStart,S=>{S.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Xt(t.onSwipeMove,S=>{const{x:A,y:j}=S.detail.delta;S.currentTarget.setAttribute("data-swipe","move"),S.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${A}px`),S.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${j}px`)}),onSwipeCancel:Xt(t.onSwipeCancel,S=>{S.currentTarget.setAttribute("data-swipe","cancel"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),S.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Xt(t.onSwipeEnd,S=>{const{x:A,y:j}=S.detail.delta;S.currentTarget.setAttribute("data-swipe","end"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),S.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),S.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${A}px`),S.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${j}px`),s(!1)})})})});TP.displayName=Yy;var[qL,WL]=_P(Yy,{onClose(){}}),ZL=I.forwardRef((t,e)=>{const{__scopeToast:r,type:l="foreground",duration:u,open:f,onClose:g,onEscapeKeyDown:w,onPause:s,onResume:S,onSwipeStart:A,onSwipeMove:j,onSwipeCancel:O,onSwipeEnd:L,...W}=t,U=d0(Yy,r),[q,Q]=I.useState(null),J=ar(e,gt=>Q(gt)),Y=I.useRef(null),ie=I.useRef(null),_e=u||U.duration,Se=I.useRef(0),Ie=I.useRef(_e),Ue=I.useRef(0),{onToastAdd:Je,onToastRemove:Me}=U,lt=$i(()=>{q?.contains(document.activeElement)&&U.viewport?.focus(),g()}),ft=I.useCallback(gt=>{!gt||gt===1/0||(window.clearTimeout(Ue.current),Se.current=new Date().getTime(),Ue.current=window.setTimeout(lt,gt))},[lt]);I.useEffect(()=>{const gt=U.viewport;if(gt){const Lt=()=>{ft(Ie.current),S?.()},it=()=>{const We=new Date().getTime()-Se.current;Ie.current=Ie.current-We,window.clearTimeout(Ue.current),s?.()};return gt.addEventListener(qw,it),gt.addEventListener(Ww,Lt),()=>{gt.removeEventListener(qw,it),gt.removeEventListener(Ww,Lt)}}},[U.viewport,_e,s,S,ft]),I.useEffect(()=>{f&&!U.isClosePausedRef.current&&ft(_e)},[f,_e,U.isClosePausedRef,ft]),I.useEffect(()=>(Je(),()=>Me()),[Je,Me]);const mt=I.useMemo(()=>q?MP(q):null,[q]);return U.viewport?v.jsxs(v.Fragment,{children:[mt&&v.jsx(KL,{__scopeToast:r,role:"status","aria-live":l==="foreground"?"assertive":"polite",children:mt}),v.jsx(qL,{scope:r,onClose:lt,children:xh.createPortal(v.jsx(l1.ItemSlot,{scope:r,children:v.jsx(kL,{asChild:!0,onEscapeKeyDown:Xt(w,()=>{U.isFocusedToastEscapeKeyDownRef.current||lt(),U.isFocusedToastEscapeKeyDownRef.current=!1}),children:v.jsx(In.li,{tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":U.swipeDirection,...W,ref:J,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Xt(t.onKeyDown,gt=>{gt.key==="Escape"&&(w?.(gt.nativeEvent),gt.nativeEvent.defaultPrevented||(U.isFocusedToastEscapeKeyDownRef.current=!0,lt()))}),onPointerDown:Xt(t.onPointerDown,gt=>{gt.button===0&&(Y.current={x:gt.clientX,y:gt.clientY})}),onPointerMove:Xt(t.onPointerMove,gt=>{if(!Y.current)return;const Lt=gt.clientX-Y.current.x,it=gt.clientY-Y.current.y,We=!!ie.current,Le=["left","right"].includes(U.swipeDirection),we=["left","up"].includes(U.swipeDirection)?Math.min:Math.max,st=Le?we(0,Lt):0,ke=Le?0:we(0,it),Ve=gt.pointerType==="touch"?10:2,bt={x:st,y:ke},wt={originalEvent:gt,delta:bt};We?(ie.current=bt,nv($L,j,wt,{discrete:!1})):BE(bt,U.swipeDirection,Ve)?(ie.current=bt,nv(UL,A,wt,{discrete:!1}),gt.target.setPointerCapture(gt.pointerId)):(Math.abs(Lt)>Ve||Math.abs(it)>Ve)&&(Y.current=null)}),onPointerUp:Xt(t.onPointerUp,gt=>{const Lt=ie.current,it=gt.target;if(it.hasPointerCapture(gt.pointerId)&&it.releasePointerCapture(gt.pointerId),ie.current=null,Y.current=null,Lt){const We=gt.currentTarget,Le={originalEvent:gt,delta:Lt};BE(Lt,U.swipeDirection,U.swipeThreshold)?nv(HL,L,Le,{discrete:!0}):nv(GL,O,Le,{discrete:!0}),We.addEventListener("click",we=>we.preventDefault(),{once:!0})}})})})}),U.viewport)})]}):null}),KL=t=>{const{__scopeToast:e,children:r,...l}=t,u=d0(Yy,e),[f,g]=I.useState(!1),[w,s]=I.useState(!1);return JL(()=>g(!0)),I.useEffect(()=>{const S=window.setTimeout(()=>s(!0),1e3);return()=>window.clearTimeout(S)},[]),w?null:v.jsx(Xy,{asChild:!0,children:v.jsx(u0,{...l,children:f&&v.jsxs(v.Fragment,{children:[u.label," ",r]})})})},XL="ToastTitle",SP=I.forwardRef((t,e)=>{const{__scopeToast:r,...l}=t;return v.jsx(In.div,{...l,ref:e})});SP.displayName=XL;var YL="ToastDescription",EP=I.forwardRef((t,e)=>{const{__scopeToast:r,...l}=t;return v.jsx(In.div,{...l,ref:e})});EP.displayName=YL;var CP="ToastAction",kP=I.forwardRef((t,e)=>{const{altText:r,...l}=t;return r.trim()?v.jsx(PP,{altText:r,asChild:!0,children:v.jsx(c1,{...l,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${CP}\`. Expected non-empty \`string\`.`),null)});kP.displayName=CP;var AP="ToastClose",c1=I.forwardRef((t,e)=>{const{__scopeToast:r,...l}=t,u=WL(AP,r);return v.jsx(PP,{asChild:!0,children:v.jsx(In.button,{type:"button",...l,ref:e,onClick:Xt(t.onClick,u.onClose)})})});c1.displayName=AP;var PP=I.forwardRef((t,e)=>{const{__scopeToast:r,altText:l,...u}=t;return v.jsx(In.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...u,ref:e})});function MP(t){const e=[];return Array.from(t.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&e.push(l.textContent),QL(l)){const u=l.ariaHidden||l.hidden||l.style.display==="none",f=l.dataset.radixToastAnnounceExclude==="";if(!u)if(f){const g=l.dataset.radixToastAnnounceAlt;g&&e.push(g)}else e.push(...MP(l))}}),e}function nv(t,e,r,{discrete:l}){const u=r.originalEvent.currentTarget,f=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:r});e&&u.addEventListener(t,e,{once:!0}),l?o1(u,f):u.dispatchEvent(f)}var BE=(t,e,r=0)=>{const l=Math.abs(t.x),u=Math.abs(t.y),f=l>u;return e==="left"||e==="right"?f&&l>r:!f&&u>r};function JL(t=()=>{}){const e=$i(t);Zi(()=>{let r=0,l=0;return r=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(l)}},[e])}function QL(t){return t.nodeType===t.ELEMENT_NODE}function e5(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const u=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||u?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function Yx(t){const e=document.activeElement;return t.some(r=>r===e?!0:(r.focus(),document.activeElement!==e))}var t5=vP,IP=wP,RP=TP,NP=SP,jP=EP,DP=kP,LP=c1;function OP(t){var e,r,l="";if(typeof t=="string"||typeof t=="number")l+=t;else if(typeof t=="object")if(Array.isArray(t)){var u=t.length;for(e=0;e<u;e++)t[e]&&(r=OP(t[e]))&&(l&&(l+=" "),l+=r)}else for(r in t)t[r]&&(l&&(l+=" "),l+=r);return l}function zP(){for(var t,e,r=0,l="",u=arguments.length;r<u;r++)(t=arguments[r])&&(e=OP(t))&&(l&&(l+=" "),l+=e);return l}const FE=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,VE=zP,Jy=(t,e)=>r=>{var l;if(e?.variants==null)return VE(t,r?.class,r?.className);const{variants:u,defaultVariants:f}=e,g=Object.keys(u).map(S=>{const A=r?.[S],j=f?.[S];if(A===null)return null;const O=FE(A)||FE(j);return u[S][O]}),w=r&&Object.entries(r).reduce((S,A)=>{let[j,O]=A;return O===void 0||(S[j]=O),S},{}),s=e==null||(l=e.compoundVariants)===null||l===void 0?void 0:l.reduce((S,A)=>{let{class:j,className:O,...L}=A;return Object.entries(L).every(W=>{let[U,q]=W;return Array.isArray(q)?q.includes({...f,...w}[U]):{...f,...w}[U]===q})?[...S,j,O]:S},[]);return VE(t,g,s,r?.class,r?.className)};const n5=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),BP=(...t)=>t.filter((e,r,l)=>!!e&&e.trim()!==""&&l.indexOf(e)===r).join(" ").trim();var r5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const i5=I.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:u="",children:f,iconNode:g,...w},s)=>I.createElement("svg",{ref:s,...r5,width:e,height:e,stroke:t,strokeWidth:l?Number(r)*24/Number(e):r,className:BP("lucide",u),...w},[...g.map(([S,A])=>I.createElement(S,A)),...Array.isArray(f)?f:[f]]));const rn=(t,e)=>{const r=I.forwardRef(({className:l,...u},f)=>I.createElement(i5,{ref:f,iconNode:e,className:BP(`lucide-${n5(t)}`,l),...u}));return r.displayName=`${t}`,r};const h0=rn("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const u1=rn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const UE=rn("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);const s5=rn("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const FP=rn("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]);const lh=rn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const Dm=rn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);const d1=rn("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);const o5=rn("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const a5=rn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const VP=rn("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);const tp=rn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const Hf=rn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const UP=rn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const Lm=rn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const l5=rn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const c5=rn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const u5=rn("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);const d5=rn("CircleUserRound",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const h5=rn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const f0=rn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const f5=rn("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);const h1=rn("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);const Jx=rn("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]);const Qx=rn("CornerUpRight",[["polyline",{points:"15 14 20 9 15 4",key:"1tbx3s"}],["path",{d:"M4 20v-7a4 4 0 0 1 4-4h12",key:"1lu4f8"}]]);const fl=rn("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);const p5=rn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);const m5=rn("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const g5=rn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const y5=rn("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);const _5=rn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const v5=rn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);const $P=rn("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]);const f1=rn("Gamepad2",[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]]);const x5=rn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);const p1=rn("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const w5=rn("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);const ih=rn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const m1=rn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const b5=rn("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);const $E=rn("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);const GP=rn("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const g1=rn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const ls=rn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const Cy=rn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const Kw=rn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const y1=rn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const Wi=rn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const HP=rn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);const T5=rn("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const Iv=rn("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);const Rv=rn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);const S5=rn("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);const ew=rn("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const E5=rn("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);const Qy=rn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const Sm=rn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const GE=rn("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);const C5=rn("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const p0=rn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const k5=rn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const A5=rn("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);const P5=rn("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const Uf=rn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const Yc=rn("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);const qP=rn("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const fh=rn("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);const ch=rn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const M5=rn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);const WP=rn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);const ky=rn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const ZP=rn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const KP=rn("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);const m0=rn("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);const xi=rn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),_1="-",I5=t=>{const e=N5(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:l}=t;return{getClassGroupId:g=>{const w=g.split(_1);return w[0]===""&&w.length!==1&&w.shift(),XP(w,e)||R5(g)},getConflictingClassGroupIds:(g,w)=>{const s=r[g]||[];return w&&l[g]?[...s,...l[g]]:s}}},XP=(t,e)=>{if(t.length===0)return e.classGroupId;const r=t[0],l=e.nextPart.get(r),u=l?XP(t.slice(1),l):void 0;if(u)return u;if(e.validators.length===0)return;const f=t.join(_1);return e.validators.find(({validator:g})=>g(f))?.classGroupId},HE=/^\[(.+)\]$/,R5=t=>{if(HE.test(t)){const e=HE.exec(t)[1],r=e?.substring(0,e.indexOf(":"));if(r)return"arbitrary.."+r}},N5=t=>{const{theme:e,prefix:r}=t,l={nextPart:new Map,validators:[]};return D5(Object.entries(t.classGroups),r).forEach(([f,g])=>{Xw(g,l,f,e)}),l},Xw=(t,e,r,l)=>{t.forEach(u=>{if(typeof u=="string"){const f=u===""?e:qE(e,u);f.classGroupId=r;return}if(typeof u=="function"){if(j5(u)){Xw(u(l),e,r,l);return}e.validators.push({validator:u,classGroupId:r});return}Object.entries(u).forEach(([f,g])=>{Xw(g,qE(e,f),r,l)})})},qE=(t,e)=>{let r=t;return e.split(_1).forEach(l=>{r.nextPart.has(l)||r.nextPart.set(l,{nextPart:new Map,validators:[]}),r=r.nextPart.get(l)}),r},j5=t=>t.isThemeGetter,D5=(t,e)=>e?t.map(([r,l])=>{const u=l.map(f=>typeof f=="string"?e+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([g,w])=>[e+g,w])):f);return[r,u]}):t,L5=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,r=new Map,l=new Map;const u=(f,g)=>{r.set(f,g),e++,e>t&&(e=0,l=r,r=new Map)};return{get(f){let g=r.get(f);if(g!==void 0)return g;if((g=l.get(f))!==void 0)return u(f,g),g},set(f,g){r.has(f)?r.set(f,g):u(f,g)}}},YP="!",O5=t=>{const{separator:e,experimentalParseClassName:r}=t,l=e.length===1,u=e[0],f=e.length,g=w=>{const s=[];let S=0,A=0,j;for(let q=0;q<w.length;q++){let Q=w[q];if(S===0){if(Q===u&&(l||w.slice(q,q+f)===e)){s.push(w.slice(A,q)),A=q+f;continue}if(Q==="/"){j=q;continue}}Q==="["?S++:Q==="]"&&S--}const O=s.length===0?w:w.substring(A),L=O.startsWith(YP),W=L?O.substring(1):O,U=j&&j>A?j-A:void 0;return{modifiers:s,hasImportantModifier:L,baseClassName:W,maybePostfixModifierPosition:U}};return r?w=>r({className:w,parseClassName:g}):g},z5=t=>{if(t.length<=1)return t;const e=[];let r=[];return t.forEach(l=>{l[0]==="["?(e.push(...r.sort(),l),r=[]):r.push(l)}),e.push(...r.sort()),e},B5=t=>({cache:L5(t.cacheSize),parseClassName:O5(t),...I5(t)}),F5=/\s+/,V5=(t,e)=>{const{parseClassName:r,getClassGroupId:l,getConflictingClassGroupIds:u}=e,f=[],g=t.trim().split(F5);let w="";for(let s=g.length-1;s>=0;s-=1){const S=g[s],{modifiers:A,hasImportantModifier:j,baseClassName:O,maybePostfixModifierPosition:L}=r(S);let W=!!L,U=l(W?O.substring(0,L):O);if(!U){if(!W){w=S+(w.length>0?" "+w:w);continue}if(U=l(O),!U){w=S+(w.length>0?" "+w:w);continue}W=!1}const q=z5(A).join(":"),Q=j?q+YP:q,J=Q+U;if(f.includes(J))continue;f.push(J);const Y=u(U,W);for(let ie=0;ie<Y.length;++ie){const _e=Y[ie];f.push(Q+_e)}w=S+(w.length>0?" "+w:w)}return w};function U5(){let t=0,e,r,l="";for(;t<arguments.length;)(e=arguments[t++])&&(r=JP(e))&&(l&&(l+=" "),l+=r);return l}const JP=t=>{if(typeof t=="string")return t;let e,r="";for(let l=0;l<t.length;l++)t[l]&&(e=JP(t[l]))&&(r&&(r+=" "),r+=e);return r};function $5(t,...e){let r,l,u,f=g;function g(s){const S=e.reduce((A,j)=>j(A),t());return r=B5(S),l=r.cache.get,u=r.cache.set,f=w,w(s)}function w(s){const S=l(s);if(S)return S;const A=V5(s,r);return u(s,A),A}return function(){return f(U5.apply(null,arguments))}}const di=t=>{const e=r=>r[t]||[];return e.isThemeGetter=!0,e},QP=/^\[(?:([a-z-]+):)?(.+)\]$/i,G5=/^\d+\/\d+$/,H5=new Set(["px","full","screen"]),q5=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,W5=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Z5=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,K5=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,X5=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Xu=t=>Mm(t)||H5.has(t)||G5.test(t),Yd=t=>Wm(t,"length",iO),Mm=t=>!!t&&!Number.isNaN(Number(t)),tw=t=>Wm(t,"number",Mm),ty=t=>!!t&&Number.isInteger(Number(t)),Y5=t=>t.endsWith("%")&&Mm(t.slice(0,-1)),rr=t=>QP.test(t),Jd=t=>q5.test(t),J5=new Set(["length","size","percentage"]),Q5=t=>Wm(t,J5,eM),eO=t=>Wm(t,"position",eM),tO=new Set(["image","url"]),nO=t=>Wm(t,tO,oO),rO=t=>Wm(t,"",sO),ny=()=>!0,Wm=(t,e,r)=>{const l=QP.exec(t);return l?l[1]?typeof e=="string"?l[1]===e:e.has(l[1]):r(l[2]):!1},iO=t=>W5.test(t)&&!Z5.test(t),eM=()=>!1,sO=t=>K5.test(t),oO=t=>X5.test(t),aO=()=>{const t=di("colors"),e=di("spacing"),r=di("blur"),l=di("brightness"),u=di("borderColor"),f=di("borderRadius"),g=di("borderSpacing"),w=di("borderWidth"),s=di("contrast"),S=di("grayscale"),A=di("hueRotate"),j=di("invert"),O=di("gap"),L=di("gradientColorStops"),W=di("gradientColorStopPositions"),U=di("inset"),q=di("margin"),Q=di("opacity"),J=di("padding"),Y=di("saturate"),ie=di("scale"),_e=di("sepia"),Se=di("skew"),Ie=di("space"),Ue=di("translate"),Je=()=>["auto","contain","none"],Me=()=>["auto","hidden","clip","visible","scroll"],lt=()=>["auto",rr,e],ft=()=>[rr,e],mt=()=>["",Xu,Yd],gt=()=>["auto",Mm,rr],Lt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],it=()=>["solid","dashed","dotted","double","none"],We=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Le=()=>["start","end","center","between","around","evenly","stretch"],we=()=>["","0",rr],st=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ke=()=>[Mm,rr];return{cacheSize:500,separator:":",theme:{colors:[ny],spacing:[Xu,Yd],blur:["none","",Jd,rr],brightness:ke(),borderColor:[t],borderRadius:["none","","full",Jd,rr],borderSpacing:ft(),borderWidth:mt(),contrast:ke(),grayscale:we(),hueRotate:ke(),invert:we(),gap:ft(),gradientColorStops:[t],gradientColorStopPositions:[Y5,Yd],inset:lt(),margin:lt(),opacity:ke(),padding:ft(),saturate:ke(),scale:ke(),sepia:we(),skew:ke(),space:ft(),translate:ft()},classGroups:{aspect:[{aspect:["auto","square","video",rr]}],container:["container"],columns:[{columns:[Jd]}],"break-after":[{"break-after":st()}],"break-before":[{"break-before":st()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Lt(),rr]}],overflow:[{overflow:Me()}],"overflow-x":[{"overflow-x":Me()}],"overflow-y":[{"overflow-y":Me()}],overscroll:[{overscroll:Je()}],"overscroll-x":[{"overscroll-x":Je()}],"overscroll-y":[{"overscroll-y":Je()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[U]}],"inset-x":[{"inset-x":[U]}],"inset-y":[{"inset-y":[U]}],start:[{start:[U]}],end:[{end:[U]}],top:[{top:[U]}],right:[{right:[U]}],bottom:[{bottom:[U]}],left:[{left:[U]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ty,rr]}],basis:[{basis:lt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",rr]}],grow:[{grow:we()}],shrink:[{shrink:we()}],order:[{order:["first","last","none",ty,rr]}],"grid-cols":[{"grid-cols":[ny]}],"col-start-end":[{col:["auto",{span:["full",ty,rr]},rr]}],"col-start":[{"col-start":gt()}],"col-end":[{"col-end":gt()}],"grid-rows":[{"grid-rows":[ny]}],"row-start-end":[{row:["auto",{span:[ty,rr]},rr]}],"row-start":[{"row-start":gt()}],"row-end":[{"row-end":gt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",rr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",rr]}],gap:[{gap:[O]}],"gap-x":[{"gap-x":[O]}],"gap-y":[{"gap-y":[O]}],"justify-content":[{justify:["normal",...Le()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Le(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Le(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[J]}],px:[{px:[J]}],py:[{py:[J]}],ps:[{ps:[J]}],pe:[{pe:[J]}],pt:[{pt:[J]}],pr:[{pr:[J]}],pb:[{pb:[J]}],pl:[{pl:[J]}],m:[{m:[q]}],mx:[{mx:[q]}],my:[{my:[q]}],ms:[{ms:[q]}],me:[{me:[q]}],mt:[{mt:[q]}],mr:[{mr:[q]}],mb:[{mb:[q]}],ml:[{ml:[q]}],"space-x":[{"space-x":[Ie]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ie]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",rr,e]}],"min-w":[{"min-w":[rr,e,"min","max","fit"]}],"max-w":[{"max-w":[rr,e,"none","full","min","max","fit","prose",{screen:[Jd]},Jd]}],h:[{h:[rr,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[rr,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[rr,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[rr,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Jd,Yd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",tw]}],"font-family":[{font:[ny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",rr]}],"line-clamp":[{"line-clamp":["none",Mm,tw]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Xu,rr]}],"list-image":[{"list-image":["none",rr]}],"list-style-type":[{list:["none","disc","decimal",rr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[Q]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...it(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Xu,Yd]}],"underline-offset":[{"underline-offset":["auto",Xu,rr]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ft()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",rr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",rr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Q]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Lt(),eO]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Q5]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},nO]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[W]}],"gradient-via-pos":[{via:[W]}],"gradient-to-pos":[{to:[W]}],"gradient-from":[{from:[L]}],"gradient-via":[{via:[L]}],"gradient-to":[{to:[L]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[w]}],"border-w-x":[{"border-x":[w]}],"border-w-y":[{"border-y":[w]}],"border-w-s":[{"border-s":[w]}],"border-w-e":[{"border-e":[w]}],"border-w-t":[{"border-t":[w]}],"border-w-r":[{"border-r":[w]}],"border-w-b":[{"border-b":[w]}],"border-w-l":[{"border-l":[w]}],"border-opacity":[{"border-opacity":[Q]}],"border-style":[{border:[...it(),"hidden"]}],"divide-x":[{"divide-x":[w]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[w]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Q]}],"divide-style":[{divide:it()}],"border-color":[{border:[u]}],"border-color-x":[{"border-x":[u]}],"border-color-y":[{"border-y":[u]}],"border-color-s":[{"border-s":[u]}],"border-color-e":[{"border-e":[u]}],"border-color-t":[{"border-t":[u]}],"border-color-r":[{"border-r":[u]}],"border-color-b":[{"border-b":[u]}],"border-color-l":[{"border-l":[u]}],"divide-color":[{divide:[u]}],"outline-style":[{outline:["",...it()]}],"outline-offset":[{"outline-offset":[Xu,rr]}],"outline-w":[{outline:[Xu,Yd]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:mt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[Q]}],"ring-offset-w":[{"ring-offset":[Xu,Yd]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Jd,rO]}],"shadow-color":[{shadow:[ny]}],opacity:[{opacity:[Q]}],"mix-blend":[{"mix-blend":[...We(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":We()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[l]}],contrast:[{contrast:[s]}],"drop-shadow":[{"drop-shadow":["","none",Jd,rr]}],grayscale:[{grayscale:[S]}],"hue-rotate":[{"hue-rotate":[A]}],invert:[{invert:[j]}],saturate:[{saturate:[Y]}],sepia:[{sepia:[_e]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[s]}],"backdrop-grayscale":[{"backdrop-grayscale":[S]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[A]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[Q]}],"backdrop-saturate":[{"backdrop-saturate":[Y]}],"backdrop-sepia":[{"backdrop-sepia":[_e]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[g]}],"border-spacing-x":[{"border-spacing-x":[g]}],"border-spacing-y":[{"border-spacing-y":[g]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",rr]}],duration:[{duration:ke()}],ease:[{ease:["linear","in","out","in-out",rr]}],delay:[{delay:ke()}],animate:[{animate:["none","spin","ping","pulse","bounce",rr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ie]}],"scale-x":[{"scale-x":[ie]}],"scale-y":[{"scale-y":[ie]}],rotate:[{rotate:[ty,rr]}],"translate-x":[{"translate-x":[Ue]}],"translate-y":[{"translate-y":[Ue]}],"skew-x":[{"skew-x":[Se]}],"skew-y":[{"skew-y":[Se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",rr]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",rr]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ft()}],"scroll-mx":[{"scroll-mx":ft()}],"scroll-my":[{"scroll-my":ft()}],"scroll-ms":[{"scroll-ms":ft()}],"scroll-me":[{"scroll-me":ft()}],"scroll-mt":[{"scroll-mt":ft()}],"scroll-mr":[{"scroll-mr":ft()}],"scroll-mb":[{"scroll-mb":ft()}],"scroll-ml":[{"scroll-ml":ft()}],"scroll-p":[{"scroll-p":ft()}],"scroll-px":[{"scroll-px":ft()}],"scroll-py":[{"scroll-py":ft()}],"scroll-ps":[{"scroll-ps":ft()}],"scroll-pe":[{"scroll-pe":ft()}],"scroll-pt":[{"scroll-pt":ft()}],"scroll-pr":[{"scroll-pr":ft()}],"scroll-pb":[{"scroll-pb":ft()}],"scroll-pl":[{"scroll-pl":ft()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",rr]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Xu,Yd,tw]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},lO=$5(aO);function cn(...t){return lO(zP(t))}const cO=t5,tM=I.forwardRef(({className:t,...e},r)=>v.jsx(IP,{ref:r,className:cn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));tM.displayName=IP.displayName;const uO=Jy("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),nM=I.forwardRef(({className:t,variant:e,...r},l)=>v.jsx(RP,{ref:l,className:cn(uO({variant:e}),t),...r}));nM.displayName=RP.displayName;const dO=I.forwardRef(({className:t,...e},r)=>v.jsx(DP,{ref:r,className:cn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...e}));dO.displayName=DP.displayName;const rM=I.forwardRef(({className:t,...e},r)=>v.jsx(LP,{ref:r,className:cn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:v.jsx(xi,{className:"h-4 w-4"})}));rM.displayName=LP.displayName;const iM=I.forwardRef(({className:t,...e},r)=>v.jsx(NP,{ref:r,className:cn("text-sm font-semibold",t),...e}));iM.displayName=NP.displayName;const sM=I.forwardRef(({className:t,...e},r)=>v.jsx(jP,{ref:r,className:cn("text-sm opacity-90",t),...e}));sM.displayName=jP.displayName;function hO(){const{toasts:t}=sL();return v.jsxs(cO,{children:[t.map(function({id:e,title:r,description:l,action:u,...f}){const{key:g,...w}=f;return v.jsxs(nM,{...w,children:[" ",v.jsxs("div",{className:"grid gap-1",children:[r&&v.jsx(iM,{children:r}),l&&v.jsx(sM,{children:l})]}),u,v.jsx(rM,{})]},e)}),v.jsx(tM,{})]})}var WE=["light","dark"],fO="(prefers-color-scheme: dark)",pO=I.createContext(void 0),mO={setTheme:t=>{},themes:[]},gO=()=>{var t;return(t=I.useContext(pO))!=null?t:mO};I.memo(({forcedTheme:t,storageKey:e,attribute:r,enableSystem:l,enableColorScheme:u,defaultTheme:f,value:g,attrs:w,nonce:s})=>{let S=f==="system",A=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${w.map(W=>`'${W}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,j=u?WE.includes(f)&&f?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${f}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",O=(W,U=!1,q=!0)=>{let Q=g?g[W]:W,J=U?W+"|| ''":`'${Q}'`,Y="";return u&&q&&!U&&WE.includes(W)&&(Y+=`d.style.colorScheme = '${W}';`),r==="class"?U||Q?Y+=`c.add(${J})`:Y+="null":Q&&(Y+=`d[s](n,${J})`),Y},L=t?`!function(){${A}${O(t)}}()`:l?`!function(){try{${A}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${S})){var t='${fO}',m=window.matchMedia(t);if(m.media!==t||m.matches){${O("dark")}}else{${O("light")}}}else if(e){${g?`var x=${JSON.stringify(g)};`:""}${O(g?"x[e]":"e",!0)}}${S?"":"else{"+O(f,!1,!1)+"}"}${j}}catch(e){}}()`:`!function(){try{${A}var e=localStorage.getItem('${e}');if(e){${g?`var x=${JSON.stringify(g)};`:""}${O(g?"x[e]":"e",!0)}}else{${O(f,!1,!1)};}${j}}catch(t){}}();`;return I.createElement("script",{nonce:s,dangerouslySetInnerHTML:{__html:L}})});var yO=t=>{switch(t){case"success":return xO;case"info":return bO;case"warning":return wO;case"error":return TO;default:return null}},_O=Array(12).fill(0),vO=({visible:t,className:e})=>Kt.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},Kt.createElement("div",{className:"sonner-spinner"},_O.map((r,l)=>Kt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${l}`})))),xO=Kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Kt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),wO=Kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Kt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),bO=Kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Kt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),TO=Kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Kt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),SO=Kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Kt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Kt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),EO=()=>{let[t,e]=Kt.useState(document.hidden);return Kt.useEffect(()=>{let r=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t},Yw=1,CO=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;let{message:r,...l}=t,u=typeof t?.id=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:Yw++,f=this.toasts.find(w=>w.id===u),g=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(u)&&this.dismissedToasts.delete(u),f?this.toasts=this.toasts.map(w=>w.id===u?(this.publish({...w,...t,id:u,title:r}),{...w,...t,id:u,dismissible:g,title:r}):w):this.addToast({title:r,...l,dismissible:g,id:u}),u},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(e=>{this.subscribers.forEach(r=>r({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:t,dismiss:!0})),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let r;e.loading!==void 0&&(r=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let l=t instanceof Promise?t:t(),u=r!==void 0,f,g=l.then(async s=>{if(f=["resolve",s],Kt.isValidElement(s))u=!1,this.create({id:r,type:"default",message:s});else if(AO(s)&&!s.ok){u=!1;let S=typeof e.error=="function"?await e.error(`HTTP error! status: ${s.status}`):e.error,A=typeof e.description=="function"?await e.description(`HTTP error! status: ${s.status}`):e.description;this.create({id:r,type:"error",message:S,description:A})}else if(e.success!==void 0){u=!1;let S=typeof e.success=="function"?await e.success(s):e.success,A=typeof e.description=="function"?await e.description(s):e.description;this.create({id:r,type:"success",message:S,description:A})}}).catch(async s=>{if(f=["reject",s],e.error!==void 0){u=!1;let S=typeof e.error=="function"?await e.error(s):e.error,A=typeof e.description=="function"?await e.description(s):e.description;this.create({id:r,type:"error",message:S,description:A})}}).finally(()=>{var s;u&&(this.dismiss(r),r=void 0),(s=e.finally)==null||s.call(e)}),w=()=>new Promise((s,S)=>g.then(()=>f[0]==="reject"?S(f[1]):s(f[1])).catch(S));return typeof r!="string"&&typeof r!="number"?{unwrap:w}:Object.assign(r,{unwrap:w})},this.custom=(t,e)=>{let r=e?.id||Yw++;return this.create({jsx:t(r),id:r,...e}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},ua=new CO,kO=(t,e)=>{let r=e?.id||Yw++;return ua.addToast({title:t,...e,id:r}),r},AO=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",PO=kO,MO=()=>ua.toasts,IO=()=>ua.getActiveToasts(),Jt=Object.assign(PO,{success:ua.success,info:ua.info,warning:ua.warning,error:ua.error,custom:ua.custom,message:ua.message,promise:ua.promise,dismiss:ua.dismiss,loading:ua.loading},{getHistory:MO,getToasts:IO});function RO(t,{insertAt:e}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",e==="top"&&r.firstChild?r.insertBefore(l,r.firstChild):r.appendChild(l),l.styleSheet?l.styleSheet.cssText=t:l.appendChild(document.createTextNode(t))}RO(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function rv(t){return t.label!==void 0}var NO=3,jO="32px",DO="16px",ZE=4e3,LO=356,OO=14,zO=20,BO=200;function Wl(...t){return t.filter(Boolean).join(" ")}function FO(t){let[e,r]=t.split("-"),l=[];return e&&l.push(e),r&&l.push(r),l}var VO=t=>{var e,r,l,u,f,g,w,s,S,A,j;let{invert:O,toast:L,unstyled:W,interacting:U,setHeights:q,visibleToasts:Q,heights:J,index:Y,toasts:ie,expanded:_e,removeToast:Se,defaultRichColors:Ie,closeButton:Ue,style:Je,cancelButtonStyle:Me,actionButtonStyle:lt,className:ft="",descriptionClassName:mt="",duration:gt,position:Lt,gap:it,loadingIcon:We,expandByDefault:Le,classNames:we,icons:st,closeButtonAriaLabel:ke="Close toast",pauseWhenPageIsHidden:Ve}=t,[bt,wt]=Kt.useState(null),[Yt,Mt]=Kt.useState(null),[ct,Nt]=Kt.useState(!1),[xn,un]=Kt.useState(!1),[Rn,sn]=Kt.useState(!1),[kr,vr]=Kt.useState(!1),[Es,Jn]=Kt.useState(!1),[Ar,io]=Kt.useState(0),[wi,Xr]=Kt.useState(0),ii=Kt.useRef(L.duration||gt||ZE),cs=Kt.useRef(null),Ki=Kt.useRef(null),zs=Y===0,Cs=Y+1<=Q,Gr=L.type,us=L.dismissible!==!1,bi=L.className||"",Bs=L.descriptionClassName||"",Xi=Kt.useMemo(()=>J.findIndex(xe=>xe.toastId===L.id)||0,[J,L.id]),Mi=Kt.useMemo(()=>{var xe;return(xe=L.closeButton)!=null?xe:Ue},[L.closeButton,Ue]),ko=Kt.useMemo(()=>L.duration||gt||ZE,[L.duration,gt]),so=Kt.useRef(0),Ii=Kt.useRef(0),ds=Kt.useRef(0),si=Kt.useRef(null),[Fs,oo]=Lt.split("-"),Ao=Kt.useMemo(()=>J.reduce((xe,ze,Be)=>Be>=Xi?xe:xe+ze.height,0),[J,Xi]),be=EO(),re=L.invert||O,se=Gr==="loading";Ii.current=Kt.useMemo(()=>Xi*it+Ao,[Xi,Ao]),Kt.useEffect(()=>{ii.current=ko},[ko]),Kt.useEffect(()=>{Nt(!0)},[]),Kt.useEffect(()=>{let xe=Ki.current;if(xe){let ze=xe.getBoundingClientRect().height;return Xr(ze),q(Be=>[{toastId:L.id,height:ze,position:L.position},...Be]),()=>q(Be=>Be.filter(Oe=>Oe.toastId!==L.id))}},[q,L.id]),Kt.useLayoutEffect(()=>{if(!ct)return;let xe=Ki.current,ze=xe.style.height;xe.style.height="auto";let Be=xe.getBoundingClientRect().height;xe.style.height=ze,Xr(Be),q(Oe=>Oe.find(Ze=>Ze.toastId===L.id)?Oe.map(Ze=>Ze.toastId===L.id?{...Ze,height:Be}:Ze):[{toastId:L.id,height:Be,position:L.position},...Oe])},[ct,L.title,L.description,q,L.id]);let de=Kt.useCallback(()=>{un(!0),io(Ii.current),q(xe=>xe.filter(ze=>ze.toastId!==L.id)),setTimeout(()=>{Se(L)},BO)},[L,Se,q,Ii]);Kt.useEffect(()=>{if(L.promise&&Gr==="loading"||L.duration===1/0||L.type==="loading")return;let xe;return _e||U||Ve&&be?(()=>{if(ds.current<so.current){let ze=new Date().getTime()-so.current;ii.current=ii.current-ze}ds.current=new Date().getTime()})():ii.current!==1/0&&(so.current=new Date().getTime(),xe=setTimeout(()=>{var ze;(ze=L.onAutoClose)==null||ze.call(L,L),de()},ii.current)),()=>clearTimeout(xe)},[_e,U,L,Gr,Ve,be,de]),Kt.useEffect(()=>{L.delete&&de()},[de,L.delete]);function Te(){var xe,ze,Be;return st!=null&&st.loading?Kt.createElement("div",{className:Wl(we?.loader,(xe=L?.classNames)==null?void 0:xe.loader,"sonner-loader"),"data-visible":Gr==="loading"},st.loading):We?Kt.createElement("div",{className:Wl(we?.loader,(ze=L?.classNames)==null?void 0:ze.loader,"sonner-loader"),"data-visible":Gr==="loading"},We):Kt.createElement(vO,{className:Wl(we?.loader,(Be=L?.classNames)==null?void 0:Be.loader),visible:Gr==="loading"})}return Kt.createElement("li",{tabIndex:0,ref:Ki,className:Wl(ft,bi,we?.toast,(e=L?.classNames)==null?void 0:e.toast,we?.default,we?.[Gr],(r=L?.classNames)==null?void 0:r[Gr]),"data-sonner-toast":"","data-rich-colors":(l=L.richColors)!=null?l:Ie,"data-styled":!(L.jsx||L.unstyled||W),"data-mounted":ct,"data-promise":!!L.promise,"data-swiped":Es,"data-removed":xn,"data-visible":Cs,"data-y-position":Fs,"data-x-position":oo,"data-index":Y,"data-front":zs,"data-swiping":Rn,"data-dismissible":us,"data-type":Gr,"data-invert":re,"data-swipe-out":kr,"data-swipe-direction":Yt,"data-expanded":!!(_e||Le&&ct),style:{"--index":Y,"--toasts-before":Y,"--z-index":ie.length-Y,"--offset":`${xn?Ar:Ii.current}px`,"--initial-height":Le?"auto":`${wi}px`,...Je,...L.style},onDragEnd:()=>{sn(!1),wt(null),si.current=null},onPointerDown:xe=>{se||!us||(cs.current=new Date,io(Ii.current),xe.target.setPointerCapture(xe.pointerId),xe.target.tagName!=="BUTTON"&&(sn(!0),si.current={x:xe.clientX,y:xe.clientY}))},onPointerUp:()=>{var xe,ze,Be,Oe;if(kr||!us)return;si.current=null;let Ze=Number(((xe=Ki.current)==null?void 0:xe.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),St=Number(((ze=Ki.current)==null?void 0:ze.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),jt=new Date().getTime()-((Be=cs.current)==null?void 0:Be.getTime()),xt=bt==="x"?Ze:St,bn=Math.abs(xt)/jt;if(Math.abs(xt)>=zO||bn>.11){io(Ii.current),(Oe=L.onDismiss)==null||Oe.call(L,L),Mt(bt==="x"?Ze>0?"right":"left":St>0?"down":"up"),de(),vr(!0),Jn(!1);return}sn(!1),wt(null)},onPointerMove:xe=>{var ze,Be,Oe,Ze;if(!si.current||!us||((ze=window.getSelection())==null?void 0:ze.toString().length)>0)return;let St=xe.clientY-si.current.y,jt=xe.clientX-si.current.x,xt=(Be=t.swipeDirections)!=null?Be:FO(Lt);!bt&&(Math.abs(jt)>1||Math.abs(St)>1)&&wt(Math.abs(jt)>Math.abs(St)?"x":"y");let bn={x:0,y:0};bt==="y"?(xt.includes("top")||xt.includes("bottom"))&&(xt.includes("top")&&St<0||xt.includes("bottom")&&St>0)&&(bn.y=St):bt==="x"&&(xt.includes("left")||xt.includes("right"))&&(xt.includes("left")&&jt<0||xt.includes("right")&&jt>0)&&(bn.x=jt),(Math.abs(bn.x)>0||Math.abs(bn.y)>0)&&Jn(!0),(Oe=Ki.current)==null||Oe.style.setProperty("--swipe-amount-x",`${bn.x}px`),(Ze=Ki.current)==null||Ze.style.setProperty("--swipe-amount-y",`${bn.y}px`)}},Mi&&!L.jsx?Kt.createElement("button",{"aria-label":ke,"data-disabled":se,"data-close-button":!0,onClick:se||!us?()=>{}:()=>{var xe;de(),(xe=L.onDismiss)==null||xe.call(L,L)},className:Wl(we?.closeButton,(u=L?.classNames)==null?void 0:u.closeButton)},(f=st?.close)!=null?f:SO):null,L.jsx||I.isValidElement(L.title)?L.jsx?L.jsx:typeof L.title=="function"?L.title():L.title:Kt.createElement(Kt.Fragment,null,Gr||L.icon||L.promise?Kt.createElement("div",{"data-icon":"",className:Wl(we?.icon,(g=L?.classNames)==null?void 0:g.icon)},L.promise||L.type==="loading"&&!L.icon?L.icon||Te():null,L.type!=="loading"?L.icon||st?.[Gr]||yO(Gr):null):null,Kt.createElement("div",{"data-content":"",className:Wl(we?.content,(w=L?.classNames)==null?void 0:w.content)},Kt.createElement("div",{"data-title":"",className:Wl(we?.title,(s=L?.classNames)==null?void 0:s.title)},typeof L.title=="function"?L.title():L.title),L.description?Kt.createElement("div",{"data-description":"",className:Wl(mt,Bs,we?.description,(S=L?.classNames)==null?void 0:S.description)},typeof L.description=="function"?L.description():L.description):null),I.isValidElement(L.cancel)?L.cancel:L.cancel&&rv(L.cancel)?Kt.createElement("button",{"data-button":!0,"data-cancel":!0,style:L.cancelButtonStyle||Me,onClick:xe=>{var ze,Be;rv(L.cancel)&&us&&((Be=(ze=L.cancel).onClick)==null||Be.call(ze,xe),de())},className:Wl(we?.cancelButton,(A=L?.classNames)==null?void 0:A.cancelButton)},L.cancel.label):null,I.isValidElement(L.action)?L.action:L.action&&rv(L.action)?Kt.createElement("button",{"data-button":!0,"data-action":!0,style:L.actionButtonStyle||lt,onClick:xe=>{var ze,Be;rv(L.action)&&((Be=(ze=L.action).onClick)==null||Be.call(ze,xe),!xe.defaultPrevented&&de())},className:Wl(we?.actionButton,(j=L?.classNames)==null?void 0:j.actionButton)},L.action.label):null))};function KE(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function UO(t,e){let r={};return[t,e].forEach((l,u)=>{let f=u===1,g=f?"--mobile-offset":"--offset",w=f?DO:jO;function s(S){["top","right","bottom","left"].forEach(A=>{r[`${g}-${A}`]=typeof S=="number"?`${S}px`:S})}typeof l=="number"||typeof l=="string"?s(l):typeof l=="object"?["top","right","bottom","left"].forEach(S=>{l[S]===void 0?r[`${g}-${S}`]=w:r[`${g}-${S}`]=typeof l[S]=="number"?`${l[S]}px`:l[S]}):s(w)}),r}var $O=I.forwardRef(function(t,e){let{invert:r,position:l="bottom-right",hotkey:u=["altKey","KeyT"],expand:f,closeButton:g,className:w,offset:s,mobileOffset:S,theme:A="light",richColors:j,duration:O,style:L,visibleToasts:W=NO,toastOptions:U,dir:q=KE(),gap:Q=OO,loadingIcon:J,icons:Y,containerAriaLabel:ie="Notifications",pauseWhenPageIsHidden:_e}=t,[Se,Ie]=Kt.useState([]),Ue=Kt.useMemo(()=>Array.from(new Set([l].concat(Se.filter(Ve=>Ve.position).map(Ve=>Ve.position)))),[Se,l]),[Je,Me]=Kt.useState([]),[lt,ft]=Kt.useState(!1),[mt,gt]=Kt.useState(!1),[Lt,it]=Kt.useState(A!=="system"?A:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),We=Kt.useRef(null),Le=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),we=Kt.useRef(null),st=Kt.useRef(!1),ke=Kt.useCallback(Ve=>{Ie(bt=>{var wt;return(wt=bt.find(Yt=>Yt.id===Ve.id))!=null&&wt.delete||ua.dismiss(Ve.id),bt.filter(({id:Yt})=>Yt!==Ve.id)})},[]);return Kt.useEffect(()=>ua.subscribe(Ve=>{if(Ve.dismiss){Ie(bt=>bt.map(wt=>wt.id===Ve.id?{...wt,delete:!0}:wt));return}setTimeout(()=>{fP.flushSync(()=>{Ie(bt=>{let wt=bt.findIndex(Yt=>Yt.id===Ve.id);return wt!==-1?[...bt.slice(0,wt),{...bt[wt],...Ve},...bt.slice(wt+1)]:[Ve,...bt]})})})}),[]),Kt.useEffect(()=>{if(A!=="system"){it(A);return}if(A==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?it("dark"):it("light")),typeof window>"u")return;let Ve=window.matchMedia("(prefers-color-scheme: dark)");try{Ve.addEventListener("change",({matches:bt})=>{it(bt?"dark":"light")})}catch{Ve.addListener(({matches:wt})=>{try{it(wt?"dark":"light")}catch(Yt){console.error(Yt)}})}},[A]),Kt.useEffect(()=>{Se.length<=1&&ft(!1)},[Se]),Kt.useEffect(()=>{let Ve=bt=>{var wt,Yt;u.every(Mt=>bt[Mt]||bt.code===Mt)&&(ft(!0),(wt=We.current)==null||wt.focus()),bt.code==="Escape"&&(document.activeElement===We.current||(Yt=We.current)!=null&&Yt.contains(document.activeElement))&&ft(!1)};return document.addEventListener("keydown",Ve),()=>document.removeEventListener("keydown",Ve)},[u]),Kt.useEffect(()=>{if(We.current)return()=>{we.current&&(we.current.focus({preventScroll:!0}),we.current=null,st.current=!1)}},[We.current]),Kt.createElement("section",{ref:e,"aria-label":`${ie} ${Le}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ue.map((Ve,bt)=>{var wt;let[Yt,Mt]=Ve.split("-");return Se.length?Kt.createElement("ol",{key:Ve,dir:q==="auto"?KE():q,tabIndex:-1,ref:We,className:w,"data-sonner-toaster":!0,"data-theme":Lt,"data-y-position":Yt,"data-lifted":lt&&Se.length>1&&!f,"data-x-position":Mt,style:{"--front-toast-height":`${((wt=Je[0])==null?void 0:wt.height)||0}px`,"--width":`${LO}px`,"--gap":`${Q}px`,...L,...UO(s,S)},onBlur:ct=>{st.current&&!ct.currentTarget.contains(ct.relatedTarget)&&(st.current=!1,we.current&&(we.current.focus({preventScroll:!0}),we.current=null))},onFocus:ct=>{ct.target instanceof HTMLElement&&ct.target.dataset.dismissible==="false"||st.current||(st.current=!0,we.current=ct.relatedTarget)},onMouseEnter:()=>ft(!0),onMouseMove:()=>ft(!0),onMouseLeave:()=>{mt||ft(!1)},onDragEnd:()=>ft(!1),onPointerDown:ct=>{ct.target instanceof HTMLElement&&ct.target.dataset.dismissible==="false"||gt(!0)},onPointerUp:()=>gt(!1)},Se.filter(ct=>!ct.position&&bt===0||ct.position===Ve).map((ct,Nt)=>{var xn,un;return Kt.createElement(VO,{key:ct.id,icons:Y,index:Nt,toast:ct,defaultRichColors:j,duration:(xn=U?.duration)!=null?xn:O,className:U?.className,descriptionClassName:U?.descriptionClassName,invert:r,visibleToasts:W,closeButton:(un=U?.closeButton)!=null?un:g,interacting:mt,position:Ve,style:U?.style,unstyled:U?.unstyled,classNames:U?.classNames,cancelButtonStyle:U?.cancelButtonStyle,actionButtonStyle:U?.actionButtonStyle,removeToast:ke,toasts:Se.filter(Rn=>Rn.position==ct.position),heights:Je.filter(Rn=>Rn.position==ct.position),setHeights:Me,expandByDefault:f,gap:Q,loadingIcon:J,expanded:lt,pauseWhenPageIsHidden:_e,swipeDirections:t.swipeDirections})})):null}))});const GO=({...t})=>{const{theme:e="system"}=gO();return v.jsx($O,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var HO=l0[" useId ".trim().toString()]||(()=>{}),qO=0;function Qc(t){const[e,r]=I.useState(HO());return Zi(()=>{r(l=>l??String(qO++))},[t]),e?`radix-${e}`:""}const WO=["top","right","bottom","left"],ph=Math.min,Ra=Math.max,Nv=Math.round,iv=Math.floor,eu=t=>({x:t,y:t}),ZO={left:"right",right:"left",bottom:"top",top:"bottom"},KO={start:"end",end:"start"};function Jw(t,e,r){return Ra(t,ph(e,r))}function ed(t,e){return typeof t=="function"?t(e):t}function td(t){return t.split("-")[0]}function Zm(t){return t.split("-")[1]}function v1(t){return t==="x"?"y":"x"}function x1(t){return t==="y"?"height":"width"}const XO=new Set(["top","bottom"]);function Jc(t){return XO.has(td(t))?"y":"x"}function w1(t){return v1(Jc(t))}function YO(t,e,r){r===void 0&&(r=!1);const l=Zm(t),u=w1(t),f=x1(u);let g=u==="x"?l===(r?"end":"start")?"right":"left":l==="start"?"bottom":"top";return e.reference[f]>e.floating[f]&&(g=jv(g)),[g,jv(g)]}function JO(t){const e=jv(t);return[Qw(t),e,Qw(e)]}function Qw(t){return t.replace(/start|end/g,e=>KO[e])}const XE=["left","right"],YE=["right","left"],QO=["top","bottom"],ez=["bottom","top"];function tz(t,e,r){switch(t){case"top":case"bottom":return r?e?YE:XE:e?XE:YE;case"left":case"right":return e?QO:ez;default:return[]}}function nz(t,e,r,l){const u=Zm(t);let f=tz(td(t),r==="start",l);return u&&(f=f.map(g=>g+"-"+u),e&&(f=f.concat(f.map(Qw)))),f}function jv(t){return t.replace(/left|right|bottom|top/g,e=>ZO[e])}function rz(t){return{top:0,right:0,bottom:0,left:0,...t}}function oM(t){return typeof t!="number"?rz(t):{top:t,right:t,bottom:t,left:t}}function Dv(t){const{x:e,y:r,width:l,height:u}=t;return{width:l,height:u,top:r,left:e,right:e+l,bottom:r+u,x:e,y:r}}function JE(t,e,r){let{reference:l,floating:u}=t;const f=Jc(e),g=w1(e),w=x1(g),s=td(e),S=f==="y",A=l.x+l.width/2-u.width/2,j=l.y+l.height/2-u.height/2,O=l[w]/2-u[w]/2;let L;switch(s){case"top":L={x:A,y:l.y-u.height};break;case"bottom":L={x:A,y:l.y+l.height};break;case"right":L={x:l.x+l.width,y:j};break;case"left":L={x:l.x-u.width,y:j};break;default:L={x:l.x,y:l.y}}switch(Zm(e)){case"start":L[g]-=O*(r&&S?-1:1);break;case"end":L[g]+=O*(r&&S?-1:1);break}return L}const iz=async(t,e,r)=>{const{placement:l="bottom",strategy:u="absolute",middleware:f=[],platform:g}=r,w=f.filter(Boolean),s=await(g.isRTL==null?void 0:g.isRTL(e));let S=await g.getElementRects({reference:t,floating:e,strategy:u}),{x:A,y:j}=JE(S,l,s),O=l,L={},W=0;for(let U=0;U<w.length;U++){const{name:q,fn:Q}=w[U],{x:J,y:Y,data:ie,reset:_e}=await Q({x:A,y:j,initialPlacement:l,placement:O,strategy:u,middlewareData:L,rects:S,platform:g,elements:{reference:t,floating:e}});A=J??A,j=Y??j,L={...L,[q]:{...L[q],...ie}},_e&&W<=50&&(W++,typeof _e=="object"&&(_e.placement&&(O=_e.placement),_e.rects&&(S=_e.rects===!0?await g.getElementRects({reference:t,floating:e,strategy:u}):_e.rects),{x:A,y:j}=JE(S,O,s)),U=-1)}return{x:A,y:j,placement:O,strategy:u,middlewareData:L}};async function Ay(t,e){var r;e===void 0&&(e={});const{x:l,y:u,platform:f,rects:g,elements:w,strategy:s}=t,{boundary:S="clippingAncestors",rootBoundary:A="viewport",elementContext:j="floating",altBoundary:O=!1,padding:L=0}=ed(e,t),W=oM(L),q=w[O?j==="floating"?"reference":"floating":j],Q=Dv(await f.getClippingRect({element:(r=await(f.isElement==null?void 0:f.isElement(q)))==null||r?q:q.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(w.floating)),boundary:S,rootBoundary:A,strategy:s})),J=j==="floating"?{x:l,y:u,width:g.floating.width,height:g.floating.height}:g.reference,Y=await(f.getOffsetParent==null?void 0:f.getOffsetParent(w.floating)),ie=await(f.isElement==null?void 0:f.isElement(Y))?await(f.getScale==null?void 0:f.getScale(Y))||{x:1,y:1}:{x:1,y:1},_e=Dv(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:w,rect:J,offsetParent:Y,strategy:s}):J);return{top:(Q.top-_e.top+W.top)/ie.y,bottom:(_e.bottom-Q.bottom+W.bottom)/ie.y,left:(Q.left-_e.left+W.left)/ie.x,right:(_e.right-Q.right+W.right)/ie.x}}const sz=t=>({name:"arrow",options:t,async fn(e){const{x:r,y:l,placement:u,rects:f,platform:g,elements:w,middlewareData:s}=e,{element:S,padding:A=0}=ed(t,e)||{};if(S==null)return{};const j=oM(A),O={x:r,y:l},L=w1(u),W=x1(L),U=await g.getDimensions(S),q=L==="y",Q=q?"top":"left",J=q?"bottom":"right",Y=q?"clientHeight":"clientWidth",ie=f.reference[W]+f.reference[L]-O[L]-f.floating[W],_e=O[L]-f.reference[L],Se=await(g.getOffsetParent==null?void 0:g.getOffsetParent(S));let Ie=Se?Se[Y]:0;(!Ie||!await(g.isElement==null?void 0:g.isElement(Se)))&&(Ie=w.floating[Y]||f.floating[W]);const Ue=ie/2-_e/2,Je=Ie/2-U[W]/2-1,Me=ph(j[Q],Je),lt=ph(j[J],Je),ft=Me,mt=Ie-U[W]-lt,gt=Ie/2-U[W]/2+Ue,Lt=Jw(ft,gt,mt),it=!s.arrow&&Zm(u)!=null&&gt!==Lt&&f.reference[W]/2-(gt<ft?Me:lt)-U[W]/2<0,We=it?gt<ft?gt-ft:gt-mt:0;return{[L]:O[L]+We,data:{[L]:Lt,centerOffset:gt-Lt-We,...it&&{alignmentOffset:We}},reset:it}}}),oz=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var r,l;const{placement:u,middlewareData:f,rects:g,initialPlacement:w,platform:s,elements:S}=e,{mainAxis:A=!0,crossAxis:j=!0,fallbackPlacements:O,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:W="none",flipAlignment:U=!0,...q}=ed(t,e);if((r=f.arrow)!=null&&r.alignmentOffset)return{};const Q=td(u),J=Jc(w),Y=td(w)===w,ie=await(s.isRTL==null?void 0:s.isRTL(S.floating)),_e=O||(Y||!U?[jv(w)]:JO(w)),Se=W!=="none";!O&&Se&&_e.push(...nz(w,U,W,ie));const Ie=[w,..._e],Ue=await Ay(e,q),Je=[];let Me=((l=f.flip)==null?void 0:l.overflows)||[];if(A&&Je.push(Ue[Q]),j){const gt=YO(u,g,ie);Je.push(Ue[gt[0]],Ue[gt[1]])}if(Me=[...Me,{placement:u,overflows:Je}],!Je.every(gt=>gt<=0)){var lt,ft;const gt=(((lt=f.flip)==null?void 0:lt.index)||0)+1,Lt=Ie[gt];if(Lt&&(!(j==="alignment"?J!==Jc(Lt):!1)||Me.every(Le=>Jc(Le.placement)===J?Le.overflows[0]>0:!0)))return{data:{index:gt,overflows:Me},reset:{placement:Lt}};let it=(ft=Me.filter(We=>We.overflows[0]<=0).sort((We,Le)=>We.overflows[1]-Le.overflows[1])[0])==null?void 0:ft.placement;if(!it)switch(L){case"bestFit":{var mt;const We=(mt=Me.filter(Le=>{if(Se){const we=Jc(Le.placement);return we===J||we==="y"}return!0}).map(Le=>[Le.placement,Le.overflows.filter(we=>we>0).reduce((we,st)=>we+st,0)]).sort((Le,we)=>Le[1]-we[1])[0])==null?void 0:mt[0];We&&(it=We);break}case"initialPlacement":it=w;break}if(u!==it)return{reset:{placement:it}}}return{}}}};function QE(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function eC(t){return WO.some(e=>t[e]>=0)}const az=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:r}=e,{strategy:l="referenceHidden",...u}=ed(t,e);switch(l){case"referenceHidden":{const f=await Ay(e,{...u,elementContext:"reference"}),g=QE(f,r.reference);return{data:{referenceHiddenOffsets:g,referenceHidden:eC(g)}}}case"escaped":{const f=await Ay(e,{...u,altBoundary:!0}),g=QE(f,r.floating);return{data:{escapedOffsets:g,escaped:eC(g)}}}default:return{}}}}},aM=new Set(["left","top"]);async function lz(t,e){const{placement:r,platform:l,elements:u}=t,f=await(l.isRTL==null?void 0:l.isRTL(u.floating)),g=td(r),w=Zm(r),s=Jc(r)==="y",S=aM.has(g)?-1:1,A=f&&s?-1:1,j=ed(e,t);let{mainAxis:O,crossAxis:L,alignmentAxis:W}=typeof j=="number"?{mainAxis:j,crossAxis:0,alignmentAxis:null}:{mainAxis:j.mainAxis||0,crossAxis:j.crossAxis||0,alignmentAxis:j.alignmentAxis};return w&&typeof W=="number"&&(L=w==="end"?W*-1:W),s?{x:L*A,y:O*S}:{x:O*S,y:L*A}}const cz=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var r,l;const{x:u,y:f,placement:g,middlewareData:w}=e,s=await lz(e,t);return g===((r=w.offset)==null?void 0:r.placement)&&(l=w.arrow)!=null&&l.alignmentOffset?{}:{x:u+s.x,y:f+s.y,data:{...s,placement:g}}}}},uz=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:r,y:l,placement:u}=e,{mainAxis:f=!0,crossAxis:g=!1,limiter:w={fn:q=>{let{x:Q,y:J}=q;return{x:Q,y:J}}},...s}=ed(t,e),S={x:r,y:l},A=await Ay(e,s),j=Jc(td(u)),O=v1(j);let L=S[O],W=S[j];if(f){const q=O==="y"?"top":"left",Q=O==="y"?"bottom":"right",J=L+A[q],Y=L-A[Q];L=Jw(J,L,Y)}if(g){const q=j==="y"?"top":"left",Q=j==="y"?"bottom":"right",J=W+A[q],Y=W-A[Q];W=Jw(J,W,Y)}const U=w.fn({...e,[O]:L,[j]:W});return{...U,data:{x:U.x-r,y:U.y-l,enabled:{[O]:f,[j]:g}}}}}},dz=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:r,y:l,placement:u,rects:f,middlewareData:g}=e,{offset:w=0,mainAxis:s=!0,crossAxis:S=!0}=ed(t,e),A={x:r,y:l},j=Jc(u),O=v1(j);let L=A[O],W=A[j];const U=ed(w,e),q=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(s){const Y=O==="y"?"height":"width",ie=f.reference[O]-f.floating[Y]+q.mainAxis,_e=f.reference[O]+f.reference[Y]-q.mainAxis;L<ie?L=ie:L>_e&&(L=_e)}if(S){var Q,J;const Y=O==="y"?"width":"height",ie=aM.has(td(u)),_e=f.reference[j]-f.floating[Y]+(ie&&((Q=g.offset)==null?void 0:Q[j])||0)+(ie?0:q.crossAxis),Se=f.reference[j]+f.reference[Y]+(ie?0:((J=g.offset)==null?void 0:J[j])||0)-(ie?q.crossAxis:0);W<_e?W=_e:W>Se&&(W=Se)}return{[O]:L,[j]:W}}}},hz=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var r,l;const{placement:u,rects:f,platform:g,elements:w}=e,{apply:s=()=>{},...S}=ed(t,e),A=await Ay(e,S),j=td(u),O=Zm(u),L=Jc(u)==="y",{width:W,height:U}=f.floating;let q,Q;j==="top"||j==="bottom"?(q=j,Q=O===(await(g.isRTL==null?void 0:g.isRTL(w.floating))?"start":"end")?"left":"right"):(Q=j,q=O==="end"?"top":"bottom");const J=U-A.top-A.bottom,Y=W-A.left-A.right,ie=ph(U-A[q],J),_e=ph(W-A[Q],Y),Se=!e.middlewareData.shift;let Ie=ie,Ue=_e;if((r=e.middlewareData.shift)!=null&&r.enabled.x&&(Ue=Y),(l=e.middlewareData.shift)!=null&&l.enabled.y&&(Ie=J),Se&&!O){const Me=Ra(A.left,0),lt=Ra(A.right,0),ft=Ra(A.top,0),mt=Ra(A.bottom,0);L?Ue=W-2*(Me!==0||lt!==0?Me+lt:Ra(A.left,A.right)):Ie=U-2*(ft!==0||mt!==0?ft+mt:Ra(A.top,A.bottom))}await s({...e,availableWidth:Ue,availableHeight:Ie});const Je=await g.getDimensions(w.floating);return W!==Je.width||U!==Je.height?{reset:{rects:!0}}:{}}}};function g0(){return typeof window<"u"}function Km(t){return lM(t)?(t.nodeName||"").toLowerCase():"#document"}function La(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function ou(t){var e;return(e=(lM(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function lM(t){return g0()?t instanceof Node||t instanceof La(t).Node:!1}function nc(t){return g0()?t instanceof Element||t instanceof La(t).Element:!1}function ru(t){return g0()?t instanceof HTMLElement||t instanceof La(t).HTMLElement:!1}function tC(t){return!g0()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof La(t).ShadowRoot}const fz=new Set(["inline","contents"]);function e_(t){const{overflow:e,overflowX:r,overflowY:l,display:u}=rc(t);return/auto|scroll|overlay|hidden|clip/.test(e+l+r)&&!fz.has(u)}const pz=new Set(["table","td","th"]);function mz(t){return pz.has(Km(t))}const gz=[":popover-open",":modal"];function y0(t){return gz.some(e=>{try{return t.matches(e)}catch{return!1}})}const yz=["transform","translate","scale","rotate","perspective"],_z=["transform","translate","scale","rotate","perspective","filter"],vz=["paint","layout","strict","content"];function b1(t){const e=T1(),r=nc(t)?rc(t):t;return yz.some(l=>r[l]?r[l]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!e&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!e&&(r.filter?r.filter!=="none":!1)||_z.some(l=>(r.willChange||"").includes(l))||vz.some(l=>(r.contain||"").includes(l))}function xz(t){let e=mh(t);for(;ru(e)&&!Om(e);){if(b1(e))return e;if(y0(e))return null;e=mh(e)}return null}function T1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const wz=new Set(["html","body","#document"]);function Om(t){return wz.has(Km(t))}function rc(t){return La(t).getComputedStyle(t)}function _0(t){return nc(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function mh(t){if(Km(t)==="html")return t;const e=t.assignedSlot||t.parentNode||tC(t)&&t.host||ou(t);return tC(e)?e.host:e}function cM(t){const e=mh(t);return Om(e)?t.ownerDocument?t.ownerDocument.body:t.body:ru(e)&&e_(e)?e:cM(e)}function Py(t,e,r){var l;e===void 0&&(e=[]),r===void 0&&(r=!0);const u=cM(t),f=u===((l=t.ownerDocument)==null?void 0:l.body),g=La(u);if(f){const w=eb(g);return e.concat(g,g.visualViewport||[],e_(u)?u:[],w&&r?Py(w):[])}return e.concat(u,Py(u,[],r))}function eb(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function uM(t){const e=rc(t);let r=parseFloat(e.width)||0,l=parseFloat(e.height)||0;const u=ru(t),f=u?t.offsetWidth:r,g=u?t.offsetHeight:l,w=Nv(r)!==f||Nv(l)!==g;return w&&(r=f,l=g),{width:r,height:l,$:w}}function S1(t){return nc(t)?t:t.contextElement}function Im(t){const e=S1(t);if(!ru(e))return eu(1);const r=e.getBoundingClientRect(),{width:l,height:u,$:f}=uM(e);let g=(f?Nv(r.width):r.width)/l,w=(f?Nv(r.height):r.height)/u;return(!g||!Number.isFinite(g))&&(g=1),(!w||!Number.isFinite(w))&&(w=1),{x:g,y:w}}const bz=eu(0);function dM(t){const e=La(t);return!T1()||!e.visualViewport?bz:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Tz(t,e,r){return e===void 0&&(e=!1),!r||e&&r!==La(t)?!1:e}function qf(t,e,r,l){e===void 0&&(e=!1),r===void 0&&(r=!1);const u=t.getBoundingClientRect(),f=S1(t);let g=eu(1);e&&(l?nc(l)&&(g=Im(l)):g=Im(t));const w=Tz(f,r,l)?dM(f):eu(0);let s=(u.left+w.x)/g.x,S=(u.top+w.y)/g.y,A=u.width/g.x,j=u.height/g.y;if(f){const O=La(f),L=l&&nc(l)?La(l):l;let W=O,U=eb(W);for(;U&&l&&L!==W;){const q=Im(U),Q=U.getBoundingClientRect(),J=rc(U),Y=Q.left+(U.clientLeft+parseFloat(J.paddingLeft))*q.x,ie=Q.top+(U.clientTop+parseFloat(J.paddingTop))*q.y;s*=q.x,S*=q.y,A*=q.x,j*=q.y,s+=Y,S+=ie,W=La(U),U=eb(W)}}return Dv({width:A,height:j,x:s,y:S})}function v0(t,e){const r=_0(t).scrollLeft;return e?e.left+r:qf(ou(t)).left+r}function hM(t,e){const r=t.getBoundingClientRect(),l=r.left+e.scrollLeft-v0(t,r),u=r.top+e.scrollTop;return{x:l,y:u}}function Sz(t){let{elements:e,rect:r,offsetParent:l,strategy:u}=t;const f=u==="fixed",g=ou(l),w=e?y0(e.floating):!1;if(l===g||w&&f)return r;let s={scrollLeft:0,scrollTop:0},S=eu(1);const A=eu(0),j=ru(l);if((j||!j&&!f)&&((Km(l)!=="body"||e_(g))&&(s=_0(l)),ru(l))){const L=qf(l);S=Im(l),A.x=L.x+l.clientLeft,A.y=L.y+l.clientTop}const O=g&&!j&&!f?hM(g,s):eu(0);return{width:r.width*S.x,height:r.height*S.y,x:r.x*S.x-s.scrollLeft*S.x+A.x+O.x,y:r.y*S.y-s.scrollTop*S.y+A.y+O.y}}function Ez(t){return Array.from(t.getClientRects())}function Cz(t){const e=ou(t),r=_0(t),l=t.ownerDocument.body,u=Ra(e.scrollWidth,e.clientWidth,l.scrollWidth,l.clientWidth),f=Ra(e.scrollHeight,e.clientHeight,l.scrollHeight,l.clientHeight);let g=-r.scrollLeft+v0(t);const w=-r.scrollTop;return rc(l).direction==="rtl"&&(g+=Ra(e.clientWidth,l.clientWidth)-u),{width:u,height:f,x:g,y:w}}const nC=25;function kz(t,e){const r=La(t),l=ou(t),u=r.visualViewport;let f=l.clientWidth,g=l.clientHeight,w=0,s=0;if(u){f=u.width,g=u.height;const A=T1();(!A||A&&e==="fixed")&&(w=u.offsetLeft,s=u.offsetTop)}const S=v0(l);if(S<=0){const A=l.ownerDocument,j=A.body,O=getComputedStyle(j),L=A.compatMode==="CSS1Compat"&&parseFloat(O.marginLeft)+parseFloat(O.marginRight)||0,W=Math.abs(l.clientWidth-j.clientWidth-L);W<=nC&&(f-=W)}else S<=nC&&(f+=S);return{width:f,height:g,x:w,y:s}}const Az=new Set(["absolute","fixed"]);function Pz(t,e){const r=qf(t,!0,e==="fixed"),l=r.top+t.clientTop,u=r.left+t.clientLeft,f=ru(t)?Im(t):eu(1),g=t.clientWidth*f.x,w=t.clientHeight*f.y,s=u*f.x,S=l*f.y;return{width:g,height:w,x:s,y:S}}function rC(t,e,r){let l;if(e==="viewport")l=kz(t,r);else if(e==="document")l=Cz(ou(t));else if(nc(e))l=Pz(e,r);else{const u=dM(t);l={x:e.x-u.x,y:e.y-u.y,width:e.width,height:e.height}}return Dv(l)}function fM(t,e){const r=mh(t);return r===e||!nc(r)||Om(r)?!1:rc(r).position==="fixed"||fM(r,e)}function Mz(t,e){const r=e.get(t);if(r)return r;let l=Py(t,[],!1).filter(w=>nc(w)&&Km(w)!=="body"),u=null;const f=rc(t).position==="fixed";let g=f?mh(t):t;for(;nc(g)&&!Om(g);){const w=rc(g),s=b1(g);!s&&w.position==="fixed"&&(u=null),(f?!s&&!u:!s&&w.position==="static"&&!!u&&Az.has(u.position)||e_(g)&&!s&&fM(t,g))?l=l.filter(A=>A!==g):u=w,g=mh(g)}return e.set(t,l),l}function Iz(t){let{element:e,boundary:r,rootBoundary:l,strategy:u}=t;const g=[...r==="clippingAncestors"?y0(e)?[]:Mz(e,this._c):[].concat(r),l],w=g[0],s=g.reduce((S,A)=>{const j=rC(e,A,u);return S.top=Ra(j.top,S.top),S.right=ph(j.right,S.right),S.bottom=ph(j.bottom,S.bottom),S.left=Ra(j.left,S.left),S},rC(e,w,u));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function Rz(t){const{width:e,height:r}=uM(t);return{width:e,height:r}}function Nz(t,e,r){const l=ru(e),u=ou(e),f=r==="fixed",g=qf(t,!0,f,e);let w={scrollLeft:0,scrollTop:0};const s=eu(0);function S(){s.x=v0(u)}if(l||!l&&!f)if((Km(e)!=="body"||e_(u))&&(w=_0(e)),l){const L=qf(e,!0,f,e);s.x=L.x+e.clientLeft,s.y=L.y+e.clientTop}else u&&S();f&&!l&&u&&S();const A=u&&!l&&!f?hM(u,w):eu(0),j=g.left+w.scrollLeft-s.x-A.x,O=g.top+w.scrollTop-s.y-A.y;return{x:j,y:O,width:g.width,height:g.height}}function nw(t){return rc(t).position==="static"}function iC(t,e){if(!ru(t)||rc(t).position==="fixed")return null;if(e)return e(t);let r=t.offsetParent;return ou(t)===r&&(r=r.ownerDocument.body),r}function pM(t,e){const r=La(t);if(y0(t))return r;if(!ru(t)){let u=mh(t);for(;u&&!Om(u);){if(nc(u)&&!nw(u))return u;u=mh(u)}return r}let l=iC(t,e);for(;l&&mz(l)&&nw(l);)l=iC(l,e);return l&&Om(l)&&nw(l)&&!b1(l)?r:l||xz(t)||r}const jz=async function(t){const e=this.getOffsetParent||pM,r=this.getDimensions,l=await r(t.floating);return{reference:Nz(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function Dz(t){return rc(t).direction==="rtl"}const Lz={convertOffsetParentRelativeRectToViewportRelativeRect:Sz,getDocumentElement:ou,getClippingRect:Iz,getOffsetParent:pM,getElementRects:jz,getClientRects:Ez,getDimensions:Rz,getScale:Im,isElement:nc,isRTL:Dz};function mM(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Oz(t,e){let r=null,l;const u=ou(t);function f(){var w;clearTimeout(l),(w=r)==null||w.disconnect(),r=null}function g(w,s){w===void 0&&(w=!1),s===void 0&&(s=1),f();const S=t.getBoundingClientRect(),{left:A,top:j,width:O,height:L}=S;if(w||e(),!O||!L)return;const W=iv(j),U=iv(u.clientWidth-(A+O)),q=iv(u.clientHeight-(j+L)),Q=iv(A),Y={rootMargin:-W+"px "+-U+"px "+-q+"px "+-Q+"px",threshold:Ra(0,ph(1,s))||1};let ie=!0;function _e(Se){const Ie=Se[0].intersectionRatio;if(Ie!==s){if(!ie)return g();Ie?g(!1,Ie):l=setTimeout(()=>{g(!1,1e-7)},1e3)}Ie===1&&!mM(S,t.getBoundingClientRect())&&g(),ie=!1}try{r=new IntersectionObserver(_e,{...Y,root:u.ownerDocument})}catch{r=new IntersectionObserver(_e,Y)}r.observe(t)}return g(!0),f}function zz(t,e,r,l){l===void 0&&(l={});const{ancestorScroll:u=!0,ancestorResize:f=!0,elementResize:g=typeof ResizeObserver=="function",layoutShift:w=typeof IntersectionObserver=="function",animationFrame:s=!1}=l,S=S1(t),A=u||f?[...S?Py(S):[],...Py(e)]:[];A.forEach(Q=>{u&&Q.addEventListener("scroll",r,{passive:!0}),f&&Q.addEventListener("resize",r)});const j=S&&w?Oz(S,r):null;let O=-1,L=null;g&&(L=new ResizeObserver(Q=>{let[J]=Q;J&&J.target===S&&L&&(L.unobserve(e),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var Y;(Y=L)==null||Y.observe(e)})),r()}),S&&!s&&L.observe(S),L.observe(e));let W,U=s?qf(t):null;s&&q();function q(){const Q=qf(t);U&&!mM(U,Q)&&r(),U=Q,W=requestAnimationFrame(q)}return r(),()=>{var Q;A.forEach(J=>{u&&J.removeEventListener("scroll",r),f&&J.removeEventListener("resize",r)}),j?.(),(Q=L)==null||Q.disconnect(),L=null,s&&cancelAnimationFrame(W)}}const Bz=cz,Fz=uz,Vz=oz,Uz=hz,$z=az,sC=sz,Gz=dz,Hz=(t,e,r)=>{const l=new Map,u={platform:Lz,...r},f={...u.platform,_c:l};return iz(t,e,{...u,platform:f})};var qz=typeof document<"u",Wz=function(){},bv=qz?I.useLayoutEffect:Wz;function Lv(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let r,l,u;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(l=r;l--!==0;)if(!Lv(t[l],e[l]))return!1;return!0}if(u=Object.keys(t),r=u.length,r!==Object.keys(e).length)return!1;for(l=r;l--!==0;)if(!{}.hasOwnProperty.call(e,u[l]))return!1;for(l=r;l--!==0;){const f=u[l];if(!(f==="_owner"&&t.$$typeof)&&!Lv(t[f],e[f]))return!1}return!0}return t!==t&&e!==e}function gM(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function oC(t,e){const r=gM(t);return Math.round(e*r)/r}function rw(t){const e=I.useRef(t);return bv(()=>{e.current=t}),e}function Zz(t){t===void 0&&(t={});const{placement:e="bottom",strategy:r="absolute",middleware:l=[],platform:u,elements:{reference:f,floating:g}={},transform:w=!0,whileElementsMounted:s,open:S}=t,[A,j]=I.useState({x:0,y:0,strategy:r,placement:e,middlewareData:{},isPositioned:!1}),[O,L]=I.useState(l);Lv(O,l)||L(l);const[W,U]=I.useState(null),[q,Q]=I.useState(null),J=I.useCallback(Le=>{Le!==Se.current&&(Se.current=Le,U(Le))},[]),Y=I.useCallback(Le=>{Le!==Ie.current&&(Ie.current=Le,Q(Le))},[]),ie=f||W,_e=g||q,Se=I.useRef(null),Ie=I.useRef(null),Ue=I.useRef(A),Je=s!=null,Me=rw(s),lt=rw(u),ft=rw(S),mt=I.useCallback(()=>{if(!Se.current||!Ie.current)return;const Le={placement:e,strategy:r,middleware:O};lt.current&&(Le.platform=lt.current),Hz(Se.current,Ie.current,Le).then(we=>{const st={...we,isPositioned:ft.current!==!1};gt.current&&!Lv(Ue.current,st)&&(Ue.current=st,xh.flushSync(()=>{j(st)}))})},[O,e,r,lt,ft]);bv(()=>{S===!1&&Ue.current.isPositioned&&(Ue.current.isPositioned=!1,j(Le=>({...Le,isPositioned:!1})))},[S]);const gt=I.useRef(!1);bv(()=>(gt.current=!0,()=>{gt.current=!1}),[]),bv(()=>{if(ie&&(Se.current=ie),_e&&(Ie.current=_e),ie&&_e){if(Me.current)return Me.current(ie,_e,mt);mt()}},[ie,_e,mt,Me,Je]);const Lt=I.useMemo(()=>({reference:Se,floating:Ie,setReference:J,setFloating:Y}),[J,Y]),it=I.useMemo(()=>({reference:ie,floating:_e}),[ie,_e]),We=I.useMemo(()=>{const Le={position:r,left:0,top:0};if(!it.floating)return Le;const we=oC(it.floating,A.x),st=oC(it.floating,A.y);return w?{...Le,transform:"translate("+we+"px, "+st+"px)",...gM(it.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:we,top:st}},[r,w,it.floating,A.x,A.y]);return I.useMemo(()=>({...A,update:mt,refs:Lt,elements:it,floatingStyles:We}),[A,mt,Lt,it,We])}const Kz=t=>{function e(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:t,fn(r){const{element:l,padding:u}=typeof t=="function"?t(r):t;return l&&e(l)?l.current!=null?sC({element:l.current,padding:u}).fn(r):{}:l?sC({element:l,padding:u}).fn(r):{}}}},Xz=(t,e)=>({...Bz(t),options:[t,e]}),Yz=(t,e)=>({...Fz(t),options:[t,e]}),Jz=(t,e)=>({...Gz(t),options:[t,e]}),Qz=(t,e)=>({...Vz(t),options:[t,e]}),eB=(t,e)=>({...Uz(t),options:[t,e]}),tB=(t,e)=>({...$z(t),options:[t,e]}),nB=(t,e)=>({...Kz(t),options:[t,e]});var rB="Arrow",yM=I.forwardRef((t,e)=>{const{children:r,width:l=10,height:u=5,...f}=t;return v.jsx(In.svg,{...f,ref:e,width:l,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?r:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});yM.displayName=rB;var iB=yM;function _M(t){const[e,r]=I.useState(void 0);return Zi(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const l=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const f=u[0];let g,w;if("borderBoxSize"in f){const s=f.borderBoxSize,S=Array.isArray(s)?s[0]:s;g=S.inlineSize,w=S.blockSize}else g=t.offsetWidth,w=t.offsetHeight;r({width:g,height:w})});return l.observe(t,{box:"border-box"}),()=>l.unobserve(t)}else r(void 0)},[t]),e}var E1="Popper",[vM,Xm]=gl(E1),[sB,xM]=vM(E1),wM=t=>{const{__scopePopper:e,children:r}=t,[l,u]=I.useState(null);return v.jsx(sB,{scope:e,anchor:l,onAnchorChange:u,children:r})};wM.displayName=E1;var bM="PopperAnchor",TM=I.forwardRef((t,e)=>{const{__scopePopper:r,virtualRef:l,...u}=t,f=xM(bM,r),g=I.useRef(null),w=ar(e,g),s=I.useRef(null);return I.useEffect(()=>{const S=s.current;s.current=l?.current||g.current,S!==s.current&&f.onAnchorChange(s.current)}),l?null:v.jsx(In.div,{...u,ref:w})});TM.displayName=bM;var C1="PopperContent",[oB,aB]=vM(C1),SM=I.forwardRef((t,e)=>{const{__scopePopper:r,side:l="bottom",sideOffset:u=0,align:f="center",alignOffset:g=0,arrowPadding:w=0,avoidCollisions:s=!0,collisionBoundary:S=[],collisionPadding:A=0,sticky:j="partial",hideWhenDetached:O=!1,updatePositionStrategy:L="optimized",onPlaced:W,...U}=t,q=xM(C1,r),[Q,J]=I.useState(null),Y=ar(e,ct=>J(ct)),[ie,_e]=I.useState(null),Se=_M(ie),Ie=Se?.width??0,Ue=Se?.height??0,Je=l+(f!=="center"?"-"+f:""),Me=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},lt=Array.isArray(S)?S:[S],ft=lt.length>0,mt={padding:Me,boundary:lt.filter(cB),altBoundary:ft},{refs:gt,floatingStyles:Lt,placement:it,isPositioned:We,middlewareData:Le}=Zz({strategy:"fixed",placement:Je,whileElementsMounted:(...ct)=>zz(...ct,{animationFrame:L==="always"}),elements:{reference:q.anchor},middleware:[Xz({mainAxis:u+Ue,alignmentAxis:g}),s&&Yz({mainAxis:!0,crossAxis:!1,limiter:j==="partial"?Jz():void 0,...mt}),s&&Qz({...mt}),eB({...mt,apply:({elements:ct,rects:Nt,availableWidth:xn,availableHeight:un})=>{const{width:Rn,height:sn}=Nt.reference,kr=ct.floating.style;kr.setProperty("--radix-popper-available-width",`${xn}px`),kr.setProperty("--radix-popper-available-height",`${un}px`),kr.setProperty("--radix-popper-anchor-width",`${Rn}px`),kr.setProperty("--radix-popper-anchor-height",`${sn}px`)}}),ie&&nB({element:ie,padding:w}),uB({arrowWidth:Ie,arrowHeight:Ue}),O&&tB({strategy:"referenceHidden",...mt})]}),[we,st]=kM(it),ke=$i(W);Zi(()=>{We&&ke?.()},[We,ke]);const Ve=Le.arrow?.x,bt=Le.arrow?.y,wt=Le.arrow?.centerOffset!==0,[Yt,Mt]=I.useState();return Zi(()=>{Q&&Mt(window.getComputedStyle(Q).zIndex)},[Q]),v.jsx("div",{ref:gt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Lt,transform:We?Lt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Yt,"--radix-popper-transform-origin":[Le.transformOrigin?.x,Le.transformOrigin?.y].join(" "),...Le.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:v.jsx(oB,{scope:r,placedSide:we,onArrowChange:_e,arrowX:Ve,arrowY:bt,shouldHideArrow:wt,children:v.jsx(In.div,{"data-side":we,"data-align":st,...U,ref:Y,style:{...U.style,animation:We?void 0:"none"}})})})});SM.displayName=C1;var EM="PopperArrow",lB={top:"bottom",right:"left",bottom:"top",left:"right"},CM=I.forwardRef(function(e,r){const{__scopePopper:l,...u}=e,f=aB(EM,l),g=lB[f.placedSide];return v.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[g]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:v.jsx(iB,{...u,ref:r,style:{...u.style,display:"block"}})})});CM.displayName=EM;function cB(t){return t!==null}var uB=t=>({name:"transformOrigin",options:t,fn(e){const{placement:r,rects:l,middlewareData:u}=e,g=u.arrow?.centerOffset!==0,w=g?0:t.arrowWidth,s=g?0:t.arrowHeight,[S,A]=kM(r),j={start:"0%",center:"50%",end:"100%"}[A],O=(u.arrow?.x??0)+w/2,L=(u.arrow?.y??0)+s/2;let W="",U="";return S==="bottom"?(W=g?j:`${O}px`,U=`${-s}px`):S==="top"?(W=g?j:`${O}px`,U=`${l.floating.height+s}px`):S==="right"?(W=`${-s}px`,U=g?j:`${L}px`):S==="left"&&(W=`${l.floating.width+s}px`,U=g?j:`${L}px`),{data:{x:W,y:U}}}});function kM(t){const[e,r="center"]=t.split("-");return[e,r]}var AM=wM,k1=TM,A1=SM,P1=CM,dB=Symbol("radix.slottable");function hB(t){const e=({children:r})=>v.jsx(v.Fragment,{children:r});return e.displayName=`${t}.Slottable`,e.__radixId=dB,e}var[x0]=gl("Tooltip",[Xm]),M1=Xm(),PM="TooltipProvider",fB=700,aC="tooltip.open",[pB,MM]=x0(PM),IM=t=>{const{__scopeTooltip:e,delayDuration:r=fB,skipDelayDuration:l=300,disableHoverableContent:u=!1,children:f}=t,g=I.useRef(!0),w=I.useRef(!1),s=I.useRef(0);return I.useEffect(()=>{const S=s.current;return()=>window.clearTimeout(S)},[]),v.jsx(pB,{scope:e,isOpenDelayedRef:g,delayDuration:r,onOpen:I.useCallback(()=>{window.clearTimeout(s.current),g.current=!1},[]),onClose:I.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(()=>g.current=!0,l)},[l]),isPointerInTransitRef:w,onPointerInTransitChange:I.useCallback(S=>{w.current=S},[]),disableHoverableContent:u,children:f})};IM.displayName=PM;var RM="Tooltip",[gX,w0]=x0(RM),tb="TooltipTrigger",mB=I.forwardRef((t,e)=>{const{__scopeTooltip:r,...l}=t,u=w0(tb,r),f=MM(tb,r),g=M1(r),w=I.useRef(null),s=ar(e,w,u.onTriggerChange),S=I.useRef(!1),A=I.useRef(!1),j=I.useCallback(()=>S.current=!1,[]);return I.useEffect(()=>()=>document.removeEventListener("pointerup",j),[j]),v.jsx(k1,{asChild:!0,...g,children:v.jsx(In.button,{"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute,...l,ref:s,onPointerMove:Xt(t.onPointerMove,O=>{O.pointerType!=="touch"&&!A.current&&!f.isPointerInTransitRef.current&&(u.onTriggerEnter(),A.current=!0)}),onPointerLeave:Xt(t.onPointerLeave,()=>{u.onTriggerLeave(),A.current=!1}),onPointerDown:Xt(t.onPointerDown,()=>{u.open&&u.onClose(),S.current=!0,document.addEventListener("pointerup",j,{once:!0})}),onFocus:Xt(t.onFocus,()=>{S.current||u.onOpen()}),onBlur:Xt(t.onBlur,u.onClose),onClick:Xt(t.onClick,u.onClose)})})});mB.displayName=tb;var gB="TooltipPortal",[yX,yB]=x0(gB,{forceMount:void 0}),zm="TooltipContent",NM=I.forwardRef((t,e)=>{const r=yB(zm,t.__scopeTooltip),{forceMount:l=r.forceMount,side:u="top",...f}=t,g=w0(zm,t.__scopeTooltip);return v.jsx(Ho,{present:l||g.open,children:g.disableHoverableContent?v.jsx(jM,{side:u,...f,ref:e}):v.jsx(_B,{side:u,...f,ref:e})})}),_B=I.forwardRef((t,e)=>{const r=w0(zm,t.__scopeTooltip),l=MM(zm,t.__scopeTooltip),u=I.useRef(null),f=ar(e,u),[g,w]=I.useState(null),{trigger:s,onClose:S}=r,A=u.current,{onPointerInTransitChange:j}=l,O=I.useCallback(()=>{w(null),j(!1)},[j]),L=I.useCallback((W,U)=>{const q=W.currentTarget,Q={x:W.clientX,y:W.clientY},J=TB(Q,q.getBoundingClientRect()),Y=SB(Q,J),ie=EB(U.getBoundingClientRect()),_e=kB([...Y,...ie]);w(_e),j(!0)},[j]);return I.useEffect(()=>()=>O(),[O]),I.useEffect(()=>{if(s&&A){const W=q=>L(q,A),U=q=>L(q,s);return s.addEventListener("pointerleave",W),A.addEventListener("pointerleave",U),()=>{s.removeEventListener("pointerleave",W),A.removeEventListener("pointerleave",U)}}},[s,A,L,O]),I.useEffect(()=>{if(g){const W=U=>{const q=U.target,Q={x:U.clientX,y:U.clientY},J=s?.contains(q)||A?.contains(q),Y=!CB(Q,g);J?O():Y&&(O(),S())};return document.addEventListener("pointermove",W),()=>document.removeEventListener("pointermove",W)}},[s,A,g,S,O]),v.jsx(jM,{...t,ref:f})}),[vB,xB]=x0(RM,{isInside:!1}),wB=hB("TooltipContent"),jM=I.forwardRef((t,e)=>{const{__scopeTooltip:r,children:l,"aria-label":u,onEscapeKeyDown:f,onPointerDownOutside:g,...w}=t,s=w0(zm,r),S=M1(r),{onClose:A}=s;return I.useEffect(()=>(document.addEventListener(aC,A),()=>document.removeEventListener(aC,A)),[A]),I.useEffect(()=>{if(s.trigger){const j=O=>{O.target?.contains(s.trigger)&&A()};return window.addEventListener("scroll",j,{capture:!0}),()=>window.removeEventListener("scroll",j,{capture:!0})}},[s.trigger,A]),v.jsx(qm,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:j=>j.preventDefault(),onDismiss:A,children:v.jsxs(A1,{"data-state":s.stateAttribute,...S,...w,ref:e,style:{...w.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(wB,{children:l}),v.jsx(vB,{scope:r,isInside:!0,children:v.jsx(OL,{id:s.contentId,role:"tooltip",children:u||l})})]})})});NM.displayName=zm;var DM="TooltipArrow",bB=I.forwardRef((t,e)=>{const{__scopeTooltip:r,...l}=t,u=M1(r);return xB(DM,r).isInside?null:v.jsx(P1,{...u,...l,ref:e})});bB.displayName=DM;function TB(t,e){const r=Math.abs(e.top-t.y),l=Math.abs(e.bottom-t.y),u=Math.abs(e.right-t.x),f=Math.abs(e.left-t.x);switch(Math.min(r,l,u,f)){case f:return"left";case u:return"right";case r:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function SB(t,e,r=5){const l=[];switch(e){case"top":l.push({x:t.x-r,y:t.y+r},{x:t.x+r,y:t.y+r});break;case"bottom":l.push({x:t.x-r,y:t.y-r},{x:t.x+r,y:t.y-r});break;case"left":l.push({x:t.x+r,y:t.y-r},{x:t.x+r,y:t.y+r});break;case"right":l.push({x:t.x-r,y:t.y-r},{x:t.x-r,y:t.y+r});break}return l}function EB(t){const{top:e,right:r,bottom:l,left:u}=t;return[{x:u,y:e},{x:r,y:e},{x:r,y:l},{x:u,y:l}]}function CB(t,e){const{x:r,y:l}=t;let u=!1;for(let f=0,g=e.length-1;f<e.length;g=f++){const w=e[f],s=e[g],S=w.x,A=w.y,j=s.x,O=s.y;A>l!=O>l&&r<(j-S)*(l-A)/(O-A)+S&&(u=!u)}return u}function kB(t){const e=t.slice();return e.sort((r,l)=>r.x<l.x?-1:r.x>l.x?1:r.y<l.y?-1:r.y>l.y?1:0),AB(e)}function AB(t){if(t.length<=1)return t.slice();const e=[];for(let l=0;l<t.length;l++){const u=t[l];for(;e.length>=2;){const f=e[e.length-1],g=e[e.length-2];if((f.x-g.x)*(u.y-g.y)>=(f.y-g.y)*(u.x-g.x))e.pop();else break}e.push(u)}e.pop();const r=[];for(let l=t.length-1;l>=0;l--){const u=t[l];for(;r.length>=2;){const f=r[r.length-1],g=r[r.length-2];if((f.x-g.x)*(u.y-g.y)>=(f.y-g.y)*(u.x-g.x))r.pop();else break}r.push(u)}return r.pop(),e.length===1&&r.length===1&&e[0].x===r[0].x&&e[0].y===r[0].y?e:e.concat(r)}var PB=IM,LM=NM;const MB=PB,IB=I.forwardRef(({className:t,sideOffset:e=4,...r},l)=>v.jsx(LM,{ref:l,sideOffset:e,className:cn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));IB.displayName=LM.displayName;var Ym=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},RB={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},NB=class{#e=RB;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},zf=new NB;function jB(t){setTimeout(t,0)}var Wf=typeof window>"u"||"Deno"in globalThis;function Uo(){}function DB(t,e){return typeof t=="function"?t(e):t}function nb(t){return typeof t=="number"&&t>=0&&t!==1/0}function OM(t,e){return Math.max(t+(e||0)-Date.now(),0)}function uh(t,e){return typeof t=="function"?t(e):t}function dl(t,e){return typeof t=="function"?t(e):t}function lC(t,e){const{type:r="all",exact:l,fetchStatus:u,predicate:f,queryKey:g,stale:w}=t;if(g){if(l){if(e.queryHash!==I1(g,e.options))return!1}else if(!My(e.queryKey,g))return!1}if(r!=="all"){const s=e.isActive();if(r==="active"&&!s||r==="inactive"&&s)return!1}return!(typeof w=="boolean"&&e.isStale()!==w||u&&u!==e.state.fetchStatus||f&&!f(e))}function cC(t,e){const{exact:r,status:l,predicate:u,mutationKey:f}=t;if(f){if(!e.options.mutationKey)return!1;if(r){if(Zf(e.options.mutationKey)!==Zf(f))return!1}else if(!My(e.options.mutationKey,f))return!1}return!(l&&e.state.status!==l||u&&!u(e))}function I1(t,e){return(e?.queryKeyHashFn||Zf)(t)}function Zf(t){return JSON.stringify(t,(e,r)=>rb(r)?Object.keys(r).sort().reduce((l,u)=>(l[u]=r[u],l),{}):r)}function My(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(r=>My(t[r],e[r])):!1}var LB=Object.prototype.hasOwnProperty;function zM(t,e,r=0){if(t===e)return t;if(r>500)return e;const l=uC(t)&&uC(e);if(!l&&!(rb(t)&&rb(e)))return e;const f=(l?t:Object.keys(t)).length,g=l?e:Object.keys(e),w=g.length,s=l?new Array(w):{};let S=0;for(let A=0;A<w;A++){const j=l?A:g[A],O=t[j],L=e[j];if(O===L){s[j]=O,(l?A<f:LB.call(t,j))&&S++;continue}if(O===null||L===null||typeof O!="object"||typeof L!="object"){s[j]=L;continue}const W=zM(O,L,r+1);s[j]=W,W===O&&S++}return f===w&&S===f?t:s}function Ov(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(t[r]!==e[r])return!1;return!0}function uC(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function rb(t){if(!dC(t))return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return!(!dC(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function dC(t){return Object.prototype.toString.call(t)==="[object Object]"}function OB(t){return new Promise(e=>{zf.setTimeout(e,t)})}function ib(t,e,r){return typeof r.structuralSharing=="function"?r.structuralSharing(t,e):r.structuralSharing!==!1?zM(t,e):e}function zB(t,e,r=0){const l=[...t,e];return r&&l.length>r?l.slice(1):l}function BB(t,e,r=0){const l=[e,...t];return r&&l.length>r?l.slice(0,-1):l}var R1=Symbol();function BM(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===R1?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function N1(t,e){return typeof t=="function"?t(...e):!!t}function FB(t,e,r){let l=!1,u;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(u??=e(),l||(l=!0,u.aborted?r():u.addEventListener("abort",r,{once:!0})),u)}),t}var VB=class extends Ym{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!Wf&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},j1=new VB;function sb(){let t,e;const r=new Promise((u,f)=>{t=u,e=f});r.status="pending",r.catch(()=>{});function l(u){Object.assign(r,u),delete r.resolve,delete r.reject}return r.resolve=u=>{l({status:"fulfilled",value:u}),t(u)},r.reject=u=>{l({status:"rejected",reason:u}),e(u)},r}var UB=jB;function $B(){let t=[],e=0,r=w=>{w()},l=w=>{w()},u=UB;const f=w=>{e?t.push(w):u(()=>{r(w)})},g=()=>{const w=t;t=[],w.length&&u(()=>{l(()=>{w.forEach(s=>{r(s)})})})};return{batch:w=>{let s;e++;try{s=w()}finally{e--,e||g()}return s},batchCalls:w=>(...s)=>{f(()=>{w(...s)})},schedule:f,setNotifyFunction:w=>{r=w},setBatchNotifyFunction:w=>{l=w},setScheduler:w=>{u=w}}}var Ts=$B(),GB=class extends Ym{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!Wf&&window.addEventListener){const e=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(r=>{r(t)}))}isOnline(){return this.#e}},zv=new GB;function HB(t){return Math.min(1e3*2**t,3e4)}function FM(t){return(t??"online")==="online"?zv.isOnline():!0}var ob=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function VM(t){let e=!1,r=0,l;const u=sb(),f=()=>u.status!=="pending",g=U=>{if(!f()){const q=new ob(U);O(q),t.onCancel?.(q)}},w=()=>{e=!0},s=()=>{e=!1},S=()=>j1.isFocused()&&(t.networkMode==="always"||zv.isOnline())&&t.canRun(),A=()=>FM(t.networkMode)&&t.canRun(),j=U=>{f()||(l?.(),u.resolve(U))},O=U=>{f()||(l?.(),u.reject(U))},L=()=>new Promise(U=>{l=q=>{(f()||S())&&U(q)},t.onPause?.()}).then(()=>{l=void 0,f()||t.onContinue?.()}),W=()=>{if(f())return;let U;const q=r===0?t.initialPromise:void 0;try{U=q??t.fn()}catch(Q){U=Promise.reject(Q)}Promise.resolve(U).then(j).catch(Q=>{if(f())return;const J=t.retry??(Wf?0:3),Y=t.retryDelay??HB,ie=typeof Y=="function"?Y(r,Q):Y,_e=J===!0||typeof J=="number"&&r<J||typeof J=="function"&&J(r,Q);if(e||!_e){O(Q);return}r++,t.onFail?.(r,Q),OB(ie).then(()=>S()?void 0:L()).then(()=>{e?O(Q):W()})})};return{promise:u,status:()=>u.status,cancel:g,continue:()=>(l?.(),u),cancelRetry:w,continueRetry:s,canStart:A,start:()=>(A()?W():L().then(W),u)}}var UM=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),nb(this.gcTime)&&(this.#e=zf.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Wf?1/0:300*1e3))}clearGcTimeout(){this.#e&&(zf.clearTimeout(this.#e),this.#e=void 0)}},qB=class extends UM{#e;#t;#n;#i;#r;#o;#a;constructor(t){super(),this.#a=!1,this.#o=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#i=t.client,this.#n=this.#i.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=fC(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(t){if(this.options={...this.#o,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=fC(this.options);e.data!==void 0&&(this.setState(hC(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(t,e){const r=ib(this.state.data,t,this.options);return this.#s({data:r,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),r}setState(t,e){this.#s({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#r?.promise;return this.#r?.cancel(t),e?e.then(Uo).catch(Uo):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>dl(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===R1||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>uh(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!OM(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(t&&this.setOptions(t),!this.options.queryFn){const w=this.observers.find(s=>s.options.queryFn);w&&this.setOptions(w.options)}const r=new AbortController,l=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(this.#a=!0,r.signal)})},u=()=>{const w=BM(this.options,e),S=(()=>{const A={client:this.#i,queryKey:this.queryKey,meta:this.meta};return l(A),A})();return this.#a=!1,this.options.persister?this.options.persister(w,S,this):w(S)},g=(()=>{const w={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:u};return l(w),w})();this.options.behavior?.onFetch(g,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==g.fetchOptions?.meta)&&this.#s({type:"fetch",meta:g.fetchOptions?.meta}),this.#r=VM({initialPromise:e?.initialPromise,fn:g.fetchFn,onCancel:w=>{w instanceof ob&&w.revert&&this.setState({...this.#t,fetchStatus:"idle"}),r.abort()},onFail:(w,s)=>{this.#s({type:"failed",failureCount:w,error:s})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0});try{const w=await this.#r.start();if(w===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(w),this.#n.config.onSuccess?.(w,this),this.#n.config.onSettled?.(w,this.state.error,this),w}catch(w){if(w instanceof ob){if(w.silent)return this.#r.promise;if(w.revert){if(this.state.data===void 0)throw w;return this.state.data}}throw this.#s({type:"error",error:w}),this.#n.config.onError?.(w,this),this.#n.config.onSettled?.(this.state.data,w,this),w}finally{this.scheduleGc()}}#s(t){const e=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...$M(r.data,this.options),fetchMeta:t.meta??null};case"success":const l={...r,...hC(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?l:void 0,l;case"error":const u=t.error;return{...r,error:u,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=e(this.state),Ts.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:t})})}};function $M(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:FM(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function hC(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function fC(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,r=e!==void 0,l=r?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:r?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var WB=class extends Ym{constructor(t,e){super(),this.options=e,this.#e=t,this.#s=null,this.#a=sb(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#i=void 0;#r;#o;#a;#s;#m;#h;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),pC(this.#t,this.options)?this.#d():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ab(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ab(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#x(),this.#w(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,r=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof dl(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#b(),this.#t.setOptions(this.options),e._defaulted&&!Ov(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const l=this.hasListeners();l&&mC(this.#t,r,this.options,e)&&this.#d(),this.updateResult(),l&&(this.#t!==r||dl(this.options.enabled,this.#t)!==dl(e.enabled,this.#t)||uh(this.options.staleTime,this.#t)!==uh(e.staleTime,this.#t))&&this.#g();const u=this.#y();l&&(this.#t!==r||dl(this.options.enabled,this.#t)!==dl(e.enabled,this.#t)||u!==this.#l)&&this.#_(u)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),r=this.createResult(e,t);return KB(this,r)&&(this.#i=r,this.#o=this.options,this.#r=this.#t.state),r}getCurrentResult(){return this.#i}trackResult(t,e){return new Proxy(t,{get:(r,l)=>(this.trackProp(l),e?.(l),l==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,l))})}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),r=this.#e.getQueryCache().build(this.#e,e);return r.fetch().then(()=>this.createResult(r,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(t){this.#b();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(Uo)),e}#g(){this.#x();const t=uh(this.options.staleTime,this.#t);if(Wf||this.#i.isStale||!nb(t))return;const r=OM(this.#i.dataUpdatedAt,t)+1;this.#c=zf.setTimeout(()=>{this.#i.isStale||this.updateResult()},r)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#w(),this.#l=t,!(Wf||dl(this.options.enabled,this.#t)===!1||!nb(this.#l)||this.#l===0)&&(this.#u=zf.setInterval(()=>{(this.options.refetchIntervalInBackground||j1.isFocused())&&this.#d()},this.#l))}#v(){this.#g(),this.#_(this.#y())}#x(){this.#c&&(zf.clearTimeout(this.#c),this.#c=void 0)}#w(){this.#u&&(zf.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const r=this.#t,l=this.options,u=this.#i,f=this.#r,g=this.#o,s=t!==r?t.state:this.#n,{state:S}=t;let A={...S},j=!1,O;if(e._optimisticResults){const Ue=this.hasListeners(),Je=!Ue&&pC(t,e),Me=Ue&&mC(t,r,e,l);(Je||Me)&&(A={...A,...$M(S.data,t.options)}),e._optimisticResults==="isRestoring"&&(A.fetchStatus="idle")}let{error:L,errorUpdatedAt:W,status:U}=A;O=A.data;let q=!1;if(e.placeholderData!==void 0&&O===void 0&&U==="pending"){let Ue;u?.isPlaceholderData&&e.placeholderData===g?.placeholderData?(Ue=u.data,q=!0):Ue=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,Ue!==void 0&&(U="success",O=ib(u?.data,Ue,e),j=!0)}if(e.select&&O!==void 0&&!q)if(u&&O===f?.data&&e.select===this.#m)O=this.#h;else try{this.#m=e.select,O=e.select(O),O=ib(u?.data,O,e),this.#h=O,this.#s=null}catch(Ue){this.#s=Ue}this.#s&&(L=this.#s,O=this.#h,W=Date.now(),U="error");const Q=A.fetchStatus==="fetching",J=U==="pending",Y=U==="error",ie=J&&Q,_e=O!==void 0,Ie={status:U,fetchStatus:A.fetchStatus,isPending:J,isSuccess:U==="success",isError:Y,isInitialLoading:ie,isLoading:ie,data:O,dataUpdatedAt:A.dataUpdatedAt,error:L,errorUpdatedAt:W,failureCount:A.fetchFailureCount,failureReason:A.fetchFailureReason,errorUpdateCount:A.errorUpdateCount,isFetched:A.dataUpdateCount>0||A.errorUpdateCount>0,isFetchedAfterMount:A.dataUpdateCount>s.dataUpdateCount||A.errorUpdateCount>s.errorUpdateCount,isFetching:Q,isRefetching:Q&&!J,isLoadingError:Y&&!_e,isPaused:A.fetchStatus==="paused",isPlaceholderData:j,isRefetchError:Y&&_e,isStale:D1(t,e),refetch:this.refetch,promise:this.#a,isEnabled:dl(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const Ue=Ie.data!==void 0,Je=Ie.status==="error"&&!Ue,Me=mt=>{Je?mt.reject(Ie.error):Ue&&mt.resolve(Ie.data)},lt=()=>{const mt=this.#a=Ie.promise=sb();Me(mt)},ft=this.#a;switch(ft.status){case"pending":t.queryHash===r.queryHash&&Me(ft);break;case"fulfilled":(Je||Ie.data!==ft.value)&&lt();break;case"rejected":(!Je||Ie.error!==ft.reason)&&lt();break}}return Ie}updateResult(){const t=this.#i,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#o=this.options,this.#r.data!==void 0&&(this.#f=this.#t),Ov(e,t))return;this.#i=e;const r=()=>{if(!t)return!0;const{notifyOnChangeProps:l}=this.options,u=typeof l=="function"?l():l;if(u==="all"||!u&&!this.#p.size)return!0;const f=new Set(u??this.#p);return this.options.throwOnError&&f.add("error"),Object.keys(this.#i).some(g=>{const w=g;return this.#i[w]!==t[w]&&f.has(w)})};this.#T({listeners:r()})}#b(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#T(t){Ts.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function ZB(t,e){return dl(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function pC(t,e){return ZB(t,e)||t.state.data!==void 0&&ab(t,e,e.refetchOnMount)}function ab(t,e,r){if(dl(e.enabled,t)!==!1&&uh(e.staleTime,t)!=="static"){const l=typeof r=="function"?r(t):r;return l==="always"||l!==!1&&D1(t,e)}return!1}function mC(t,e,r,l){return(t!==e||dl(l.enabled,t)===!1)&&(!r.suspense||t.state.status!=="error")&&D1(t,r)}function D1(t,e){return dl(e.enabled,t)!==!1&&t.isStaleByTime(uh(e.staleTime,t))}function KB(t,e){return!Ov(t.getCurrentResult(),e)}function gC(t){return{onFetch:(e,r)=>{const l=e.options,u=e.fetchOptions?.meta?.fetchMore?.direction,f=e.state.data?.pages||[],g=e.state.data?.pageParams||[];let w={pages:[],pageParams:[]},s=0;const S=async()=>{let A=!1;const j=W=>{FB(W,()=>e.signal,()=>A=!0)},O=BM(e.options,e.fetchOptions),L=async(W,U,q)=>{if(A)return Promise.reject();if(U==null&&W.pages.length)return Promise.resolve(W);const J=(()=>{const Se={client:e.client,queryKey:e.queryKey,pageParam:U,direction:q?"backward":"forward",meta:e.options.meta};return j(Se),Se})(),Y=await O(J),{maxPages:ie}=e.options,_e=q?BB:zB;return{pages:_e(W.pages,Y,ie),pageParams:_e(W.pageParams,U,ie)}};if(u&&f.length){const W=u==="backward",U=W?XB:yC,q={pages:f,pageParams:g},Q=U(l,q);w=await L(q,Q,W)}else{const W=t??f.length;do{const U=s===0?g[0]??l.initialPageParam:yC(l,w);if(s>0&&U==null)break;w=await L(w,U),s++}while(s<W)}return w};e.options.persister?e.fetchFn=()=>e.options.persister?.(S,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},r):e.fetchFn=S}}}function yC(t,{pages:e,pageParams:r}){const l=e.length-1;return e.length>0?t.getNextPageParam(e[l],e,r[l],r):void 0}function XB(t,{pages:e,pageParams:r}){return e.length>0?t.getPreviousPageParam?.(e[0],e,r[0],r):void 0}var YB=class extends UM{#e;#t;#n;#i;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#n=t.mutationCache,this.#t=[],this.state=t.state||GM(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(t){const e=()=>{this.#r({type:"continue"})},r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=VM({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(f,g)=>{this.#r({type:"failed",failureCount:f,error:g})},onPause:()=>{this.#r({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const l=this.state.status==="pending",u=!this.#i.canStart();try{if(l)e();else{this.#r({type:"pending",variables:t,isPaused:u}),this.#n.config.onMutate&&await this.#n.config.onMutate(t,this,r);const g=await this.options.onMutate?.(t,r);g!==this.state.context&&this.#r({type:"pending",context:g,variables:t,isPaused:u})}const f=await this.#i.start();return await this.#n.config.onSuccess?.(f,t,this.state.context,this,r),await this.options.onSuccess?.(f,t,this.state.context,r),await this.#n.config.onSettled?.(f,null,this.state.variables,this.state.context,this,r),await this.options.onSettled?.(f,null,t,this.state.context,r),this.#r({type:"success",data:f}),f}catch(f){try{await this.#n.config.onError?.(f,t,this.state.context,this,r)}catch(g){Promise.reject(g)}try{await this.options.onError?.(f,t,this.state.context,r)}catch(g){Promise.reject(g)}try{await this.#n.config.onSettled?.(void 0,f,this.state.variables,this.state.context,this,r)}catch(g){Promise.reject(g)}try{await this.options.onSettled?.(void 0,f,t,this.state.context,r)}catch(g){Promise.reject(g)}throw this.#r({type:"error",error:f}),f}finally{this.#n.runNext(this)}}#r(t){const e=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),Ts.batch(()=>{this.#t.forEach(r=>{r.onMutationUpdate(t)}),this.#n.notify({mutation:this,type:"updated",action:t})})}};function GM(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var JB=class extends Ym{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,r){const l=new YB({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:r});return this.add(l),l}add(t){this.#e.add(t);const e=sv(t);if(typeof e=="string"){const r=this.#t.get(e);r?r.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=sv(t);if(typeof e=="string"){const r=this.#t.get(e);if(r)if(r.length>1){const l=r.indexOf(t);l!==-1&&r.splice(l,1)}else r[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=sv(t);if(typeof e=="string"){const l=this.#t.get(e)?.find(u=>u.state.status==="pending");return!l||l===t}else return!0}runNext(t){const e=sv(t);return typeof e=="string"?this.#t.get(e)?.find(l=>l!==t&&l.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ts.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(r=>cC(e,r))}findAll(t={}){return this.getAll().filter(e=>cC(t,e))}notify(t){Ts.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Ts.batch(()=>Promise.all(t.map(e=>e.continue().catch(Uo))))}};function sv(t){return t.options.scope?.id}var QB=class extends Ym{#e;#t=void 0;#n;#i;constructor(e,r){super(),this.#e=e,this.setOptions(r),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const r=this.options;this.options=this.#e.defaultMutationOptions(e),Ov(this.options,r)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),r?.mutationKey&&this.options.mutationKey&&Zf(r.mutationKey)!==Zf(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#o(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#o()}mutate(e,r){return this.#i=r,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??GM();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){Ts.batch(()=>{if(this.#i&&this.hasListeners()){const r=this.#t.variables,l=this.#t.context,u={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#i.onSuccess?.(e.data,r,l,u)}catch(f){Promise.reject(f)}try{this.#i.onSettled?.(e.data,null,r,l,u)}catch(f){Promise.reject(f)}}else if(e?.type==="error"){try{this.#i.onError?.(e.error,r,l,u)}catch(f){Promise.reject(f)}try{this.#i.onSettled?.(void 0,e.error,r,l,u)}catch(f){Promise.reject(f)}}}this.listeners.forEach(r=>{r(this.#t)})})}},eF=class extends Ym{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,r){const l=e.queryKey,u=e.queryHash??I1(l,e);let f=this.get(u);return f||(f=new qB({client:t,queryKey:l,queryHash:u,options:t.defaultQueryOptions(e),state:r,defaultOptions:t.getQueryDefaults(l)}),this.add(f)),f}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Ts.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(r=>lC(e,r))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(r=>lC(t,r)):e}notify(t){Ts.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Ts.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Ts.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},tF=class{#e;#t;#n;#i;#r;#o;#a;#s;constructor(t={}){this.#e=t.queryCache||new eF,this.#t=t.mutationCache||new JB,this.#n=t.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=j1.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=zv.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),r=this.#e.build(this,e),l=r.state.data;return l===void 0?this.fetchQuery(t):(t.revalidateIfStale&&r.isStaleByTime(uh(e.staleTime,r))&&this.prefetchQuery(e),Promise.resolve(l))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:r})=>{const l=r.data;return[e,l]})}setQueryData(t,e,r){const l=this.defaultQueryOptions({queryKey:t}),f=this.#e.get(l.queryHash)?.state.data,g=DB(e,f);if(g!==void 0)return this.#e.build(this,l).setData(g,{...r,manual:!0})}setQueriesData(t,e,r){return Ts.batch(()=>this.#e.findAll(t).map(({queryKey:l})=>[l,this.setQueryData(l,e,r)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Ts.batch(()=>{e.findAll(t).forEach(r=>{e.remove(r)})})}resetQueries(t,e){const r=this.#e;return Ts.batch(()=>(r.findAll(t).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const r={revert:!0,...e},l=Ts.batch(()=>this.#e.findAll(t).map(u=>u.cancel(r)));return Promise.all(l).then(Uo).catch(Uo)}invalidateQueries(t,e={}){return Ts.batch(()=>(this.#e.findAll(t).forEach(r=>{r.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const r={...e,cancelRefetch:e.cancelRefetch??!0},l=Ts.batch(()=>this.#e.findAll(t).filter(u=>!u.isDisabled()&&!u.isStatic()).map(u=>{let f=u.fetch(void 0,r);return r.throwOnError||(f=f.catch(Uo)),u.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(l).then(Uo)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const r=this.#e.build(this,e);return r.isStaleByTime(uh(e.staleTime,r))?r.fetch(e):Promise.resolve(r.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Uo).catch(Uo)}fetchInfiniteQuery(t){return t.behavior=gC(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Uo).catch(Uo)}ensureInfiniteQueryData(t){return t.behavior=gC(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return zv.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#i.set(Zf(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#i.values()],r={};return e.forEach(l=>{My(t,l.queryKey)&&Object.assign(r,l.defaultOptions)}),r}setMutationDefaults(t,e){this.#r.set(Zf(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],r={};return e.forEach(l=>{My(t,l.mutationKey)&&Object.assign(r,l.defaultOptions)}),r}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=I1(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===R1&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},HM=I.createContext(void 0),b0=t=>{const e=I.useContext(HM);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},nF=({client:t,children:e})=>(I.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),v.jsx(HM.Provider,{value:t,children:e})),qM=I.createContext(!1),rF=()=>I.useContext(qM);qM.Provider;function iF(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var sF=I.createContext(iF()),oF=()=>I.useContext(sF),aF=(t,e,r)=>{const l=r?.state.error&&typeof t.throwOnError=="function"?N1(t.throwOnError,[r.state.error,r]):t.throwOnError;(t.suspense||t.experimental_prefetchInRender||l)&&(e.isReset()||(t.retryOnMount=!1))},lF=t=>{I.useEffect(()=>{t.clearReset()},[t])},cF=({result:t,errorResetBoundary:e,throwOnError:r,query:l,suspense:u})=>t.isError&&!e.isReset()&&!t.isFetching&&l&&(u&&t.data===void 0||N1(r,[t.error,l])),uF=t=>{if(t.suspense){const r=u=>u==="static"?u:Math.max(u??1e3,1e3),l=t.staleTime;t.staleTime=typeof l=="function"?(...u)=>r(l(...u)):r(l),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},dF=(t,e)=>t.isLoading&&t.isFetching&&!e,hF=(t,e)=>t?.suspense&&e.isPending,_C=(t,e,r)=>e.fetchOptimistic(t).catch(()=>{r.clearReset()});function fF(t,e,r){const l=rF(),u=oF(),f=b0(),g=f.defaultQueryOptions(t);f.getDefaultOptions().queries?._experimental_beforeQuery?.(g);const w=f.getQueryCache().get(g.queryHash);g._optimisticResults=l?"isRestoring":"optimistic",uF(g),aF(g,u,w),lF(u);const s=!f.getQueryCache().get(g.queryHash),[S]=I.useState(()=>new e(f,g)),A=S.getOptimisticResult(g),j=!l&&t.subscribed!==!1;if(I.useSyncExternalStore(I.useCallback(O=>{const L=j?S.subscribe(Ts.batchCalls(O)):Uo;return S.updateResult(),L},[S,j]),()=>S.getCurrentResult(),()=>S.getCurrentResult()),I.useEffect(()=>{S.setOptions(g)},[g,S]),hF(g,A))throw _C(g,S,u);if(cF({result:A,errorResetBoundary:u,throwOnError:g.throwOnError,query:w,suspense:g.suspense}))throw A.error;return f.getDefaultOptions().queries?._experimental_afterQuery?.(g,A),g.experimental_prefetchInRender&&!Wf&&dF(A,l)&&(s?_C(g,S,u):w?.promise)?.catch(Uo).finally(()=>{S.updateResult()}),g.notifyOnChangeProps?A:S.trackResult(A)}function L1(t,e){return fF(t,WB)}function Yl(t,e){const r=b0(),[l]=I.useState(()=>new QB(r,t));I.useEffect(()=>{l.setOptions(t)},[l,t]);const u=I.useSyncExternalStore(I.useCallback(g=>l.subscribe(Ts.batchCalls(g)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),f=I.useCallback((g,w)=>{l.mutate(g,w).catch(Uo)},[l]);if(u.error&&N1(l.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:f,mutateAsync:u.mutate}}function Iy(){return Iy=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},Iy.apply(this,arguments)}var sh;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(sh||(sh={}));const vC="popstate";function pF(t){t===void 0&&(t={});function e(l,u){let{pathname:f,search:g,hash:w}=l.location;return lb("",{pathname:f,search:g,hash:w},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function r(l,u){return typeof u=="string"?u:WM(u)}return gF(e,r,null,t)}function Ss(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function O1(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function mF(){return Math.random().toString(36).substr(2,8)}function xC(t,e){return{usr:t.state,key:t.key,idx:e}}function lb(t,e,r,l){return r===void 0&&(r=null),Iy({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Jm(e):e,{state:r,key:e&&e.key||l||mF()})}function WM(t){let{pathname:e="/",search:r="",hash:l=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),l&&l!=="#"&&(e+=l.charAt(0)==="#"?l:"#"+l),e}function Jm(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let l=t.indexOf("?");l>=0&&(e.search=t.substr(l),t=t.substr(0,l)),t&&(e.pathname=t)}return e}function gF(t,e,r,l){l===void 0&&(l={});let{window:u=document.defaultView,v5Compat:f=!1}=l,g=u.history,w=sh.Pop,s=null,S=A();S==null&&(S=0,g.replaceState(Iy({},g.state,{idx:S}),""));function A(){return(g.state||{idx:null}).idx}function j(){w=sh.Pop;let q=A(),Q=q==null?null:q-S;S=q,s&&s({action:w,location:U.location,delta:Q})}function O(q,Q){w=sh.Push;let J=lb(U.location,q,Q);S=A()+1;let Y=xC(J,S),ie=U.createHref(J);try{g.pushState(Y,"",ie)}catch(_e){if(_e instanceof DOMException&&_e.name==="DataCloneError")throw _e;u.location.assign(ie)}f&&s&&s({action:w,location:U.location,delta:1})}function L(q,Q){w=sh.Replace;let J=lb(U.location,q,Q);S=A();let Y=xC(J,S),ie=U.createHref(J);g.replaceState(Y,"",ie),f&&s&&s({action:w,location:U.location,delta:0})}function W(q){let Q=u.location.origin!=="null"?u.location.origin:u.location.href,J=typeof q=="string"?q:WM(q);return J=J.replace(/ $/,"%20"),Ss(Q,"No window.location.(origin|href) available to create URL for href: "+J),new URL(J,Q)}let U={get action(){return w},get location(){return t(u,g)},listen(q){if(s)throw new Error("A history only accepts one active listener");return u.addEventListener(vC,j),s=q,()=>{u.removeEventListener(vC,j),s=null}},createHref(q){return e(u,q)},createURL:W,encodeLocation(q){let Q=W(q);return{pathname:Q.pathname,search:Q.search,hash:Q.hash}},push:O,replace:L,go(q){return g.go(q)}};return U}var wC;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(wC||(wC={}));function yF(t,e,r){return r===void 0&&(r="/"),_F(t,e,r)}function _F(t,e,r,l){let u=typeof e=="string"?Jm(e):e,f=XM(u.pathname||"/",r);if(f==null)return null;let g=ZM(t);vF(g);let w=null;for(let s=0;w==null&&s<g.length;++s){let S=IF(f);w=AF(g[s],S)}return w}function ZM(t,e,r,l){e===void 0&&(e=[]),r===void 0&&(r=[]),l===void 0&&(l="");let u=(f,g,w)=>{let s={relativePath:w===void 0?f.path||"":w,caseSensitive:f.caseSensitive===!0,childrenIndex:g,route:f};s.relativePath.startsWith("/")&&(Ss(s.relativePath.startsWith(l),'Absolute route path "'+s.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),s.relativePath=s.relativePath.slice(l.length));let S=$f([l,s.relativePath]),A=r.concat(s);f.children&&f.children.length>0&&(Ss(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+S+'".')),ZM(f.children,e,A,S)),!(f.path==null&&!f.index)&&e.push({path:S,score:CF(S,f.index),routesMeta:A})};return t.forEach((f,g)=>{var w;if(f.path===""||!((w=f.path)!=null&&w.includes("?")))u(f,g);else for(let s of KM(f.path))u(f,g,s)}),e}function KM(t){let e=t.split("/");if(e.length===0)return[];let[r,...l]=e,u=r.endsWith("?"),f=r.replace(/\?$/,"");if(l.length===0)return u?[f,""]:[f];let g=KM(l.join("/")),w=[];return w.push(...g.map(s=>s===""?f:[f,s].join("/"))),u&&w.push(...g),w.map(s=>t.startsWith("/")&&s===""?"/":s)}function vF(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:kF(e.routesMeta.map(l=>l.childrenIndex),r.routesMeta.map(l=>l.childrenIndex)))}const xF=/^:[\w-]+$/,wF=3,bF=2,TF=1,SF=10,EF=-2,bC=t=>t==="*";function CF(t,e){let r=t.split("/"),l=r.length;return r.some(bC)&&(l+=EF),e&&(l+=bF),r.filter(u=>!bC(u)).reduce((u,f)=>u+(xF.test(f)?wF:f===""?TF:SF),l)}function kF(t,e){return t.length===e.length&&t.slice(0,-1).every((l,u)=>l===e[u])?t[t.length-1]-e[e.length-1]:0}function AF(t,e,r){let{routesMeta:l}=t,u={},f="/",g=[];for(let w=0;w<l.length;++w){let s=l[w],S=w===l.length-1,A=f==="/"?e:e.slice(f.length)||"/",j=PF({path:s.relativePath,caseSensitive:s.caseSensitive,end:S},A),O=s.route;if(!j)return null;Object.assign(u,j.params),g.push({params:u,pathname:$f([f,j.pathname]),pathnameBase:zF($f([f,j.pathnameBase])),route:O}),j.pathnameBase!=="/"&&(f=$f([f,j.pathnameBase]))}return g}function PF(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,l]=MF(t.path,t.caseSensitive,t.end),u=e.match(r);if(!u)return null;let f=u[0],g=f.replace(/(.)\/+$/,"$1"),w=u.slice(1);return{params:l.reduce((S,A,j)=>{let{paramName:O,isOptional:L}=A;if(O==="*"){let U=w[j]||"";g=f.slice(0,f.length-U.length).replace(/(.)\/+$/,"$1")}const W=w[j];return L&&!W?S[O]=void 0:S[O]=(W||"").replace(/%2F/g,"/"),S},{}),pathname:f,pathnameBase:g,pattern:t}}function MF(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),O1(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let l=[],u="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,w,s)=>(l.push({paramName:w,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(l.push({paramName:"*"}),u+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?u+="\\/*$":t!==""&&t!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,e?void 0:"i"),l]}function IF(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return O1(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function XM(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,l=t.charAt(r);return l&&l!=="/"?null:t.slice(r)||"/"}const RF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,NF=t=>RF.test(t);function jF(t,e){e===void 0&&(e="/");let{pathname:r,search:l="",hash:u=""}=typeof t=="string"?Jm(t):t,f;if(r)if(NF(r))f=r;else{if(r.includes("//")){let g=r;r=r.replace(/\/\/+/g,"/"),O1(!1,"Pathnames cannot have embedded double slashes - normalizing "+(g+" -> "+r))}r.startsWith("/")?f=TC(r.substring(1),"/"):f=TC(r,e)}else f=e;return{pathname:f,search:BF(l),hash:FF(u)}}function TC(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(u=>{u===".."?r.length>1&&r.pop():u!=="."&&r.push(u)}),r.length>1?r.join("/"):"/"}function iw(t,e,r,l){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function DF(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function LF(t,e){let r=DF(t);return e?r.map((l,u)=>u===r.length-1?l.pathname:l.pathnameBase):r.map(l=>l.pathnameBase)}function OF(t,e,r,l){l===void 0&&(l=!1);let u;typeof t=="string"?u=Jm(t):(u=Iy({},t),Ss(!u.pathname||!u.pathname.includes("?"),iw("?","pathname","search",u)),Ss(!u.pathname||!u.pathname.includes("#"),iw("#","pathname","hash",u)),Ss(!u.search||!u.search.includes("#"),iw("#","search","hash",u)));let f=t===""||u.pathname==="",g=f?"/":u.pathname,w;if(g==null)w=r;else{let j=e.length-1;if(!l&&g.startsWith("..")){let O=g.split("/");for(;O[0]==="..";)O.shift(),j-=1;u.pathname=O.join("/")}w=j>=0?e[j]:"/"}let s=jF(u,w),S=g&&g!=="/"&&g.endsWith("/"),A=(f||g===".")&&r.endsWith("/");return!s.pathname.endsWith("/")&&(S||A)&&(s.pathname+="/"),s}const $f=t=>t.join("/").replace(/\/\/+/g,"/"),zF=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),BF=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,FF=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function VF(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const YM=["post","put","patch","delete"];new Set(YM);const UF=["get",...YM];new Set(UF);function Ry(){return Ry=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},Ry.apply(this,arguments)}const z1=I.createContext(null),$F=I.createContext(null),T0=I.createContext(null),S0=I.createContext(null),np=I.createContext({outlet:null,matches:[],isDataRoute:!1}),JM=I.createContext(null);function E0(){return I.useContext(S0)!=null}function C0(){return E0()||Ss(!1),I.useContext(S0).location}function QM(t){I.useContext(T0).static||I.useLayoutEffect(t)}function rp(){let{isDataRoute:t}=I.useContext(np);return t?r6():GF()}function GF(){E0()||Ss(!1);let t=I.useContext(z1),{basename:e,future:r,navigator:l}=I.useContext(T0),{matches:u}=I.useContext(np),{pathname:f}=C0(),g=JSON.stringify(LF(u,r.v7_relativeSplatPath)),w=I.useRef(!1);return QM(()=>{w.current=!0}),I.useCallback(function(S,A){if(A===void 0&&(A={}),!w.current)return;if(typeof S=="number"){l.go(S);return}let j=OF(S,JSON.parse(g),f,A.relative==="path");t==null&&e!=="/"&&(j.pathname=j.pathname==="/"?e:$f([e,j.pathname])),(A.replace?l.replace:l.push)(j,A.state,A)},[e,l,g,f,t])}function HF(){let{matches:t}=I.useContext(np),e=t[t.length-1];return e?e.params:{}}function qF(t,e){return WF(t,e)}function WF(t,e,r,l){E0()||Ss(!1);let{navigator:u}=I.useContext(T0),{matches:f}=I.useContext(np),g=f[f.length-1],w=g?g.params:{};g&&g.pathname;let s=g?g.pathnameBase:"/";g&&g.route;let S=C0(),A;if(e){var j;let q=typeof e=="string"?Jm(e):e;s==="/"||(j=q.pathname)!=null&&j.startsWith(s)||Ss(!1),A=q}else A=S;let O=A.pathname||"/",L=O;if(s!=="/"){let q=s.replace(/^\//,"").split("/");L="/"+O.replace(/^\//,"").split("/").slice(q.length).join("/")}let W=yF(t,{pathname:L}),U=JF(W&&W.map(q=>Object.assign({},q,{params:Object.assign({},w,q.params),pathname:$f([s,u.encodeLocation?u.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?s:$f([s,u.encodeLocation?u.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),f,r,l);return e&&U?I.createElement(S0.Provider,{value:{location:Ry({pathname:"/",search:"",hash:"",state:null,key:"default"},A),navigationType:sh.Pop}},U):U}function ZF(){let t=n6(),e=VF(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},e),r?I.createElement("pre",{style:u},r):null,null)}const KF=I.createElement(ZF,null);class XF extends I.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?I.createElement(np.Provider,{value:this.props.routeContext},I.createElement(JM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function YF(t){let{routeContext:e,match:r,children:l}=t,u=I.useContext(z1);return u&&u.static&&u.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=r.route.id),I.createElement(np.Provider,{value:e},l)}function JF(t,e,r,l){var u;if(e===void 0&&(e=[]),r===void 0&&(r=null),l===void 0&&(l=null),t==null){var f;if(!r)return null;if(r.errors)t=r.matches;else if((f=l)!=null&&f.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let g=t,w=(u=r)==null?void 0:u.errors;if(w!=null){let A=g.findIndex(j=>j.route.id&&w?.[j.route.id]!==void 0);A>=0||Ss(!1),g=g.slice(0,Math.min(g.length,A+1))}let s=!1,S=-1;if(r&&l&&l.v7_partialHydration)for(let A=0;A<g.length;A++){let j=g[A];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(S=A),j.route.id){let{loaderData:O,errors:L}=r,W=j.route.loader&&O[j.route.id]===void 0&&(!L||L[j.route.id]===void 0);if(j.route.lazy||W){s=!0,S>=0?g=g.slice(0,S+1):g=[g[0]];break}}}return g.reduceRight((A,j,O)=>{let L,W=!1,U=null,q=null;r&&(L=w&&j.route.id?w[j.route.id]:void 0,U=j.route.errorElement||KF,s&&(S<0&&O===0?(i6("route-fallback"),W=!0,q=null):S===O&&(W=!0,q=j.route.hydrateFallbackElement||null)));let Q=e.concat(g.slice(0,O+1)),J=()=>{let Y;return L?Y=U:W?Y=q:j.route.Component?Y=I.createElement(j.route.Component,null):j.route.element?Y=j.route.element:Y=A,I.createElement(YF,{match:j,routeContext:{outlet:A,matches:Q,isDataRoute:r!=null},children:Y})};return r&&(j.route.ErrorBoundary||j.route.errorElement||O===0)?I.createElement(XF,{location:r.location,revalidation:r.revalidation,component:U,error:L,children:J(),routeContext:{outlet:null,matches:Q,isDataRoute:!0}}):J()},null)}var eI=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(eI||{}),tI=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(tI||{});function QF(t){let e=I.useContext(z1);return e||Ss(!1),e}function e6(t){let e=I.useContext($F);return e||Ss(!1),e}function t6(t){let e=I.useContext(np);return e||Ss(!1),e}function nI(t){let e=t6(),r=e.matches[e.matches.length-1];return r.route.id||Ss(!1),r.route.id}function n6(){var t;let e=I.useContext(JM),r=e6(),l=nI();return e!==void 0?e:(t=r.errors)==null?void 0:t[l]}function r6(){let{router:t}=QF(eI.UseNavigateStable),e=nI(tI.UseNavigateStable),r=I.useRef(!1);return QM(()=>{r.current=!0}),I.useCallback(function(u,f){f===void 0&&(f={}),r.current&&(typeof u=="number"?t.navigate(u):t.navigate(u,Ry({fromRouteId:e},f)))},[t,e])}const SC={};function i6(t,e,r){SC[t]||(SC[t]=!0)}function s6(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function Nf(t){Ss(!1)}function o6(t){let{basename:e="/",children:r=null,location:l,navigationType:u=sh.Pop,navigator:f,static:g=!1,future:w}=t;E0()&&Ss(!1);let s=e.replace(/^\/*/,"/"),S=I.useMemo(()=>({basename:s,navigator:f,static:g,future:Ry({v7_relativeSplatPath:!1},w)}),[s,w,f,g]);typeof l=="string"&&(l=Jm(l));let{pathname:A="/",search:j="",hash:O="",state:L=null,key:W="default"}=l,U=I.useMemo(()=>{let q=XM(A,s);return q==null?null:{location:{pathname:q,search:j,hash:O,state:L,key:W},navigationType:u}},[s,A,j,O,L,W,u]);return U==null?null:I.createElement(T0.Provider,{value:S},I.createElement(S0.Provider,{children:r,value:U}))}function a6(t){let{children:e,location:r}=t;return qF(cb(e),r)}new Promise(()=>{});function cb(t,e){e===void 0&&(e=[]);let r=[];return I.Children.forEach(t,(l,u)=>{if(!I.isValidElement(l))return;let f=[...e,u];if(l.type===I.Fragment){r.push.apply(r,cb(l.props.children,f));return}l.type!==Nf&&Ss(!1),!l.props.index||!l.props.children||Ss(!1);let g={id:l.props.id||f.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(g.children=cb(l.props.children,f)),r.push(g)}),r}const l6="6";try{window.__reactRouterVersion=l6}catch{}const c6="startTransition",EC=l0[c6];function u6(t){let{basename:e,children:r,future:l,window:u}=t,f=I.useRef();f.current==null&&(f.current=pF({window:u,v5Compat:!0}));let g=f.current,[w,s]=I.useState({action:g.action,location:g.location}),{v7_startTransition:S}=l||{},A=I.useCallback(j=>{S&&EC?EC(()=>s(j)):s(j)},[s,S]);return I.useLayoutEffect(()=>g.listen(A),[g,A]),I.useEffect(()=>s6(l),[l]),I.createElement(o6,{basename:e,children:r,location:w.location,navigationType:w.action,navigator:g,future:l})}var CC;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(CC||(CC={}));var kC;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(kC||(kC={}));const AC={vi:{appName:"UniPocket",appTagline:"Campus & Lifestyle Map",searchPlaceholder:"Tm phng ban, ta nh, hoc qun ngon...",categoryBuilding:"Ta nh",categoryFood:"n ung",categoryHousing:"Nh tr",categoryJob:"Vic lm",reviews:"nh gi",departments:"Phng ban",floor:"Tng",room:"Phng",roomShort:"P.",seeMore:"Xem thm",directions:"Ch ng",sponsored:"c ti tr",viewNow:"Xem ngay",reviewCount:"{count} nh gi",navigatingTo:"ang ch ng n",calculatingRoute:"ang tnh ton tuyn ng...",hideInstructions:"n hng dn",viewSteps:"Xem {count} bc hng dn",continueStright:"Tip tc i thng",youAreHere:" Bn ang  y",next:"Tip theo:",continue:"Tip tc",accuracy:" chnh xc",remaining:"Cn",multiStopRoute:"L trnh nhiu im",stops:"im dng",addStop:"Thm im dng",selectPointOnMap:"Chn im trn bn ...",total:"Tng cng",startMultiStop:"i nhiu im",walking:"i b",cycling:"Xe my",driving:" t",shortest:"Ngn nht",fastest:"Nhanh nht",minutes:"pht",hours:"gi",meters:"m",kilometers:"km",turnLeft:"R tri",turnRight:"R phi",turnSlightLeft:"R nh sang tri",turnSlightRight:"R nh sang phi",turnSharpLeft:"R gp sang tri",turnSharpRight:"R gp sang phi",continueOn:"Tip tc i",arrive:"n ni",arriveDestination:"Bn  n im ch",depart:"Bt u",straight:"i thng",uturn:"Quay u",roundabout:"i vng xuyn",merge:"Nhp ln",fork:"R ng ba",endOfRoad:"Cui ng",newName:"Tip tc theo",onThe:" pha",left:"tri",right:"phi",locationError:"Khng th ly v tr ca bn. Vui lng cho php truy cp v tr.",browserNoLocation:"Trnh duyt khng h tr nh v",offRouteWarning:"Bn  i lch tuyn ng. ang tnh ton li...",tokenNotConfigured:"Mapbox Token cha c cu hnh",mapboxTokenRequired:"Cn Mapbox Token  xem bn ",mapboxTokenInstructions:"Dn Access Token ca bn (public token)  chy demo ngay.",tokenPlaceholder:"pk.eyJ1Ijoi...",saveTokenAndLoad:"Lu token & ti bn ",tokenSavedInBrowser:"Token s c lu trong trnh duyt (localStorage).",tokenEmptyError:"Vui lng dn Mapbox Access Token",tokenTooShortError:"Token c v cha ng (qu ngn)",language:"Ngn ng",vietnamese:"Ting Vit",english:"English",voucherDiscount20Student:"Gim 20% cho sinh vin",voucherBuy2Get1:"Mua 2 tng 1",voucherDiscount500kFirstMonth:"Gim 500k thng u",voucherFreeDrink:"Tng nc ung",voucherBogo:"Mua 1 tng 1 (T2-T4)",lectureHall:"Ging ng",dormitory:"K tc x",student:"Sinh vin",parking:"Nh xe",gate:"Cng",entrance:"Li vo",security:"Bo v",safetyGuard:"An ninh",sports:"Th thao",health:"Sc khe",medical:"Y t",administration:"Hnh chnh",innovation:"i mi",startup:"Khi nghip",bank:"Ngn hng",atm:"ATM",lake:"H",relaxation:"Th gin",landscape:"Cnh quan",sportsField:"Sn bng",carParking:" xe  t",checkin:"Check-in",lecture_hall:"Ging ng",office:"Vn phng",cafe:"Caf",entertainment:"Vui chi",food:"Qun n",building:"Ta nh",job:"Vic lm",housing:"Nh tr",coffee:"C ph",studySpace:"Khng gian hc tp",wifi:"Wifi",pastry:"Bnh ngt",group:"Nhm",milkTea:"Tr sa",cheap:"Gi r",nearSchool:"Gn trng",aesthetic:"Sng o",safe:"An ninh",partTime:"Part-time",sales:"Bn hng",evening:"Ti",selectCategory:"Chn danh mc",category:"Danh mc",save:"Lu thng tin",cancel:"Hy",premium:"VIP"},en:{lecture_hall:"Lecture Hall",checkin:"Check-in",office:"Office",cafe:"Cafe",entertainment:"Entertainment",food:"Food",building:"Building",job:"Job",appName:"UniPocket",appTagline:"Campus & Lifestyle Map",searchPlaceholder:"Search departments, buildings, or restaurants...",categoryBuilding:"Buildings",categoryFood:"Food & Drink",categoryHousing:"Housing",categoryJob:"Jobs",category:"Category",reviews:"Reviews",departments:"Departments",floor:"Floor",room:"Room",roomShort:"R.",seeMore:"See more",directions:"Directions",sponsored:"Sponsored",viewNow:"View now",reviewCount:"{count} reviews",navigatingTo:"Navigating to",calculatingRoute:"Calculating route...",hideInstructions:"Hide instructions",viewSteps:"View {count} steps",continueStright:"Continue straight",youAreHere:" You are here",next:"Next:",continue:"Continue",accuracy:"Accuracy",remaining:"Remaining",multiStopRoute:"Multi-stop Route",stops:"stops",addStop:"Add stop",selectPointOnMap:"Select point on map...",total:"Total",startMultiStop:"Multi-stop",walking:"Walk",cycling:"Bike",driving:"Drive",shortest:"Shortest",fastest:"Fastest",minutes:"min",hours:"hr",meters:"m",kilometers:"km",turnLeft:"Turn left",turnRight:"Turn right",turnSlightLeft:"Turn slight left",turnSlightRight:"Turn slight right",turnSharpLeft:"Turn sharp left",turnSharpRight:"Turn sharp right",continueOn:"Continue on",arrive:"Arrive",arriveDestination:"You have arrived at your destination",depart:"Depart",straight:"Go straight",uturn:"Make a U-turn",roundabout:"Enter roundabout",merge:"Merge",fork:"Take fork",endOfRoad:"End of road",newName:"Continue onto",onThe:"on the",left:"left",right:"right",locationError:"Unable to get your location. Please allow location access.",browserNoLocation:"Browser does not support geolocation",offRouteWarning:"You are off route. Recalculating...",tokenNotConfigured:"Mapbox Token not configured",mapboxTokenRequired:"Mapbox Token required to view the map",mapboxTokenInstructions:"Paste your Access Token (public token) to run the demo.",tokenPlaceholder:"pk.eyJ1Ijoi...",saveTokenAndLoad:"Save token & load map",tokenSavedInBrowser:"Token will be saved in browser (localStorage).",tokenEmptyError:"Please paste your Mapbox Access Token",tokenTooShortError:"Token seems invalid (too short)",language:"Language",vietnamese:"Ting Vit",english:"English",voucherDiscount20Student:"20% off for students",voucherBuy2Get1:"Buy 2 get 1 free",voucherDiscount500kFirstMonth:"500k off first month",voucherFreeDrink:"Free drink included",voucherBogo:"Buy 1 get 1 free (Mon-Wed)",lectureHall:"Lecture Hall",dormitory:"Dormitory",student:"Student",parking:"Parking",gate:"Gate",entrance:"Entrance",security:"Security",safetyGuard:"Safety Guard",sports:"Sports",health:"Health",medical:"Medical",administration:"Administration",innovation:"Innovation",startup:"Startup",bank:"Bank",atm:"ATM",lake:"Lake",relaxation:"Relaxation",landscape:"Landscape",sportsField:"Sports Field",carParking:"Car Parking",coffee:"Coffee",studySpace:"Study Space",wifi:"WiFi",pastry:"Pastry",group:"Group",milkTea:"Milk Tea",cheap:"Budget-friendly",nearSchool:"Near Campus",aesthetic:"Aesthetic",housing:"Housing",safe:"Safe",partTime:"Part-time",sales:"Sales",evening:"Evening"}},rI=I.createContext(void 0),PC="unipocket-language",d6=({children:t})=>{const[e,r]=I.useState(()=>{if(typeof window<"u"){const f=localStorage.getItem(PC);if(f==="vi"||f==="en")return f}return"vi"}),l=I.useCallback(f=>{r(f),localStorage.setItem(PC,f)},[]),u=I.useCallback((f,g)=>{let w=AC[e][f]||AC.vi[f]||f;return g&&Object.entries(g).forEach(([s,S])=>{w=w.replace(`{${s}}`,String(S))}),w},[e]);return v.jsx(rI.Provider,{value:{language:e,setLanguage:l,t:u},children:t})},da=()=>{const t=I.useContext(rI);if(t===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return t};var Xc=function(){return Xc=Object.assign||function(e){for(var r,l=1,u=arguments.length;l<u;l++){r=arguments[l];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(e[f]=r[f])}return e},Xc.apply(this,arguments)};function Qm(t,e){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&e.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(t);u<l.length;u++)e.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(t,l[u])&&(r[l[u]]=t[l[u]]);return r}function h6(t,e,r,l){function u(f){return f instanceof r?f:new r(function(g){g(f)})}return new(r||(r=Promise))(function(f,g){function w(A){try{S(l.next(A))}catch(j){g(j)}}function s(A){try{S(l.throw(A))}catch(j){g(j)}}function S(A){A.done?f(A.value):u(A.value).then(w,s)}S((l=l.apply(t,e||[])).next())})}function f6(t,e,r){if(r||arguments.length===2)for(var l=0,u=e.length,f;l<u;l++)(f||!(l in e))&&(f||(f=Array.prototype.slice.call(e,0,l)),f[l]=e[l]);return t.concat(f||Array.prototype.slice.call(e))}const p6=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class B1 extends Error{constructor(e,r="FunctionsError",l){super(e),this.name=r,this.context=l}}class m6 extends B1{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class MC extends B1{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class IC extends B1{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ub;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(ub||(ub={}));class g6{constructor(e,{headers:r={},customFetch:l,region:u=ub.Any}={}){this.url=e,this.headers=r,this.region=u,this.fetch=p6(l)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return h6(this,arguments,void 0,function*(r,l={}){var u;let f,g;try{const{headers:w,method:s,body:S,signal:A,timeout:j}=l;let O={},{region:L}=l;L||(L=this.region);const W=new URL(`${this.url}/${r}`);L&&L!=="any"&&(O["x-region"]=L,W.searchParams.set("forceFunctionRegion",L));let U;S&&(w&&!Object.prototype.hasOwnProperty.call(w,"Content-Type")||!w)?typeof Blob<"u"&&S instanceof Blob||S instanceof ArrayBuffer?(O["Content-Type"]="application/octet-stream",U=S):typeof S=="string"?(O["Content-Type"]="text/plain",U=S):typeof FormData<"u"&&S instanceof FormData?U=S:(O["Content-Type"]="application/json",U=JSON.stringify(S)):S&&typeof S!="string"&&!(typeof Blob<"u"&&S instanceof Blob)&&!(S instanceof ArrayBuffer)&&!(typeof FormData<"u"&&S instanceof FormData)?U=JSON.stringify(S):U=S;let q=A;j&&(g=new AbortController,f=setTimeout(()=>g.abort(),j),A?(q=g.signal,A.addEventListener("abort",()=>g.abort())):q=g.signal);const Q=yield this.fetch(W.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},O),this.headers),w),body:U,signal:q}).catch(_e=>{throw new m6(_e)}),J=Q.headers.get("x-relay-error");if(J&&J==="true")throw new MC(Q);if(!Q.ok)throw new IC(Q);let Y=((u=Q.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),ie;return Y==="application/json"?ie=yield Q.json():Y==="application/octet-stream"||Y==="application/pdf"?ie=yield Q.blob():Y==="text/event-stream"?ie=Q:Y==="multipart/form-data"?ie=yield Q.formData():ie=yield Q.text(),{data:ie,error:null,response:Q}}catch(w){return{data:null,error:w,response:w instanceof IC||w instanceof MC?w.context:void 0}}finally{f&&clearTimeout(f)}})}}var y6=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},_6=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let u=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async f=>{let g=null,w=null,s=null,S=f.status,A=f.statusText;if(f.ok){var j,O;if(r.method!=="HEAD"){var L;const Q=await f.text();Q===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((L=r.headers.get("Accept"))===null||L===void 0)&&L.includes("application/vnd.pgrst.plan+text"))?w=Q:w=JSON.parse(Q))}const U=(j=r.headers.get("Prefer"))===null||j===void 0?void 0:j.match(/count=(exact|planned|estimated)/),q=(O=f.headers.get("content-range"))===null||O===void 0?void 0:O.split("/");U&&q&&q.length>1&&(s=parseInt(q[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(w)&&(w.length>1?(g={code:"PGRST116",details:`Results contain ${w.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},w=null,s=null,S=406,A="Not Acceptable"):w.length===1?w=w[0]:w=null)}else{var W;const U=await f.text();try{g=JSON.parse(U),Array.isArray(g)&&f.status===404&&(w=[],g=null,S=200,A="OK")}catch{f.status===404&&U===""?(S=204,A="No Content"):g={message:U}}if(g&&r.isMaybeSingle&&(!(g==null||(W=g.details)===null||W===void 0)&&W.includes("0 rows"))&&(g=null,S=200,A="OK"),g&&r.shouldThrowOnError)throw new y6(g)}return{error:g,data:w,count:s,status:S,statusText:A}});return this.shouldThrowOnError||(u=u.catch(f=>{var g;let w="";const s=f?.cause;if(s){var S,A,j,O;const W=(S=s?.message)!==null&&S!==void 0?S:"",U=(A=s?.code)!==null&&A!==void 0?A:"";w=`${(j=f?.name)!==null&&j!==void 0?j:"FetchError"}: ${f?.message}`,w+=`

Caused by: ${(O=s?.name)!==null&&O!==void 0?O:"Error"}: ${W}`,U&&(w+=` (${U})`),s?.stack&&(w+=`
${s.stack}`)}else{var L;w=(L=f?.stack)!==null&&L!==void 0?L:""}return{error:{message:`${(g=f?.name)!==null&&g!==void 0?g:"FetchError"}: ${f?.message}`,details:w,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),u.then(t,e)}returns(){return this}overrideTypes(){return this}},v6=class extends _6{select(t){let e=!1;const r=(t??"*").split("").map(l=>/\s/.test(l)&&!e?"":(l==='"'&&(e=!e),l)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:l,referencedTable:u=l}={}){const f=u?`${u}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const l=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(l,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:l=r}={}){const u=typeof l>"u"?"offset":`${l}.offset`,f=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(u,`${t}`),this.url.searchParams.set(f,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:l=!1,wal:u=!1,format:f="text"}={}){var g;const w=[t?"analyze":null,e?"verbose":null,r?"settings":null,l?"buffers":null,u?"wal":null].filter(Boolean).join("|"),s=(g=this.headers.get("Accept"))!==null&&g!==void 0?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${s}"; options=${w};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const RC=new RegExp("[,()]");var _m=class extends v6{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(l=>typeof l=="string"&&RC.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(l=>typeof l=="string"&&RC.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:l}={}){let u="";l==="plain"?u="pl":l==="phrase"?u="ph":l==="websearch"&&(u="w");const f=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${u}fts${f}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const l=r?`${r}.or`:"or";return this.url.searchParams.append(l,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},x6=class{constructor(t,{headers:e={},schema:r,fetch:l}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=l}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:l}=e??{},u=r?"HEAD":"GET";let f=!1;const g=(t??"*").split("").map(S=>/\s/.test(S)&&!f?"":(S==='"'&&(f=!f),S)).join(""),{url:w,headers:s}=this.cloneRequestState();return w.searchParams.set("select",g),l&&s.append("Prefer",`count=${l}`),new _m({method:u,url:w,headers:s,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var l;const u="POST",{url:f,headers:g}=this.cloneRequestState();if(e&&g.append("Prefer",`count=${e}`),r||g.append("Prefer","missing=default"),Array.isArray(t)){const w=t.reduce((s,S)=>s.concat(Object.keys(S)),[]);if(w.length>0){const s=[...new Set(w)].map(S=>`"${S}"`);f.searchParams.set("columns",s.join(","))}}return new _m({method:u,url:f,headers:g,schema:this.schema,body:t,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:l,defaultToNull:u=!0}={}){var f;const g="POST",{url:w,headers:s}=this.cloneRequestState();if(s.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&w.searchParams.set("on_conflict",e),l&&s.append("Prefer",`count=${l}`),u||s.append("Prefer","missing=default"),Array.isArray(t)){const S=t.reduce((A,j)=>A.concat(Object.keys(j)),[]);if(S.length>0){const A=[...new Set(S)].map(j=>`"${j}"`);w.searchParams.set("columns",A.join(","))}}return new _m({method:g,url:w,headers:s,schema:this.schema,body:t,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(t,{count:e}={}){var r;const l="PATCH",{url:u,headers:f}=this.cloneRequestState();return e&&f.append("Prefer",`count=${e}`),new _m({method:l,url:u,headers:f,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var e;const r="DELETE",{url:l,headers:u}=this.cloneRequestState();return t&&u.append("Prefer",`count=${t}`),new _m({method:r,url:l,headers:u,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},w6=class iI{constructor(e,{headers:r={},schema:l,fetch:u}={}){this.url=e,this.headers=new Headers(r),this.schemaName=l,this.fetch=u}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new x6(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new iI(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:l=!1,get:u=!1,count:f}={}){var g;let w;const s=new URL(`${this.url}/rpc/${e}`);let S;const A=L=>L!==null&&typeof L=="object"&&(!Array.isArray(L)||L.some(A)),j=l&&Object.values(r).some(A);j?(w="POST",S=r):l||u?(w=l?"HEAD":"GET",Object.entries(r).filter(([L,W])=>W!==void 0).map(([L,W])=>[L,Array.isArray(W)?`{${W.join(",")}}`:`${W}`]).forEach(([L,W])=>{s.searchParams.append(L,W)})):(w="POST",S=r);const O=new Headers(this.headers);return j?O.set("Prefer",f?`count=${f},return=minimal`:"return=minimal"):f&&O.set("Prefer",`count=${f}`),new _m({method:w,url:s,headers:O,schema:this.schemaName,body:S,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}};class b6{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const l=r.versions;if(l&&l.node){const u=l.node,f=parseInt(u.replace(/^v/,"").split(".")[0]);return f>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${f} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${f} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const l=this.getWebSocketConstructor();return new l(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const T6="2.91.1",S6=`realtime-js/${T6}`,E6="1.0.0",sI="2.0.0",NC=sI,db=1e4,C6=1e3,k6=100;var th;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(th||(th={}));var xs;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(xs||(xs={}));var tc;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(tc||(tc={}));var hb;(function(t){t.websocket="websocket"})(hb||(hb={}));var Lf;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Lf||(Lf={}));class A6{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let l=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(l))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,l;const u=(l=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&l!==void 0?l:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,u)}_encodeJsonUserBroadcastPush(e){var r,l;const u=(l=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&l!==void 0?l:{},g=new TextEncoder().encode(JSON.stringify(u)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,g)}_encodeUserBroadcastPush(e,r,l){var u,f;const g=e.topic,w=(u=e.ref)!==null&&u!==void 0?u:"",s=(f=e.join_ref)!==null&&f!==void 0?f:"",S=e.payload.event,A=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},j=Object.keys(A).length===0?"":JSON.stringify(A);if(s.length>255)throw new Error(`joinRef length ${s.length} exceeds maximum of 255`);if(w.length>255)throw new Error(`ref length ${w.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`topic length ${g.length} exceeds maximum of 255`);if(S.length>255)throw new Error(`userEvent length ${S.length} exceeds maximum of 255`);if(j.length>255)throw new Error(`metadata length ${j.length} exceeds maximum of 255`);const O=this.USER_BROADCAST_PUSH_META_LENGTH+s.length+w.length+g.length+S.length+j.length,L=new ArrayBuffer(this.HEADER_LENGTH+O);let W=new DataView(L),U=0;W.setUint8(U++,this.KINDS.userBroadcastPush),W.setUint8(U++,s.length),W.setUint8(U++,w.length),W.setUint8(U++,g.length),W.setUint8(U++,S.length),W.setUint8(U++,j.length),W.setUint8(U++,r),Array.from(s,Q=>W.setUint8(U++,Q.charCodeAt(0))),Array.from(w,Q=>W.setUint8(U++,Q.charCodeAt(0))),Array.from(g,Q=>W.setUint8(U++,Q.charCodeAt(0))),Array.from(S,Q=>W.setUint8(U++,Q.charCodeAt(0))),Array.from(j,Q=>W.setUint8(U++,Q.charCodeAt(0)));var q=new Uint8Array(L.byteLength+l.byteLength);return q.set(new Uint8Array(L),0),q.set(new Uint8Array(l),L.byteLength),q.buffer}decode(e,r){if(this._isArrayBuffer(e)){let l=this._binaryDecode(e);return r(l)}if(typeof e=="string"){const l=JSON.parse(e),[u,f,g,w,s]=l;return r({join_ref:u,ref:f,topic:g,event:w,payload:s})}return r({})}_binaryDecode(e){const r=new DataView(e),l=r.getUint8(0),u=new TextDecoder;if(l===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,r,u)}_decodeUserBroadcast(e,r,l){const u=r.getUint8(1),f=r.getUint8(2),g=r.getUint8(3),w=r.getUint8(4);let s=this.HEADER_LENGTH+4;const S=l.decode(e.slice(s,s+u));s=s+u;const A=l.decode(e.slice(s,s+f));s=s+f;const j=l.decode(e.slice(s,s+g));s=s+g;const O=e.slice(s,e.byteLength),L=w===this.JSON_ENCODING?JSON.parse(l.decode(O)):O,W={type:this.BROADCAST_EVENT,event:A,payload:L};return g>0&&(W.meta=JSON.parse(j)),{join_ref:null,ref:null,topic:S,event:this.BROADCAST_EVENT,payload:W}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([l])=>r.includes(l)))}}class oI{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ni;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ni||(ni={}));const jC=(t,e,r={})=>{var l;const u=(l=r.skipTypes)!==null&&l!==void 0?l:[];return e?Object.keys(e).reduce((f,g)=>(f[g]=P6(g,t,e,u),f),{}):{}},P6=(t,e,r,l)=>{const u=e.find(w=>w.name===t),f=u?.type,g=r[t];return f&&!l.includes(f)?aI(f,g):fb(g)},aI=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return N6(e,r)}switch(t){case ni.bool:return M6(e);case ni.float4:case ni.float8:case ni.int2:case ni.int4:case ni.int8:case ni.numeric:case ni.oid:return I6(e);case ni.json:case ni.jsonb:return R6(e);case ni.timestamp:return j6(e);case ni.abstime:case ni.date:case ni.daterange:case ni.int4range:case ni.int8range:case ni.money:case ni.reltime:case ni.text:case ni.time:case ni.timestamptz:case ni.timetz:case ni.tsrange:case ni.tstzrange:return fb(e);default:return fb(e)}},fb=t=>t,M6=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},I6=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},R6=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},N6=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,l=t[r];if(t[0]==="{"&&l==="}"){let f;const g=t.slice(1,r);try{f=JSON.parse("["+g+"]")}catch{f=g?g.split(","):[]}return f.map(w=>aI(e,w))}return t},j6=t=>typeof t=="string"?t.replace(" ","T"):t,lI=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class sw{constructor(e,r,l={},u=db){this.channel=e,this.event=r,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var l;return this._hasReceived(e)&&r((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(l=>l.status===e).forEach(l=>l.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var DC;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(DC||(DC={}));class yy{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},u=>{const{onJoin:f,onLeave:g,onSync:w}=this.caller;this.joinRef=this.channel._joinRef(),this.state=yy.syncState(this.state,u,f,g),this.pendingDiffs.forEach(s=>{this.state=yy.syncDiff(this.state,s,f,g)}),this.pendingDiffs=[],w()}),this.channel._on(l.diff,{},u=>{const{onJoin:f,onLeave:g,onSync:w}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=yy.syncDiff(this.state,u,f,g),w())}),this.onJoin((u,f,g)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:f,newPresences:g})}),this.onLeave((u,f,g)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:f,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,l,u){const f=this.cloneDeep(e),g=this.transformState(r),w={},s={};return this.map(f,(S,A)=>{g[S]||(s[S]=A)}),this.map(g,(S,A)=>{const j=f[S];if(j){const O=A.map(q=>q.presence_ref),L=j.map(q=>q.presence_ref),W=A.filter(q=>L.indexOf(q.presence_ref)<0),U=j.filter(q=>O.indexOf(q.presence_ref)<0);W.length>0&&(w[S]=W),U.length>0&&(s[S]=U)}else w[S]=A}),this.syncDiff(f,{joins:w,leaves:s},l,u)}static syncDiff(e,r,l,u){const{joins:f,leaves:g}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return l||(l=()=>{}),u||(u=()=>{}),this.map(f,(w,s)=>{var S;const A=(S=e[w])!==null&&S!==void 0?S:[];if(e[w]=this.cloneDeep(s),A.length>0){const j=e[w].map(L=>L.presence_ref),O=A.filter(L=>j.indexOf(L.presence_ref)<0);e[w].unshift(...O)}l(w,A,s)}),this.map(g,(w,s)=>{let S=e[w];if(!S)return;const A=s.map(j=>j.presence_ref);S=S.filter(j=>A.indexOf(j.presence_ref)<0),e[w]=S,u(w,S,s),S.length===0&&delete e[w]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(l=>r(l,e[l]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,l)=>{const u=e[l];return"metas"in u?r[l]=u.metas.map(f=>(f.presence_ref=f.phx_ref,delete f.phx_ref,delete f.phx_ref_prev,f)):r[l]=u,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var LC;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(LC||(LC={}));var _y;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(_y||(_y={}));var Yu;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Yu||(Yu={}));class Em{constructor(e,r={config:{}},l){var u,f;if(this.topic=e,this.params=r,this.socket=l,this.bindings={},this.state=xs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new sw(this,tc.join,this.params,this.timeout),this.rejoinTimer=new oI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(g=>g.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xs.closed,this.socket._remove(this)}),this._onError(g=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,g),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",g=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,g),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(tc.reply,{},(g,w)=>{this._trigger(this._replyEventName(w),g)}),this.presence=new yy(this),this.broadcastEndpointURL=lI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((f=(u=this.params.config)===null||u===void 0?void 0:u.broadcast)===null||f===void 0)&&f.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var l,u,f;if(this.socket.isConnected()||this.socket.connect(),this.state==xs.closed){const{config:{broadcast:g,presence:w,private:s}}=this.params,S=(u=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(L=>L.filter))!==null&&u!==void 0?u:[],A=!!this.bindings[_y.PRESENCE]&&this.bindings[_y.PRESENCE].length>0||((f=this.params.config.presence)===null||f===void 0?void 0:f.enabled)===!0,j={},O={broadcast:g,presence:Object.assign(Object.assign({},w),{enabled:A}),postgres_changes:S,private:s};this.socket.accessTokenValue&&(j.access_token=this.socket.accessTokenValue),this._onError(L=>e?.(Yu.CHANNEL_ERROR,L)),this._onClose(()=>e?.(Yu.CLOSED)),this.updateJoinPayload(Object.assign({config:O},j)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:L})=>{var W;if(this.socket._isManualToken()||this.socket.setAuth(),L===void 0){e?.(Yu.SUBSCRIBED);return}else{const U=this.bindings.postgres_changes,q=(W=U?.length)!==null&&W!==void 0?W:0,Q=[];for(let J=0;J<q;J++){const Y=U[J],{filter:{event:ie,schema:_e,table:Se,filter:Ie}}=Y,Ue=L&&L[J];if(Ue&&Ue.event===ie&&Em.isFilterValueEqual(Ue.schema,_e)&&Em.isFilterValueEqual(Ue.table,Se)&&Em.isFilterValueEqual(Ue.filter,Ie))Q.push(Object.assign(Object.assign({},Y),{id:Ue.id}));else{this.unsubscribe(),this.state=xs.errored,e?.(Yu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Q,e&&e(Yu.SUBSCRIBED);return}}).receive("error",L=>{this.state=xs.errored,e?.(Yu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(L).join(", ")||"error")))}).receive("timeout",()=>{e?.(Yu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,l){return this.state===xs.joined&&e===_y.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,l)}async httpSend(e,r,l={}){var u;if(r==null)return Promise.reject("Payload is required for httpSend()");const f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const g={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},w=await this._fetchWithTimeout(this.broadcastEndpointURL,g,(u=l.timeout)!==null&&u!==void 0?u:this.timeout);if(w.status===202)return{success:!0};let s=w.statusText;try{const S=await w.json();s=S.error||S.message||s}catch{}return Promise.reject(new Error(s))}async send(e,r={}){var l,u;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:f,payload:g}=e,w={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(w.Authorization=`Bearer ${this.socket.accessTokenValue}`);const s={method:"POST",headers:w,body:JSON.stringify({messages:[{topic:this.subTopic,event:f,payload:g,private:this.private}]})};try{const S=await this._fetchWithTimeout(this.broadcastEndpointURL,s,(l=r.timeout)!==null&&l!==void 0?l:this.timeout);return await((u=S.body)===null||u===void 0?void 0:u.cancel()),S.ok?"ok":"error"}catch(S){return S.name==="AbortError"?"timed out":"error"}}else return new Promise(f=>{var g,w,s;const S=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((s=(w=(g=this.params)===null||g===void 0?void 0:g.config)===null||w===void 0?void 0:w.broadcast)===null||s===void 0)&&s.ack)&&f("ok"),S.receive("ok",()=>f("ok")),S.receive("error",()=>f("error")),S.receive("timeout",()=>f("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=xs.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(tc.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(u=>{l=new sw(this,tc.leave,{},e),l.receive("ok",()=>{r(),u("ok")}).receive("timeout",()=>{r(),u("timed out")}).receive("error",()=>{u("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=xs.closed,this.bindings={}}async _fetchWithTimeout(e,r,l){const u=new AbortController,f=setTimeout(()=>u.abort(),l),g=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:u.signal}));return clearTimeout(f),g}_push(e,r,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new sw(this,e,r,l);return this._canPush()?u.send():this._addToPushBuffer(u),u}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>k6){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,l){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,l){var u,f;const g=e.toLocaleLowerCase(),{close:w,error:s,leave:S,join:A}=tc;if(l&&[w,s,S,A].indexOf(g)>=0&&l!==this._joinRef())return;let O=this._onMessage(g,r,l);if(r&&!O)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(L=>{var W,U,q;return((W=L.filter)===null||W===void 0?void 0:W.event)==="*"||((q=(U=L.filter)===null||U===void 0?void 0:U.event)===null||q===void 0?void 0:q.toLocaleLowerCase())===g}).map(L=>L.callback(O,l)):(f=this.bindings[g])===null||f===void 0||f.filter(L=>{var W,U,q,Q,J,Y,ie,_e;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in L){const Se=L.id,Ie=(W=L.filter)===null||W===void 0?void 0:W.event;return Se&&((U=r.ids)===null||U===void 0?void 0:U.includes(Se))&&(Ie==="*"||Ie?.toLocaleLowerCase()===((q=r.data)===null||q===void 0?void 0:q.type.toLocaleLowerCase()))&&(!(!((Q=L.filter)===null||Q===void 0)&&Q.table)||L.filter.table===((J=r.data)===null||J===void 0?void 0:J.table))}else{const Se=(ie=(Y=L?.filter)===null||Y===void 0?void 0:Y.event)===null||ie===void 0?void 0:ie.toLocaleLowerCase();return Se==="*"||Se===((_e=r?.event)===null||_e===void 0?void 0:_e.toLocaleLowerCase())}else return L.type.toLocaleLowerCase()===g}).map(L=>{if(typeof O=="object"&&"ids"in O){const W=O.data,{schema:U,table:q,commit_timestamp:Q,type:J,errors:Y}=W;O=Object.assign(Object.assign({},{schema:U,table:q,commit_timestamp:Q,eventType:J,new:{},old:{},errors:Y}),this._getPayloadRecords(W))}L.callback(O,l)})}_isClosed(){return this.state===xs.closed}_isJoined(){return this.state===xs.joined}_isJoining(){return this.state===xs.joining}_isLeaving(){return this.state===xs.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,l){const u=e.toLocaleLowerCase(),f={type:u,filter:r,callback:l};return this.bindings[u]?this.bindings[u].push(f):this.bindings[u]=[f],this}_off(e,r){const l=e.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(u=>{var f;return!(((f=u.type)===null||f===void 0?void 0:f.toLocaleLowerCase())===l&&Em.isEqual(u.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const l in e)if(e[l]!==r[l])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(tc.close,{},e)}_onError(e){this._on(tc.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xs.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=jC(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=jC(e.columns,e.old_record)),r}}const ow=()=>{},ov={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},D6=[1e3,2e3,5e3,1e4],L6=1e4,O6=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class z6{constructor(e,r){var l;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=db,this.transport=null,this.heartbeatIntervalMs=ov.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ow,this.ref=0,this.reconnectTimer=null,this.vsn=NC,this.logger=ow,this.conn=null,this.sendBuffer=[],this.serializer=new A6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=u=>u?(...f)=>u(...f):(...f)=>fetch(...f),!(!((l=r?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${hb.websocket}`,this.httpEndpoint=lI(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=b6.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,l){this.logger(e,r,l)}connectionState(){switch(this.conn&&this.conn.readyState){case th.connecting:return Lf.Connecting;case th.open:return Lf.Open;case th.closing:return Lf.Closing;default:return Lf.Closed}}isConnected(){return this.connectionState()===Lf.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const l=`realtime:${e}`,u=this.getChannels().find(f=>f.topic===l);if(u)return u;{const f=new Em(`realtime:${e}`,r,this);return this.channels.push(f),f}}push(e){const{topic:r,event:l,payload:u,ref:f}=e,g=()=>{this.encode(e,w=>{var s;(s=this.conn)===null||s===void 0||s.send(w)})};this.log("push",`${r} ${l} (${f})`,u),this.isConnected()?g():this.sendBuffer.push(g)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(C6,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},ov.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(l=>l.topic===e&&(l._isJoined()||l._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const S=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",S)}catch(A){this.log("error","error in heartbeat callback",A)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:l,event:u,payload:f,ref:g}=r,w=g?`(${g})`:"",s=f.status||"";this.log("receive",`${s} ${l} ${u} ${w}`.trim(),f),this.channels.filter(S=>S._isMember(l)).forEach(S=>S._trigger(u,f,g)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===th.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===th.open||this.conn.readyState===th.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(tc.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const l=e.match(/\?/)?"&":"?",u=new URLSearchParams(r);return`${e}${l}${u}`}_workerObjectUrl(e){let r;if(e)r=e;else{const l=new Blob([O6],{type:"application/javascript"});r=URL.createObjectURL(l)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,l=!1;if(e)r=e,l=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(u){this.log("error","Error fetching access token from callback",u),r=this.accessTokenValue}else r=this.accessTokenValue;l?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(u=>{const f={access_token:r,version:S6};r&&u.updateJoinPayload(f),u.joinedOnce&&u._isJoined()&&u._push(tc.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(l=>{try{l(r)}catch(u){this.log("error",`error in ${e} callback`,u)}})}catch(l){this.log("error",`error triggering ${e} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new oI(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ov.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,l,u,f,g,w,s,S,A,j,O,L;switch(this.transport=(r=e?.transport)!==null&&r!==void 0?r:null,this.timeout=(l=e?.timeout)!==null&&l!==void 0?l:db,this.heartbeatIntervalMs=(u=e?.heartbeatIntervalMs)!==null&&u!==void 0?u:ov.HEARTBEAT_INTERVAL,this.worker=(f=e?.worker)!==null&&f!==void 0?f:!1,this.accessToken=(g=e?.accessToken)!==null&&g!==void 0?g:null,this.heartbeatCallback=(w=e?.heartbeatCallback)!==null&&w!==void 0?w:ow,this.vsn=(s=e?.vsn)!==null&&s!==void 0?s:NC,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(S=e?.reconnectAfterMs)!==null&&S!==void 0?S:(W=>D6[W-1]||L6),this.vsn){case E6:this.encode=(A=e?.encode)!==null&&A!==void 0?A:((W,U)=>U(JSON.stringify(W))),this.decode=(j=e?.decode)!==null&&j!==void 0?j:((W,U)=>U(JSON.parse(W)));break;case sI:this.encode=(O=e?.encode)!==null&&O!==void 0?O:this.serializer.encode.bind(this.serializer),this.decode=(L=e?.decode)!==null&&L!==void 0?L:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var Ny=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function B6(t,e,r){const l=new URL(e,t);if(r)for(const[u,f]of Object.entries(r))f!==void 0&&l.searchParams.set(u,f);return l.toString()}async function F6(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function V6(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:l,query:u,body:f,headers:g}){const w=B6(t.baseUrl,l,u),s=await F6(t.auth),S=await e(w,{method:r,headers:{...f?{"Content-Type":"application/json"}:{},...s,...g},body:f?JSON.stringify(f):void 0}),A=await S.text(),j=(S.headers.get("content-type")||"").includes("application/json"),O=j&&A?JSON.parse(A):A;if(!S.ok){const L=j?O:void 0,W=L?.error;throw new Ny(W?.message??`Request failed with status ${S.status}`,{status:S.status,icebergType:W?.type,icebergCode:W?.code,details:L})}return{status:S.status,headers:S.headers,data:O}}}}function av(t){return t.join("")}var U6=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:av(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(l=>({namespace:l}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${av(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${av(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${av(t.namespace)}`}),!0}catch(e){if(e instanceof Ny&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof Ny&&r.status===409)return;throw r}}};function lm(t){return t.join("")}var $6=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${lm(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof Ny&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof Ny&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},G6=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=V6({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new U6(this.client,e),this.tableOps=new $6(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},k0=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Pi(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var H6=class extends k0{constructor(t,e,r){super(t),this.name="StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},pb=class extends k0{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const F1=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),q6=()=>Response,mb=t=>{if(Array.isArray(t))return t.map(r=>mb(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,l])=>{const u=r.replace(/([-_][a-z])/gi,f=>f.toUpperCase().replace(/[-_]/g,""));e[u]=mb(l)}),e},W6=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Z6=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function jy(t){"@babel/helpers - typeof";return jy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jy(t)}function K6(t,e){if(jy(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var l=r.call(t,e);if(jy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function X6(t){var e=K6(t,"string");return jy(e)=="symbol"?e:e+""}function Y6(t,e,r){return(e=X6(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function OC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,l)}return r}function Un(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?OC(Object(r),!0).forEach(function(l){Y6(t,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):OC(Object(r)).forEach(function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(r,l))})}return t}const aw=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},J6=async(t,e,r)=>{t instanceof await q6()&&!r?.noResolveJson?t.json().then(l=>{const u=t.status||500,f=l?.statusCode||u+"";e(new H6(aw(l),u,f))}).catch(l=>{e(new pb(aw(l),l))}):e(new pb(aw(t),t))},Q6=(t,e,r,l)=>{const u={method:t,headers:e?.headers||{}};return t==="GET"||!l?u:(W6(l)?(u.headers=Un({"Content-Type":"application/json"},e?.headers),u.body=JSON.stringify(l)):u.body=l,e?.duplex&&(u.duplex=e.duplex),Un(Un({},u),r))};async function t_(t,e,r,l,u,f){return new Promise((g,w)=>{t(r,Q6(e,l,u,f)).then(s=>{if(!s.ok)throw s;return l?.noResolveJson?s:s.json()}).then(s=>g(s)).catch(s=>J6(s,w,l))})}async function Dy(t,e,r,l){return t_(t,"GET",e,r,l)}async function ec(t,e,r,l,u){return t_(t,"POST",e,l,u,r)}async function gb(t,e,r,l,u){return t_(t,"PUT",e,l,u,r)}async function eV(t,e,r,l){return t_(t,"HEAD",e,Un(Un({},r),{},{noResolveJson:!0}),l)}async function V1(t,e,r,l,u){return t_(t,"DELETE",e,l,u,r)}var tV=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Pi(e))return{data:null,error:e};throw e}}};let cI;cI=Symbol.toStringTag;var nV=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[cI]="BlobDownloadBuilder",this.promise=null}asStream(){return new tV(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Pi(e))return{data:null,error:e};throw e}}};const rV={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},zC={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var iV=class{constructor(t,e={},r,l){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=r,this.fetch=F1(l)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,r,l){var u=this;try{let f;const g=Un(Un({},zC),l);let w=Un(Un({},u.headers),t==="POST"&&{"x-upsert":String(g.upsert)});const s=g.metadata;typeof Blob<"u"&&r instanceof Blob?(f=new FormData,f.append("cacheControl",g.cacheControl),s&&f.append("metadata",u.encodeMetadata(s)),f.append("",r)):typeof FormData<"u"&&r instanceof FormData?(f=r,f.has("cacheControl")||f.append("cacheControl",g.cacheControl),s&&!f.has("metadata")&&f.append("metadata",u.encodeMetadata(s))):(f=r,w["cache-control"]=`max-age=${g.cacheControl}`,w["content-type"]=g.contentType,s&&(w["x-metadata"]=u.toBase64(u.encodeMetadata(s))),(typeof ReadableStream<"u"&&f instanceof ReadableStream||f&&typeof f=="object"&&"pipe"in f&&typeof f.pipe=="function")&&!g.duplex&&(g.duplex="half")),l?.headers&&(w=Un(Un({},w),l.headers));const S=u._removeEmptyFolders(e),A=u._getFinalPath(S),j=await(t=="PUT"?gb:ec)(u.fetch,`${u.url}/object/${A}`,f,Un({headers:w},g?.duplex?{duplex:g.duplex}:{}));return{data:{path:S,id:j.Id,fullPath:j.Key},error:null}}catch(f){if(u.shouldThrowOnError)throw f;if(Pi(f))return{data:null,error:f};throw f}}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,l){var u=this;const f=u._removeEmptyFolders(t),g=u._getFinalPath(f),w=new URL(u.url+`/object/upload/sign/${g}`);w.searchParams.set("token",e);try{let s;const S=Un({upsert:zC.upsert},l),A=Un(Un({},u.headers),{"x-upsert":String(S.upsert)});return typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",S.cacheControl),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",S.cacheControl)):(s=r,A["cache-control"]=`max-age=${S.cacheControl}`,A["content-type"]=S.contentType),{data:{path:f,fullPath:(await gb(u.fetch,w.toString(),s,{headers:A})).Key},error:null}}catch(s){if(u.shouldThrowOnError)throw s;if(Pi(s))return{data:null,error:s};throw s}}async createSignedUploadUrl(t,e){var r=this;try{let l=r._getFinalPath(t);const u=Un({},r.headers);e?.upsert&&(u["x-upsert"]="true");const f=await ec(r.fetch,`${r.url}/object/upload/sign/${l}`,{},{headers:u}),g=new URL(r.url+f.url),w=g.searchParams.get("token");if(!w)throw new k0("No token returned by API");return{data:{signedUrl:g.toString(),path:t,token:w},error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Pi(l))return{data:null,error:l};throw l}}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var l=this;try{return{data:await ec(l.fetch,`${l.url}/object/move`,{bucketId:l.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:l.headers}),error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Pi(u))return{data:null,error:u};throw u}}async copy(t,e,r){var l=this;try{return{data:{path:(await ec(l.fetch,`${l.url}/object/copy`,{bucketId:l.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:l.headers})).Key},error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Pi(u))return{data:null,error:u};throw u}}async createSignedUrl(t,e,r){var l=this;try{let u=l._getFinalPath(t),f=await ec(l.fetch,`${l.url}/object/sign/${u}`,Un({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:l.headers});const g=r?.download?`&download=${r.download===!0?"":r.download}`:"";return f={signedUrl:encodeURI(`${l.url}${f.signedURL}${g}`)},{data:f,error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Pi(u))return{data:null,error:u};throw u}}async createSignedUrls(t,e,r){var l=this;try{const u=await ec(l.fetch,`${l.url}/object/sign/${l.bucketId}`,{expiresIn:e,paths:t},{headers:l.headers}),f=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:u.map(g=>Un(Un({},g),{},{signedUrl:g.signedURL?encodeURI(`${l.url}${g.signedURL}${f}`):null})),error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Pi(u))return{data:null,error:u};throw u}}download(t,e){const r=typeof e?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(e?.transform||{}),u=l?`?${l}`:"",f=this._getFinalPath(t),g=()=>Dy(this.fetch,`${this.url}/${r}/${f}${u}`,{headers:this.headers,noResolveJson:!0});return new nV(g,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);try{return{data:mb(await Dy(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})),error:null}}catch(l){if(e.shouldThrowOnError)throw l;if(Pi(l))return{data:null,error:l};throw l}}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await eV(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(l){if(e.shouldThrowOnError)throw l;if(Pi(l)&&l instanceof pb){const u=l.originalError;if([400,404].includes(u?.status))return{data:!1,error:l}}throw l}}getPublicUrl(t,e){const r=this._getFinalPath(t),l=[],u=e?.download?`download=${e.download===!0?"":e.download}`:"";u!==""&&l.push(u);const f=typeof e?.transform<"u"?"render/image":"object",g=this.transformOptsToQueryString(e?.transform||{});g!==""&&l.push(g);let w=l.join("&");return w!==""&&(w=`?${w}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${r}${w}`)}}}async remove(t){var e=this;try{return{data:await V1(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async list(t,e,r){var l=this;try{const u=Un(Un(Un({},rV),e),{},{prefix:t||""});return{data:await ec(l.fetch,`${l.url}/object/list/${l.bucketId}`,u,{headers:l.headers},r),error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Pi(u))return{data:null,error:u};throw u}}async listV2(t,e){var r=this;try{const l=Un({},t);return{data:await ec(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,l,{headers:r.headers},e),error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Pi(l))return{data:null,error:l};throw l}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const uI="2.91.1",dI={"X-Client-Info":`storage-js/${uI}`};var sV=class{constructor(t,e={},r,l){this.shouldThrowOnError=!1;const u=new URL(t);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href.replace(/\/$/,""),this.headers=Un(Un({},dI),e),this.fetch=F1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const r=e.listBucketOptionsToQueryString(t);return{data:await Dy(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await Dy(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async createBucket(t,e={public:!1}){var r=this;try{return{data:await ec(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Pi(l))return{data:null,error:l};throw l}}async updateBucket(t,e){var r=this;try{return{data:await gb(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Pi(l))return{data:null,error:l};throw l}}async emptyBucket(t){var e=this;try{return{data:await ec(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await V1(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},oV=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Un(Un({},dI),e),this.fetch=F1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ec(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async listBuckets(t){var e=this;try{const r=new URLSearchParams;t?.limit!==void 0&&r.set("limit",t.limit.toString()),t?.offset!==void 0&&r.set("offset",t.offset.toString()),t?.sortColumn&&r.set("sortColumn",t.sortColumn),t?.sortOrder&&r.set("sortOrder",t.sortOrder),t?.search&&r.set("search",t.search);const l=r.toString(),u=l?`${e.url}/bucket?${l}`:`${e.url}/bucket`;return{data:await Dy(e.fetch,u,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await V1(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Pi(r))return{data:null,error:r};throw r}}from(t){var e=this;if(!Z6(t))throw new k0("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new G6({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),l=this.shouldThrowOnError;return new Proxy(r,{get(u,f){const g=u[f];return typeof g!="function"?g:async(...w)=>{try{return{data:await g.apply(u,w),error:null}}catch(s){if(l)throw s;return{data:null,error:s}}}}})}};const U1={"X-Client-Info":`storage-js/${uI}`,"Content-Type":"application/json"};var hI=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Na(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var lw=class extends hI{constructor(t,e,r){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},aV=class extends hI{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const $1=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),lV=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},BC=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),cV=async(t,e,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!r?.noResolveJson){const l=t.status||500,u=t;if(typeof u.json=="function")u.json().then(f=>{const g=f?.statusCode||f?.code||l+"";e(new lw(BC(f),l,g))}).catch(()=>{const f=l+"";e(new lw(u.statusText||`HTTP ${l} error`,l,f))});else{const f=l+"";e(new lw(u.statusText||`HTTP ${l} error`,l,f))}}else e(new aV(BC(t),t))},uV=(t,e,r,l)=>{const u={method:t,headers:e?.headers||{}};return l?(lV(l)?(u.headers=Un({"Content-Type":"application/json"},e?.headers),u.body=JSON.stringify(l)):u.body=l,Un(Un({},u),r)):u};async function dV(t,e,r,l,u,f){return new Promise((g,w)=>{t(r,uV(e,l,u,f)).then(s=>{if(!s.ok)throw s;if(l?.noResolveJson)return s;const S=s.headers.get("content-type");return!S||!S.includes("application/json")?{}:s.json()}).then(s=>g(s)).catch(s=>cV(s,w,l))})}async function ja(t,e,r,l,u){return dV(t,"POST",e,l,u,r)}var hV=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Un(Un({},U1),e),this.fetch=$1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async getIndex(t,e){var r=this;try{return{data:await ja(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}),error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Na(l))return{data:null,error:l};throw l}}async listIndexes(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async deleteIndex(t,e){var r=this;try{return{data:await ja(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{},error:null}}catch(l){if(r.shouldThrowOnError)throw l;if(Na(l))return{data:null,error:l};throw l}}},fV=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Un(Un({},U1),e),this.fetch=$1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await ja(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async getVectors(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await ja(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async queryVectors(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await ja(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}},pV=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Un(Un({},U1),e),this.fetch=$1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async listBuckets(t={}){var e=this;try{return{data:await ja(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await ja(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Na(r))return{data:null,error:r};throw r}}},mV=class extends pV{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new gV(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},gV=class extends hV{constructor(t,e,r,l){super(t,e,l),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new yV(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},yV=class extends fV{constructor(t,e,r,l,u){super(t,e,u),this.vectorBucketName=r,this.indexName=l}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,Un(Un({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},_V=class extends sV{constructor(t,e={},r,l){super(t,e,r,l)}from(t){return new iV(this.url,this.headers,t,this.fetch)}get vectors(){return new mV(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new oV(this.url+"/iceberg",this.headers,this.fetch)}};const fI="2.91.1",vm=30*1e3,yb=3,cw=yb*vm,vV="http://localhost:9999",xV="supabase.auth.token",wV={"X-Client-Info":`gotrue-js/${fI}`},_b="X-Supabase-Api-Version",pI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bV=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,TV=600*1e3;class Ly extends Error{constructor(e,r,l){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=l}}function En(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class SV extends Ly{constructor(e,r,l){super(e,r,l),this.name="AuthApiError",this.status=r,this.code=l}}function EV(t){return En(t)&&t.name==="AuthApiError"}class Of extends Ly{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class sd extends Ly{constructor(e,r,l,u){super(e,l,u),this.name=r,this.status=l}}class Ia extends sd{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function CV(t){return En(t)&&t.name==="AuthSessionMissingError"}class cm extends sd{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class lv extends sd{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class cv extends sd{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function kV(t){return En(t)&&t.name==="AuthImplicitGrantRedirectError"}class FC extends sd{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class AV extends sd{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class vb extends sd{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function uw(t){return En(t)&&t.name==="AuthRetryableFetchError"}class VC extends sd{constructor(e,r,l){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=l}}class xb extends sd{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Bv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),UC=` 	
\r=`.split(""),PV=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<UC.length;e+=1)t[UC[e].charCodeAt(0)]=-2;for(let e=0;e<Bv.length;e+=1)t[Bv[e].charCodeAt(0)]=e;return t})();function $C(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const l=e.queue>>e.queuedBits-6&63;r(Bv[l]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const l=e.queue>>e.queuedBits-6&63;r(Bv[l]),e.queuedBits-=6}}function mI(t,e,r){const l=PV[t];if(l>-1)for(e.queue=e.queue<<6|l,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function GC(t){const e=[],r=g=>{e.push(String.fromCodePoint(g))},l={utf8seq:0,codepoint:0},u={queue:0,queuedBits:0},f=g=>{RV(g,l,r)};for(let g=0;g<t.length;g+=1)mI(t.charCodeAt(g),u,f);return e.join("")}function MV(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function IV(t,e){for(let r=0;r<t.length;r+=1){let l=t.charCodeAt(r);if(l>55295&&l<=56319){const u=(l-55296)*1024&65535;l=(t.charCodeAt(r+1)-56320&65535|u)+65536,r+=1}MV(l,e)}}function RV(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let l=1;l<6;l+=1)if((t>>7-l&1)===0){e.utf8seq=l;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function Rm(t){const e=[],r={queue:0,queuedBits:0},l=u=>{e.push(u)};for(let u=0;u<t.length;u+=1)mI(t.charCodeAt(u),r,l);return new Uint8Array(e)}function NV(t){const e=[];return IV(t,r=>e.push(r)),new Uint8Array(e)}function Bf(t){const e=[],r={queue:0,queuedBits:0},l=u=>{e.push(u)};return t.forEach(u=>$C(u,r,l)),$C(null,r,l),e.join("")}function jV(t){return Math.round(Date.now()/1e3)+t}function DV(){return Symbol("auth-callback")}const to=()=>typeof window<"u"&&typeof document<"u",Mf={tested:!1,writable:!1},gI=()=>{if(!to())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mf.tested)return Mf.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Mf.tested=!0,Mf.writable=!0}catch{Mf.tested=!0,Mf.writable=!1}return Mf.writable};function LV(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((u,f)=>{e[f]=u})}catch{}return r.searchParams.forEach((l,u)=>{e[u]=l}),e}const yI=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),OV=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",xm=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},If=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},eo=async(t,e)=>{await t.removeItem(e)};class A0{constructor(){this.promise=new A0.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}A0.promiseConstructor=Promise;function dw(t){const e=t.split(".");if(e.length!==3)throw new xb("Invalid JWT structure");for(let l=0;l<e.length;l++)if(!bV.test(e[l]))throw new xb("JWT not in base64url format");return{header:JSON.parse(GC(e[0])),payload:JSON.parse(GC(e[1])),signature:Rm(e[2]),raw:{header:e[0],payload:e[1]}}}async function zV(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function BV(t,e){return new Promise((l,u)=>{(async()=>{for(let f=0;f<1/0;f++)try{const g=await t(f);if(!e(f,null,g)){l(g);return}}catch(g){if(!e(f,g)){u(g);return}}})()})}function FV(t){return("0"+t.toString(16)).substr(-2)}function VV(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=r.length;let u="";for(let f=0;f<56;f++)u+=r.charAt(Math.floor(Math.random()*l));return u}return crypto.getRandomValues(e),Array.from(e,FV).join("")}async function UV(t){const r=new TextEncoder().encode(t),l=await crypto.subtle.digest("SHA-256",r),u=new Uint8Array(l);return Array.from(u).map(f=>String.fromCharCode(f)).join("")}async function $V(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await UV(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function um(t,e,r=!1){const l=VV();let u=l;r&&(u+="/PASSWORD_RECOVERY"),await xm(t,`${e}-code-verifier`,u);const f=await $V(l);return[f,l===f?"plain":"s256"]}const GV=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function HV(t){const e=t.headers.get(_b);if(!e||!e.match(GV))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function qV(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function WV(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ZV=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function dm(t){if(!ZV.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function hw(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const l=r.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function KV(t,e){return new Proxy(t,{get:(r,l,u)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const f=l.toString();if(f==="Symbol(Symbol.toPrimitive)"||f==="Symbol(Symbol.toStringTag)"||f==="Symbol(util.inspect.custom)"||f==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,l,u)}return!e.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,l,u)}})}function HC(t){return JSON.parse(JSON.stringify(t))}const jf=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),XV=[502,503,504];async function qC(t){var e;if(!OV(t))throw new vb(jf(t),0);if(XV.includes(t.status))throw new vb(jf(t),t.status);let r;try{r=await t.json()}catch(f){throw new Of(jf(f),f)}let l;const u=HV(t);if(u&&u.getTime()>=pI["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?l=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(l=r.error_code),l){if(l==="weak_password")throw new VC(jf(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(l==="session_not_found")throw new Ia}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((f,g)=>f&&typeof g=="string",!0))throw new VC(jf(r),t.status,r.weak_password.reasons);throw new SV(jf(r),t.status||500,l)}const YV=(t,e,r,l)=>{const u={method:t,headers:e?.headers||{}};return t==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),r))};async function Vn(t,e,r,l){var u;const f=Object.assign({},l?.headers);f[_b]||(f[_b]=pI["2024-01-01"].name),l?.jwt&&(f.Authorization=`Bearer ${l.jwt}`);const g=(u=l?.query)!==null&&u!==void 0?u:{};l?.redirectTo&&(g.redirect_to=l.redirectTo);const w=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",s=await JV(t,e,r+w,{headers:f,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(s):{data:Object.assign({},s),error:null}}async function JV(t,e,r,l,u,f){const g=YV(e,l,u,f);let w;try{w=await t(r,Object.assign({},g))}catch(s){throw console.error(s),new vb(jf(s),0)}if(w.ok||await qC(w),l?.noResolveJson)return w;try{return await w.json()}catch(s){await qC(s)}}function Kl(t){var e;let r=null;tU(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=jV(t.expires_in)));const l=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:l},error:null}}function WC(t){const e=Kl(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,l)=>r&&typeof l=="string",!0)&&(e.data.weak_password=t.weak_password),e}function rh(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function QV(t){return{data:t,error:null}}function eU(t){const{action_link:e,email_otp:r,hashed_token:l,redirect_to:u,verification_type:f}=t,g=Qm(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),w={action_link:e,email_otp:r,hashed_token:l,redirect_to:u,verification_type:f},s=Object.assign({},g);return{data:{properties:w,user:s},error:null}}function ZC(t){return t}function tU(t){return t.access_token&&t.refresh_token&&t.expires_in}const fw=["global","local","others"];class nU{constructor({url:e="",headers:r={},fetch:l}){this.url=e,this.headers=r,this.fetch=yI(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=fw[0]){if(fw.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fw.join(", ")}`);try{return await Vn(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(l){if(En(l))return{data:null,error:l};throw l}}async inviteUserByEmail(e,r={}){try{return await Vn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:rh})}catch(l){if(En(l))return{data:{user:null},error:l};throw l}}async generateLink(e){try{const{options:r}=e,l=Qm(e,["options"]),u=Object.assign(Object.assign({},l),r);return"newEmail"in l&&(u.new_email=l?.newEmail,delete u.newEmail),await Vn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:eU,redirectTo:r?.redirectTo})}catch(r){if(En(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await Vn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:rh})}catch(r){if(En(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,l,u,f,g,w,s;try{const S={nextPage:null,lastPage:0,total:0},A=await Vn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:"",per_page:(f=(u=e?.perPage)===null||u===void 0?void 0:u.toString())!==null&&f!==void 0?f:""},xform:ZC});if(A.error)throw A.error;const j=await A.json(),O=(g=A.headers.get("x-total-count"))!==null&&g!==void 0?g:0,L=(s=(w=A.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&s!==void 0?s:[];return L.length>0&&(L.forEach(W=>{const U=parseInt(W.split(";")[0].split("=")[1].substring(0,1)),q=JSON.parse(W.split(";")[1].split("=")[1]);S[`${q}Page`]=U}),S.total=parseInt(O)),{data:Object.assign(Object.assign({},j),S),error:null}}catch(S){if(En(S))return{data:{users:[]},error:S};throw S}}async getUserById(e){dm(e);try{return await Vn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:rh})}catch(r){if(En(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){dm(e);try{return await Vn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:rh})}catch(l){if(En(l))return{data:{user:null},error:l};throw l}}async deleteUser(e,r=!1){dm(e);try{return await Vn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:rh})}catch(l){if(En(l))return{data:{user:null},error:l};throw l}}async _listFactors(e){dm(e.userId);try{const{data:r,error:l}=await Vn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:r,error:l}}catch(r){if(En(r))return{data:null,error:r};throw r}}async _deleteFactor(e){dm(e.userId),dm(e.id);try{return{data:await Vn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(En(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,l,u,f,g,w,s;try{const S={nextPage:null,lastPage:0,total:0},A=await Vn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:"",per_page:(f=(u=e?.perPage)===null||u===void 0?void 0:u.toString())!==null&&f!==void 0?f:""},xform:ZC});if(A.error)throw A.error;const j=await A.json(),O=(g=A.headers.get("x-total-count"))!==null&&g!==void 0?g:0,L=(s=(w=A.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&s!==void 0?s:[];return L.length>0&&(L.forEach(W=>{const U=parseInt(W.split(";")[0].split("=")[1].substring(0,1)),q=JSON.parse(W.split(";")[1].split("=")[1]);S[`${q}Page`]=U}),S.total=parseInt(O)),{data:Object.assign(Object.assign({},j),S),error:null}}catch(S){if(En(S))return{data:{clients:[]},error:S};throw S}}async _createOAuthClient(e){try{return await Vn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(En(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await Vn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(En(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await Vn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(En(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(e){try{return await Vn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(En(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await Vn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(En(r))return{data:null,error:r};throw r}}}function KC(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const hm={debug:!!(globalThis&&gI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class _I extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class rU extends _I{}async function iU(t,e,r){hm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const l=new globalThis.AbortController;return e>0&&setTimeout(()=>{l.abort(),hm.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async u=>{if(u){hm.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,u.name);try{return await r()}finally{hm.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,u.name)}}else{if(e===0)throw hm.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new rU(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(hm.debug)try{const f=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(f,null,"  "))}catch(f){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",f)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function sU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function vI(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function oU(t){return parseInt(t,16)}function aU(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,l=>l.toString(16).padStart(2,"0")).join("")}function lU(t){var e;const{chainId:r,domain:l,expirationTime:u,issuedAt:f=new Date,nonce:g,notBefore:w,requestId:s,resources:S,scheme:A,uri:j,version:O}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(g&&g.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${g}`);if(!j)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(O!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${O}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const L=vI(t.address),W=A?`${A}://${l}`:l,U=t.statement?`${t.statement}
`:"",q=`${W} wants you to sign in with your Ethereum account:
${L}

${U}`;let Q=`URI: ${j}
Version: ${O}
Chain ID: ${r}${g?`
Nonce: ${g}`:""}
Issued At: ${f.toISOString()}`;if(u&&(Q+=`
Expiration Time: ${u.toISOString()}`),w&&(Q+=`
Not Before: ${w.toISOString()}`),s&&(Q+=`
Request ID: ${s}`),S){let J=`
Resources:`;for(const Y of S){if(!Y||typeof Y!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Y}`);J+=`
- ${Y}`}Q+=J}return`${q}
${Q}`}class ss extends Error{constructor({message:e,code:r,cause:l,name:u}){var f;super(e,{cause:l}),this.__isWebAuthnError=!0,this.name=(f=u??(l instanceof Error?l.name:void 0))!==null&&f!==void 0?f:"Unknown Error",this.code=r}}class Fv extends ss{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function cU({error:t,options:e}){var r,l,u;const{publicKey:f}=e;if(!f)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ss({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=f.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new ss({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((l=f.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new ss({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((u=f.authenticatorSelection)===null||u===void 0?void 0:u.userVerification)==="required")return new ss({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new ss({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new ss({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return f.pubKeyCredParams.filter(w=>w.type==="public-key").length===0?new ss({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new ss({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const g=window.location.hostname;if(xI(g)){if(f.rp.id!==g)return new ss({message:`The RP ID "${f.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ss({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(f.user.id.byteLength<1||f.user.id.byteLength>64)return new ss({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new ss({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ss({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function uU({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ss({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new ss({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const l=window.location.hostname;if(xI(l)){if(r.rpId!==l)return new ss({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new ss({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new ss({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new ss({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class dU{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const hU=new dU;function fU(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:l}=t,u=Qm(t,["challenge","user","excludeCredentials"]),f=Rm(e).buffer,g=Object.assign(Object.assign({},r),{id:Rm(r.id).buffer}),w=Object.assign(Object.assign({},u),{challenge:f,user:g});if(l&&l.length>0){w.excludeCredentials=new Array(l.length);for(let s=0;s<l.length;s++){const S=l[s];w.excludeCredentials[s]=Object.assign(Object.assign({},S),{id:Rm(S.id).buffer,type:S.type||"public-key",transports:S.transports})}}return w}function pU(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,l=Qm(t,["challenge","allowCredentials"]),u=Rm(e).buffer,f=Object.assign(Object.assign({},l),{challenge:u});if(r&&r.length>0){f.allowCredentials=new Array(r.length);for(let g=0;g<r.length;g++){const w=r[g];f.allowCredentials[g]=Object.assign(Object.assign({},w),{id:Rm(w.id).buffer,type:w.type||"public-key",transports:w.transports})}}return f}function mU(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Bf(new Uint8Array(t.response.attestationObject)),clientDataJSON:Bf(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function gU(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,l=t.getClientExtensionResults(),u=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Bf(new Uint8Array(u.authenticatorData)),clientDataJSON:Bf(new Uint8Array(u.clientDataJSON)),signature:Bf(new Uint8Array(u.signature)),userHandle:u.userHandle?Bf(new Uint8Array(u.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function xI(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function XC(){var t,e;return!!(to()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function yU(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Fv("Browser returned unexpected credential type",e)}:{data:null,error:new Fv("Empty credential response",e)}}catch(e){return{data:null,error:cU({error:e,options:t})}}}async function _U(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Fv("Browser returned unexpected credential type",e)}:{data:null,error:new Fv("Empty credential response",e)}}catch(e){return{data:null,error:uU({error:e,options:t})}}}const vU={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},xU={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Vv(...t){const e=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),r=u=>u instanceof ArrayBuffer||ArrayBuffer.isView(u),l={};for(const u of t)if(u)for(const f in u){const g=u[f];if(g!==void 0)if(Array.isArray(g))l[f]=g;else if(r(g))l[f]=g;else if(e(g)){const w=l[f];e(w)?l[f]=Vv(w,g):l[f]=Vv(g)}else l[f]=g}return l}function wU(t,e){return Vv(vU,t,e||{})}function bU(t,e){return Vv(xU,t,e||{})}class TU{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:l,signal:u},f){try{const{data:g,error:w}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!g)return{data:null,error:w};const s=u??hU.createNewAbortSignal();if(g.webauthn.type==="create"){const{user:S}=g.webauthn.credential_options.publicKey;S.name||(S.name=`${S.id}:${l}`),S.displayName||(S.displayName=S.name)}switch(g.webauthn.type){case"create":{const S=wU(g.webauthn.credential_options.publicKey,f?.create),{data:A,error:j}=await yU({publicKey:S,signal:s});return A?{data:{factorId:e,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:A}},error:null}:{data:null,error:j}}case"request":{const S=bU(g.webauthn.credential_options.publicKey,f?.request),{data:A,error:j}=await _U(Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:S,signal:s}));return A?{data:{factorId:e,challengeId:g.id,webauthn:{type:g.webauthn.type,credential_response:A}},error:null}:{data:null,error:j}}}}catch(g){return En(g)?{data:null,error:g}:{data:null,error:new Of("Unexpected error in challenge",g)}}}async _verify({challengeId:e,factorId:r,webauthn:l}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:l})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},f){if(!r)return{data:null,error:new Ly("rpId is required for WebAuthn authentication")};try{if(!XC())return{data:null,error:new Of("Browser does not support WebAuthn",null)};const{data:g,error:w}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:l},signal:u},{request:f});if(!g)return{data:null,error:w};const{webauthn:s}=g;return this._verify({factorId:e,challengeId:g.challengeId,webauthn:{type:s.type,rpId:r,rpOrigins:l,credential_response:s.credential_response}})}catch(g){return En(g)?{data:null,error:g}:{data:null,error:new Of("Unexpected error in authenticate",g)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},f){if(!r)return{data:null,error:new Ly("rpId is required for WebAuthn registration")};try{if(!XC())return{data:null,error:new Of("Browser does not support WebAuthn",null)};const{data:g,error:w}=await this._enroll({friendlyName:e});if(!g)return await this.client.mfa.listFactors().then(A=>{var j;return(j=A.data)===null||j===void 0?void 0:j.all.find(O=>O.factor_type==="webauthn"&&O.friendly_name===e&&O.status!=="unverified")}).then(A=>A?this.client.mfa.unenroll({factorId:A?.id}):void 0),{data:null,error:w};const{data:s,error:S}=await this._challenge({factorId:g.id,friendlyName:g.friendly_name,webauthn:{rpId:r,rpOrigins:l},signal:u},{create:f});return s?this._verify({factorId:g.id,challengeId:s.challengeId,webauthn:{rpId:r,rpOrigins:l,type:s.webauthn.type,credential_response:s.webauthn.credential_response}}):{data:null,error:S}}catch(g){return En(g)?{data:null,error:g}:{data:null,error:new Of("Unexpected error in register",g)}}}}sU();const SU={url:vV,storageKey:xV,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wV,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function YC(t,e,r){return await r()}const fm={};class Oy{get jwks(){var e,r;return(r=(e=fm[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){fm[this.storageKey]=Object.assign(Object.assign({},fm[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=fm[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){fm[this.storageKey]=Object.assign(Object.assign({},fm[this.storageKey]),{cachedAt:e})}constructor(e){var r,l,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const f=Object.assign(Object.assign({},SU),e);if(this.storageKey=f.storageKey,this.instanceID=(r=Oy.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Oy.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!f.debug,typeof f.debug=="function"&&(this.logger=f.debug),this.instanceID>0&&to()){const g=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(g),this.logDebugMessages&&console.trace(g)}if(this.persistSession=f.persistSession,this.autoRefreshToken=f.autoRefreshToken,this.admin=new nU({url:f.url,headers:f.headers,fetch:f.fetch}),this.url=f.url,this.headers=f.headers,this.fetch=yI(f.fetch),this.lock=f.lock||YC,this.detectSessionInUrl=f.detectSessionInUrl,this.flowType=f.flowType,this.hasCustomAuthorizationHeader=f.hasCustomAuthorizationHeader,this.throwOnError=f.throwOnError,this.lockAcquireTimeout=f.lockAcquireTimeout,f.lock?this.lock=f.lock:this.persistSession&&to()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=iU:this.lock=YC,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new TU(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(f.storage?this.storage=f.storage:gI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=KC(this.memoryStorage)),f.userStorage&&(this.userStorage=f.userStorage)):(this.memoryStorage={},this.storage=KC(this.memoryStorage)),to()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(g){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",g)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async g=>{this._debug("received broadcast notification from other tab or client",g),await this._notifyAllSubscribers(g.data.event,g.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${fI}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},l="none";if(to()&&(r=LV(window.location.href),this._isImplicitGrantCallback(r)?l="implicit":await this._isPKCECallback(r)&&(l="pkce")),to()&&this.detectSessionInUrl&&l!=="none"){const{data:u,error:f}=await this._getSessionFromURL(r,l);if(f){if(this._debug("#_initialize()","error detecting session from URL",f),kV(f)){const s=(e=f.details)===null||e===void 0?void 0:e.code;if(s==="identity_already_exists"||s==="identity_not_found"||s==="single_identity_not_deletable")return{error:f}}return{error:f}}const{session:g,redirectType:w}=u;return this._debug("#_initialize()","detected session in URL",g,"redirect type",w),await this._saveSession(g),setTimeout(async()=>{w==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",g):await this._notifyAllSubscribers("SIGNED_IN",g)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return En(r)?this._returnResult({error:r}):this._returnResult({error:new Of("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,l,u;try{const f=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(u=e?.options)===null||u===void 0?void 0:u.captchaToken}},xform:Kl}),{data:g,error:w}=f;if(w||!g)return this._returnResult({data:{user:null,session:null},error:w});const s=g.session,S=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",s)),this._returnResult({data:{user:S,session:s},error:null})}catch(f){if(En(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signUp(e){var r,l,u;try{let f;if("email"in e){const{email:A,password:j,options:O}=e;let L=null,W=null;this.flowType==="pkce"&&([L,W]=await um(this.storage,this.storageKey)),f=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:O?.emailRedirectTo,body:{email:A,password:j,data:(r=O?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:O?.captchaToken},code_challenge:L,code_challenge_method:W},xform:Kl})}else if("phone"in e){const{phone:A,password:j,options:O}=e;f=await Vn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:A,password:j,data:(l=O?.data)!==null&&l!==void 0?l:{},channel:(u=O?.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:O?.captchaToken}},xform:Kl})}else throw new lv("You must provide either an email or phone number and a password");const{data:g,error:w}=f;if(w||!g)return await eo(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:w});const s=g.session,S=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",s)),this._returnResult({data:{user:S,session:s},error:null})}catch(f){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithPassword(e){try{let r;if("email"in e){const{email:f,password:g,options:w}=e;r=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:f,password:g,gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:WC})}else if("phone"in e){const{phone:f,password:g,options:w}=e;r=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:f,password:g,gotrue_meta_security:{captcha_token:w?.captchaToken}},xform:WC})}else throw new lv("You must provide either an email or phone number and a password");const{data:l,error:u}=r;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const f=new cm;return this._returnResult({data:{user:null,session:null},error:f})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:u})}catch(r){if(En(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,l,u,f;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(f=e.options)===null||f===void 0?void 0:f.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,l,u,f,g,w,s,S,A,j,O;let L,W;if("message"in e)L=e.message,W=e.signature;else{const{chain:U,wallet:q,statement:Q,options:J}=e;let Y;if(to())if(typeof q=="object")Y=q;else{const Je=window;if("ethereum"in Je&&typeof Je.ethereum=="object"&&"request"in Je.ethereum&&typeof Je.ethereum.request=="function")Y=Je.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof q!="object"||!J?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Y=q}const ie=new URL((r=J?.url)!==null&&r!==void 0?r:window.location.href),_e=await Y.request({method:"eth_requestAccounts"}).then(Je=>Je).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_e||_e.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Se=vI(_e[0]);let Ie=(l=J?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!Ie){const Je=await Y.request({method:"eth_chainId"});Ie=oU(Je)}const Ue={domain:ie.host,address:Se,statement:Q,uri:ie.href,version:"1",chainId:Ie,nonce:(u=J?.signInWithEthereum)===null||u===void 0?void 0:u.nonce,issuedAt:(g=(f=J?.signInWithEthereum)===null||f===void 0?void 0:f.issuedAt)!==null&&g!==void 0?g:new Date,expirationTime:(w=J?.signInWithEthereum)===null||w===void 0?void 0:w.expirationTime,notBefore:(s=J?.signInWithEthereum)===null||s===void 0?void 0:s.notBefore,requestId:(S=J?.signInWithEthereum)===null||S===void 0?void 0:S.requestId,resources:(A=J?.signInWithEthereum)===null||A===void 0?void 0:A.resources};L=lU(Ue),W=await Y.request({method:"personal_sign",params:[aU(L),Se]})}try{const{data:U,error:q}=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:L,signature:W},!((j=e.options)===null||j===void 0)&&j.captchaToken?{gotrue_meta_security:{captcha_token:(O=e.options)===null||O===void 0?void 0:O.captchaToken}}:null),xform:Kl});if(q)throw q;if(!U||!U.session||!U.user){const Q=new cm;return this._returnResult({data:{user:null,session:null},error:Q})}return U.session&&(await this._saveSession(U.session),await this._notifyAllSubscribers("SIGNED_IN",U.session)),this._returnResult({data:Object.assign({},U),error:q})}catch(U){if(En(U))return this._returnResult({data:{user:null,session:null},error:U});throw U}}async signInWithSolana(e){var r,l,u,f,g,w,s,S,A,j,O,L;let W,U;if("message"in e)W=e.message,U=e.signature;else{const{chain:q,wallet:Q,statement:J,options:Y}=e;let ie;if(to())if(typeof Q=="object")ie=Q;else{const Se=window;if("solana"in Se&&typeof Se.solana=="object"&&("signIn"in Se.solana&&typeof Se.solana.signIn=="function"||"signMessage"in Se.solana&&typeof Se.solana.signMessage=="function"))ie=Se.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Q!="object"||!Y?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ie=Q}const _e=new URL((r=Y?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in ie&&ie.signIn){const Se=await ie.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Y?.signInWithSolana),{version:"1",domain:_e.host,uri:_e.href}),J?{statement:J}:null));let Ie;if(Array.isArray(Se)&&Se[0]&&typeof Se[0]=="object")Ie=Se[0];else if(Se&&typeof Se=="object"&&"signedMessage"in Se&&"signature"in Se)Ie=Se;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Ie&&"signature"in Ie&&(typeof Ie.signedMessage=="string"||Ie.signedMessage instanceof Uint8Array)&&Ie.signature instanceof Uint8Array)W=typeof Ie.signedMessage=="string"?Ie.signedMessage:new TextDecoder().decode(Ie.signedMessage),U=Ie.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ie)||typeof ie.signMessage!="function"||!("publicKey"in ie)||typeof ie!="object"||!ie.publicKey||!("toBase58"in ie.publicKey)||typeof ie.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");W=[`${_e.host} wants you to sign in with your Solana account:`,ie.publicKey.toBase58(),...J?["",J,""]:[""],"Version: 1",`URI: ${_e.href}`,`Issued At: ${(u=(l=Y?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&u!==void 0?u:new Date().toISOString()}`,...!((f=Y?.signInWithSolana)===null||f===void 0)&&f.notBefore?[`Not Before: ${Y.signInWithSolana.notBefore}`]:[],...!((g=Y?.signInWithSolana)===null||g===void 0)&&g.expirationTime?[`Expiration Time: ${Y.signInWithSolana.expirationTime}`]:[],...!((w=Y?.signInWithSolana)===null||w===void 0)&&w.chainId?[`Chain ID: ${Y.signInWithSolana.chainId}`]:[],...!((s=Y?.signInWithSolana)===null||s===void 0)&&s.nonce?[`Nonce: ${Y.signInWithSolana.nonce}`]:[],...!((S=Y?.signInWithSolana)===null||S===void 0)&&S.requestId?[`Request ID: ${Y.signInWithSolana.requestId}`]:[],...!((j=(A=Y?.signInWithSolana)===null||A===void 0?void 0:A.resources)===null||j===void 0)&&j.length?["Resources",...Y.signInWithSolana.resources.map(Ie=>`- ${Ie}`)]:[]].join(`
`);const Se=await ie.signMessage(new TextEncoder().encode(W),"utf8");if(!Se||!(Se instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");U=Se}}try{const{data:q,error:Q}=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:W,signature:Bf(U)},!((O=e.options)===null||O===void 0)&&O.captchaToken?{gotrue_meta_security:{captcha_token:(L=e.options)===null||L===void 0?void 0:L.captchaToken}}:null),xform:Kl});if(Q)throw Q;if(!q||!q.session||!q.user){const J=new cm;return this._returnResult({data:{user:null,session:null},error:J})}return q.session&&(await this._saveSession(q.session),await this._notifyAllSubscribers("SIGNED_IN",q.session)),this._returnResult({data:Object.assign({},q),error:Q})}catch(q){if(En(q))return this._returnResult({data:{user:null,session:null},error:q});throw q}}async _exchangeCodeForSession(e){const r=await If(this.storage,`${this.storageKey}-code-verifier`),[l,u]=(r??"").split("/");try{if(!l&&this.flowType==="pkce")throw new AV;const{data:f,error:g}=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:l},xform:Kl});if(await eo(this.storage,`${this.storageKey}-code-verifier`),g)throw g;if(!f||!f.session||!f.user){const w=new cm;return this._returnResult({data:{user:null,session:null,redirectType:null},error:w})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:Object.assign(Object.assign({},f),{redirectType:u??null}),error:g})}catch(f){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(f))return this._returnResult({data:{user:null,session:null,redirectType:null},error:f});throw f}}async signInWithIdToken(e){try{const{options:r,provider:l,token:u,access_token:f,nonce:g}=e,w=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:u,access_token:f,nonce:g,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Kl}),{data:s,error:S}=w;if(S)return this._returnResult({data:{user:null,session:null},error:S});if(!s||!s.session||!s.user){const A=new cm;return this._returnResult({data:{user:null,session:null},error:A})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:s,error:S})}catch(r){if(En(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,l,u,f,g;try{if("email"in e){const{email:w,options:s}=e;let S=null,A=null;this.flowType==="pkce"&&([S,A]=await um(this.storage,this.storageKey));const{error:j}=await Vn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:w,data:(r=s?.data)!==null&&r!==void 0?r:{},create_user:(l=s?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:s?.captchaToken},code_challenge:S,code_challenge_method:A},redirectTo:s?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:j})}if("phone"in e){const{phone:w,options:s}=e,{data:S,error:A}=await Vn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:w,data:(u=s?.data)!==null&&u!==void 0?u:{},create_user:(f=s?.shouldCreateUser)!==null&&f!==void 0?f:!0,gotrue_meta_security:{captcha_token:s?.captchaToken},channel:(g=s?.channel)!==null&&g!==void 0?g:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:S?.message_id},error:A})}throw new lv("You must provide either an email or phone number.")}catch(w){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async verifyOtp(e){var r,l;try{let u,f;"options"in e&&(u=(r=e.options)===null||r===void 0?void 0:r.redirectTo,f=(l=e.options)===null||l===void 0?void 0:l.captchaToken);const{data:g,error:w}=await Vn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:f}}),redirectTo:u,xform:Kl});if(w)throw w;if(!g)throw new Error("An error occurred on token verification.");const s=g.session,S=g.user;return s?.access_token&&(await this._saveSession(s),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",s)),this._returnResult({data:{user:S,session:s},error:null})}catch(u){if(En(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithSSO(e){var r,l,u,f,g;try{let w=null,s=null;this.flowType==="pkce"&&([w,s]=await um(this.storage,this.storageKey));const S=await Vn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(l=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&l!==void 0?l:void 0}),!((u=e?.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:w,code_challenge_method:s}),headers:this.headers,xform:QV});return!((f=S.data)===null||f===void 0)&&f.url&&to()&&!(!((g=e.options)===null||g===void 0)&&g.skipBrowserRedirect)&&window.location.assign(S.data.url),this._returnResult(S)}catch(w){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(w))return this._returnResult({data:null,error:w});throw w}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:l}=e;if(l)throw l;if(!r)throw new Ia;const{error:u}=await Vn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:u})})}catch(e){if(En(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:l,type:u,options:f}=e,{error:g}=await Vn(this.fetch,"POST",r,{headers:this.headers,body:{email:l,type:u,gotrue_meta_security:{captcha_token:f?.captchaToken}},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}else if("phone"in e){const{phone:l,type:u,options:f}=e,{data:g,error:w}=await Vn(this.fetch,"POST",r,{headers:this.headers,body:{phone:l,type:u,gotrue_meta_security:{captcha_token:f?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:g?.message_id},error:w})}throw new lv("You must provide either an email or phone number and a type")}catch(r){if(En(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await l,await r()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=r();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await If(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const l=e.expires_at?e.expires_at*1e3-Date.now()<cw:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",e.expires_at),!l){if(this.userStorage){const g=await If(this.userStorage,this.storageKey+"-user");g?.user?e.user=g.user:e.user=hw()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const g={value:this.suppressGetSessionWarning};e.user=KV(e.user,g),g.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:u,error:f}=await this._callRefreshToken(e.refresh_token);return f?this._returnResult({data:{session:null},error:f}):this._returnResult({data:{session:u},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await Vn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:rh}):await this._useSession(async r=>{var l,u,f;const{data:g,error:w}=r;if(w)throw w;return!(!((l=g.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ia}:await Vn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(f=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&f!==void 0?f:void 0,xform:rh})})}catch(r){if(En(r))return CV(r)&&(await this._removeSession(),await eo(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async l=>{const{data:u,error:f}=l;if(f)throw f;if(!u.session)throw new Ia;const g=u.session;let w=null,s=null;this.flowType==="pkce"&&e.email!=null&&([w,s]=await um(this.storage,this.storageKey));const{data:S,error:A}=await Vn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:w,code_challenge_method:s}),jwt:g.access_token,xform:rh});if(A)throw A;return g.user=S.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),this._returnResult({data:{user:g.user},error:null})})}catch(l){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ia;const r=Date.now()/1e3;let l=r,u=!0,f=null;const{payload:g}=dw(e.access_token);if(g.exp&&(l=g.exp,u=l<=r),u){const{data:w,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!w)return{data:{user:null,session:null},error:null};f=w}else{const{data:w,error:s}=await this._getUser(e.access_token);if(s)throw s;f={access_token:e.access_token,refresh_token:e.refresh_token,user:w.user,token_type:"bearer",expires_in:l-r,expires_at:l},await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)}return this._returnResult({data:{user:f.user,session:f},error:null})}catch(r){if(En(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var l;if(!e){const{data:g,error:w}=r;if(w)throw w;e=(l=g.session)!==null&&l!==void 0?l:void 0}if(!e?.refresh_token)throw new Ia;const{data:u,error:f}=await this._callRefreshToken(e.refresh_token);return f?this._returnResult({data:{user:null,session:null},error:f}):u?this._returnResult({data:{user:u.user,session:u},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(En(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!to())throw new cv("No browser detected.");if(e.error||e.error_description||e.error_code)throw new cv(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new FC("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new cv("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new FC("No code detected.");const{data:J,error:Y}=await this._exchangeCodeForSession(e.code);if(Y)throw Y;const ie=new URL(window.location.href);return ie.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ie.toString()),{data:{session:J.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:u,access_token:f,refresh_token:g,expires_in:w,expires_at:s,token_type:S}=e;if(!f||!w||!g||!S)throw new cv("No session defined in URL");const A=Math.round(Date.now()/1e3),j=parseInt(w);let O=A+j;s&&(O=parseInt(s));const L=O-A;L*1e3<=vm&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${L}s, should have been closer to ${j}s`);const W=O-j;A-W>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",W,O,A):A-W<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",W,O,A);const{data:U,error:q}=await this._getUser(f);if(q)throw q;const Q={provider_token:l,provider_refresh_token:u,access_token:f,expires_in:j,expires_at:O,refresh_token:g,token_type:S,user:U.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:Q,redirectType:e.type},error:null})}catch(l){if(En(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await If(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var l;const{data:u,error:f}=r;if(f)return this._returnResult({error:f});const g=(l=u.session)===null||l===void 0?void 0:l.access_token;if(g){const{error:w}=await this.admin.signOut(g,e);if(w&&!(EV(w)&&(w.status===404||w.status===401||w.status===403)))return this._returnResult({error:w})}return e!=="others"&&(await this._removeSession(),await eo(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=DV(),l={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,l),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:l}}}async _emitInitialSession(e){return await this._useSession(async r=>{var l,u;try{const{data:{session:f},error:g}=r;if(g)throw g;await((l=this.stateChangeEmitters.get(e))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",f)),this._debug("INITIAL_SESSION","callback id",e,"session",f)}catch(f){await((u=this.stateChangeEmitters.get(e))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",f),console.error(f)}})}async resetPasswordForEmail(e,r={}){let l=null,u=null;this.flowType==="pkce"&&([l,u]=await um(this.storage,this.storageKey,!0));try{return await Vn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:l,code_challenge_method:u,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(f){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(f))return this._returnResult({data:null,error:f});throw f}}async getUserIdentities(){var e;try{const{data:r,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:l,error:u}=await this._useSession(async f=>{var g,w,s,S,A;const{data:j,error:O}=f;if(O)throw O;const L=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(g=e.options)===null||g===void 0?void 0:g.redirectTo,scopes:(w=e.options)===null||w===void 0?void 0:w.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:!0});return await Vn(this.fetch,"GET",L,{headers:this.headers,jwt:(A=(S=j.session)===null||S===void 0?void 0:S.access_token)!==null&&A!==void 0?A:void 0})});if(u)throw u;return to()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(l?.url),this._returnResult({data:{provider:e.provider,url:l?.url},error:null})}catch(l){if(En(l))return this._returnResult({data:{provider:e.provider,url:null},error:l});throw l}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var l;try{const{error:u,data:{session:f}}=r;if(u)throw u;const{options:g,provider:w,token:s,access_token:S,nonce:A}=e,j=await Vn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=f?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:w,id_token:s,access_token:S,nonce:A,link_identity:!0,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:Kl}),{data:O,error:L}=j;return L?this._returnResult({data:{user:null,session:null},error:L}):!O||!O.session||!O.user?this._returnResult({data:{user:null,session:null},error:new cm}):(O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("USER_UPDATED",O.session)),this._returnResult({data:O,error:L}))}catch(u){if(await eo(this.storage,`${this.storageKey}-code-verifier`),En(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var l,u;const{data:f,error:g}=r;if(g)throw g;return await Vn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(u=(l=f.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const l=Date.now();return await BV(async u=>(u>0&&await zV(200*Math.pow(2,u-1)),this._debug(r,"refreshing attempt",u),await Vn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Kl})),(u,f)=>{const g=200*Math.pow(2,u);return f&&uw(f)&&Date.now()+g-l<vm})}catch(l){if(this._debug(r,"error",l),En(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const l=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",l),to()&&!r.skipBrowserRedirect&&window.location.assign(l),{data:{provider:e,url:l},error:null}}async _recoverAndRefresh(){var e,r;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const u=await If(this.storage,this.storageKey);if(u&&this.userStorage){let g=await If(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!g&&(g={user:u.user},await xm(this.userStorage,this.storageKey+"-user",g)),u.user=(e=g?.user)!==null&&e!==void 0?e:hw()}else if(u&&!u.user&&!u.user){const g=await If(this.storage,this.storageKey+"-user");g&&g?.user?(u.user=g.user,await eo(this.storage,this.storageKey+"-user"),await xm(this.storage,this.storageKey,u)):u.user=hw()}if(this._debug(l,"session from storage",u),!this._isValidSession(u)){this._debug(l,"session is not valid"),u!==null&&await this._removeSession();return}const f=((r=u.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<cw;if(this._debug(l,`session has${f?"":" not"} expired with margin of ${cw}s`),f){if(this.autoRefreshToken&&u.refresh_token){const{error:g}=await this._callRefreshToken(u.refresh_token);g&&(console.error(g),uw(g)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",g),await this._removeSession()))}}else if(u.user&&u.user.__isUserNotAvailableProxy===!0)try{const{data:g,error:w}=await this._getUser(u.access_token);!w&&g?.user?(u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(g){console.error("Error getting user data:",g),this._debug(l,"error getting user data, skipping SIGNED_IN notification",g)}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(l,"error",u),console.error(u);return}finally{this._debug(l,"end")}}async _callRefreshToken(e){var r,l;if(!e)throw new Ia;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new A0;const{data:f,error:g}=await this._refreshAccessToken(e);if(g)throw g;if(!f.session)throw new Ia;await this._saveSession(f.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",f.session);const w={data:f.session,error:null};return this.refreshingDeferred.resolve(w),w}catch(f){if(this._debug(u,"error",f),En(f)){const g={data:null,error:f};return uw(f)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(g),g}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(f),f}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(e,r,l=!0){const u=`#_notifyAllSubscribers(${e})`;this._debug(u,"begin",r,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:e,session:r});const f=[],g=Array.from(this.stateChangeEmitters.values()).map(async w=>{try{await w.callback(e,r)}catch(s){f.push(s)}});if(await Promise.all(g),f.length>0){for(let w=0;w<f.length;w+=1)console.error(f[w]);throw f[0]}}finally{this._debug(u,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await eo(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),l=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&r.user&&await xm(this.userStorage,this.storageKey+"-user",{user:r.user});const u=Object.assign({},r);delete u.user;const f=HC(u);await xm(this.storage,this.storageKey,f)}else{const u=HC(r);await xm(this.storage,this.storageKey,u)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await eo(this.storage,this.storageKey),await eo(this.storage,this.storageKey+"-code-verifier"),await eo(this.storage,this.storageKey+"-user"),this.userStorage&&await eo(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&to()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),vm);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:l}}=r;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((l.expires_at*1e3-e)/vm);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${vm}ms, refresh threshold is ${yb} ticks`),u<=yb&&await this._callRefreshToken(l.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof _I)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!to()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,l){const u=[`provider=${encodeURIComponent(r)}`];if(l?.redirectTo&&u.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&u.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[f,g]=await um(this.storage,this.storageKey),w=new URLSearchParams({code_challenge:`${encodeURIComponent(f)}`,code_challenge_method:`${encodeURIComponent(g)}`});u.push(w.toString())}if(l?.queryParams){const f=new URLSearchParams(l.queryParams);u.push(f.toString())}return l?.skipBrowserRedirect&&u.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${e}?${u.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var l;const{data:u,error:f}=r;return f?this._returnResult({data:null,error:f}):await Vn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token})})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var l,u;const{data:f,error:g}=r;if(g)return this._returnResult({data:null,error:g});const w=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:s,error:S}=await Vn(this.fetch,"POST",`${this.url}/factors`,{body:w,headers:this.headers,jwt:(l=f?.session)===null||l===void 0?void 0:l.access_token});return S?this._returnResult({data:null,error:S}):(e.factorType==="totp"&&s.type==="totp"&&(!((u=s?.totp)===null||u===void 0)&&u.qr_code)&&(s.totp.qr_code=`data:image/svg+xml;utf-8,${s.totp.qr_code}`),this._returnResult({data:s,error:null}))})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var l;const{data:u,error:f}=r;if(f)return this._returnResult({data:null,error:f});const g=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?mU(e.webauthn.credential_response):gU(e.webauthn.credential_response)})}:{code:e.code}),{data:w,error:s}=await Vn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:g,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});return s?this._returnResult({data:null,error:s}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+w.expires_in},w)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",w),this._returnResult({data:w,error:s}))})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var l;const{data:u,error:f}=r;if(f)return this._returnResult({data:null,error:f});const g=await Vn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});if(g.error)return g;const{data:w}=g;if(w.type!=="webauthn")return{data:w,error:null};switch(w.webauthn.type){case"create":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:fU(w.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:pU(w.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:l}=await this._challenge({factorId:e.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:l}=await this.getUser();if(l)return{data:null,error:l};const u={all:[],phone:[],totp:[],webauthn:[]};for(const f of(e=r?.factors)!==null&&e!==void 0?e:[])u.all.push(f),f.status==="verified"&&u[f.factor_type].push(f);return{data:u,error:null}}async _getAuthenticatorAssuranceLevel(){var e,r;const{data:{session:l},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=dw(l.access_token);let g=null;f.aal&&(g=f.aal);let w=g;((r=(e=l.user.factors)===null||e===void 0?void 0:e.filter(A=>A.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(w="aal2");const S=f.amr||[];return{data:{currentLevel:g,nextLevel:w,currentAuthenticationMethods:S},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:l},error:u}=r;return u?this._returnResult({data:null,error:u}):l?await Vn(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:l.access_token,xform:f=>({data:f,error:null})}):this._returnResult({data:null,error:new Ia})})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async l=>{const{data:{session:u},error:f}=l;if(f)return this._returnResult({data:null,error:f});if(!u)return this._returnResult({data:null,error:new Ia});const g=await Vn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"approve"},xform:w=>({data:w,error:null})});return g.data&&g.data.redirect_url&&to()&&!r?.skipBrowserRedirect&&window.location.assign(g.data.redirect_url),g})}catch(l){if(En(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(e,r){try{return await this._useSession(async l=>{const{data:{session:u},error:f}=l;if(f)return this._returnResult({data:null,error:f});if(!u)return this._returnResult({data:null,error:new Ia});const g=await Vn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"deny"},xform:w=>({data:w,error:null})});return g.data&&g.data.redirect_url&&to()&&!r?.skipBrowserRedirect&&window.location.assign(g.data.redirect_url),g})}catch(l){if(En(l))return this._returnResult({data:null,error:l});throw l}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:l}=e;return l?this._returnResult({data:null,error:l}):r?await Vn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Ia})})}catch(e){if(En(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:l},error:u}=r;return u?this._returnResult({data:null,error:u}):l?(await Vn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ia})})}catch(r){if(En(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let l=r.keys.find(w=>w.kid===e);if(l)return l;const u=Date.now();if(l=this.jwks.keys.find(w=>w.kid===e),l&&this.jwks_cached_at+TV>u)return l;const{data:f,error:g}=await Vn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(g)throw g;return!f.keys||f.keys.length===0||(this.jwks=f,this.jwks_cached_at=u,l=f.keys.find(w=>w.kid===e),!l)?null:l}async getClaims(e,r={}){try{let l=e;if(!l){const{data:L,error:W}=await this.getSession();if(W||!L.session)return this._returnResult({data:null,error:W});l=L.session.access_token}const{header:u,payload:f,signature:g,raw:{header:w,payload:s}}=dw(l);r?.allowExpired||qV(f.exp);const S=!u.alg||u.alg.startsWith("HS")||!u.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(u.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!S){const{error:L}=await this.getUser(l);if(L)throw L;return{data:{claims:f,header:u,signature:g},error:null}}const A=WV(u.alg),j=await crypto.subtle.importKey("jwk",S,A,!0,["verify"]);if(!await crypto.subtle.verify(A,j,g,NV(`${w}.${s}`)))throw new xb("Invalid JWT signature");return{data:{claims:f,header:u,signature:g},error:null}}catch(l){if(En(l))return this._returnResult({data:null,error:l});throw l}}}Oy.nextInstanceID={};const EU=Oy,CU="2.91.1";let sy="";typeof Deno<"u"?sy="deno":typeof document<"u"?sy="web":typeof navigator<"u"&&navigator.product==="ReactNative"?sy="react-native":sy="node";const kU={"X-Client-Info":`supabase-js-${sy}/${CU}`},AU={headers:kU},PU={schema:"public"},MU={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},IU={};function zy(t){"@babel/helpers - typeof";return zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zy(t)}function RU(t,e){if(zy(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var l=r.call(t,e);if(zy(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function NU(t){var e=RU(t,"string");return zy(e)=="symbol"?e:e+""}function jU(t,e,r){return(e=NU(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function JC(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,l)}return r}function Vi(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?JC(Object(r),!0).forEach(function(l){jU(t,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):JC(Object(r)).forEach(function(l){Object.defineProperty(t,l,Object.getOwnPropertyDescriptor(r,l))})}return t}const DU=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),LU=()=>Headers,OU=(t,e,r)=>{const l=DU(r),u=LU();return async(f,g)=>{var w;const s=(w=await e())!==null&&w!==void 0?w:t;let S=new u(g?.headers);return S.has("apikey")||S.set("apikey",t),S.has("Authorization")||S.set("Authorization",`Bearer ${s}`),l(f,Vi(Vi({},g),{},{headers:S}))}};function zU(t){return t.endsWith("/")?t:t+"/"}function BU(t,e){var r,l;const{db:u,auth:f,realtime:g,global:w}=t,{db:s,auth:S,realtime:A,global:j}=e,O={db:Vi(Vi({},s),u),auth:Vi(Vi({},S),f),realtime:Vi(Vi({},A),g),storage:{},global:Vi(Vi(Vi({},j),w),{},{headers:Vi(Vi({},(r=j?.headers)!==null&&r!==void 0?r:{}),(l=w?.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return t.accessToken?O.accessToken=t.accessToken:delete O.accessToken,O}function FU(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(zU(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var VU=class extends EU{constructor(t){super(t)}},UU=class{constructor(t,e,r){var l,u;this.supabaseUrl=t,this.supabaseKey=e;const f=FU(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",f),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",f),this.storageUrl=new URL("storage/v1",f),this.functionsUrl=new URL("functions/v1",f);const g=`sb-${f.hostname.split(".")[0]}-auth-token`,w={db:PU,realtime:IU,auth:Vi(Vi({},MU),{},{storageKey:g}),global:AU},s=BU(r??{},w);if(this.storageKey=(l=s.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(u=s.global.headers)!==null&&u!==void 0?u:{},s.accessToken)this.accessToken=s.accessToken,this.auth=new Proxy({},{get:(A,j)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(j)} is not possible`)}});else{var S;this.auth=this._initSupabaseAuthClient((S=s.auth)!==null&&S!==void 0?S:{},this.headers,s.global.fetch)}this.fetch=OU(e,this._getAccessToken.bind(this),s.global.fetch),this.realtime=this._initRealtimeClient(Vi({headers:this.headers,accessToken:this._getAccessToken.bind(this)},s.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(A=>this.realtime.setAuth(A)).catch(A=>console.warn("Failed to set initial Realtime auth token:",A)),this.rest=new w6(new URL("rest/v1",f).href,{headers:this.headers,schema:s.db.schema,fetch:this.fetch}),this.storage=new _V(this.storageUrl.href,this.headers,this.fetch,r?.storage),s.accessToken||this._listenForAuthEvents()}get functions(){return new g6(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:l}=await t.auth.getSession();return(e=(r=l.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:l,userStorage:u,storageKey:f,flowType:g,lock:w,debug:s,throwOnError:S},A,j){const O={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new VU({url:this.authUrl.href,headers:Vi(Vi({},O),A),storageKey:f,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:l,userStorage:u,flowType:g,lock:w,debug:s,throwOnError:S,fetch:j,hasCustomAuthorizationHeader:Object.keys(this.headers).some(L=>L.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new z6(this.realtimeUrl.href,Vi(Vi({},t),{},{params:Vi(Vi({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const $U=(t,e,r)=>new UU(t,e,r);function GU(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}GU()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const HU="https://hbpelkknboqiaefsdwcp.supabase.co",qU="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhicGVsa2tuYm9xaWFlZnNkd2NwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5ODExMjgsImV4cCI6MjA4NDU1NzEyOH0.An8CGV-ucwRhloWkqDUKxdLr_rhQDfOBj7XXq5nVhAU",Wt=$U(HU,qU),wI=I.createContext(void 0),WU=({children:t})=>{const[e,r]=I.useState(null),[l,u]=I.useState(null),[f,g]=I.useState(!0);I.useEffect(()=>{Wt.auth.getSession().then(({data:{session:j}})=>{r(j),u(j?.user??null),g(!1)});const{data:{subscription:A}}=Wt.auth.onAuthStateChange((j,O)=>{r(O),u(O?.user??null),g(!1)});return()=>A.unsubscribe()},[]);const w=async(A,j)=>{const{error:O}=await Wt.auth.signInWithPassword({email:A,password:j});return{error:O}},s=async(A,j)=>{const{error:O}=await Wt.auth.signUp({email:A,password:j});return{error:O}},S=async()=>{const{error:A}=await Wt.auth.signOut();A?Jt.error(A.message):Jt.success("ng xut thnh cng")};return v.jsx(wI.Provider,{value:{session:e,user:l,isLoading:f,signIn:w,signUp:s,signOut:S},children:t})},ha=()=>{const t=I.useContext(wI);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},G1=I.createContext({});function ip(t){const e=I.useRef(null);return e.current===null&&(e.current=t()),e.current}const bI=typeof window<"u",H1=bI?I.useLayoutEffect:I.useEffect,P0=I.createContext(null);function q1(t,e){t.indexOf(e)===-1&&t.push(e)}function W1(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}function ZU([...t],e,r){const l=e<0?t.length+e:e;if(l>=0&&l<t.length){const u=r<0?t.length+r:r,[f]=t.splice(e,1);t.splice(u,0,f)}return t}const iu=(t,e,r)=>r>e?e:r<t?t:r;let Z1=()=>{};const nd={},TI=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function SI(t){return typeof t=="object"&&t!==null}const EI=t=>/^0[^.\s]+$/u.test(t);function K1(t){let e;return()=>(e===void 0&&(e=t()),e)}const pl=t=>t,KU=(t,e)=>r=>e(t(r)),n_=(...t)=>t.reduce(KU),By=(t,e,r)=>{const l=e-t;return l===0?1:(r-t)/l};class X1{constructor(){this.subscriptions=[]}add(e){return q1(this.subscriptions,e),()=>W1(this.subscriptions,e)}notify(e,r,l){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](e,r,l);else for(let f=0;f<u;f++){const g=this.subscriptions[f];g&&g(e,r,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Qu=t=>t*1e3,hl=t=>t/1e3;function CI(t,e){return e?t*(1e3/e):0}const kI=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,XU=1e-7,YU=12;function JU(t,e,r,l,u){let f,g,w=0;do g=e+(r-e)/2,f=kI(g,l,u)-t,f>0?r=g:e=g;while(Math.abs(f)>XU&&++w<YU);return g}function r_(t,e,r,l){if(t===e&&r===l)return pl;const u=f=>JU(f,0,1,t,r);return f=>f===0||f===1?f:kI(u(f),e,l)}const AI=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,PI=t=>e=>1-t(1-e),MI=r_(.33,1.53,.69,.99),Y1=PI(MI),II=AI(Y1),RI=t=>(t*=2)<1?.5*Y1(t):.5*(2-Math.pow(2,-10*(t-1))),J1=t=>1-Math.sin(Math.acos(t)),NI=PI(J1),jI=AI(J1),QU=r_(.42,0,1,1),e8=r_(0,0,.58,1),DI=r_(.42,0,.58,1),t8=t=>Array.isArray(t)&&typeof t[0]!="number",LI=t=>Array.isArray(t)&&typeof t[0]=="number",n8={linear:pl,easeIn:QU,easeInOut:DI,easeOut:e8,circIn:J1,circInOut:jI,circOut:NI,backIn:Y1,backInOut:II,backOut:MI,anticipate:RI},r8=t=>typeof t=="string",QC=t=>{if(LI(t)){Z1(t.length===4);const[e,r,l,u]=t;return r_(e,r,l,u)}else if(r8(t))return n8[t];return t},uv=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function i8(t,e){let r=new Set,l=new Set,u=!1,f=!1;const g=new WeakSet;let w={delta:0,timestamp:0,isProcessing:!1};function s(A){g.has(A)&&(S.schedule(A),t()),A(w)}const S={schedule:(A,j=!1,O=!1)=>{const W=O&&u?r:l;return j&&g.add(A),W.has(A)||W.add(A),A},cancel:A=>{l.delete(A),g.delete(A)},process:A=>{if(w=A,u){f=!0;return}u=!0,[r,l]=[l,r],r.forEach(s),r.clear(),u=!1,f&&(f=!1,S.process(A))}};return S}const s8=40;function OI(t,e){let r=!1,l=!0;const u={delta:0,timestamp:0,isProcessing:!1},f=()=>r=!0,g=uv.reduce((Y,ie)=>(Y[ie]=i8(f),Y),{}),{setup:w,read:s,resolveKeyframes:S,preUpdate:A,update:j,preRender:O,render:L,postRender:W}=g,U=()=>{const Y=nd.useManualTiming?u.timestamp:performance.now();r=!1,nd.useManualTiming||(u.delta=l?1e3/60:Math.max(Math.min(Y-u.timestamp,s8),1)),u.timestamp=Y,u.isProcessing=!0,w.process(u),s.process(u),S.process(u),A.process(u),j.process(u),O.process(u),L.process(u),W.process(u),u.isProcessing=!1,r&&e&&(l=!1,t(U))},q=()=>{r=!0,l=!0,u.isProcessing||t(U)};return{schedule:uv.reduce((Y,ie)=>{const _e=g[ie];return Y[ie]=(Se,Ie=!1,Ue=!1)=>(r||q(),_e.schedule(Se,Ie,Ue)),Y},{}),cancel:Y=>{for(let ie=0;ie<uv.length;ie++)g[uv[ie]].cancel(Y)},state:u,steps:g}}const{schedule:ri,cancel:rd,state:no,steps:pw}=OI(typeof requestAnimationFrame<"u"?requestAnimationFrame:pl,!0);let Tv;function o8(){Tv=void 0}const $o={now:()=>(Tv===void 0&&$o.set(no.isProcessing||nd.useManualTiming?no.timestamp:performance.now()),Tv),set:t=>{Tv=t,queueMicrotask(o8)}},zI=t=>e=>typeof e=="string"&&e.startsWith(t),BI=zI("--"),a8=zI("var(--"),Q1=t=>a8(t)?l8.test(t.split("/*")[0].trim()):!1,l8=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function ek(t){return typeof t!="string"?!1:t.split("/*")[0].includes("var(--")}const eg={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Fy={...eg,transform:t=>iu(0,1,t)},dv={...eg,default:1},vy=t=>Math.round(t*1e5)/1e5,eT=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function c8(t){return t==null}const u8=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,tT=(t,e)=>r=>!!(typeof r=="string"&&u8.test(r)&&r.startsWith(t)||e&&!c8(r)&&Object.prototype.hasOwnProperty.call(r,e)),FI=(t,e,r)=>l=>{if(typeof l!="string")return l;const[u,f,g,w]=l.match(eT);return{[t]:parseFloat(u),[e]:parseFloat(f),[r]:parseFloat(g),alpha:w!==void 0?parseFloat(w):1}},d8=t=>iu(0,255,t),mw={...eg,transform:t=>Math.round(d8(t))},Ff={test:tT("rgb","red"),parse:FI("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:l=1})=>"rgba("+mw.transform(t)+", "+mw.transform(e)+", "+mw.transform(r)+", "+vy(Fy.transform(l))+")"};function h8(t){let e="",r="",l="",u="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),l=t.substring(5,7),u=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),l=t.substring(3,4),u=t.substring(4,5),e+=e,r+=r,l+=l,u+=u),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(l,16),alpha:u?parseInt(u,16)/255:1}}const wb={test:tT("#"),parse:h8,transform:Ff.transform},i_=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Qd=i_("deg"),tu=i_("%"),yn=i_("px"),f8=i_("vh"),p8=i_("vw"),tk={...tu,parse:t=>tu.parse(t)/100,transform:t=>tu.transform(t*100)},Cm={test:tT("hsl","hue"),parse:FI("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:l=1})=>"hsla("+Math.round(t)+", "+tu.transform(vy(e))+", "+tu.transform(vy(r))+", "+vy(Fy.transform(l))+")"},os={test:t=>Ff.test(t)||wb.test(t)||Cm.test(t),parse:t=>Ff.test(t)?Ff.parse(t):Cm.test(t)?Cm.parse(t):wb.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Ff.transform(t):Cm.transform(t),getAnimatableNone:t=>{const e=os.parse(t);return e.alpha=0,os.transform(e)}},m8=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function g8(t){return isNaN(t)&&typeof t=="string"&&(t.match(eT)?.length||0)+(t.match(m8)?.length||0)>0}const VI="number",UI="color",y8="var",_8="var(",nk="${}",v8=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Vy(t){const e=t.toString(),r=[],l={color:[],number:[],var:[]},u=[];let f=0;const w=e.replace(v8,s=>(os.test(s)?(l.color.push(f),u.push(UI),r.push(os.parse(s))):s.startsWith(_8)?(l.var.push(f),u.push(y8),r.push(s)):(l.number.push(f),u.push(VI),r.push(parseFloat(s))),++f,nk)).split(nk);return{values:r,split:w,indexes:l,types:u}}function $I(t){return Vy(t).values}function GI(t){const{split:e,types:r}=Vy(t),l=e.length;return u=>{let f="";for(let g=0;g<l;g++)if(f+=e[g],u[g]!==void 0){const w=r[g];w===VI?f+=vy(u[g]):w===UI?f+=os.transform(u[g]):f+=u[g]}return f}}const x8=t=>typeof t=="number"?0:os.test(t)?os.getAnimatableNone(t):t;function w8(t){const e=$I(t);return GI(t)(e.map(x8))}const gh={test:g8,parse:$I,createTransformer:GI,getAnimatableNone:w8};function gw(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function b8({hue:t,saturation:e,lightness:r,alpha:l}){t/=360,e/=100,r/=100;let u=0,f=0,g=0;if(!e)u=f=g=r;else{const w=r<.5?r*(1+e):r+e-r*e,s=2*r-w;u=gw(s,w,t+1/3),f=gw(s,w,t),g=gw(s,w,t-1/3)}return{red:Math.round(u*255),green:Math.round(f*255),blue:Math.round(g*255),alpha:l}}function Uv(t,e){return r=>r>0?e:t}const vi=(t,e,r)=>t+(e-t)*r,yw=(t,e,r)=>{const l=t*t,u=r*(e*e-l)+l;return u<0?0:Math.sqrt(u)},T8=[wb,Ff,Cm],S8=t=>T8.find(e=>e.test(t));function rk(t){const e=S8(t);if(!e)return!1;let r=e.parse(t);return e===Cm&&(r=b8(r)),r}const ik=(t,e)=>{const r=rk(t),l=rk(e);if(!r||!l)return Uv(t,e);const u={...r};return f=>(u.red=yw(r.red,l.red,f),u.green=yw(r.green,l.green,f),u.blue=yw(r.blue,l.blue,f),u.alpha=vi(r.alpha,l.alpha,f),Ff.transform(u))},bb=new Set(["none","hidden"]);function E8(t,e){return bb.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function C8(t,e){return r=>vi(t,e,r)}function nT(t){return typeof t=="number"?C8:typeof t=="string"?Q1(t)?Uv:os.test(t)?ik:P8:Array.isArray(t)?HI:typeof t=="object"?os.test(t)?ik:k8:Uv}function HI(t,e){const r=[...t],l=r.length,u=t.map((f,g)=>nT(f)(f,e[g]));return f=>{for(let g=0;g<l;g++)r[g]=u[g](f);return r}}function k8(t,e){const r={...t,...e},l={};for(const u in r)t[u]!==void 0&&e[u]!==void 0&&(l[u]=nT(t[u])(t[u],e[u]));return u=>{for(const f in l)r[f]=l[f](u);return r}}function A8(t,e){const r=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],g=t.indexes[f][l[f]],w=t.values[g]??0;r[u]=w,l[f]++}return r}const P8=(t,e)=>{const r=gh.createTransformer(e),l=Vy(t),u=Vy(e);return l.indexes.var.length===u.indexes.var.length&&l.indexes.color.length===u.indexes.color.length&&l.indexes.number.length>=u.indexes.number.length?bb.has(t)&&!u.values.length||bb.has(e)&&!l.values.length?E8(t,e):n_(HI(A8(l,u),u.values),r):Uv(t,e)};function qI(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?vi(t,e,r):nT(t)(t,e)}const M8=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>ri.update(e,r),stop:()=>rd(e),now:()=>no.isProcessing?no.timestamp:$o.now()}},WI=(t,e,r=10)=>{let l="";const u=Math.max(Math.round(e/r),2);for(let f=0;f<u;f++)l+=Math.round(t(f/(u-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},$v=2e4;function rT(t){let e=0;const r=50;let l=t.next(e);for(;!l.done&&e<$v;)e+=r,l=t.next(e);return e>=$v?1/0:e}function I8(t,e=100,r){const l=r({...t,keyframes:[0,e]}),u=Math.min(rT(l),$v);return{type:"keyframes",ease:f=>l.next(u*f).value/e,duration:hl(u)}}const R8=5;function ZI(t,e,r){const l=Math.max(e-R8,0);return CI(r-t(l),e-l)}const Ui={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},_w=.001;function N8({duration:t=Ui.duration,bounce:e=Ui.bounce,velocity:r=Ui.velocity,mass:l=Ui.mass}){let u,f,g=1-e;g=iu(Ui.minDamping,Ui.maxDamping,g),t=iu(Ui.minDuration,Ui.maxDuration,hl(t)),g<1?(u=S=>{const A=S*g,j=A*t,O=A-r,L=Tb(S,g),W=Math.exp(-j);return _w-O/L*W},f=S=>{const j=S*g*t,O=j*r+r,L=Math.pow(g,2)*Math.pow(S,2)*t,W=Math.exp(-j),U=Tb(Math.pow(S,2),g);return(-u(S)+_w>0?-1:1)*((O-L)*W)/U}):(u=S=>{const A=Math.exp(-S*t),j=(S-r)*t+1;return-_w+A*j},f=S=>{const A=Math.exp(-S*t),j=(r-S)*(t*t);return A*j});const w=5/t,s=D8(u,f,w);if(t=Qu(t),isNaN(s))return{stiffness:Ui.stiffness,damping:Ui.damping,duration:t};{const S=Math.pow(s,2)*l;return{stiffness:S,damping:g*2*Math.sqrt(l*S),duration:t}}}const j8=12;function D8(t,e,r){let l=r;for(let u=1;u<j8;u++)l=l-t(l)/e(l);return l}function Tb(t,e){return t*Math.sqrt(1-e*e)}const L8=["duration","bounce"],O8=["stiffness","damping","mass"];function sk(t,e){return e.some(r=>t[r]!==void 0)}function z8(t){let e={velocity:Ui.velocity,stiffness:Ui.stiffness,damping:Ui.damping,mass:Ui.mass,isResolvedFromDuration:!1,...t};if(!sk(t,O8)&&sk(t,L8))if(t.visualDuration){const r=t.visualDuration,l=2*Math.PI/(r*1.2),u=l*l,f=2*iu(.05,1,1-(t.bounce||0))*Math.sqrt(u);e={...e,mass:Ui.mass,stiffness:u,damping:f}}else{const r=N8(t);e={...e,...r,mass:Ui.mass},e.isResolvedFromDuration=!0}return e}function Gv(t=Ui.visualDuration,e=Ui.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:l,restDelta:u}=r;const f=r.keyframes[0],g=r.keyframes[r.keyframes.length-1],w={done:!1,value:f},{stiffness:s,damping:S,mass:A,duration:j,velocity:O,isResolvedFromDuration:L}=z8({...r,velocity:-hl(r.velocity||0)}),W=O||0,U=S/(2*Math.sqrt(s*A)),q=g-f,Q=hl(Math.sqrt(s/A)),J=Math.abs(q)<5;l||(l=J?Ui.restSpeed.granular:Ui.restSpeed.default),u||(u=J?Ui.restDelta.granular:Ui.restDelta.default);let Y;if(U<1){const _e=Tb(Q,U);Y=Se=>{const Ie=Math.exp(-U*Q*Se);return g-Ie*((W+U*Q*q)/_e*Math.sin(_e*Se)+q*Math.cos(_e*Se))}}else if(U===1)Y=_e=>g-Math.exp(-Q*_e)*(q+(W+Q*q)*_e);else{const _e=Q*Math.sqrt(U*U-1);Y=Se=>{const Ie=Math.exp(-U*Q*Se),Ue=Math.min(_e*Se,300);return g-Ie*((W+U*Q*q)*Math.sinh(Ue)+_e*q*Math.cosh(Ue))/_e}}const ie={calculatedDuration:L&&j||null,next:_e=>{const Se=Y(_e);if(L)w.done=_e>=j;else{let Ie=_e===0?W:0;U<1&&(Ie=_e===0?Qu(W):ZI(Y,_e,Se));const Ue=Math.abs(Ie)<=l,Je=Math.abs(g-Se)<=u;w.done=Ue&&Je}return w.value=w.done?g:Se,w},toString:()=>{const _e=Math.min(rT(ie),$v),Se=WI(Ie=>ie.next(_e*Ie).value,_e,30);return _e+"ms "+Se},toTransition:()=>{}};return ie}Gv.applyToOptions=t=>{const e=I8(t,100,Gv);return t.ease=e.ease,t.duration=Qu(e.duration),t.type="keyframes",t};function Sb({keyframes:t,velocity:e=0,power:r=.8,timeConstant:l=325,bounceDamping:u=10,bounceStiffness:f=500,modifyTarget:g,min:w,max:s,restDelta:S=.5,restSpeed:A}){const j=t[0],O={done:!1,value:j},L=Ue=>w!==void 0&&Ue<w||s!==void 0&&Ue>s,W=Ue=>w===void 0?s:s===void 0||Math.abs(w-Ue)<Math.abs(s-Ue)?w:s;let U=r*e;const q=j+U,Q=g===void 0?q:g(q);Q!==q&&(U=Q-j);const J=Ue=>-U*Math.exp(-Ue/l),Y=Ue=>Q+J(Ue),ie=Ue=>{const Je=J(Ue),Me=Y(Ue);O.done=Math.abs(Je)<=S,O.value=O.done?Q:Me};let _e,Se;const Ie=Ue=>{L(O.value)&&(_e=Ue,Se=Gv({keyframes:[O.value,W(O.value)],velocity:ZI(Y,Ue,O.value),damping:u,stiffness:f,restDelta:S,restSpeed:A}))};return Ie(0),{calculatedDuration:null,next:Ue=>{let Je=!1;return!Se&&_e===void 0&&(Je=!0,ie(Ue),Ie(Ue)),_e!==void 0&&Ue>=_e?Se.next(Ue-_e):(!Je&&ie(Ue),O)}}}function B8(t,e,r){const l=[],u=r||nd.mix||qI,f=t.length-1;for(let g=0;g<f;g++){let w=u(t[g],t[g+1]);if(e){const s=Array.isArray(e)?e[g]||pl:e;w=n_(s,w)}l.push(w)}return l}function KI(t,e,{clamp:r=!0,ease:l,mixer:u}={}){const f=t.length;if(Z1(f===e.length),f===1)return()=>e[0];if(f===2&&e[0]===e[1])return()=>e[1];const g=t[0]===t[1];t[0]>t[f-1]&&(t=[...t].reverse(),e=[...e].reverse());const w=B8(e,l,u),s=w.length,S=A=>{if(g&&A<t[0])return e[0];let j=0;if(s>1)for(;j<t.length-2&&!(A<t[j+1]);j++);const O=By(t[j],t[j+1],A);return w[j](O)};return r?A=>S(iu(t[0],t[f-1],A)):S}function F8(t,e){const r=t[t.length-1];for(let l=1;l<=e;l++){const u=By(0,e,l);t.push(vi(r,1,u))}}function V8(t){const e=[0];return F8(e,t.length-1),e}function U8(t,e){return t.map(r=>r*e)}function $8(t,e){return t.map(()=>e||DI).splice(0,t.length-1)}function xy({duration:t=300,keyframes:e,times:r,ease:l="easeInOut"}){const u=t8(l)?l.map(QC):QC(l),f={done:!1,value:e[0]},g=U8(r&&r.length===e.length?r:V8(e),t),w=KI(g,e,{ease:Array.isArray(u)?u:$8(e,u)});return{calculatedDuration:t,next:s=>(f.value=w(s),f.done=s>=t,f)}}const G8=t=>t!==null;function iT(t,{repeat:e,repeatType:r="loop"},l,u=1){const f=t.filter(G8),w=u<0||e&&r!=="loop"&&e%2===1?0:f.length-1;return!w||l===void 0?f[w]:l}const H8={decay:Sb,inertia:Sb,tween:xy,keyframes:xy,spring:Gv};function XI(t){typeof t.type=="string"&&(t.type=H8[t.type])}class sT{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const q8=t=>t/100;class oT extends sT{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:r}=this.options;r&&r.updatedAt!==$o.now()&&this.tick($o.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;XI(e);const{type:r=xy,repeat:l=0,repeatDelay:u=0,repeatType:f,velocity:g=0}=e;let{keyframes:w}=e;const s=r||xy;s!==xy&&typeof w[0]!="number"&&(this.mixKeyframes=n_(q8,qI(w[0],w[1])),w=[0,100]);const S=s({...e,keyframes:w});f==="mirror"&&(this.mirroredGenerator=s({...e,keyframes:[...w].reverse(),velocity:-g})),S.calculatedDuration===null&&(S.calculatedDuration=rT(S));const{calculatedDuration:A}=S;this.calculatedDuration=A,this.resolvedDuration=A+u,this.totalDuration=this.resolvedDuration*(l+1)-u,this.generator=S}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:l,totalDuration:u,mixKeyframes:f,mirroredGenerator:g,resolvedDuration:w,calculatedDuration:s}=this;if(this.startTime===null)return l.next(0);const{delay:S=0,keyframes:A,repeat:j,repeatType:O,repeatDelay:L,type:W,onUpdate:U,finalKeyframe:q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-u/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const Q=this.currentTime-S*(this.playbackSpeed>=0?1:-1),J=this.playbackSpeed>=0?Q<0:Q>u;this.currentTime=Math.max(Q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let Y=this.currentTime,ie=l;if(j){const Ue=Math.min(this.currentTime,u)/w;let Je=Math.floor(Ue),Me=Ue%1;!Me&&Ue>=1&&(Me=1),Me===1&&Je--,Je=Math.min(Je,j+1),Je%2&&(O==="reverse"?(Me=1-Me,L&&(Me-=L/w)):O==="mirror"&&(ie=g)),Y=iu(0,1,Me)*w}const _e=J?{done:!1,value:A[0]}:ie.next(Y);f&&(_e.value=f(_e.value));let{done:Se}=_e;!J&&s!==null&&(Se=this.playbackSpeed>=0?this.currentTime>=u:this.currentTime<=0);const Ie=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Se);return Ie&&W!==Sb&&(_e.value=iT(A,this.options,q,this.speed)),U&&U(_e.value),Ie&&this.finish(),_e}then(e,r){return this.finished.then(e,r)}get duration(){return hl(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+hl(e)}get time(){return hl(this.currentTime)}set time(e){e=Qu(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime($o.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=hl(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=M8,startTime:r}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),this.options.onPlay?.();const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=r??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime($o.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function W8(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Vf=t=>t*180/Math.PI,Eb=t=>{const e=Vf(Math.atan2(t[1],t[0]));return Cb(e)},Z8={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Eb,rotateZ:Eb,skewX:t=>Vf(Math.atan(t[1])),skewY:t=>Vf(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Cb=t=>(t=t%360,t<0&&(t+=360),t),ok=Eb,ak=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),lk=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),K8={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ak,scaleY:lk,scale:t=>(ak(t)+lk(t))/2,rotateX:t=>Cb(Vf(Math.atan2(t[6],t[5]))),rotateY:t=>Cb(Vf(Math.atan2(-t[2],t[0]))),rotateZ:ok,rotate:ok,skewX:t=>Vf(Math.atan(t[4])),skewY:t=>Vf(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function kb(t){return t.includes("scale")?1:0}function Ab(t,e){if(!t||t==="none")return kb(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,u;if(r)l=K8,u=r;else{const w=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=Z8,u=w}if(!u)return kb(e);const f=l[e],g=u[1].split(",").map(Y8);return typeof f=="function"?f(g):g[f]}const X8=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Ab(r,e)};function Y8(t){return parseFloat(t.trim())}const tg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ng=new Set(tg),ck=t=>t===eg||t===yn,J8=new Set(["x","y","z"]),Q8=tg.filter(t=>!J8.has(t));function e$(t){const e=[];return Q8.forEach(r=>{const l=t.getValue(r);l!==void 0&&(e.push([r,l.get()]),l.set(r.startsWith("scale")?1:0))}),e}const oh={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Ab(e,"x"),y:(t,{transform:e})=>Ab(e,"y")};oh.translateX=oh.x;oh.translateY=oh.y;const Gf=new Set;let Pb=!1,Mb=!1,Ib=!1;function YI(){if(Mb){const t=Array.from(Gf).filter(l=>l.needsMeasurement),e=new Set(t.map(l=>l.element)),r=new Map;e.forEach(l=>{const u=e$(l);u.length&&(r.set(l,u),l.render())}),t.forEach(l=>l.measureInitialState()),e.forEach(l=>{l.render();const u=r.get(l);u&&u.forEach(([f,g])=>{l.getValue(f)?.set(g)})}),t.forEach(l=>l.measureEndState()),t.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}Mb=!1,Pb=!1,Gf.forEach(t=>t.complete(Ib)),Gf.clear()}function JI(){Gf.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Mb=!0)})}function t$(){Ib=!0,JI(),YI(),Ib=!1}class aT{constructor(e,r,l,u,f,g=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=l,this.motionValue=u,this.element=f,this.isAsync=g}scheduleResolve(){this.state="scheduled",this.isAsync?(Gf.add(this),Pb||(Pb=!0,ri.read(JI),ri.resolveKeyframes(YI))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:l,motionValue:u}=this;if(e[0]===null){const f=u?.get(),g=e[e.length-1];if(f!==void 0)e[0]=f;else if(l&&r){const w=l.readValue(r,g);w!=null&&(e[0]=w)}e[0]===void 0&&(e[0]=g),u&&f===void 0&&u.set(e[0])}W8(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Gf.delete(this)}cancel(){this.state==="scheduled"&&(Gf.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const n$=t=>t.startsWith("--");function r$(t,e,r){n$(e)?t.style.setProperty(e,r):t.style[e]=r}const i$=K1(()=>window.ScrollTimeline!==void 0),s$={};function o$(t,e){const r=K1(t);return()=>s$[e]??r()}const QI=o$(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),oy=([t,e,r,l])=>`cubic-bezier(${t}, ${e}, ${r}, ${l})`,uk={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:oy([0,.65,.55,1]),circOut:oy([.55,0,1,.45]),backIn:oy([.31,.01,.66,-.59]),backOut:oy([.33,1.53,.69,.99])};function eR(t,e){if(t)return typeof t=="function"?QI()?WI(t,e):"ease-out":LI(t)?oy(t):Array.isArray(t)?t.map(r=>eR(r,e)||uk.easeOut):uk[t]}function a$(t,e,r,{delay:l=0,duration:u=300,repeat:f=0,repeatType:g="loop",ease:w="easeOut",times:s}={},S=void 0){const A={[e]:r};s&&(A.offset=s);const j=eR(w,u);Array.isArray(j)&&(A.easing=j);const O={delay:l,duration:u,easing:Array.isArray(j)?"linear":j,fill:"both",iterations:f+1,direction:g==="reverse"?"alternate":"normal"};return S&&(O.pseudoElement=S),t.animate(A,O)}function tR(t){return typeof t=="function"&&"applyToOptions"in t}function l$({type:t,...e}){return tR(t)&&QI()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class c$ extends sT{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:r,name:l,keyframes:u,pseudoElement:f,allowFlatten:g=!1,finalKeyframe:w,onComplete:s}=e;this.isPseudoElement=!!f,this.allowFlatten=g,this.options=e,Z1(typeof e.type!="string");const S=l$(e);this.animation=a$(r,l,u,S,f),S.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!f){const A=iT(u,this.options,w,this.speed);this.updateMotionValue?this.updateMotionValue(A):r$(r,l,A),this.animation.cancel()}s?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return hl(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+hl(e)}get time(){return hl(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Qu(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&i$()?(this.animation.timeline=e,pl):r(this)}}const nR={anticipate:RI,backInOut:II,circInOut:jI};function u$(t){return t in nR}function d$(t){typeof t.ease=="string"&&u$(t.ease)&&(t.ease=nR[t.ease])}const vw=10;class h$ extends c${constructor(e){d$(e),XI(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:l,onComplete:u,element:f,...g}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const w=new oT({...g,autoplay:!1}),s=Math.max(vw,$o.now()-this.startTime),S=iu(0,vw,s-vw);r.setWithVelocity(w.sample(Math.max(0,s-S)).value,w.sample(s).value,S),w.stop()}}const dk=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(gh.test(t)||t==="0")&&!t.startsWith("url("));function f$(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function p$(t,e,r,l){const u=t[0];if(u===null)return!1;if(e==="display"||e==="visibility")return!0;const f=t[t.length-1],g=dk(u,e),w=dk(f,e);return!g||!w?!1:f$(t)||(r==="spring"||tR(r))&&l}function Rb(t){t.duration=0,t.type="keyframes"}const m$=new Set(["opacity","clipPath","filter","transform"]),g$=K1(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function y$(t){const{motionValue:e,name:r,repeatDelay:l,repeatType:u,damping:f,type:g}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:s,transformTemplate:S}=e.owner.getProps();return g$()&&r&&m$.has(r)&&(r!=="transform"||!S)&&!s&&!l&&u!=="mirror"&&f!==0&&g!=="inertia"}const _$=40;class v$ extends sT{constructor({autoplay:e=!0,delay:r=0,type:l="keyframes",repeat:u=0,repeatDelay:f=0,repeatType:g="loop",keyframes:w,name:s,motionValue:S,element:A,...j}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=$o.now();const O={autoplay:e,delay:r,type:l,repeat:u,repeatDelay:f,repeatType:g,name:s,motionValue:S,element:A,...j},L=A?.KeyframeResolver||aT;this.keyframeResolver=new L(w,(W,U,q)=>this.onKeyframesResolved(W,U,O,!q),s,S,A),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,r,l,u){this.keyframeResolver=void 0;const{name:f,type:g,velocity:w,delay:s,isHandoff:S,onUpdate:A}=l;this.resolvedAt=$o.now(),p$(e,f,g,w)||((nd.instantAnimations||!s)&&A?.(iT(e,l,r)),e[0]=e[e.length-1],Rb(l),l.repeat=0);const O={startTime:u?this.resolvedAt?this.resolvedAt-this.createdAt>_$?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...l,keyframes:e},L=!S&&y$(O),W=O.motionValue?.owner?.current,U=L?new h$({...O,element:W}):new oT(O);U.finished.then(()=>{this.notifyFinished()}).catch(pl),this.pendingTimeline&&(this.stopTimeline=U.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=U}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),t$()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}function rR(t,e,r,l=0,u=1){const f=Array.from(t).sort((S,A)=>S.sortNodePosition(A)).indexOf(e),g=t.size,w=(g-1)*l;return typeof r=="function"?r(f,g):u===1?f*l:w-f*l}const x$=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function w$(t){const e=x$.exec(t);if(!e)return[,];const[,r,l,u]=e;return[`--${r??l}`,u]}function iR(t,e,r=1){const[l,u]=w$(t);if(!l)return;const f=window.getComputedStyle(e).getPropertyValue(l);if(f){const g=f.trim();return TI(g)?parseFloat(g):g}return Q1(u)?iR(u,e,r+1):u}const b$={type:"spring",stiffness:500,damping:25,restSpeed:10},T$=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),S$={type:"keyframes",duration:.8},E$={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},C$=(t,{keyframes:e})=>e.length>2?S$:ng.has(t)?t.startsWith("scale")?T$(e[1]):b$:E$,k$=t=>t!==null;function A$(t,{repeat:e,repeatType:r="loop"},l){const u=t.filter(k$),f=e&&r!=="loop"&&e%2===1?0:u.length-1;return u[f]}function lT(t,e){return t?.[e]??t?.default??t}function P$({when:t,delay:e,delayChildren:r,staggerChildren:l,staggerDirection:u,repeat:f,repeatType:g,repeatDelay:w,from:s,elapsed:S,...A}){return!!Object.keys(A).length}const cT=(t,e,r,l={},u,f)=>g=>{const w=lT(l,t)||{},s=w.delay||l.delay||0;let{elapsed:S=0}=l;S=S-Qu(s);const A={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...w,delay:-S,onUpdate:O=>{e.set(O),w.onUpdate&&w.onUpdate(O)},onComplete:()=>{g(),w.onComplete&&w.onComplete()},name:t,motionValue:e,element:f?void 0:u};P$(w)||Object.assign(A,C$(t,A)),A.duration&&(A.duration=Qu(A.duration)),A.repeatDelay&&(A.repeatDelay=Qu(A.repeatDelay)),A.from!==void 0&&(A.keyframes[0]=A.from);let j=!1;if((A.type===!1||A.duration===0&&!A.repeatDelay)&&(Rb(A),A.delay===0&&(j=!0)),(nd.instantAnimations||nd.skipAnimations)&&(j=!0,Rb(A),A.delay=0),A.allowFlatten=!w.type&&!w.ease,j&&!f&&e.get()!==void 0){const O=A$(A.keyframes,w);if(O!==void 0){ri.update(()=>{A.onUpdate(O),A.onComplete()});return}}return w.isSync?new oT(A):new v$(A)};function hk(t){const e=[{},{}];return t?.values.forEach((r,l)=>{e[0][l]=r.get(),e[1][l]=r.getVelocity()}),e}function uT(t,e,r,l){if(typeof e=="function"){const[u,f]=hk(l);e=e(r!==void 0?r:t.custom,u,f)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[u,f]=hk(l);e=e(r!==void 0?r:t.custom,u,f)}return e}function Nm(t,e,r){const l=t.getProps();return uT(l,e,r!==void 0?r:l.custom,t)}const sR=new Set(["width","height","top","left","right","bottom",...tg]),fk=30,M$=t=>!isNaN(parseFloat(t)),wy={current:void 0};class I${constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{const u=$o.now();if(this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const f of this.dependents)f.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=$o.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=M$(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new X1);const l=this.events[e].add(r);return e==="change"?()=>{l(),ri.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,l){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-l}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return wy.current&&wy.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=$o.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>fk)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,fk);return CI(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Kf(t,e){return new I$(t,e)}const Nb=t=>Array.isArray(t);function R$(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,Kf(r))}function N$(t){return Nb(t)?t[t.length-1]||0:t}function j$(t,e){const r=Nm(t,e);let{transitionEnd:l={},transition:u={},...f}=r||{};f={...f,...l};for(const g in f){const w=N$(f[g]);R$(t,g,w)}}const ro=t=>!!(t&&t.getVelocity);function D$(t){return!!(ro(t)&&t.add)}function jb(t,e){const r=t.getValue("willChange");if(D$(r))return r.add(e);if(!r&&nd.WillChange){const l=new nd.WillChange("auto");t.addValue("willChange",l),l.add(e)}}function dT(t){return t.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const L$="framerAppearId",oR="data-"+dT(L$);function aR(t){return t.props[oR]}function O$({protectedKeys:t,needsAnimating:e},r){const l=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,l}function lR(t,e,{delay:r=0,transitionOverride:l,type:u}={}){let{transition:f=t.getDefaultTransition(),transitionEnd:g,...w}=e;const s=f?.reduceMotion;l&&(f=l);const S=[],A=u&&t.animationState&&t.animationState.getState()[u];for(const j in w){const O=t.getValue(j,t.latestValues[j]??null),L=w[j];if(L===void 0||A&&O$(A,j))continue;const W={delay:r,...lT(f||{},j)},U=O.get();if(U!==void 0&&!O.isAnimating&&!Array.isArray(L)&&L===U&&!W.velocity)continue;let q=!1;if(window.MotionHandoffAnimation){const Y=aR(t);if(Y){const ie=window.MotionHandoffAnimation(Y,j,ri);ie!==null&&(W.startTime=ie,q=!0)}}jb(t,j);const Q=s??t.shouldReduceMotion;O.start(cT(j,O,L,Q&&sR.has(j)?{type:!1}:W,t,q));const J=O.animation;J&&S.push(J)}return g&&Promise.all(S).then(()=>{ri.update(()=>{g&&j$(t,g)})}),S}function Db(t,e,r={}){const l=Nm(t,e,r.type==="exit"?t.presenceContext?.custom:void 0);let{transition:u=t.getDefaultTransition()||{}}=l||{};r.transitionOverride&&(u=r.transitionOverride);const f=l?()=>Promise.all(lR(t,l,r)):()=>Promise.resolve(),g=t.variantChildren&&t.variantChildren.size?(s=0)=>{const{delayChildren:S=0,staggerChildren:A,staggerDirection:j}=u;return z$(t,e,s,S,A,j,r)}:()=>Promise.resolve(),{when:w}=u;if(w){const[s,S]=w==="beforeChildren"?[f,g]:[g,f];return s().then(()=>S())}else return Promise.all([f(),g(r.delay)])}function z$(t,e,r=0,l=0,u=0,f=1,g){const w=[];for(const s of t.variantChildren)s.notify("AnimationStart",e),w.push(Db(s,e,{...g,delay:r+(typeof l=="function"?0:l)+rR(t.variantChildren,s,l,u,f)}).then(()=>s.notify("AnimationComplete",e)));return Promise.all(w)}function B$(t,e,r={}){t.notify("AnimationStart",e);let l;if(Array.isArray(e)){const u=e.map(f=>Db(t,f,r));l=Promise.all(u)}else if(typeof e=="string")l=Db(t,e,r);else{const u=typeof e=="function"?Nm(t,e,r.custom):e;l=Promise.all(lR(t,u,r))}return l.then(()=>{t.notify("AnimationComplete",e)})}const F$={test:t=>t==="auto",parse:t=>t},cR=t=>e=>e.test(t),uR=[eg,yn,tu,Qd,p8,f8,F$],pk=t=>uR.find(cR(t));function V$(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||EI(t):!0}const U$=new Set(["brightness","contrast","saturate","opacity"]);function $$(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[l]=r.match(eT)||[];if(!l)return t;const u=r.replace(l,"");let f=U$.has(e)?1:0;return l!==r&&(f*=100),e+"("+f+u+")"}const G$=/\b([a-z-]*)\(.*?\)/gu,Lb={...gh,getAnimatableNone:t=>{const e=t.match(G$);return e?e.map($$).join(" "):t}},mk={...eg,transform:Math.round},H$={rotate:Qd,rotateX:Qd,rotateY:Qd,rotateZ:Qd,scale:dv,scaleX:dv,scaleY:dv,scaleZ:dv,skew:Qd,skewX:Qd,skewY:Qd,distance:yn,translateX:yn,translateY:yn,translateZ:yn,x:yn,y:yn,z:yn,perspective:yn,transformPerspective:yn,opacity:Fy,originX:tk,originY:tk,originZ:yn},hT={borderWidth:yn,borderTopWidth:yn,borderRightWidth:yn,borderBottomWidth:yn,borderLeftWidth:yn,borderRadius:yn,borderTopLeftRadius:yn,borderTopRightRadius:yn,borderBottomRightRadius:yn,borderBottomLeftRadius:yn,width:yn,maxWidth:yn,height:yn,maxHeight:yn,top:yn,right:yn,bottom:yn,left:yn,inset:yn,insetBlock:yn,insetBlockStart:yn,insetBlockEnd:yn,insetInline:yn,insetInlineStart:yn,insetInlineEnd:yn,padding:yn,paddingTop:yn,paddingRight:yn,paddingBottom:yn,paddingLeft:yn,paddingBlock:yn,paddingBlockStart:yn,paddingBlockEnd:yn,paddingInline:yn,paddingInlineStart:yn,paddingInlineEnd:yn,margin:yn,marginTop:yn,marginRight:yn,marginBottom:yn,marginLeft:yn,marginBlock:yn,marginBlockStart:yn,marginBlockEnd:yn,marginInline:yn,marginInlineStart:yn,marginInlineEnd:yn,fontSize:yn,backgroundPositionX:yn,backgroundPositionY:yn,...H$,zIndex:mk,fillOpacity:Fy,strokeOpacity:Fy,numOctaves:mk},q$={...hT,color:os,backgroundColor:os,outlineColor:os,fill:os,stroke:os,borderColor:os,borderTopColor:os,borderRightColor:os,borderBottomColor:os,borderLeftColor:os,filter:Lb,WebkitFilter:Lb},dR=t=>q$[t];function hR(t,e){let r=dR(t);return r!==Lb&&(r=gh),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const W$=new Set(["auto","none","0"]);function Z$(t,e,r){let l=0,u;for(;l<t.length&&!u;){const f=t[l];typeof f=="string"&&!W$.has(f)&&Vy(f).values.length&&(u=t[l]),l++}if(u&&r)for(const f of e)t[f]=hR(r,u)}class K$ extends aT{constructor(e,r,l,u,f){super(e,r,l,u,f,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:l}=this;if(!r||!r.current)return;super.readKeyframes();for(let A=0;A<e.length;A++){let j=e[A];if(typeof j=="string"&&(j=j.trim(),Q1(j))){const O=iR(j,r.current);O!==void 0&&(e[A]=O),A===e.length-1&&(this.finalKeyframe=j)}}if(this.resolveNoneKeyframes(),!sR.has(l)||e.length!==2)return;const[u,f]=e,g=pk(u),w=pk(f),s=ek(u),S=ek(f);if(s!==S&&oh[l]){this.needsMeasurement=!0;return}if(g!==w)if(ck(g)&&ck(w))for(let A=0;A<e.length;A++){const j=e[A];typeof j=="string"&&(e[A]=parseFloat(j))}else oh[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,l=[];for(let u=0;u<e.length;u++)(e[u]===null||V$(e[u]))&&l.push(u);l.length&&Z$(e,l,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:l}=this;if(!e||!e.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=oh[l](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const u=r[r.length-1];u!==void 0&&e.getValue(l,u).jump(u,!1)}measureEndState(){const{element:e,name:r,unresolvedKeyframes:l}=this;if(!e||!e.current)return;const u=e.getValue(r);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,g=l[f];l[f]=oh[r](e.measureViewportBox(),window.getComputedStyle(e.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),this.removedTransforms?.length&&this.removedTransforms.forEach(([w,s])=>{e.getValue(w).set(s)}),this.resolveNoneKeyframes()}}function X$(t,e,r){if(t==null)return[];if(t instanceof EventTarget)return[t];if(typeof t=="string"){let l=document;const u=r?.[t]??l.querySelectorAll(t);return u?Array.from(u):[]}return Array.from(t).filter(l=>l!=null)}const fR=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function Ob(t){return SI(t)&&"offsetHeight"in t}const{schedule:fT}=OI(queueMicrotask,!1),Jl={x:!1,y:!1};function pR(){return Jl.x||Jl.y}function Y$(t){return t==="x"||t==="y"?Jl[t]?null:(Jl[t]=!0,()=>{Jl[t]=!1}):Jl.x||Jl.y?null:(Jl.x=Jl.y=!0,()=>{Jl.x=Jl.y=!1})}function mR(t,e){const r=X$(t),l=new AbortController,u={passive:!0,...e,signal:l.signal};return[r,u,()=>l.abort()]}function gk(t){return!(t.pointerType==="touch"||pR())}function J$(t,e,r={}){const[l,u,f]=mR(t,r),g=w=>{if(!gk(w))return;const{target:s}=w,S=e(s,w);if(typeof S!="function"||!s)return;const A=j=>{gk(j)&&(S(j),s.removeEventListener("pointerleave",A))};s.addEventListener("pointerleave",A,u)};return l.forEach(w=>{w.addEventListener("pointerenter",g,u)}),f}const gR=(t,e)=>e?t===e?!0:gR(t,e.parentElement):!1,pT=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,Q$=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function yR(t){return Q$.has(t.tagName)||t.isContentEditable===!0}const Sv=new WeakSet;function yk(t){return e=>{e.key==="Enter"&&t(e)}}function xw(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const e2=(t,e)=>{const r=t.currentTarget;if(!r)return;const l=yk(()=>{if(Sv.has(r))return;xw(r,"down");const u=yk(()=>{xw(r,"up")}),f=()=>xw(r,"cancel");r.addEventListener("keyup",u,e),r.addEventListener("blur",f,e)});r.addEventListener("keydown",l,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",l),e)};function _k(t){return pT(t)&&!pR()}function t2(t,e,r={}){const[l,u,f]=mR(t,r),g=w=>{const s=w.currentTarget;if(!_k(w))return;Sv.add(s);const S=e(s,w),A=(L,W)=>{window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",O),Sv.has(s)&&Sv.delete(s),_k(L)&&typeof S=="function"&&S(L,{success:W})},j=L=>{A(L,s===window||s===document||r.useGlobalTarget||gR(s,L.target))},O=L=>{A(L,!1)};window.addEventListener("pointerup",j,u),window.addEventListener("pointercancel",O,u)};return l.forEach(w=>{(r.useGlobalTarget?window:w).addEventListener("pointerdown",g,u),Ob(w)&&(w.addEventListener("focus",S=>e2(S,u)),!yR(w)&&!w.hasAttribute("tabindex")&&(w.tabIndex=0))}),f}function _R(t){return SI(t)&&"ownerSVGElement"in t}function n2(t){return _R(t)&&t.tagName==="svg"}function r2(...t){const e=!Array.isArray(t[0]),r=e?0:-1,l=t[0+r],u=t[1+r],f=t[2+r],g=t[3+r],w=KI(u,f,g);return e?w(l):w}const i2=[...uR,os,gh],s2=t=>i2.find(cR(t)),vk=()=>({translate:0,scale:1,origin:0,originPoint:0}),km=()=>({x:vk(),y:vk()}),xk=()=>({min:0,max:0}),ws=()=>({x:xk(),y:xk()}),zb={current:null},vR={current:!1},o2=typeof window<"u";function a2(){if(vR.current=!0,!!o2)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>zb.current=t.matches;t.addEventListener("change",e),e()}else zb.current=!1}const l2=new WeakMap;function M0(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Uy(t){return typeof t=="string"||Array.isArray(t)}const mT=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],gT=["initial",...mT];function I0(t){return M0(t.animate)||gT.some(e=>Uy(t[e]))}function xR(t){return!!(I0(t)||t.variants)}function c2(t,e,r){for(const l in e){const u=e[l],f=r[l];if(ro(u))t.addValue(l,u);else if(ro(f))t.addValue(l,Kf(u,{owner:t}));else if(f!==u)if(t.hasValue(l)){const g=t.getValue(l);g.liveStyle===!0?g.jump(u):g.hasAnimated||g.set(u)}else{const g=t.getStaticValue(l);t.addValue(l,Kf(g!==void 0?g:u,{owner:t}))}}for(const l in r)e[l]===void 0&&t.removeValue(l);return e}const wk=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let Hv={};function wR(t){Hv=t}function u2(){return Hv}class d2{scrapeMotionValuesFromProps(e,r,l){return{}}constructor({parent:e,props:r,presenceContext:l,reducedMotionConfig:u,blockInitialAnimation:f,visualState:g},w={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=aT,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=$o.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,ri.render(this.render,!1,!0))};const{latestValues:s,renderState:S}=g;this.latestValues=s,this.baseTarget={...s},this.initialValues=r.initial?{...s}:{},this.renderState=S,this.parent=e,this.props=r,this.presenceContext=l,this.depth=e?e.depth+1:0,this.reducedMotionConfig=u,this.options=w,this.blockInitialAnimation=!!f,this.isControllingVariants=I0(r),this.isVariantNode=xR(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:A,...j}=this.scrapeMotionValuesFromProps(r,{},this);for(const O in j){const L=j[O];s[O]!==void 0&&ro(L)&&L.set(s[O])}}mount(e){this.current=e,l2.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,l)=>this.bindToMotionValue(l,r)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(vR.current||a2(),this.shouldReduceMotion=zb.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),rd(this.notifyUpdate),rd(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const r=this.features[e];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const l=ng.has(e);l&&this.onBindTransform&&this.onBindTransform();const u=r.on("change",g=>{this.latestValues[e]=g,this.props.onUpdate&&ri.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let f;typeof window<"u"&&window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{u(),f&&f(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Hv){const r=Hv[e];if(!r)continue;const{isEnabled:l,Feature:u}=r;if(!this.features[e]&&u&&l(this.props)&&(this.features[e]=new u(this)),this.features[e]){const f=this.features[e];f.isMounted?f.update():(f.mount(),f.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ws()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let l=0;l<wk.length;l++){const u=wk[l];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const f="on"+u,g=e[f];g&&(this.propEventSubscriptions[u]=this.on(u,g))}this.prevMotionValues=c2(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const l=this.values.get(e);r!==l&&(l&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let l=this.values.get(e);return l===void 0&&r!==void 0&&(l=Kf(r===null?void 0:r,{owner:this}),this.addValue(e,l)),l}readValue(e,r){let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(TI(l)||EI(l))?l=parseFloat(l):!s2(l)&&gh.test(r)&&(l=hR(e,r)),this.setBaseTarget(e,ro(l)?l.get():l)),ro(l)?l.get():l}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){const{initial:r}=this.props;let l;if(typeof r=="string"||typeof r=="object"){const f=uT(this.props,r,this.presenceContext?.custom);f&&(l=f[e])}if(r&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!ro(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new X1),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){fT.render(this.render)}}class bR extends d2{constructor(){super(...arguments),this.KeyframeResolver=K$}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){const l=e.style;return l?l[r]:void 0}removeValueFromRenderState(e,{vars:r,style:l}){delete r[e],delete l[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ro(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}class wh{constructor(e){this.isMounted=!1,this.node=e}update(){}}function TR({top:t,left:e,right:r,bottom:l}){return{x:{min:e,max:r},y:{min:t,max:l}}}function h2({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function f2(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),l=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:l.y,right:l.x}}function ww(t){return t===void 0||t===1}function Bb({scale:t,scaleX:e,scaleY:r}){return!ww(t)||!ww(e)||!ww(r)}function Df(t){return Bb(t)||SR(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function SR(t){return bk(t.x)||bk(t.y)}function bk(t){return t&&t!=="0%"}function qv(t,e,r){const l=t-r,u=e*l;return r+u}function Tk(t,e,r,l,u){return u!==void 0&&(t=qv(t,u,l)),qv(t,r,l)+e}function Fb(t,e=0,r=1,l,u){t.min=Tk(t.min,e,r,l,u),t.max=Tk(t.max,e,r,l,u)}function ER(t,{x:e,y:r}){Fb(t.x,e.translate,e.scale,e.originPoint),Fb(t.y,r.translate,r.scale,r.originPoint)}const Sk=.999999999999,Ek=1.0000000000001;function p2(t,e,r,l=!1){const u=r.length;if(!u)return;e.x=e.y=1;let f,g;for(let w=0;w<u;w++){f=r[w],g=f.projectionDelta;const{visualElement:s}=f.options;s&&s.props.style&&s.props.style.display==="contents"||(l&&f.options.layoutScroll&&f.scroll&&f!==f.root&&Pm(t,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),g&&(e.x*=g.x.scale,e.y*=g.y.scale,ER(t,g)),l&&Df(f.latestValues)&&Pm(t,f.latestValues))}e.x<Ek&&e.x>Sk&&(e.x=1),e.y<Ek&&e.y>Sk&&(e.y=1)}function Am(t,e){t.min=t.min+e,t.max=t.max+e}function Ck(t,e,r,l,u=.5){const f=vi(t.min,t.max,u);Fb(t,e,r,f,l)}function Pm(t,e){Ck(t.x,e.x,e.scaleX,e.scale,e.originX),Ck(t.y,e.y,e.scaleY,e.scale,e.originY)}function CR(t,e){return TR(f2(t.getBoundingClientRect(),e))}function m2(t,e,r){const l=CR(t,r),{scroll:u}=e;return u&&(Am(l.x,u.offset.x),Am(l.y,u.offset.y)),l}const g2={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},y2=tg.length;function _2(t,e,r){let l="",u=!0;for(let f=0;f<y2;f++){const g=tg[f],w=t[g];if(w===void 0)continue;let s=!0;if(typeof w=="number")s=w===(g.startsWith("scale")?1:0);else{const S=parseFloat(w);s=g.startsWith("scale")?S===1:S===0}if(!s||r){const S=fR(w,hT[g]);if(!s){u=!1;const A=g2[g]||g;l+=`${A}(${S}) `}r&&(e[g]=S)}}return l=l.trim(),r?l=r(e,u?"":l):u&&(l="none"),l}function yT(t,e,r){const{style:l,vars:u,transformOrigin:f}=t;let g=!1,w=!1;for(const s in e){const S=e[s];if(ng.has(s)){g=!0;continue}else if(BI(s)){u[s]=S;continue}else{const A=fR(S,hT[s]);s.startsWith("origin")?(w=!0,f[s]=A):l[s]=A}}if(e.transform||(g||r?l.transform=_2(e,t.transform,r):l.transform&&(l.transform="none")),w){const{originX:s="50%",originY:S="50%",originZ:A=0}=f;l.transformOrigin=`${s} ${S} ${A}`}}function kR(t,{style:e,vars:r},l,u){const f=t.style;let g;for(g in e)f[g]=e[g];u?.applyProjectionStyles(f,l);for(g in r)f.setProperty(g,r[g])}function kk(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const ry={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(yn.test(t))t=parseFloat(t);else return t;const r=kk(t,e.target.x),l=kk(t,e.target.y);return`${r}% ${l}%`}},v2={correct:(t,{treeScale:e,projectionDelta:r})=>{const l=t,u=gh.parse(t);if(u.length>5)return l;const f=gh.createTransformer(t),g=typeof u[0]!="number"?1:0,w=r.x.scale*e.x,s=r.y.scale*e.y;u[0+g]/=w,u[1+g]/=s;const S=vi(w,s,.5);return typeof u[2+g]=="number"&&(u[2+g]/=S),typeof u[3+g]=="number"&&(u[3+g]/=S),f(u)}},Vb={borderRadius:{...ry,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ry,borderTopRightRadius:ry,borderBottomLeftRadius:ry,borderBottomRightRadius:ry,boxShadow:v2};function AR(t,{layout:e,layoutId:r}){return ng.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!Vb[t]||t==="opacity")}function _T(t,e,r){const l=t.style,u=e?.style,f={};if(!l)return f;for(const g in l)(ro(l[g])||u&&ro(u[g])||AR(g,t)||r?.getValue(g)?.liveStyle!==void 0)&&(f[g]=l[g]);return f}function x2(t){return window.getComputedStyle(t)}class w2 extends bR{constructor(){super(...arguments),this.type="html",this.renderInstance=kR}readValueFromInstance(e,r){if(ng.has(r))return this.projection?.isProjecting?kb(r):X8(e,r);{const l=x2(e),u=(BI(r)?l.getPropertyValue(r):l[r])||0;return typeof u=="string"?u.trim():u}}measureInstanceViewportBox(e,{transformPagePoint:r}){return CR(e,r)}build(e,r,l){yT(e,r,l.transformTemplate)}scrapeMotionValuesFromProps(e,r,l){return _T(e,r,l)}}const b2={offset:"stroke-dashoffset",array:"stroke-dasharray"},T2={offset:"strokeDashoffset",array:"strokeDasharray"};function S2(t,e,r=1,l=0,u=!0){t.pathLength=1;const f=u?b2:T2;t[f.offset]=`${-l}`,t[f.array]=`${e} ${r}`}const E2=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function PR(t,{attrX:e,attrY:r,attrScale:l,pathLength:u,pathSpacing:f=1,pathOffset:g=0,...w},s,S,A){if(yT(t,w,S),s){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:j,style:O}=t;j.transform&&(O.transform=j.transform,delete j.transform),(O.transform||j.transformOrigin)&&(O.transformOrigin=j.transformOrigin??"50% 50%",delete j.transformOrigin),O.transform&&(O.transformBox=A?.transformBox??"fill-box",delete j.transformBox);for(const L of E2)j[L]!==void 0&&(O[L]=j[L],delete j[L]);e!==void 0&&(j.x=e),r!==void 0&&(j.y=r),l!==void 0&&(j.scale=l),u!==void 0&&S2(j,u,f,g,!1)}const MR=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),IR=t=>typeof t=="string"&&t.toLowerCase()==="svg";function C2(t,e,r,l){kR(t,e,void 0,l);for(const u in e.attrs)t.setAttribute(MR.has(u)?u:dT(u),e.attrs[u])}function RR(t,e,r){const l=_T(t,e,r);for(const u in t)if(ro(t[u])||ro(e[u])){const f=tg.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;l[f]=t[u]}return l}class k2 extends bR{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ws}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(ng.has(r)){const l=dR(r);return l&&l.default||0}return r=MR.has(r)?r:dT(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,l){return RR(e,r,l)}build(e,r,l){PR(e,r,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(e,r,l,u){C2(e,r,l,u)}mount(e){this.isSVGTag=IR(e.tagName),super.mount(e)}}const A2=gT.length;function NR(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?NR(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<A2;r++){const l=gT[r],u=t.props[l];(Uy(u)||u===!1)&&(e[l]=u)}return e}function jR(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let l=0;l<r;l++)if(e[l]!==t[l])return!1;return!0}const P2=[...mT].reverse(),M2=mT.length;function I2(t){return e=>Promise.all(e.map(({animation:r,options:l})=>B$(t,r,l)))}function R2(t){let e=I2(t),r=Ak(),l=!0;const u=s=>(S,A)=>{const j=Nm(t,A,s==="exit"?t.presenceContext?.custom:void 0);if(j){const{transition:O,transitionEnd:L,...W}=j;S={...S,...W,...L}}return S};function f(s){e=s(t)}function g(s){const{props:S}=t,A=NR(t.parent)||{},j=[],O=new Set;let L={},W=1/0;for(let q=0;q<M2;q++){const Q=P2[q],J=r[Q],Y=S[Q]!==void 0?S[Q]:A[Q],ie=Uy(Y),_e=Q===s?J.isActive:null;_e===!1&&(W=q);let Se=Y===A[Q]&&Y!==S[Q]&&ie;if(Se&&l&&t.manuallyAnimateOnMount&&(Se=!1),J.protectedKeys={...L},!J.isActive&&_e===null||!Y&&!J.prevProp||M0(Y)||typeof Y=="boolean")continue;const Ie=N2(J.prevProp,Y);let Ue=Ie||Q===s&&J.isActive&&!Se&&ie||q>W&&ie,Je=!1;const Me=Array.isArray(Y)?Y:[Y];let lt=Me.reduce(u(Q),{});_e===!1&&(lt={});const{prevResolvedValues:ft={}}=J,mt={...ft,...lt},gt=We=>{Ue=!0,O.has(We)&&(Je=!0,O.delete(We)),J.needsAnimating[We]=!0;const Le=t.getValue(We);Le&&(Le.liveStyle=!1)};for(const We in mt){const Le=lt[We],we=ft[We];if(L.hasOwnProperty(We))continue;let st=!1;Nb(Le)&&Nb(we)?st=!jR(Le,we):st=Le!==we,st?Le!=null?gt(We):O.add(We):Le!==void 0&&O.has(We)?gt(We):J.protectedKeys[We]=!0}J.prevProp=Y,J.prevResolvedValues=lt,J.isActive&&(L={...L,...lt}),l&&t.blockInitialAnimation&&(Ue=!1);const Lt=Se&&Ie;Ue&&(!Lt||Je)&&j.push(...Me.map(We=>{const Le={type:Q};if(typeof We=="string"&&l&&!Lt&&t.manuallyAnimateOnMount&&t.parent){const{parent:we}=t,st=Nm(we,We);if(we.enteringChildren&&st){const{delayChildren:ke}=st.transition||{};Le.delay=rR(we.enteringChildren,t,ke)}}return{animation:We,options:Le}}))}if(O.size){const q={};if(typeof S.initial!="boolean"){const Q=Nm(t,Array.isArray(S.initial)?S.initial[0]:S.initial);Q&&Q.transition&&(q.transition=Q.transition)}O.forEach(Q=>{const J=t.getBaseTarget(Q),Y=t.getValue(Q);Y&&(Y.liveStyle=!0),q[Q]=J??null}),j.push({animation:q})}let U=!!j.length;return l&&(S.initial===!1||S.initial===S.animate)&&!t.manuallyAnimateOnMount&&(U=!1),l=!1,U?e(j):Promise.resolve()}function w(s,S){if(r[s].isActive===S)return Promise.resolve();t.variantChildren?.forEach(j=>j.animationState?.setActive(s,S)),r[s].isActive=S;const A=g(s);for(const j in r)r[j].protectedKeys={};return A}return{animateChanges:g,setActive:w,setAnimateFunction:f,getState:()=>r,reset:()=>{r=Ak()}}}function N2(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!jR(e,t):!1}function Rf(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ak(){return{animate:Rf(!0),whileInView:Rf(),whileHover:Rf(),whileTap:Rf(),whileDrag:Rf(),whileFocus:Rf(),exit:Rf()}}function Pk(t,e){t.min=e.min,t.max=e.max}function Zl(t,e){Pk(t.x,e.x),Pk(t.y,e.y)}function Mk(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}const DR=1e-4,j2=1-DR,D2=1+DR,LR=.01,L2=0-LR,O2=0+LR;function Go(t){return t.max-t.min}function z2(t,e,r){return Math.abs(t-e)<=r}function Ik(t,e,r,l=.5){t.origin=l,t.originPoint=vi(e.min,e.max,t.origin),t.scale=Go(r)/Go(e),t.translate=vi(r.min,r.max,t.origin)-t.originPoint,(t.scale>=j2&&t.scale<=D2||isNaN(t.scale))&&(t.scale=1),(t.translate>=L2&&t.translate<=O2||isNaN(t.translate))&&(t.translate=0)}function by(t,e,r,l){Ik(t.x,e.x,r.x,l?l.originX:void 0),Ik(t.y,e.y,r.y,l?l.originY:void 0)}function Rk(t,e,r){t.min=r.min+e.min,t.max=t.min+Go(e)}function B2(t,e,r){Rk(t.x,e.x,r.x),Rk(t.y,e.y,r.y)}function Nk(t,e,r){t.min=e.min-r.min,t.max=t.min+Go(e)}function Wv(t,e,r){Nk(t.x,e.x,r.x),Nk(t.y,e.y,r.y)}function jk(t,e,r,l,u){return t-=e,t=qv(t,1/r,l),u!==void 0&&(t=qv(t,1/u,l)),t}function F2(t,e=0,r=1,l=.5,u,f=t,g=t){if(tu.test(e)&&(e=parseFloat(e),e=vi(g.min,g.max,e/100)-g.min),typeof e!="number")return;let w=vi(f.min,f.max,l);t===f&&(w-=e),t.min=jk(t.min,e,r,w,u),t.max=jk(t.max,e,r,w,u)}function Dk(t,e,[r,l,u],f,g){F2(t,e[r],e[l],e[u],e.scale,f,g)}const V2=["x","scaleX","originX"],U2=["y","scaleY","originY"];function Lk(t,e,r,l){Dk(t.x,e,V2,r?r.x:void 0,l?l.x:void 0),Dk(t.y,e,U2,r?r.y:void 0,l?l.y:void 0)}function Ok(t){return t.translate===0&&t.scale===1}function OR(t){return Ok(t.x)&&Ok(t.y)}function zk(t,e){return t.min===e.min&&t.max===e.max}function $2(t,e){return zk(t.x,e.x)&&zk(t.y,e.y)}function Bk(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function zR(t,e){return Bk(t.x,e.x)&&Bk(t.y,e.y)}function Fk(t){return Go(t.x)/Go(t.y)}function Vk(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}function cl(t){return[t("x"),t("y")]}function G2(t,e,r){let l="";const u=t.x.translate/e.x,f=t.y.translate/e.y,g=r?.z||0;if((u||f||g)&&(l=`translate3d(${u}px, ${f}px, ${g}px) `),(e.x!==1||e.y!==1)&&(l+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:S,rotate:A,rotateX:j,rotateY:O,skewX:L,skewY:W}=r;S&&(l=`perspective(${S}px) ${l}`),A&&(l+=`rotate(${A}deg) `),j&&(l+=`rotateX(${j}deg) `),O&&(l+=`rotateY(${O}deg) `),L&&(l+=`skewX(${L}deg) `),W&&(l+=`skewY(${W}deg) `)}const w=t.x.scale*e.x,s=t.y.scale*e.y;return(w!==1||s!==1)&&(l+=`scale(${w}, ${s})`),l||"none"}const BR=["TopLeft","TopRight","BottomLeft","BottomRight"],H2=BR.length,Uk=t=>typeof t=="string"?parseFloat(t):t,$k=t=>typeof t=="number"||yn.test(t);function q2(t,e,r,l,u,f){u?(t.opacity=vi(0,r.opacity??1,W2(l)),t.opacityExit=vi(e.opacity??1,0,Z2(l))):f&&(t.opacity=vi(e.opacity??1,r.opacity??1,l));for(let g=0;g<H2;g++){const w=`border${BR[g]}Radius`;let s=Gk(e,w),S=Gk(r,w);if(s===void 0&&S===void 0)continue;s||(s=0),S||(S=0),s===0||S===0||$k(s)===$k(S)?(t[w]=Math.max(vi(Uk(s),Uk(S),l),0),(tu.test(S)||tu.test(s))&&(t[w]+="%")):t[w]=S}(e.rotate||r.rotate)&&(t.rotate=vi(e.rotate||0,r.rotate||0,l))}function Gk(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const W2=FR(0,.5,NI),Z2=FR(.5,.95,pl);function FR(t,e,r){return l=>l<t?0:l>e?1:r(By(t,e,l))}function K2(t,e,r){const l=ro(t)?t:Kf(t);return l.start(cT("",l,e,r)),l.animation}function $y(t,e,r,l={passive:!0}){return t.addEventListener(e,r,l),()=>t.removeEventListener(e,r)}const X2=(t,e)=>t.depth-e.depth;class Y2{constructor(){this.children=[],this.isDirty=!1}add(e){q1(this.children,e),this.isDirty=!0}remove(e){W1(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(X2),this.isDirty=!1,this.children.forEach(e)}}function J2(t,e){const r=$o.now(),l=({timestamp:u})=>{const f=u-r;f>=e&&(rd(l),t(f-e))};return ri.setup(l,!0),()=>rd(l)}function Ev(t){return ro(t)?t.get():t}class Q2{constructor(){this.members=[]}add(e){q1(this.members,e),e.scheduleRender()}remove(e){if(W1(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(u=>e===u);if(r===0)return!1;let l;for(let u=r;u>=0;u--){const f=this.members[u];if(f.isPresent!==!1){l=f;break}}return l?(this.promote(l),!0):!1}promote(e,r){const l=this.lead;if(e!==l&&(this.prevLead=l,this.lead=e,e.show(),l)){l.instance&&l.scheduleRender(),e.scheduleRender();const u=l.options.layoutDependency,f=e.options.layoutDependency;u!==void 0&&f!==void 0&&u===f||(e.resumeFrom=l,r&&(e.resumeFrom.preserveOpacity=!0),l.snapshot&&(e.snapshot=l.snapshot,e.snapshot.latestValues=l.animationValues||l.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0));const{crossfade:w}=e.options;w===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:l}=e;r.onExitComplete&&r.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Cv={hasAnimatedSinceResize:!0,hasEverUpdated:!1},bw=["","X","Y","Z"],e9=1e3;let t9=0;function Tw(t,e,r,l){const{latestValues:u}=e;u[t]&&(r[t]=u[t],e.setStaticValue(t,0),l&&(l[t]=0))}function VR(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=aR(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:u,layoutId:f}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",ri,!(u||f))}const{parent:l}=t;l&&!l.hasCheckedOptimisedAppear&&VR(l)}function UR({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:l,resetTransform:u}){return class{constructor(g={},w=e?.()){this.id=t9++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(i9),this.nodes.forEach(l9),this.nodes.forEach(c9),this.nodes.forEach(s9)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=w?w.root||w:this,this.path=w?[...w.path,w]:[],this.parent=w,this.depth=w?w.depth+1:0;for(let s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new Y2)}addEventListener(g,w){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new X1),this.eventHandlers.get(g).add(w)}notifyListeners(g,...w){const s=this.eventHandlers.get(g);s&&s.notify(...w)}hasListeners(g){return this.eventHandlers.has(g)}mount(g){if(this.instance)return;this.isSVG=_R(g)&&!n2(g),this.instance=g;const{layoutId:w,layout:s,visualElement:S}=this.options;if(S&&!S.current&&S.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(s||w)&&(this.isLayoutDirty=!0),t){let A,j=0;const O=()=>this.root.updateBlockedByResize=!1;ri.read(()=>{j=window.innerWidth}),t(g,()=>{const L=window.innerWidth;L!==j&&(j=L,this.root.updateBlockedByResize=!0,A&&A(),A=J2(O,250),Cv.hasAnimatedSinceResize&&(Cv.hasAnimatedSinceResize=!1,this.nodes.forEach(Wk)))})}w&&this.root.registerSharedNode(w,this),this.options.animate!==!1&&S&&(w||s)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:j,hasRelativeLayoutChanged:O,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const W=this.options.transition||S.getDefaultTransition()||p9,{onLayoutAnimationStart:U,onLayoutAnimationComplete:q}=S.getProps(),Q=!this.targetLayout||!zR(this.targetLayout,L),J=!j&&O;if(this.options.layoutRoot||this.resumeFrom||J||j&&(Q||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Y={...lT(W,"layout"),onPlay:U,onComplete:q};(S.shouldReduceMotion||this.options.layoutRoot)&&(Y.delay=0,Y.type=!1),this.startAnimation(Y),this.setAnimationOrigin(A,J)}else j||Wk(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),rd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(u9),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&VR(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let A=0;A<this.path.length;A++){const j=this.path[A];j.shouldResetTransform=!0,j.updateScroll("snapshot"),j.options.layoutRoot&&j.willUpdate(!1)}const{layoutId:w,layout:s}=this.options;if(w===void 0&&!s)return;const S=this.getTransformTemplate();this.prevTransformTemplateValue=S?S(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Hk);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(qk);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(a9),this.nodes.forEach(n9),this.nodes.forEach(r9)):this.nodes.forEach(qk),this.clearAllSnapshots();const w=$o.now();no.delta=iu(0,1e3/60,w-no.timestamp),no.timestamp=w,no.isProcessing=!0,pw.update.process(no),pw.preRender.process(no),pw.render.process(no),no.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,fT.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(o9),this.sharedNodes.forEach(d9)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ri.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ri.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Go(this.snapshot.measuredBox.x)&&!Go(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++)this.path[s].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ws(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:w}=this.options;w&&w.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let w=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(w=!1),w&&this.instance){const s=l(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:s,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:s}}}resetTransform(){if(!u)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,w=this.projectionDelta&&!OR(this.projectionDelta),s=this.getTransformTemplate(),S=s?s(this.latestValues,""):void 0,A=S!==this.prevTransformTemplateValue;g&&this.instance&&(w||Df(this.latestValues)||A)&&(u(this.instance,S),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const w=this.measurePageBox();let s=this.removeElementScroll(w);return g&&(s=this.removeTransform(s)),m9(s),{animationId:this.root.animationId,measuredBox:w,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:g}=this.options;if(!g)return ws();const w=g.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(g9))){const{scroll:S}=this.root;S&&(Am(w.x,S.offset.x),Am(w.y,S.offset.y))}return w}removeElementScroll(g){const w=ws();if(Zl(w,g),this.scroll?.wasRoot)return w;for(let s=0;s<this.path.length;s++){const S=this.path[s],{scroll:A,options:j}=S;S!==this.root&&A&&j.layoutScroll&&(A.wasRoot&&Zl(w,g),Am(w.x,A.offset.x),Am(w.y,A.offset.y))}return w}applyTransform(g,w=!1){const s=ws();Zl(s,g);for(let S=0;S<this.path.length;S++){const A=this.path[S];!w&&A.options.layoutScroll&&A.scroll&&A!==A.root&&Pm(s,{x:-A.scroll.offset.x,y:-A.scroll.offset.y}),Df(A.latestValues)&&Pm(s,A.latestValues)}return Df(this.latestValues)&&Pm(s,this.latestValues),s}removeTransform(g){const w=ws();Zl(w,g);for(let s=0;s<this.path.length;s++){const S=this.path[s];if(!S.instance||!Df(S.latestValues))continue;Bb(S.latestValues)&&S.updateSnapshot();const A=ws(),j=S.measurePageBox();Zl(A,j),Lk(w,S.latestValues,S.snapshot?S.snapshot.layoutBox:void 0,A)}return Df(this.latestValues)&&Lk(w,this.latestValues),w}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==no.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){const w=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=w.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=w.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=w.isSharedProjectionDirty);const s=!!this.resumingFrom||this!==w;if(!(g||s&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:j}=this.options;if(!this.layout||!(A||j))return;this.resolvedRelativeTargetAt=no.timestamp;const O=this.getClosestProjectingParent();O&&this.linkedParentVersion!==O.layoutVersion&&!O.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(O&&O.layout?this.createRelativeTarget(O,this.layout.layoutBox,O.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ws(),this.targetWithTransforms=ws()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),B2(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Zl(this.target,this.layout.layoutBox),ER(this.target,this.targetDelta)):Zl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,O&&!!O.resumingFrom==!!this.resumingFrom&&!O.options.layoutScroll&&O.target&&this.animationProgress!==1?this.createRelativeTarget(O,this.target,O.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Bb(this.parent.latestValues)||SR(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(g,w,s){this.relativeParent=g,this.linkedParentVersion=g.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ws(),this.relativeTargetOrigin=ws(),Wv(this.relativeTargetOrigin,w,s),Zl(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const g=this.getLead(),w=!!this.resumingFrom||this!==g;let s=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(s=!1),w&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(s=!1),this.resolvedRelativeTargetAt===no.timestamp&&(s=!1),s)return;const{layout:S,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(S||A))return;Zl(this.layoutCorrected,this.layout.layoutBox);const j=this.treeScale.x,O=this.treeScale.y;p2(this.layoutCorrected,this.treeScale,this.path,w),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=ws());const{target:L}=g;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Mk(this.prevProjectionDelta.x,this.projectionDelta.x),Mk(this.prevProjectionDelta.y,this.projectionDelta.y)),by(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==j||this.treeScale.y!==O||!Vk(this.projectionDelta.x,this.prevProjectionDelta.x)||!Vk(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){if(this.options.visualElement?.scheduleRender(),g){const w=this.getStack();w&&w.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=km(),this.projectionDelta=km(),this.projectionDeltaWithTransform=km()}setAnimationOrigin(g,w=!1){const s=this.snapshot,S=s?s.latestValues:{},A={...this.latestValues},j=km();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!w;const O=ws(),L=s?s.source:void 0,W=this.layout?this.layout.source:void 0,U=L!==W,q=this.getStack(),Q=!q||q.members.length<=1,J=!!(U&&!Q&&this.options.crossfade===!0&&!this.path.some(f9));this.animationProgress=0;let Y;this.mixTargetDelta=ie=>{const _e=ie/1e3;Zk(j.x,g.x,_e),Zk(j.y,g.y,_e),this.setTargetDelta(j),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Wv(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h9(this.relativeTarget,this.relativeTargetOrigin,O,_e),Y&&$2(this.relativeTarget,Y)&&(this.isProjectionDirty=!1),Y||(Y=ws()),Zl(Y,this.relativeTarget)),U&&(this.animationValues=A,q2(A,S,this.latestValues,_e,J,Q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_e},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(rd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ri.update(()=>{Cv.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Kf(0)),this.currentAnimation=K2(this.motionValue,[0,1e3],{...g,velocity:0,isSync:!0,onUpdate:w=>{this.mixTargetDelta(w),g.onUpdate&&g.onUpdate(w)},onStop:()=>{},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(e9),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:w,target:s,layout:S,latestValues:A}=g;if(!(!w||!s||!S)){if(this!==g&&this.layout&&S&&$R(this.options.animationType,this.layout.layoutBox,S.layoutBox)){s=this.target||ws();const j=Go(this.layout.layoutBox.x);s.x.min=g.target.x.min,s.x.max=s.x.min+j;const O=Go(this.layout.layoutBox.y);s.y.min=g.target.y.min,s.y.max=s.y.min+O}Zl(w,s),Pm(w,A),by(this.projectionDeltaWithTransform,this.layoutCorrected,w,A)}}registerSharedNode(g,w){this.sharedNodes.has(g)||this.sharedNodes.set(g,new Q2),this.sharedNodes.get(g).add(w);const S=w.options.initialPromotionConfig;w.promote({transition:S?S.transition:void 0,preserveFollowOpacity:S&&S.shouldPreserveFollowOpacity?S.shouldPreserveFollowOpacity(w):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){const{layoutId:g}=this.options;return g?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:g}=this.options;return g?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:w,preserveFollowOpacity:s}={}){const S=this.getStack();S&&S.promote(this,s),g&&(this.projectionDelta=void 0,this.needsReset=!0),w&&this.setOptions({transition:w})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let w=!1;const{latestValues:s}=g;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(w=!0),!w)return;const S={};s.z&&Tw("z",g,S,this.animationValues);for(let A=0;A<bw.length;A++)Tw(`rotate${bw[A]}`,g,S,this.animationValues),Tw(`skew${bw[A]}`,g,S,this.animationValues);g.render();for(const A in S)g.setStaticValue(A,S[A]),this.animationValues&&(this.animationValues[A]=S[A]);g.scheduleRender()}applyProjectionStyles(g,w){if(!this.instance||this.isSVG)return;if(!this.isVisible){g.visibility="hidden";return}const s=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,g.visibility="",g.opacity="",g.pointerEvents=Ev(w?.pointerEvents)||"",g.transform=s?s(this.latestValues,""):"none";return}const S=this.getLead();if(!this.projectionDelta||!this.layout||!S.target){this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=Ev(w?.pointerEvents)||""),this.hasProjected&&!Df(this.latestValues)&&(g.transform=s?s({},""):"none",this.hasProjected=!1);return}g.visibility="";const A=S.animationValues||S.latestValues;this.applyTransformsToTarget();let j=G2(this.projectionDeltaWithTransform,this.treeScale,A);s&&(j=s(A,j)),g.transform=j;const{x:O,y:L}=this.projectionDelta;g.transformOrigin=`${O.origin*100}% ${L.origin*100}% 0`,S.animationValues?g.opacity=S===this?A.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:A.opacityExit:g.opacity=S===this?A.opacity!==void 0?A.opacity:"":A.opacityExit!==void 0?A.opacityExit:0;for(const W in Vb){if(A[W]===void 0)continue;const{correct:U,applyTo:q,isCSSVariable:Q}=Vb[W],J=j==="none"?A[W]:U(A[W],S);if(q){const Y=q.length;for(let ie=0;ie<Y;ie++)g[q[ie]]=J}else Q?this.options.visualElement.renderState.vars[W]=J:g[W]=J}this.options.layoutId&&(g.pointerEvents=S===this?Ev(w?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>g.currentAnimation?.stop()),this.root.nodes.forEach(Hk),this.root.sharedNodes.clear()}}}function n9(t){t.updateLayout()}function r9(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:l}=t.layout,{animationType:u}=t.options,f=e.source!==t.layout.source;u==="size"?cl(A=>{const j=f?e.measuredBox[A]:e.layoutBox[A],O=Go(j);j.min=r[A].min,j.max=j.min+O}):$R(u,e.layoutBox,r)&&cl(A=>{const j=f?e.measuredBox[A]:e.layoutBox[A],O=Go(r[A]);j.max=j.min+O,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[A].max=t.relativeTarget[A].min+O)});const g=km();by(g,r,e.layoutBox);const w=km();f?by(w,t.applyTransform(l,!0),e.measuredBox):by(w,r,e.layoutBox);const s=!OR(g);let S=!1;if(!t.resumeFrom){const A=t.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:j,layout:O}=A;if(j&&O){const L=ws();Wv(L,e.layoutBox,j.layoutBox);const W=ws();Wv(W,r,O.layoutBox),zR(L,W)||(S=!0),A.options.layoutRoot&&(t.relativeTarget=W,t.relativeTargetOrigin=L,t.relativeParent=A)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:w,layoutDelta:g,hasLayoutChanged:s,hasRelativeLayoutChanged:S})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function i9(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function s9(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function o9(t){t.clearSnapshot()}function Hk(t){t.clearMeasurements()}function qk(t){t.isLayoutDirty=!1}function a9(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Wk(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function l9(t){t.resolveTargetDelta()}function c9(t){t.calcProjection()}function u9(t){t.resetSkewAndRotation()}function d9(t){t.removeLeadSnapshot()}function Zk(t,e,r){t.translate=vi(e.translate,0,r),t.scale=vi(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function Kk(t,e,r,l){t.min=vi(e.min,r.min,l),t.max=vi(e.max,r.max,l)}function h9(t,e,r,l){Kk(t.x,e.x,r.x,l),Kk(t.y,e.y,r.y,l)}function f9(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const p9={duration:.45,ease:[.4,0,.1,1]},Xk=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),Yk=Xk("applewebkit/")&&!Xk("chrome/")?Math.round:pl;function Jk(t){t.min=Yk(t.min),t.max=Yk(t.max)}function m9(t){Jk(t.x),Jk(t.y)}function $R(t,e,r){return t==="position"||t==="preserve-aspect"&&!z2(Fk(e),Fk(r),.2)}function g9(t){return t!==t.root&&t.scroll?.wasRoot}const y9=UR({attachResizeListener:(t,e)=>$y(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),Sw={current:void 0},GR=UR({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Sw.current){const t=new y9({});t.mount(window),t.setOptions({layoutScroll:!0}),Sw.current=t}return Sw.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),R0=I.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Qk(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function _9(...t){return e=>{let r=!1;const l=t.map(u=>{const f=Qk(u,e);return!r&&typeof f=="function"&&(r=!0),f});if(r)return()=>{for(let u=0;u<l.length;u++){const f=l[u];typeof f=="function"?f():Qk(t[u],null)}}}}function v9(...t){return I.useCallback(_9(...t),t)}class x9 extends I.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const l=r.offsetParent,u=Ob(l)&&l.offsetWidth||0,f=Ob(l)&&l.offsetHeight||0,g=this.props.sizeRef.current;g.height=r.offsetHeight||0,g.width=r.offsetWidth||0,g.top=r.offsetTop,g.left=r.offsetLeft,g.right=u-g.width-g.left,g.bottom=f-g.height-g.top}return null}componentDidUpdate(){}render(){return this.props.children}}function w9({children:t,isPresent:e,anchorX:r,anchorY:l,root:u}){const f=I.useId(),g=I.useRef(null),w=I.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:s}=I.useContext(R0),S=t.props?.ref??t?.ref,A=v9(g,S);return I.useInsertionEffect(()=>{const{width:j,height:O,top:L,left:W,right:U,bottom:q}=w.current;if(e||!g.current||!j||!O)return;const Q=r==="left"?`left: ${W}`:`right: ${U}`,J=l==="bottom"?`bottom: ${q}`:`top: ${L}`;g.current.dataset.motionPopId=f;const Y=document.createElement("style");s&&(Y.nonce=s);const ie=u??document.head;return ie.appendChild(Y),Y.sheet&&Y.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${j}px !important;
            height: ${O}px !important;
            ${Q}px !important;
            ${J}px !important;
          }
        `),()=>{ie.contains(Y)&&ie.removeChild(Y)}},[e]),v.jsx(x9,{isPresent:e,childRef:g,sizeRef:w,children:I.cloneElement(t,{ref:A})})}const b9=({children:t,initial:e,isPresent:r,onExitComplete:l,custom:u,presenceAffectsLayout:f,mode:g,anchorX:w,anchorY:s,root:S})=>{const A=ip(T9),j=I.useId();let O=!0,L=I.useMemo(()=>(O=!1,{id:j,initial:e,isPresent:r,custom:u,onExitComplete:W=>{A.set(W,!0);for(const U of A.values())if(!U)return;l&&l()},register:W=>(A.set(W,!1),()=>A.delete(W))}),[r,A,l]);return f&&O&&(L={...L}),I.useMemo(()=>{A.forEach((W,U)=>A.set(U,!1))},[r]),I.useEffect(()=>{!r&&!A.size&&l&&l()},[r]),g==="popLayout"&&(t=v.jsx(w9,{isPresent:r,anchorX:w,anchorY:s,root:S,children:t})),v.jsx(P0.Provider,{value:L,children:t})};function T9(){return new Map}function HR(t=!0){const e=I.useContext(P0);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:l,register:u}=e,f=I.useId();I.useEffect(()=>{if(t)return u(f)},[t]);const g=I.useCallback(()=>t&&l&&l(f),[f,l,t]);return!r&&l?[!1,g]:[!0]}const hv=t=>t.key||"";function eA(t){const e=[];return I.Children.forEach(t,r=>{I.isValidElement(r)&&e.push(r)}),e}const Da=({children:t,custom:e,initial:r=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:f="sync",propagate:g=!1,anchorX:w="left",anchorY:s="top",root:S})=>{const[A,j]=HR(g),O=I.useMemo(()=>eA(t),[t]),L=g&&!A?[]:O.map(hv),W=I.useRef(!0),U=I.useRef(O),q=ip(()=>new Map),Q=I.useRef(new Set),[J,Y]=I.useState(O),[ie,_e]=I.useState(O);H1(()=>{W.current=!1,U.current=O;for(let Ue=0;Ue<ie.length;Ue++){const Je=hv(ie[Ue]);L.includes(Je)?(q.delete(Je),Q.current.delete(Je)):q.get(Je)!==!0&&q.set(Je,!1)}},[ie,L.length,L.join("-")]);const Se=[];if(O!==J){let Ue=[...O];for(let Je=0;Je<ie.length;Je++){const Me=ie[Je],lt=hv(Me);L.includes(lt)||(Ue.splice(Je,0,Me),Se.push(Me))}return f==="wait"&&Se.length&&(Ue=Se),_e(eA(Ue)),Y(O),null}const{forceRender:Ie}=I.useContext(G1);return v.jsx(v.Fragment,{children:ie.map(Ue=>{const Je=hv(Ue),Me=g&&!A?!1:O===ie||L.includes(Je),lt=()=>{if(Q.current.has(Je))return;if(Q.current.add(Je),q.has(Je))q.set(Je,!0);else return;let ft=!0;q.forEach(mt=>{mt||(ft=!1)}),ft&&(Ie?.(),_e(U.current),g&&j?.(),l&&l())};return v.jsx(b9,{isPresent:Me,initial:!W.current||r?void 0:!1,custom:e,presenceAffectsLayout:u,mode:f,root:S,onExitComplete:Me?void 0:lt,anchorX:w,anchorY:s,children:Ue},Je)})})},qR=I.createContext({strict:!1}),tA={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let nA=!1;function S9(){if(nA)return;const t={};for(const e in tA)t[e]={isEnabled:r=>tA[e].some(l=>!!r[l])};wR(t),nA=!0}function WR(){return S9(),u2()}function E9(t){const e=WR();for(const r in t)e[r]={...e[r],...t[r]};wR(e)}const C9=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Zv(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||C9.has(t)}let ZR=t=>!Zv(t);function k9(t){typeof t=="function"&&(ZR=e=>e.startsWith("on")?!Zv(e):t(e))}try{k9(require("@emotion/is-prop-valid").default)}catch{}function A9(t,e,r){const l={};for(const u in t)u==="values"&&typeof t.values=="object"||(ZR(u)||r===!0&&Zv(u)||!e&&!Zv(u)||t.draggable&&u.startsWith("onDrag"))&&(l[u]=t[u]);return l}const N0=I.createContext({});function P9(t,e){if(I0(t)){const{initial:r,animate:l}=t;return{initial:r===!1||Uy(r)?r:void 0,animate:Uy(l)?l:void 0}}return t.inherit!==!1?e:{}}function M9(t){const{initial:e,animate:r}=P9(t,I.useContext(N0));return I.useMemo(()=>({initial:e,animate:r}),[rA(e),rA(r)])}function rA(t){return Array.isArray(t)?t.join(" "):t}const vT=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function KR(t,e,r){for(const l in e)!ro(e[l])&&!AR(l,r)&&(t[l]=e[l])}function I9({transformTemplate:t},e){return I.useMemo(()=>{const r=vT();return yT(r,e,t),Object.assign({},r.vars,r.style)},[e])}function R9(t,e){const r=t.style||{},l={};return KR(l,r,t),Object.assign(l,I9(t,e)),l}function N9(t,e){const r={},l=R9(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=l,r}const XR=()=>({...vT(),attrs:{}});function j9(t,e,r,l){const u=I.useMemo(()=>{const f=XR();return PR(f,e,IR(l),t.transformTemplate,t.style),{...f.attrs,style:{...f.style}}},[e]);if(t.style){const f={};KR(f,t.style,t),u.style={...f,...u.style}}return u}const D9=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function xT(t){return typeof t!="string"||t.includes("-")?!1:!!(D9.indexOf(t)>-1||/[A-Z]/u.test(t))}function L9(t,e,r,{latestValues:l},u,f=!1,g){const s=(g??xT(t)?j9:N9)(e,l,u,t),S=A9(e,typeof t=="string",f),A=t!==I.Fragment?{...S,...s,ref:r}:{},{children:j}=e,O=I.useMemo(()=>ro(j)?j.get():j,[j]);return I.createElement(t,{...A,children:O})}function O9({scrapeMotionValuesFromProps:t,createRenderState:e},r,l,u){return{latestValues:z9(r,l,u,t),renderState:e()}}function z9(t,e,r,l){const u={},f=l(t,{});for(const O in f)u[O]=Ev(f[O]);let{initial:g,animate:w}=t;const s=I0(t),S=xR(t);e&&S&&!s&&t.inherit!==!1&&(g===void 0&&(g=e.initial),w===void 0&&(w=e.animate));let A=r?r.initial===!1:!1;A=A||g===!1;const j=A?w:g;if(j&&typeof j!="boolean"&&!M0(j)){const O=Array.isArray(j)?j:[j];for(let L=0;L<O.length;L++){const W=uT(t,O[L]);if(W){const{transitionEnd:U,transition:q,...Q}=W;for(const J in Q){let Y=Q[J];if(Array.isArray(Y)){const ie=A?Y.length-1:0;Y=Y[ie]}Y!==null&&(u[J]=Y)}for(const J in U)u[J]=U[J]}}}return u}const YR=t=>(e,r)=>{const l=I.useContext(N0),u=I.useContext(P0),f=()=>O9(t,e,l,u);return r?f():ip(f)},B9=YR({scrapeMotionValuesFromProps:_T,createRenderState:vT}),F9=YR({scrapeMotionValuesFromProps:RR,createRenderState:XR}),V9=Symbol.for("motionComponentSymbol");function U9(t,e,r){const l=I.useRef(r);I.useInsertionEffect(()=>{l.current=r});const u=I.useRef(null);return I.useCallback(f=>{f&&t.onMount?.(f),e&&(f?e.mount(f):e.unmount());const g=l.current;if(typeof g=="function")if(f){const w=g(f);typeof w=="function"&&(u.current=w)}else u.current?(u.current(),u.current=null):g(f);else g&&(g.current=f)},[e])}const JR=I.createContext({});function ay(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function $9(t,e,r,l,u,f){const{visualElement:g}=I.useContext(N0),w=I.useContext(qR),s=I.useContext(P0),S=I.useContext(R0).reducedMotion,A=I.useRef(null),j=I.useRef(!1);l=l||w.renderer,!A.current&&l&&(A.current=l(t,{visualState:e,parent:g,props:r,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:S,isSVG:f}),j.current&&A.current&&(A.current.manuallyAnimateOnMount=!0));const O=A.current,L=I.useContext(JR);O&&!O.projection&&u&&(O.type==="html"||O.type==="svg")&&G9(A.current,r,u,L);const W=I.useRef(!1);I.useInsertionEffect(()=>{O&&W.current&&O.update(r,s)});const U=r[oR],q=I.useRef(!!U&&!window.MotionHandoffIsComplete?.(U)&&window.MotionHasOptimisedAnimation?.(U));return H1(()=>{j.current=!0,O&&(W.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),O.scheduleRenderMicrotask(),q.current&&O.animationState&&O.animationState.animateChanges())}),I.useEffect(()=>{O&&(!q.current&&O.animationState&&O.animationState.animateChanges(),q.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(U)}),q.current=!1),O.enteringChildren=void 0)}),O}function G9(t,e,r,l){const{layoutId:u,layout:f,drag:g,dragConstraints:w,layoutScroll:s,layoutRoot:S,layoutCrossfade:A}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:QR(t.parent)),t.projection.setOptions({layoutId:u,layout:f,alwaysMeasureLayout:!!g||w&&ay(w),visualElement:t,animationType:typeof f=="string"?f:"both",initialPromotionConfig:l,crossfade:A,layoutScroll:s,layoutRoot:S})}function QR(t){if(t)return t.options.allowProjection!==!1?t.projection:QR(t.parent)}function Ew(t,{forwardMotionProps:e=!1,type:r}={},l,u){l&&E9(l);const f=r?r==="svg":xT(t),g=f?F9:B9;function w(S,A){let j;const O={...I.useContext(R0),...S,layoutId:H9(S)},{isStatic:L}=O,W=M9(S),U=g(S,L);if(!L&&bI){q9();const q=W9(O);j=q.MeasureLayout,W.visualElement=$9(t,U,O,u,q.ProjectionNode,f)}return v.jsxs(N0.Provider,{value:W,children:[j&&W.visualElement?v.jsx(j,{visualElement:W.visualElement,...O}):null,L9(t,S,U9(U,W.visualElement,A),U,L,e,f)]})}w.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const s=I.forwardRef(w);return s[V9]=t,s}function H9({layoutId:t}){const e=I.useContext(G1).id;return e&&t!==void 0?e+"-"+t:t}function q9(t,e){I.useContext(qR).strict}function W9(t){const e=WR(),{drag:r,layout:l}=e;if(!r&&!l)return{};const u={...r,...l};return{MeasureLayout:r?.isEnabled(t)||l?.isEnabled(t)?u.MeasureLayout:void 0,ProjectionNode:u.ProjectionNode}}function Z9(t,e){if(typeof Proxy>"u")return Ew;const r=new Map,l=(f,g)=>Ew(f,g,t,e),u=(f,g)=>l(f,g);return new Proxy(u,{get:(f,g)=>g==="create"?l:(r.has(g)||r.set(g,Ew(g,void 0,t,e)),r.get(g))})}const K9=(t,e)=>e.isSVG??xT(t)?new k2(e):new w2(e,{allowProjection:t!==I.Fragment});class X9 extends wh{constructor(e){super(e),e.animationState||(e.animationState=R2(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();M0(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Y9=0;class J9 extends wh{constructor(){super(...arguments),this.id=Y9++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===l)return;const u=this.node.animationState.setActive("exit",!e);r&&!e&&u.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Q9={animation:{Feature:X9},exit:{Feature:J9}};function s_(t){return{point:{x:t.pageX,y:t.pageY}}}const e7=t=>e=>pT(e)&&t(e,s_(e));function Ty(t,e,r,l){return $y(t,e,e7(r),l)}const eN=({current:t})=>t?t.ownerDocument.defaultView:null,iA=(t,e)=>Math.abs(t-e);function t7(t,e){const r=iA(t.x,e.x),l=iA(t.y,e.y);return Math.sqrt(r**2+l**2)}const sA=new Set(["auto","scroll"]);class tN{constructor(e,r,{transformPagePoint:l,contextWindow:u=window,dragSnapToOrigin:f=!1,distanceThreshold:g=3,element:w}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=L=>{this.handleScroll(L.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=kw(this.lastMoveEventInfo,this.history),W=this.startEvent!==null,U=t7(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!W&&!U)return;const{point:q}=L,{timestamp:Q}=no;this.history.push({...q,timestamp:Q});const{onStart:J,onMove:Y}=this.handlers;W||(J&&J(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),Y&&Y(this.lastMoveEvent,L)},this.handlePointerMove=(L,W)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=Cw(W,this.transformPagePoint),ri.update(this.updatePoint,!0)},this.handlePointerUp=(L,W)=>{this.end();const{onEnd:U,onSessionEnd:q,resumeAnimation:Q}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&Q&&Q(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const J=kw(L.type==="pointercancel"?this.lastMoveEventInfo:Cw(W,this.transformPagePoint),this.history);this.startEvent&&U&&U(L,J),q&&q(L,J)},!pT(e))return;this.dragSnapToOrigin=f,this.handlers=r,this.transformPagePoint=l,this.distanceThreshold=g,this.contextWindow=u||window;const s=s_(e),S=Cw(s,this.transformPagePoint),{point:A}=S,{timestamp:j}=no;this.history=[{...A,timestamp:j}];const{onSessionStart:O}=r;O&&O(e,kw(S,this.history)),this.removeListeners=n_(Ty(this.contextWindow,"pointermove",this.handlePointerMove),Ty(this.contextWindow,"pointerup",this.handlePointerUp),Ty(this.contextWindow,"pointercancel",this.handlePointerUp)),w&&this.startScrollTracking(w)}startScrollTracking(e){let r=e.parentElement;for(;r;){const l=getComputedStyle(r);(sA.has(l.overflowX)||sA.has(l.overflowY))&&this.scrollPositions.set(r,{x:r.scrollLeft,y:r.scrollTop}),r=r.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const r=this.scrollPositions.get(e);if(!r)return;const l=e===window,u=l?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},f={x:u.x-r.x,y:u.y-r.y};f.x===0&&f.y===0||(l?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=f.x,this.lastMoveEventInfo.point.y+=f.y):this.history.length>0&&(this.history[0].x-=f.x,this.history[0].y-=f.y),this.scrollPositions.set(e,u),ri.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),rd(this.updatePoint)}}function Cw(t,e){return e?{point:e(t.point)}:t}function oA(t,e){return{x:t.x-e.x,y:t.y-e.y}}function kw({point:t},e){return{point:t,delta:oA(t,nN(e)),offset:oA(t,n7(e)),velocity:r7(e,.1)}}function n7(t){return t[0]}function nN(t){return t[t.length-1]}function r7(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,l=null;const u=nN(t);for(;r>=0&&(l=t[r],!(u.timestamp-l.timestamp>Qu(e)));)r--;if(!l)return{x:0,y:0};const f=hl(u.timestamp-l.timestamp);if(f===0)return{x:0,y:0};const g={x:(u.x-l.x)/f,y:(u.y-l.y)/f};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function i7(t,{min:e,max:r},l){return e!==void 0&&t<e?t=l?vi(e,t,l.min):Math.max(t,e):r!==void 0&&t>r&&(t=l?vi(r,t,l.max):Math.min(t,r)),t}function aA(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function s7(t,{top:e,left:r,bottom:l,right:u}){return{x:aA(t.x,r,u),y:aA(t.y,e,l)}}function lA(t,e){let r=e.min-t.min,l=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,l]=[l,r]),{min:r,max:l}}function o7(t,e){return{x:lA(t.x,e.x),y:lA(t.y,e.y)}}function a7(t,e){let r=.5;const l=Go(t),u=Go(e);return u>l?r=By(e.min,e.max-l,t.min):l>u&&(r=By(t.min,t.max-u,e.min)),iu(0,1,r)}function l7(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const Ub=.35;function c7(t=Ub){return t===!1?t=0:t===!0&&(t=Ub),{x:cA(t,"left","right"),y:cA(t,"top","bottom")}}function cA(t,e,r){return{min:uA(t,e),max:uA(t,r)}}function uA(t,e){return typeof t=="number"?t:t[e]||0}const u7=new WeakMap;class d7{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ws(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:l}={}){const{presenceContext:u}=this.visualElement;if(u&&u.isPresent===!1)return;const f=j=>{r?(this.stopAnimation(),this.snapToCursor(s_(j).point)):this.pauseAnimation()},g=(j,O)=>{this.stopAnimation();const{drag:L,dragPropagation:W,onDragStart:U}=this.getProps();if(L&&!W&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Y$(L),!this.openDragLock))return;this.latestPointerEvent=j,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),cl(Q=>{let J=this.getAxisMotionValue(Q).get()||0;if(tu.test(J)){const{projection:Y}=this.visualElement;if(Y&&Y.layout){const ie=Y.layout.layoutBox[Q];ie&&(J=Go(ie)*(parseFloat(J)/100))}}this.originPoint[Q]=J}),U&&ri.postRender(()=>U(j,O)),jb(this.visualElement,"transform");const{animationState:q}=this.visualElement;q&&q.setActive("whileDrag",!0)},w=(j,O)=>{this.latestPointerEvent=j,this.latestPanInfo=O;const{dragPropagation:L,dragDirectionLock:W,onDirectionLock:U,onDrag:q}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:Q}=O;if(W&&this.currentDirection===null){this.currentDirection=h7(Q),this.currentDirection!==null&&U&&U(this.currentDirection);return}this.updateAxis("x",O.point,Q),this.updateAxis("y",O.point,Q),this.visualElement.render(),q&&q(j,O)},s=(j,O)=>{this.latestPointerEvent=j,this.latestPanInfo=O,this.stop(j,O),this.latestPointerEvent=null,this.latestPanInfo=null},S=()=>cl(j=>this.getAnimationState(j)==="paused"&&this.getAxisMotionValue(j).animation?.play()),{dragSnapToOrigin:A}=this.getProps();this.panSession=new tN(e,{onSessionStart:f,onStart:g,onMove:w,onSessionEnd:s,resumeAnimation:S},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:A,distanceThreshold:l,contextWindow:eN(this.visualElement),element:this.visualElement.current})}stop(e,r){const l=e||this.latestPointerEvent,u=r||this.latestPanInfo,f=this.isDragging;if(this.cancel(),!f||!u||!l)return;const{velocity:g}=u;this.startAnimation(g);const{onDragEnd:w}=this.getProps();w&&ri.postRender(()=>w(l,u))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,r,l){const{drag:u}=this.getProps();if(!l||!fv(e,u,this.currentDirection))return;const f=this.getAxisMotionValue(e);let g=this.originPoint[e]+l[e];this.constraints&&this.constraints[e]&&(g=i7(g,this.constraints[e],this.elastic[e])),f.set(g)}resolveConstraints(){const{dragConstraints:e,dragElastic:r}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,u=this.constraints;e&&ay(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&l?this.constraints=s7(l.layoutBox,e):this.constraints=!1,this.elastic=c7(r),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&cl(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=l7(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!ay(e))return!1;const l=e.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const f=m2(l,u.root,this.visualElement.getTransformPagePoint());let g=o7(u.layout.layoutBox,f);if(r){const w=r(h2(g));this.hasMutatedConstraints=!!w,w&&(g=TR(w))}return g}startAnimation(e){const{drag:r,dragMomentum:l,dragElastic:u,dragTransition:f,dragSnapToOrigin:g,onDragTransitionEnd:w}=this.getProps(),s=this.constraints||{},S=cl(A=>{if(!fv(A,r,this.currentDirection))return;let j=s&&s[A]||{};g&&(j={min:0,max:0});const O=u?200:1e6,L=u?40:1e7,W={type:"inertia",velocity:l?e[A]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...f,...j};return this.startAxisValueAnimation(A,W)});return Promise.all(S).then(w)}startAxisValueAnimation(e,r){const l=this.getAxisMotionValue(e);return jb(this.visualElement,e),l.start(cT(e,l,0,r,this.visualElement,!1))}stopAnimation(){cl(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){cl(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,l=this.visualElement.getProps(),u=l[r];return u||this.visualElement.getValue(e,(l.initial?l.initial[e]:void 0)||0)}snapToCursor(e){cl(r=>{const{drag:l}=this.getProps();if(!fv(r,l,this.currentDirection))return;const{projection:u}=this.visualElement,f=this.getAxisMotionValue(r);if(u&&u.layout){const{min:g,max:w}=u.layout.layoutBox[r],s=f.get()||0;f.set(e[r]-vi(g,w,.5)+s)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:l}=this.visualElement;if(!ay(r)||!l||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};cl(g=>{const w=this.getAxisMotionValue(g);if(w&&this.constraints!==!1){const s=w.get();u[g]=a7({min:s,max:s},this.constraints[g])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),cl(g=>{if(!fv(g,e,null))return;const w=this.getAxisMotionValue(g),{min:s,max:S}=this.constraints[g];w.set(vi(s,S,u[g]))})}addListeners(){if(!this.visualElement.current)return;u7.set(this.visualElement,this);const e=this.visualElement.current,r=Ty(e,"pointerdown",s=>{const{drag:S,dragListener:A=!0}=this.getProps(),j=s.target,O=j!==e&&yR(j);S&&A&&!O&&this.start(s)}),l=()=>{const{dragConstraints:s}=this.getProps();ay(s)&&s.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,f=u.addEventListener("measure",l);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),ri.read(l);const g=$y(window,"resize",()=>this.scalePositionWithinConstraints()),w=u.addEventListener("didUpdate",(({delta:s,hasLayoutChanged:S})=>{this.isDragging&&S&&(cl(A=>{const j=this.getAxisMotionValue(A);j&&(this.originPoint[A]+=s[A].translate,j.set(j.get()+s[A].translate))}),this.visualElement.render())}));return()=>{g(),r(),f(),w&&w()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:l=!1,dragPropagation:u=!1,dragConstraints:f=!1,dragElastic:g=Ub,dragMomentum:w=!0}=e;return{...e,drag:r,dragDirectionLock:l,dragPropagation:u,dragConstraints:f,dragElastic:g,dragMomentum:w}}}function fv(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function h7(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class f7 extends wh{constructor(e){super(e),this.removeGroupControls=pl,this.removeListeners=pl,this.controls=new d7(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||pl}update(){const{dragControls:e}=this.node.getProps(),{dragControls:r}=this.node.prevProps||{};e!==r&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const dA=t=>(e,r)=>{t&&ri.postRender(()=>t(e,r))};class p7 extends wh{constructor(){super(...arguments),this.removePointerDownListener=pl}onPointerDown(e){this.session=new tN(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:eN(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:l,onPanEnd:u}=this.node.getProps();return{onSessionStart:dA(e),onStart:dA(r),onMove:l,onEnd:(f,g)=>{delete this.session,u&&ri.postRender(()=>u(f,g))}}}mount(){this.removePointerDownListener=Ty(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Aw=!1;class m7 extends I.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:l,layoutId:u}=this.props,{projection:f}=e;f&&(r.group&&r.group.add(f),l&&l.register&&u&&l.register(f),Aw&&f.root.didUpdate(),f.addEventListener("animationComplete",()=>{this.safeToRemove()}),f.setOptions({...f.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Cv.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:l,drag:u,isPresent:f}=this.props,{projection:g}=l;return g&&(g.isPresent=f,e.layoutDependency!==r&&g.setOptions({...g.options,layoutDependency:r}),Aw=!0,u||e.layoutDependency!==r||r===void 0||e.isPresent!==f?g.willUpdate():this.safeToRemove(),e.isPresent!==f&&(f?g.promote():g.relegate()||ri.postRender(()=>{const w=g.getStack();(!w||!w.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),fT.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:l}=this.props,{projection:u}=e;Aw=!0,u&&(u.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(u),l&&l.deregister&&l.deregister(u))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function rN(t){const[e,r]=HR(),l=I.useContext(G1);return v.jsx(m7,{...t,layoutGroup:l,switchLayoutGroup:I.useContext(JR),isPresent:e,safeToRemove:r})}const g7={pan:{Feature:p7},drag:{Feature:f7,ProjectionNode:GR,MeasureLayout:rN}};function hA(t,e,r){const{props:l}=t;t.animationState&&l.whileHover&&t.animationState.setActive("whileHover",r==="Start");const u="onHover"+r,f=l[u];f&&ri.postRender(()=>f(e,s_(e)))}class y7 extends wh{mount(){const{current:e}=this.node;e&&(this.unmount=J$(e,(r,l)=>(hA(this.node,l,"Start"),u=>hA(this.node,u,"End"))))}unmount(){}}class _7 extends wh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=n_($y(this.node.current,"focus",()=>this.onFocus()),$y(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function fA(t,e,r){const{props:l}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&l.whileTap&&t.animationState.setActive("whileTap",r==="Start");const u="onTap"+(r==="End"?"":r),f=l[u];f&&ri.postRender(()=>f(e,s_(e)))}class v7 extends wh{mount(){const{current:e}=this.node;e&&(this.unmount=t2(e,(r,l)=>(fA(this.node,l,"Start"),(u,{success:f})=>fA(this.node,u,f?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const $b=new WeakMap,Pw=new WeakMap,x7=t=>{const e=$b.get(t.target);e&&e(t)},w7=t=>{t.forEach(x7)};function b7({root:t,...e}){const r=t||document;Pw.has(r)||Pw.set(r,{});const l=Pw.get(r),u=JSON.stringify(e);return l[u]||(l[u]=new IntersectionObserver(w7,{root:t,...e})),l[u]}function T7(t,e,r){const l=b7(e);return $b.set(t,r),l.observe(t),()=>{$b.delete(t),l.unobserve(t)}}const S7={some:0,all:1};class E7 extends wh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:l,amount:u="some",once:f}=e,g={root:r?r.current:void 0,rootMargin:l,threshold:typeof u=="number"?u:S7[u]},w=s=>{const{isIntersecting:S}=s;if(this.isInView===S||(this.isInView=S,f&&!S&&this.hasEnteredView))return;S&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",S);const{onViewportEnter:A,onViewportLeave:j}=this.node.getProps(),O=S?A:j;O&&O(s)};return T7(this.node.current,g,w)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(C7(e,r))&&this.startObserver()}unmount(){}}function C7({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const k7={inView:{Feature:E7},tap:{Feature:v7},focus:{Feature:_7},hover:{Feature:y7}},A7={layout:{ProjectionNode:GR,MeasureLayout:rN}},P7={...Q9,...k7,...g7,...A7},_r=Z9(P7,K9);function iN(t){const e=ip(()=>Kf(t)),{isStatic:r}=I.useContext(R0);if(r){const[,l]=I.useState(t);I.useEffect(()=>e.on("change",l),[])}return e}function sN(t,e){const r=iN(e()),l=()=>r.set(e());return l(),H1(()=>{const u=()=>ri.preRender(l,!1,!0),f=t.map(g=>g.on("change",u));return()=>{f.forEach(g=>g()),rd(l)}}),r}function M7(t){wy.current=[],t();const e=sN(wy.current,t);return wy.current=void 0,e}function I7(t,e,r,l){if(typeof t=="function")return M7(t);const f=typeof e=="function"?e:r2(e,r,l);return Array.isArray(t)?pA(t,f):pA([t],([g])=>f(g))}function pA(t,e){const r=ip(()=>[]);return sN(t,()=>{r.length=0;const l=t.length;for(let u=0;u<l;u++)r[u]=t[u].get();return e(r)})}const oN=I.createContext(null);function R7(t,e,r,l){if(!l)return t;const u=t.findIndex(A=>A.value===e);if(u===-1)return t;const f=l>0?1:-1,g=t[u+f];if(!g)return t;const w=t[u],s=g.layout,S=vi(s.min,s.max,.5);return f===1&&w.layout.max+r>S||f===-1&&w.layout.min+r<S?ZU(t,u,u+f):t}function N7({children:t,as:e="ul",axis:r="y",onReorder:l,values:u,...f},g){const w=ip(()=>_r[e]),s=[],S=I.useRef(!1),A=I.useRef(null),j={axis:r,groupRef:A,registerItem:(W,U)=>{const q=s.findIndex(Q=>W===Q.value);q!==-1?s[q].layout=U[r]:s.push({value:W,layout:U[r]}),s.sort(L7)},updateOrder:(W,U,q)=>{if(S.current)return;const Q=R7(s,W,U,q);s!==Q&&(S.current=!0,l(Q.map(D7).filter(J=>u.indexOf(J)!==-1)))}};I.useEffect(()=>{S.current=!1});const O=W=>{A.current=W,typeof g=="function"?g(W):g&&(g.current=W)},L={overflowAnchor:"none",...f.style};return v.jsx(w,{...f,style:L,ref:O,ignoreStrict:!0,children:v.jsx(oN.Provider,{value:j,children:t})})}const j7=I.forwardRef(N7);function D7(t){return t.value}function L7(t,e){return t.layout.min-e.layout.min}const pv=50,mA=25,O7=new Set(["auto","scroll"]),Sy=new WeakMap,Ey=new WeakMap;let ly=null;function z7(){if(ly){const t=Gb(ly,"y");t&&(Ey.delete(t),Sy.delete(t));const e=Gb(ly,"x");e&&e!==t&&(Ey.delete(e),Sy.delete(e)),ly=null}}function B7(t,e){const r=getComputedStyle(t),l=e==="x"?r.overflowX:r.overflowY;return O7.has(l)}function Gb(t,e){let r=t?.parentElement;for(;r;){if(B7(r,e))return r;r=r.parentElement}return null}function F7(t,e,r){const l=e.getBoundingClientRect(),u=r==="x"?l.left:l.top,f=r==="x"?l.right:l.bottom,g=t-u,w=f-t;if(g<pv){const s=1-g/pv;return{amount:-mA*s*s,edge:"start"}}else if(w<pv){const s=1-w/pv;return{amount:mA*s*s,edge:"end"}}return{amount:0,edge:null}}function V7(t,e,r,l){if(!t)return;ly=t;const u=Gb(t,r);if(!u)return;const f=e-(r==="x"?window.scrollX:window.scrollY),{amount:g,edge:w}=F7(f,u,r);if(w===null){Ey.delete(u),Sy.delete(u);return}if(Ey.get(u)!==w){if(!(w==="start"&&l<0||w==="end"&&l>0))return;Ey.set(u,w);const A=r==="x"?u.scrollWidth-u.clientWidth:u.scrollHeight-u.clientHeight;Sy.set(u,A)}if(g>0){const S=Sy.get(u);if((r==="x"?u.scrollLeft:u.scrollTop)>=S)return}r==="x"?u.scrollLeft+=g:u.scrollTop+=g}function gA(t,e=0){return ro(t)?t:iN(e)}function U7({children:t,style:e={},value:r,as:l="li",onDrag:u,onDragEnd:f,layout:g=!0,...w},s){const S=ip(()=>_r[l]),A=I.useContext(oN),j={x:gA(e.x),y:gA(e.y)},O=I7([j.x,j.y],([Q,J])=>Q||J?1:"unset"),{axis:L,registerItem:W,updateOrder:U,groupRef:q}=A;return v.jsx(S,{drag:L,...w,dragSnapToOrigin:!0,style:{...e,x:j.x,y:j.y,zIndex:O},layout:g,onDrag:(Q,J)=>{const{velocity:Y,point:ie}=J,_e=j[L].get();U(r,_e,Y[L]),V7(q.current,ie[L],L,Y[L]),u&&u(Q,J)},onDragEnd:(Q,J)=>{z7(),f&&f(Q,J)},onLayoutMeasure:Q=>{W(r,Q)},ref:s,ignoreStrict:!0,children:t})}const $7=I.forwardRef(U7);var G7=Symbol.for("react.lazy"),Kv=l0[" use ".trim().toString()];function H7(t){return typeof t=="object"&&t!==null&&"then"in t}function aN(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===G7&&"_payload"in t&&H7(t._payload)}function wT(t){const e=W7(t),r=I.forwardRef((l,u)=>{let{children:f,...g}=l;aN(f)&&typeof Kv=="function"&&(f=Kv(f._payload));const w=I.Children.toArray(f),s=w.find(K7);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}var q7=wT("Slot");function W7(t){const e=I.forwardRef((r,l)=>{let{children:u,...f}=r;if(aN(u)&&typeof Kv=="function"&&(u=Kv(u._payload)),I.isValidElement(u)){const g=Y7(u),w=X7(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Z7=Symbol("radix.slottable");function K7(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Z7}function X7(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function Y7(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}const J7=Jy("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),vn=I.forwardRef(({className:t,variant:e,size:r,asChild:l=!1,...u},f)=>{const g=l?q7:"button";return v.jsx(g,{className:cn(J7({variant:e,size:r,className:t})),ref:f,...u})});vn.displayName="Button";const Q7=({size:t=20,className:e=""})=>v.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:v.jsx("path",{d:"M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"})}),eG=()=>{const t=rp(),e=()=>{const l=document.getElementById("features-section");l&&l.scrollIntoView({behavior:"smooth"})},r=[{icon:v.jsx(p0,{className:"w-8 h-8 text-blue-500"}),title:"Tm g cng c",desc:"Hiu  nh ca bn: G 'i', 'kht', 'ht tin'... h thng s t ng gi  qun n, cafe, ATM ph hp."},{icon:v.jsx(HP,{className:"w-8 h-8 text-green-500"}),title:"Bn  sinh vin",desc:"D liu c ti u ring cho sinh vin: V tr ging ng, th vin, nh tr, v cc im check-in hot nht."},{icon:v.jsx(fh,{className:"w-8 h-8 text-orange-500"}),title:"Sn Voucher",desc:"Lin kt vi cc ca hng quanh trng  tung ra cc m gim gi c quyn ch dnh cho sinh vin."},{icon:v.jsx(Uf,{className:"w-8 h-8 text-yellow-500"}),title:"Review C Tm",desc:"Xem nh gi thc t t cng ng sinh vin trc khi quyt nh 'xung tin' i n hay i chi."}];return v.jsxs("div",{className:"min-h-screen bg-white text-gray-800 font-sans selection:bg-green-100",children:[v.jsx("nav",{className:"fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-md z-50 border-b border-gray-100",children:v.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>t("/"),children:[v.jsx("img",{src:"/logo.png",alt:"ThodiaUni",className:"w-8 h-8 object-contain rounded"}),v.jsx("span",{className:"font-bold text-xl tracking-tight text-green-700",children:"ThodiaUni"})]}),v.jsxs(vn,{variant:"ghost",onClick:()=>t("/"),className:"gap-2 hover:bg-green-50 text-green-700",children:[v.jsx(h0,{size:18}),"Quay li Bn "]})]})}),v.jsxs("section",{className:"pt-32 pb-20 px-4 text-center relative overflow-hidden",children:[v.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-green-200/30 rounded-full blur-3xl -z-10"}),v.jsxs(_r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-3xl mx-auto",children:[v.jsx("span",{className:"px-3 py-1 rounded-full bg-green-100 text-green-700 text-sm font-bold mb-4 inline-block",children:"Dnh ring cho Sinh Vin"}),v.jsxs("h1",{className:"text-5xl md:text-6xl font-black text-gray-900 mb-6 leading-tight",children:["Th a Ca ",v.jsx("span",{className:"text-green-600",children:"Sinh Vin"})]}),v.jsx("p",{className:"text-xl text-gray-600 mb-8 leading-relaxed",children:'Bn l tn sinh vin cn b ng? Hay "cu" sinh vin nhng tra no cng hi "Hm nay n g?". ThodiaUni chnh l ngi bn ng hnh gip bn lm ch khu vc quanh trng.'}),v.jsxs("div",{className:"flex justify-center gap-4",children:[v.jsx(vn,{size:"lg",className:"bg-green-600 hover:bg-green-700 text-white h-12 px-8 rounded-full text-lg shadow-lg shadow-green-600/20",onClick:()=>t("/"),children:"Khm ph ngay"}),v.jsx(vn,{variant:"outline",size:"lg",className:"h-12 px-8 rounded-full text-lg border-2 hover:bg-gray-50",onClick:e,children:"Tm hiu thm"})]})]})]}),v.jsx("section",{id:"features-section",className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Ti sao chn ThodiaUni?"}),v.jsx("p",{className:"text-gray-500",children:"Tt c nhng g bn cn  sng st qua 4 nm i hc."})]}),v.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:r.map((l,u)=>v.jsxs(_r.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{delay:u*.1},viewport:{once:!0},className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[v.jsx("div",{className:"mb-4 bg-gray-50 w-14 h-14 rounded-xl flex items-center justify-center",children:l.icon}),v.jsx("h3",{className:"text-xl font-bold mb-2 text-gray-800",children:l.title}),v.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:l.desc})]},u))})]})}),v.jsx("section",{className:"py-20 px-4",children:v.jsxs("div",{className:"max-w-4xl mx-auto bg-green-600 rounded-3xl p-8 md:p-12 text-center text-white relative overflow-hidden",children:[v.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),v.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full translate-y-1/2 -translate-x-1/2"}),v.jsx(ih,{className:"w-12 h-12 mx-auto mb-6 text-green-200 animate-pulse"}),v.jsx("h2",{className:"text-3xl font-bold mb-4",children:"S Mnh Ca Chng Ti"}),v.jsx("p",{className:"text-lg text-green-100 mb-8 leading-relaxed",children:'"Chng ti tin rng i sinh vin l khong thi gian p nht. ThodiaUni c to ra  gip bn bt lo lng v chuyn n , i li,  dnh trn tm tr cho vic hc tp v tri nghim tui tr."'}),v.jsxs("div",{className:"flex flex-wrap justify-center gap-6 text-sm font-medium text-green-200",children:[v.jsxs("span",{className:"flex items-center gap-2",children:[v.jsx(Wi,{size:16})," Lng i Hc"]}),v.jsxs("span",{className:"flex items-center gap-2",children:[v.jsx(x5,{size:16})," Kt ni cng ng"]})]})]})}),v.jsxs("footer",{className:"bg-gray-900 text-gray-400 py-12 px-4",children:[v.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx("img",{src:"/logo.png",alt:"ThodiaUni",className:"w-8 h-8 object-contain rounded"}),v.jsx("span",{className:"text-white font-bold text-xl",children:"ThodiaUni"})]}),v.jsxs("div",{className:"text-sm flex flex-col md:flex-row gap-4 md:gap-8 items-center font-medium",children:[v.jsxs("div",{className:"flex items-center gap-2 hover:text-white transition-colors cursor-default",children:[v.jsx(y1,{size:16,className:"text-gray-500"}),v.jsx("span",{children:"contact@thodiauni.com"})]}),v.jsxs("div",{className:"flex items-center gap-2 hover:text-white transition-colors cursor-default",children:[v.jsx(Qy,{size:16,className:"text-gray-500"}),v.jsx("span",{children:"086 299 3382"})]})]}),v.jsxs("div",{className:"flex gap-6 items-center",children:[v.jsx("a",{href:"https://facebook.com/thodiauni",target:"_blank",rel:"noopener noreferrer",className:"hover:text-blue-500 transition-colors flex items-center gap-1 group",title:"Facebook",children:v.jsx(y5,{size:24,className:"group-hover:scale-110 transition-transform"})}),v.jsx("a",{href:"https://tiktok.com/@thodiauni",target:"_blank",rel:"noopener noreferrer",className:"hover:text-pink-500 transition-colors flex items-center gap-1 group",title:"TikTok",children:v.jsx(Q7,{size:22,className:"group-hover:scale-110 transition-transform"})})]})]}),v.jsx("div",{className:"max-w-6xl mx-auto mt-8 pt-8 border-t border-gray-800 text-center text-xs text-gray-600",children:" 2026 ThodiaUni Project. Built with passion."})]})]})};function Mw({className:t,...e}){return v.jsx("div",{className:cn("animate-pulse rounded-md bg-muted",t),...e})}var tG=I.createContext(void 0);function o_(t){const e=I.useContext(tG);return t||e||"ltr"}function Hb(t,[e,r]){return Math.min(r,Math.max(e,t))}function nG(t,e){return I.useReducer((r,l)=>e[r][l]??r,t)}var bT="ScrollArea",[lN]=gl(bT),[rG,yl]=lN(bT),cN=I.forwardRef((t,e)=>{const{__scopeScrollArea:r,type:l="hover",dir:u,scrollHideDelay:f=600,...g}=t,[w,s]=I.useState(null),[S,A]=I.useState(null),[j,O]=I.useState(null),[L,W]=I.useState(null),[U,q]=I.useState(null),[Q,J]=I.useState(0),[Y,ie]=I.useState(0),[_e,Se]=I.useState(!1),[Ie,Ue]=I.useState(!1),Je=ar(e,lt=>s(lt)),Me=o_(u);return v.jsx(rG,{scope:r,type:l,dir:Me,scrollHideDelay:f,scrollArea:w,viewport:S,onViewportChange:A,content:j,onContentChange:O,scrollbarX:L,onScrollbarXChange:W,scrollbarXEnabled:_e,onScrollbarXEnabledChange:Se,scrollbarY:U,onScrollbarYChange:q,scrollbarYEnabled:Ie,onScrollbarYEnabledChange:Ue,onCornerWidthChange:J,onCornerHeightChange:ie,children:v.jsx(In.div,{dir:Me,...g,ref:Je,style:{position:"relative","--radix-scroll-area-corner-width":Q+"px","--radix-scroll-area-corner-height":Y+"px",...t.style}})})});cN.displayName=bT;var uN="ScrollAreaViewport",dN=I.forwardRef((t,e)=>{const{__scopeScrollArea:r,children:l,nonce:u,...f}=t,g=yl(uN,r),w=I.useRef(null),s=ar(e,w,g.onViewportChange);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:u}),v.jsx(In.div,{"data-radix-scroll-area-viewport":"",...f,ref:s,style:{overflowX:g.scrollbarXEnabled?"scroll":"hidden",overflowY:g.scrollbarYEnabled?"scroll":"hidden",...t.style},children:v.jsx("div",{ref:g.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});dN.displayName=uN;var au="ScrollAreaScrollbar",TT=I.forwardRef((t,e)=>{const{forceMount:r,...l}=t,u=yl(au,t.__scopeScrollArea),{onScrollbarXEnabledChange:f,onScrollbarYEnabledChange:g}=u,w=t.orientation==="horizontal";return I.useEffect(()=>(w?f(!0):g(!0),()=>{w?f(!1):g(!1)}),[w,f,g]),u.type==="hover"?v.jsx(iG,{...l,ref:e,forceMount:r}):u.type==="scroll"?v.jsx(sG,{...l,ref:e,forceMount:r}):u.type==="auto"?v.jsx(hN,{...l,ref:e,forceMount:r}):u.type==="always"?v.jsx(ST,{...l,ref:e}):null});TT.displayName=au;var iG=I.forwardRef((t,e)=>{const{forceMount:r,...l}=t,u=yl(au,t.__scopeScrollArea),[f,g]=I.useState(!1);return I.useEffect(()=>{const w=u.scrollArea;let s=0;if(w){const S=()=>{window.clearTimeout(s),g(!0)},A=()=>{s=window.setTimeout(()=>g(!1),u.scrollHideDelay)};return w.addEventListener("pointerenter",S),w.addEventListener("pointerleave",A),()=>{window.clearTimeout(s),w.removeEventListener("pointerenter",S),w.removeEventListener("pointerleave",A)}}},[u.scrollArea,u.scrollHideDelay]),v.jsx(Ho,{present:r||f,children:v.jsx(hN,{"data-state":f?"visible":"hidden",...l,ref:e})})}),sG=I.forwardRef((t,e)=>{const{forceMount:r,...l}=t,u=yl(au,t.__scopeScrollArea),f=t.orientation==="horizontal",g=D0(()=>s("SCROLL_END"),100),[w,s]=nG("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return I.useEffect(()=>{if(w==="idle"){const S=window.setTimeout(()=>s("HIDE"),u.scrollHideDelay);return()=>window.clearTimeout(S)}},[w,u.scrollHideDelay,s]),I.useEffect(()=>{const S=u.viewport,A=f?"scrollLeft":"scrollTop";if(S){let j=S[A];const O=()=>{const L=S[A];j!==L&&(s("SCROLL"),g()),j=L};return S.addEventListener("scroll",O),()=>S.removeEventListener("scroll",O)}},[u.viewport,f,s,g]),v.jsx(Ho,{present:r||w!=="hidden",children:v.jsx(ST,{"data-state":w==="hidden"?"hidden":"visible",...l,ref:e,onPointerEnter:Xt(t.onPointerEnter,()=>s("POINTER_ENTER")),onPointerLeave:Xt(t.onPointerLeave,()=>s("POINTER_LEAVE"))})})}),hN=I.forwardRef((t,e)=>{const r=yl(au,t.__scopeScrollArea),{forceMount:l,...u}=t,[f,g]=I.useState(!1),w=t.orientation==="horizontal",s=D0(()=>{if(r.viewport){const S=r.viewport.offsetWidth<r.viewport.scrollWidth,A=r.viewport.offsetHeight<r.viewport.scrollHeight;g(w?S:A)}},10);return Bm(r.viewport,s),Bm(r.content,s),v.jsx(Ho,{present:l||f,children:v.jsx(ST,{"data-state":f?"visible":"hidden",...u,ref:e})})}),ST=I.forwardRef((t,e)=>{const{orientation:r="vertical",...l}=t,u=yl(au,t.__scopeScrollArea),f=I.useRef(null),g=I.useRef(0),[w,s]=I.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),S=yN(w.viewport,w.content),A={...l,sizes:w,onSizesChange:s,hasThumb:S>0&&S<1,onThumbChange:O=>f.current=O,onThumbPointerUp:()=>g.current=0,onThumbPointerDown:O=>g.current=O};function j(O,L){return dG(O,g.current,w,L)}return r==="horizontal"?v.jsx(oG,{...A,ref:e,onThumbPositionChange:()=>{if(u.viewport&&f.current){const O=u.viewport.scrollLeft,L=yA(O,w,u.dir);f.current.style.transform=`translate3d(${L}px, 0, 0)`}},onWheelScroll:O=>{u.viewport&&(u.viewport.scrollLeft=O)},onDragScroll:O=>{u.viewport&&(u.viewport.scrollLeft=j(O,u.dir))}}):r==="vertical"?v.jsx(aG,{...A,ref:e,onThumbPositionChange:()=>{if(u.viewport&&f.current){const O=u.viewport.scrollTop,L=yA(O,w);f.current.style.transform=`translate3d(0, ${L}px, 0)`}},onWheelScroll:O=>{u.viewport&&(u.viewport.scrollTop=O)},onDragScroll:O=>{u.viewport&&(u.viewport.scrollTop=j(O))}}):null}),oG=I.forwardRef((t,e)=>{const{sizes:r,onSizesChange:l,...u}=t,f=yl(au,t.__scopeScrollArea),[g,w]=I.useState(),s=I.useRef(null),S=ar(e,s,f.onScrollbarXChange);return I.useEffect(()=>{s.current&&w(getComputedStyle(s.current))},[s]),v.jsx(pN,{"data-orientation":"horizontal",...u,ref:S,sizes:r,style:{bottom:0,left:f.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:f.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":j0(r)+"px",...t.style},onThumbPointerDown:A=>t.onThumbPointerDown(A.x),onDragScroll:A=>t.onDragScroll(A.x),onWheelScroll:(A,j)=>{if(f.viewport){const O=f.viewport.scrollLeft+A.deltaX;t.onWheelScroll(O),vN(O,j)&&A.preventDefault()}},onResize:()=>{s.current&&f.viewport&&g&&l({content:f.viewport.scrollWidth,viewport:f.viewport.offsetWidth,scrollbar:{size:s.current.clientWidth,paddingStart:Yv(g.paddingLeft),paddingEnd:Yv(g.paddingRight)}})}})}),aG=I.forwardRef((t,e)=>{const{sizes:r,onSizesChange:l,...u}=t,f=yl(au,t.__scopeScrollArea),[g,w]=I.useState(),s=I.useRef(null),S=ar(e,s,f.onScrollbarYChange);return I.useEffect(()=>{s.current&&w(getComputedStyle(s.current))},[s]),v.jsx(pN,{"data-orientation":"vertical",...u,ref:S,sizes:r,style:{top:0,right:f.dir==="ltr"?0:void 0,left:f.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":j0(r)+"px",...t.style},onThumbPointerDown:A=>t.onThumbPointerDown(A.y),onDragScroll:A=>t.onDragScroll(A.y),onWheelScroll:(A,j)=>{if(f.viewport){const O=f.viewport.scrollTop+A.deltaY;t.onWheelScroll(O),vN(O,j)&&A.preventDefault()}},onResize:()=>{s.current&&f.viewport&&g&&l({content:f.viewport.scrollHeight,viewport:f.viewport.offsetHeight,scrollbar:{size:s.current.clientHeight,paddingStart:Yv(g.paddingTop),paddingEnd:Yv(g.paddingBottom)}})}})}),[lG,fN]=lN(au),pN=I.forwardRef((t,e)=>{const{__scopeScrollArea:r,sizes:l,hasThumb:u,onThumbChange:f,onThumbPointerUp:g,onThumbPointerDown:w,onThumbPositionChange:s,onDragScroll:S,onWheelScroll:A,onResize:j,...O}=t,L=yl(au,r),[W,U]=I.useState(null),q=ar(e,Je=>U(Je)),Q=I.useRef(null),J=I.useRef(""),Y=L.viewport,ie=l.content-l.viewport,_e=$i(A),Se=$i(s),Ie=D0(j,10);function Ue(Je){if(Q.current){const Me=Je.clientX-Q.current.left,lt=Je.clientY-Q.current.top;S({x:Me,y:lt})}}return I.useEffect(()=>{const Je=Me=>{const lt=Me.target;W?.contains(lt)&&_e(Me,ie)};return document.addEventListener("wheel",Je,{passive:!1}),()=>document.removeEventListener("wheel",Je,{passive:!1})},[Y,W,ie,_e]),I.useEffect(Se,[l,Se]),Bm(W,Ie),Bm(L.content,Ie),v.jsx(lG,{scope:r,scrollbar:W,hasThumb:u,onThumbChange:$i(f),onThumbPointerUp:$i(g),onThumbPositionChange:Se,onThumbPointerDown:$i(w),children:v.jsx(In.div,{...O,ref:q,style:{position:"absolute",...O.style},onPointerDown:Xt(t.onPointerDown,Je=>{Je.button===0&&(Je.target.setPointerCapture(Je.pointerId),Q.current=W.getBoundingClientRect(),J.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",L.viewport&&(L.viewport.style.scrollBehavior="auto"),Ue(Je))}),onPointerMove:Xt(t.onPointerMove,Ue),onPointerUp:Xt(t.onPointerUp,Je=>{const Me=Je.target;Me.hasPointerCapture(Je.pointerId)&&Me.releasePointerCapture(Je.pointerId),document.body.style.webkitUserSelect=J.current,L.viewport&&(L.viewport.style.scrollBehavior=""),Q.current=null})})})}),Xv="ScrollAreaThumb",mN=I.forwardRef((t,e)=>{const{forceMount:r,...l}=t,u=fN(Xv,t.__scopeScrollArea);return v.jsx(Ho,{present:r||u.hasThumb,children:v.jsx(cG,{ref:e,...l})})}),cG=I.forwardRef((t,e)=>{const{__scopeScrollArea:r,style:l,...u}=t,f=yl(Xv,r),g=fN(Xv,r),{onThumbPositionChange:w}=g,s=ar(e,j=>g.onThumbChange(j)),S=I.useRef(void 0),A=D0(()=>{S.current&&(S.current(),S.current=void 0)},100);return I.useEffect(()=>{const j=f.viewport;if(j){const O=()=>{if(A(),!S.current){const L=hG(j,w);S.current=L,w()}};return w(),j.addEventListener("scroll",O),()=>j.removeEventListener("scroll",O)}},[f.viewport,A,w]),v.jsx(In.div,{"data-state":g.hasThumb?"visible":"hidden",...u,ref:s,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:Xt(t.onPointerDownCapture,j=>{const L=j.target.getBoundingClientRect(),W=j.clientX-L.left,U=j.clientY-L.top;g.onThumbPointerDown({x:W,y:U})}),onPointerUp:Xt(t.onPointerUp,g.onThumbPointerUp)})});mN.displayName=Xv;var ET="ScrollAreaCorner",gN=I.forwardRef((t,e)=>{const r=yl(ET,t.__scopeScrollArea),l=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&l?v.jsx(uG,{...t,ref:e}):null});gN.displayName=ET;var uG=I.forwardRef((t,e)=>{const{__scopeScrollArea:r,...l}=t,u=yl(ET,r),[f,g]=I.useState(0),[w,s]=I.useState(0),S=!!(f&&w);return Bm(u.scrollbarX,()=>{const A=u.scrollbarX?.offsetHeight||0;u.onCornerHeightChange(A),s(A)}),Bm(u.scrollbarY,()=>{const A=u.scrollbarY?.offsetWidth||0;u.onCornerWidthChange(A),g(A)}),S?v.jsx(In.div,{...l,ref:e,style:{width:f,height:w,position:"absolute",right:u.dir==="ltr"?0:void 0,left:u.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function Yv(t){return t?parseInt(t,10):0}function yN(t,e){const r=t/e;return isNaN(r)?0:r}function j0(t){const e=yN(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=(t.scrollbar.size-r)*e;return Math.max(l,18)}function dG(t,e,r,l="ltr"){const u=j0(r),f=u/2,g=e||f,w=u-g,s=r.scrollbar.paddingStart+g,S=r.scrollbar.size-r.scrollbar.paddingEnd-w,A=r.content-r.viewport,j=l==="ltr"?[0,A]:[A*-1,0];return _N([s,S],j)(t)}function yA(t,e,r="ltr"){const l=j0(e),u=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,f=e.scrollbar.size-u,g=e.content-e.viewport,w=f-l,s=r==="ltr"?[0,g]:[g*-1,0],S=Hb(t,s);return _N([0,g],[0,w])(S)}function _N(t,e){return r=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const l=(e[1]-e[0])/(t[1]-t[0]);return e[0]+l*(r-t[0])}}function vN(t,e){return t>0&&t<e}var hG=(t,e=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},l=0;return(function u(){const f={left:t.scrollLeft,top:t.scrollTop},g=r.left!==f.left,w=r.top!==f.top;(g||w)&&e(),r=f,l=window.requestAnimationFrame(u)})(),()=>window.cancelAnimationFrame(l)};function D0(t,e){const r=$i(t),l=I.useRef(0);return I.useEffect(()=>()=>window.clearTimeout(l.current),[]),I.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(r,e)},[r,e])}function Bm(t,e){const r=$i(e);Zi(()=>{let l=0;if(t){const u=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(r)});return u.observe(t),()=>{window.cancelAnimationFrame(l),u.unobserve(t)}}},[t,r])}var xN=cN,fG=dN,pG=gN;const L0=I.forwardRef(({className:t,children:e,...r},l)=>v.jsxs(xN,{ref:l,className:cn("relative overflow-hidden",t),...r,children:[v.jsx(fG,{className:"h-full w-full rounded-[inherit]",children:e}),v.jsx(wN,{}),v.jsx(pG,{})]}));L0.displayName=xN.displayName;const wN=I.forwardRef(({className:t,orientation:e="vertical",...r},l)=>v.jsx(TT,{ref:l,orientation:e,className:cn("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:v.jsx(mN,{className:"relative flex-1 rounded-full bg-border"})}));wN.displayName=TT.displayName;const mG=(t,e,r,l)=>{const f=(r-t)*(Math.PI/180),g=(l-e)*(Math.PI/180),w=Math.sin(f/2)*Math.sin(f/2)+Math.cos(t*(Math.PI/180))*Math.cos(r*(Math.PI/180))*Math.sin(g/2)*Math.sin(g/2);return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},gG=`
  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .animate-scroll {
    display: flex;
    white-space: nowrap;
    animation: scroll-left 10s linear infinite;
  }
  .group:hover .animate-scroll {
    animation-play-state: paused;
  }
`,_A=({text:t,className:e})=>t.length>30?v.jsx("div",{className:"overflow-hidden w-full mask-gradient",children:v.jsxs("div",{className:`animate-scroll w-fit ${e}`,children:[v.jsx("span",{className:"mr-8",children:t}),v.jsx("span",{className:"mr-8",children:t})]})}):v.jsx("h4",{className:`truncate ${e}`,children:t}),vA=[{id:"food",icon:v.jsx(m0,{className:"w-3.5 h-3.5"}),label:"n ung"},{id:"cafe",icon:v.jsx(h1,{className:"w-3.5 h-3.5"}),label:"Caf"},{id:"entertainment",icon:v.jsx(f1,{className:"w-3.5 h-3.5"}),label:"Vui chi"},{id:"lecture_hall",icon:v.jsx(p1,{className:"w-3.5 h-3.5"}),label:"Ging ng"},{id:"office",icon:v.jsx(d1,{className:"w-3.5 h-3.5"}),label:"Vn phng"},{id:"housing",icon:v.jsx(m1,{className:"w-3.5 h-3.5"}),label:"Nh tr"},{id:"job",icon:v.jsx(lh,{className:"w-3.5 h-3.5"}),label:"Vic lm"},{id:"building",icon:v.jsx(Dm,{className:"w-3.5 h-3.5"}),label:"Ta nh"},{id:"checkin",icon:v.jsx(WP,{className:"w-3.5 h-3.5"}),label:"Check-in"}],yG=({onSelectLocation:t,userLocation:e})=>{const{language:r}=da(),[l,u]=I.useState(!1),[f,g]=I.useState("food"),[w,s]=I.useState({}),[S,A]=I.useState(!0);I.useEffect(()=>{(async()=>{A(!0);const{data:W,error:U}=await Wt.from("user_stores").select("*").eq("status","approved");if(U||!W){console.error("Error fetching stores:",U),A(!1);return}let q=W.map(J=>{let Y=0;return e&&(Y=mG(e.lat,e.lng,J.lat,J.lng)),{...J,distance:Y}});q.sort((J,Y)=>J.is_premium&&!Y.is_premium?-1:!J.is_premium&&Y.is_premium?1:(J.distance||0)-(Y.distance||0));const Q={};vA.forEach(J=>Q[J.id]=[]),q.forEach(J=>{Q[J.category]&&Q[J.category].length<10&&Q[J.category].push(J)}),s(Q),A(!1)})()},[e]);const j=L=>{const W={...L,id:L.id,name:r==="en"&&L.name_en?L.name_en:L.name_vi,nameVi:L.name_vi,address:r==="en"&&L.address_en?L.address_en:L.address_vi,category:L.category,lat:L.lat,lng:L.lng,image:L.image_url};t(W),u(!1)},O=w[f]||[];return v.jsxs("div",{className:"absolute top-[112px] left-3 z-[30] flex flex-col items-start gap-2",children:[v.jsx("style",{children:gG}),v.jsxs("button",{onClick:()=>u(!l),className:"bg-white/95 backdrop-blur-md shadow-lg border rounded-full px-3 py-2 text-xs font-bold flex items-center gap-2 hover:bg-white transition-all text-primary group",children:[v.jsx("div",{className:"bg-primary/10 p-1 rounded-full group-hover:bg-primary/20 transition-colors",children:v.jsx(Yc,{className:"w-3.5 h-3.5 text-primary"})}),r==="vi"?"Gi  hm nay":"Suggestions",l?v.jsx(Lm,{className:"w-3 h-3 text-gray-400"}):v.jsx(Hf,{className:"w-3 h-3 text-gray-400"})]}),v.jsx(Da,{children:l&&v.jsxs(_r.div,{initial:{opacity:0,scale:.95,y:-10,height:0},animate:{opacity:1,scale:1,y:0,height:"auto"},exit:{opacity:0,scale:.95,y:-10,height:0},className:"w-[320px] max-h-[60vh] bg-white/95 backdrop-blur-md rounded-xl shadow-2xl border overflow-hidden flex flex-col",children:[v.jsx("div",{className:"border-b bg-gray-50/50",children:v.jsxs("div",{className:"flex overflow-x-auto p-1.5 gap-1.5",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[v.jsx("style",{children:".flex::-webkit-scrollbar { display: none; }"}),vA.map(L=>{const W=f===L.id;return v.jsxs("button",{onClick:()=>g(L.id),className:cn("flex-none flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-full text-[11px] font-bold transition-all whitespace-nowrap",W?"bg-white text-primary shadow-sm border ring-1 ring-gray-100":"text-gray-500 hover:bg-gray-200/50 hover:text-gray-700"),children:[L.icon,L.label]},L.id)})]})}),v.jsx(L0,{className:"flex-1 w-full bg-white/50",children:v.jsxs("div",{className:"p-2 space-y-2",children:[S?[1,2,3,4].map(L=>v.jsxs("div",{className:"flex gap-3 items-center p-2",children:[v.jsx(Mw,{className:"w-16 h-16 rounded-lg flex-shrink-0"}),v.jsxs("div",{className:"space-y-2 flex-1",children:[v.jsx(Mw,{className:"h-3 w-3/4"}),v.jsx(Mw,{className:"h-2 w-1/2"})]})]},L)):O.length===0?v.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-400 gap-2",children:[v.jsx(Yc,{className:"w-8 h-8 opacity-20"}),v.jsx("span",{className:"text-xs",children:"Cha c a im no"})]}):O.map(L=>{const W=r==="en"&&L.name_en?L.name_en:L.name_vi,U=r==="en"&&L.address_en?L.address_en:L.address_vi,q=L.is_premium,Q=L.distance?L.distance<1?`${(L.distance*1e3).toFixed(0)}m`:`${L.distance.toFixed(1)}km`:"";return v.jsxs(_r.div,{layoutId:String(L.id),onClick:()=>j(L),className:cn("flex gap-3 p-2 rounded-lg transition-all cursor-pointer border group relative",q?"bg-gradient-to-r from-yellow-50 to-white border-yellow-200 hover:border-yellow-300":"bg-white/40 border-transparent hover:bg-white hover:shadow-md hover:border-gray-100"),children:[v.jsxs("div",{className:"w-14 h-14 flex-shrink-0 relative",children:[v.jsx("img",{src:L.image_url||"https://placehold.co/100x100?text=Store",className:"w-full h-full object-cover rounded-md bg-gray-200 border",onError:J=>J.currentTarget.src="https://placehold.co/100x100?text=Store"}),q&&v.jsx("div",{className:"absolute -top-2 -left-2",children:v.jsxs("span",{className:"relative flex h-3 w-3",children:[v.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),v.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]})})]}),v.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-0.5 overflow-hidden",children:[v.jsxs("div",{className:"flex justify-between items-start",children:[v.jsx(_A,{text:W,className:cn("text-xs font-bold transition-colors w-[85%]",q?"text-yellow-800":"text-gray-800 group-hover:text-primary")}),Q&&v.jsx("span",{className:"text-[9px] font-bold text-blue-500 bg-blue-50 px-1 rounded flex items-center whitespace-nowrap",children:Q})]}),v.jsxs("div",{className:"flex items-start gap-1 text-gray-500 overflow-hidden",children:[v.jsx(Wi,{className:"w-2.5 h-2.5 mt-0.5 flex-shrink-0"}),v.jsx(_A,{text:U,className:"text-[10px] leading-tight text-gray-500"})]}),q&&v.jsx("div",{className:"flex gap-1 mt-1",children:v.jsxs("span",{className:"text-[9px] text-yellow-700 font-bold bg-yellow-100 px-1.5 rounded-full border border-yellow-200 flex items-center gap-1 shadow-sm",children:[v.jsx(fl,{className:"w-2 h-2 fill-yellow-700"}),"c  xut"]})})]})]},L.id)}),v.jsx("div",{className:"h-4"})]})})]})})]})};var kv={exports:{}},_G=kv.exports,xA;function vG(){return xA||(xA=1,(function(t,e){var r={};(function(l,u){t.exports=u()})(_G,(function(){var l,u,f;function g(s,S){if(!l)l=S;else if(!u)u=S;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",j={};l(j),f=S(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}g(["exports"],(function(s){var S=typeof self<"u"?self:{},A="2.15.0";let j;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(j==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{j=i}}return j},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const i=new URL(O.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},L={supported:!1,testSupport:function(i){!q&&U&&(Q?J(i):W=i)}};let W,U,q=!1,Q=!1;function J(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,U),i.isContextLost())return;L.supported=!0}catch{}i.deleteTexture(n),q=!0}S.document&&(U=S.document.createElement("img"),U.onload=function(){W&&J(W),W=null,Q=!0},U.onerror=function(){q=!0,W=null},U.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Y="01";function ie(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var _e=Se;function Se(i,n,o,c){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=o,this.p2y=c}Se.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,c=0;c<8;c++){var p=this.sampleCurveX(o)-i;if(Math.abs(p)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=p/_}var b=0,C=1;for(o=i,c=0;c<20&&(p=this.sampleCurveX(o),!(Math.abs(p-i)<n));c++)i>p?b=o:C=o,o=.5*(C-b)+b;return o},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var Ie=ie(_e),Ue=Je;function Je(i,n){this.x=i,this.y=n}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,o=i.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),o=Math.sin(i),c=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=c,this},_rotateAround:function(i,n){var o=Math.cos(i),c=Math.sin(i),p=n.y+c*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-c*(this.y-n.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(i){return i instanceof Je?i:Array.isArray(i)?new Je(i[0],i[1]):i};var Me=ie(Ue);const lt=Math.PI/180,ft=180/Math.PI;function mt(i){return i*lt}function gt(i){return i*ft}const Lt=[[0,0],[1,0],[1,1],[0,1]];function it(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,o=n*i;return 4*(i<.5?o:3*(i-n)+o-.75)}function We(i,n,o,c){const p=new Ie(i,n,o,c);return function(_){return p.solve(_)}}const Le=We(.25,.1,.25,1);function we(i,n,o){return Math.min(o,Math.max(n,i))}function st(i,n,o){return(o=we((o-i)/(n-i),0,1))*o*(3-2*o)}function ke(i,n,o){const c=o-n,p=((i-n)%c+c)%c+n;return p===n?o:p}function Ve(i,n,o){if(!i.length)return o(null,[]);let c=i.length;const p=new Array(i.length);let _=null;i.forEach(((b,C)=>{n(b,((P,M)=>{P&&(_=P),p[C]=M,--c==0&&o(_,p)}))}))}function bt(i){const n=[];for(const o in i)n.push(i[o]);return n}function wt(i,...n){for(const o of n)for(const c in o)i[c]=o[c];return i}let Yt=1;function Mt(){return Yt++}function ct(){return(function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)})()}function Nt(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function xn(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function un(i,n){i.forEach((o=>{n[o]&&(n[o]=n[o].bind(n))}))}function Rn(i,n){return i.indexOf(n,i.length-n.length)!==-1}function sn(i,n,o){const c={};for(const p in i)c[p]=n.call(this,i[p],p,i);return c}function kr(i,n,o){const c={};for(const p in i)n.call(o||this,i[p],p,i)&&(c[p]=i[p]);return c}function vr(i){return Array.isArray(i)?i.map(vr):typeof i=="object"&&i?sn(i,vr):i}const Es={};function Jn(i){Es[i]||(typeof console<"u"&&console.warn(i),Es[i]=!0)}function Ar(i,n,o){return(o.y-i.y)*(n.x-i.x)>(n.y-i.y)*(o.x-i.x)}function io(i){let n=0;for(let o,c,p=0,_=i.length,b=_-1;p<_;b=p++)o=i[p],c=i[b],n+=(c.x-o.x)*(o.y+c.y);return n}function wi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xr(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((o,c,p,_)=>{const b=p||_;return n[c]=!b||b.toLowerCase(),""})),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let ii=null;function cs(i){if(ii==null){const n=i.navigator?i.navigator.userAgent:null;ii=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ii}function Ki(i){try{const n=S[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function zs(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}const Cs="mapbox-tiles";let Gr=500,us=50,bi,Bs;function Xi(){try{return S.caches}catch{}}function Mi(){Xi()&&!bi&&(bi=S.caches.open(Cs))}function ko(i){const n=i.indexOf("?");if(n<0)return i;const o=(function(p){const _=p.indexOf("?");return _>0?p.slice(_+1).split("&"):[]})(i),c=o.filter((p=>{const _=p.split("=");return _[0]==="language"||_[0]==="worldview"}));return c.length?`${i.slice(0,n)}?${c.join("&")}`:i.slice(0,n)}let so=1/0;const Ii={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ii);class ds extends Error{constructor(n,o,c){o===401&&ze(c)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const si=wi()?()=>self.worker&&self.worker.referrer:()=>(S.location.protocol==="blob:"?S.parent:S).location.href,Fs=function(i,n){if(!(/^file:/.test(o=i.url)||/^file:/.test(si())&&!/^\w+:/.test(o))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return(function(c,p){const _=new S.AbortController,b=new S.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:si(),referrerPolicy:c.referrerPolicy,signal:_.signal});let C=!1,P=!1;const M=(z=b.url).indexOf("sku=")>0&&ze(z);var z;c.type==="json"&&b.headers.set("Accept","application/json");const V=(K,X,ne)=>{if(P)return;if(K&&K.message!=="SecurityError"&&Jn(K.toString()),X&&ne)return $(X);const le=Date.now();S.fetch(b).then((me=>{if(me.ok){const Ce=M?me.clone():null;return $(me,Ce,le)}return p(new ds(me.statusText,me.status,c.url))})).catch((me=>{me.name!=="AbortError"&&p(new Error(`${me.message} ${c.url}`))}))},$=(K,X,ne)=>{(c.type==="arrayBuffer"?K.arrayBuffer():c.type==="json"?K.json():K.text()).then((le=>{P||(X&&ne&&(function(me,Ce,ge){if(Mi(),!bi)return;const Ee={status:Ce.status,statusText:Ce.statusText,headers:new S.Headers};Ce.headers.forEach(((et,Ke)=>Ee.headers.set(Ke,et)));const Re=Xr(Ce.headers.get("Cache-Control")||"");if(Re["no-store"])return;Re["max-age"]&&Ee.headers.set("Expires",new Date(ge+1e3*Re["max-age"]).toUTCString());const Pe=Ee.headers.get("Expires");Pe&&(new Date(Pe).getTime()-ge<42e4||(function(et,Ke){if(Bs===void 0)try{new Response(new ReadableStream),Bs=!0}catch{Bs=!1}Bs?Ke(et.body):et.blob().then(Ke)})(Ce,(et=>{const Ke=new S.Response(et,Ee);Mi(),bi&&bi.then((pt=>pt.put(ko(me.url),Ke))).catch((pt=>Jn(pt.message)))})))})(b,X,ne),C=!0,p(null,le,K.headers.get("Cache-Control"),K.headers.get("Expires")))})).catch((le=>{P||p(new Error(le.message))}))};return M?(function(K,X){if(Mi(),!bi)return X(null);const ne=ko(K.url);bi.then((le=>{le.match(ne).then((me=>{const Ce=(function(ge){if(!ge)return!1;const Ee=new Date(ge.headers.get("Expires")||0),Re=Xr(ge.headers.get("Cache-Control")||"");return Ee>Date.now()&&!Re["no-cache"]})(me);le.delete(ne),Ce&&le.put(ne,me.clone()),X(null,me,Ce)})).catch(X)})).catch(X)})(b,V):V(null,null),{cancel:()=>{P=!0,C||_.abort()}}})(i,n);if(wi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var o;return(function(c,p){const _=new S.XMLHttpRequest;_.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const b in c.headers)_.setRequestHeader(b,c.headers[b]);return c.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=c.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let b=_.response;if(c.type==="json")try{b=JSON.parse(_.response)}catch(C){return p(C)}p(null,b,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else p(new ds(_.statusText,_.status,c.url))},_.send(c.body),{cancel:()=>_.abort()}})(i,n)},oo=function(i,n){return Fs(wt(i,{type:"arrayBuffer"}),n)};function Ao(i){const n=S.document.createElement("a");return n.href=i,n.protocol===S.document.location.protocol&&n.host===S.document.location.host}const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let re,se;re=[],se=0;const de=function(i,n){if(L.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),se>=O.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return re.push(_),_}se++;let o=!1;const c=()=>{if(!o)for(o=!0,se--;re.length&&se<O.MAX_PARALLEL_IMAGE_REQUESTS;){const _=re.shift(),{requestParameters:b,callback:C,cancelled:P}=_;P||(_.cancel=de(b,C).cancel)}},p=oo(i,((_,b,C,P)=>{c(),_?n(_):b&&(S.createImageBitmap?(function(M,z){const V=new S.Blob([new Uint8Array(M)],{type:"image/png"});S.createImageBitmap(V).then(($=>{z(null,$)})).catch(($=>{z(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(b,((M,z)=>n(M,z,C,P))):(function(M,z){const V=new S.Image,$=S.URL;V.onload=()=>{z(null,V),$.revokeObjectURL(V.src),V.onload=null,S.requestAnimationFrame((()=>{V.src=be}))},V.onerror=()=>z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const K=new S.Blob([new Uint8Array(M)],{type:"image/png"});V.src=M.byteLength?$.createObjectURL(K):be})(b,((M,z)=>n(M,z,C,P))))}));return{cancel:()=>{p.cancel(),c()}}},Te="NO_ACCESS_TOKEN";function xe(i){return i.indexOf("mapbox:")===0}function ze(i){return O.API_URL_REGEX.test(i)}function Be(i){return O.API_CDN_URL_REGEX.test(i)}function Oe(i){return O.API_STYLE_REGEX.test(i)&&!Ze(i)}function Ze(i){return O.API_SPRITE_REGEX.test(i)}const St=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function jt(i){const n=i.match(St);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function xt(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const bn="mapbox.eventData";function Pn(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(n[1]).split("").map((o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch{return null}}class An{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Pn(O.ACCESS_TOKEN);let c="";return c=o&&o.u?S.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,((p,_)=>String.fromCharCode(+("0x"+_))))):O.ACCESS_TOKEN||"",n?`${bn}.${n}:${c}`:`${bn}:${c}`}fetchEventData(){const n=Ki("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{const p=S.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));const _=S.localStorage.getItem(c);_&&(this.anonId=_)}catch{Jn("Unable to read from LocalStorage")}}saveEventData(){const n=Ki("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{S.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Jn("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,c,p){if(!O.EVENTS_URL)return;const _=jt(O.EVENTS_URL);_.params.push(`access_token=${p||O.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(n).toISOString()},C=o?wt(b,o):b,P={url:xt(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=(function(M,z){return Fs(wt(M,{method:"POST"}),z)})(P,(M=>{this.pendingRequest=null,c(M),this.saveEventData(),this.processRequests(p)}))}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const Nn=new class extends An{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some((o=>xe(o)||ze(o)))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Pn(O.ACCESS_TOKEN),o=n?n.u:O.ACCESS_TOKEN;let c=o!==this.eventData.tokenU;xn(this.anonId)||(this.anonId=ct(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),b=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;c=c||C>=1||C<-1||_.getDate()!==b.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Y,"enabled.telemetry":!1,userId:this.anonId},(_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=o)}),i):this.processRequests()}},qn=Nn.postTurnstileEvent.bind(Nn),Br=new class extends An{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,o,c){this.skuToken=n,this.errorCb=c,O.EVENTS_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Te)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),xn(this.anonId)||(this.anonId=ct()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Y,skuToken:this.skuToken,userId:this.anonId},(c=>{c?this.errorCb(c):n&&(this.success[n]=!0)}),i))}},oi=Br.postMapLoadEvent.bind(Br),Yi=new class extends An{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){O.EVENTS_URL&&(i||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),c=(function(p){const _=S.performance.getEntriesByType("resource"),b=S.performance.getEntriesByType("mark"),C=(function($){const K={};if($){for(const X in $)if(X!=="other")for(const ne of $[X]){const le=`${X}ResolveRangeMin`,me=`${X}ResolveRangeMax`,Ce=`${X}RequestCount`,ge=`${X}RequestCachedCount`;K[le]=Math.min(K[le]||1/0,ne.startTime),K[me]=Math.max(K[me]||-1/0,ne.responseEnd);const Ee=Re=>{K[Re]===void 0&&(K[Re]=0),++K[Re]};ne.transferSize!==void 0&&ne.transferSize===0&&Ee(ge),Ee(Ce)}}return K})((function($,K){const X={};if($)for(const ne of $){const le=K(ne);X[le]===void 0&&(X[le]=[]),X[le].push(ne)}return X})(_,Sh)),P=S.devicePixelRatio,M=S.navigator.connection||S.navigator.mozConnection||S.navigator.webkitConnection,z={counters:[],metadata:[],attributes:[]},V=($,K,X)=>{X!=null&&$.push({name:K,value:X.toString()})};for(const $ in C)V(z.counters,$,C[$]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(V(z.counters,"interactionRangeMin",p.interactionRange[0]),V(z.counters,"interactionRangeMax",p.interactionRange[1])),b)for(const $ of Object.keys(vl)){const K=vl[$],X=b.find((ne=>ne.name===K));X&&V(z.counters,K,X.startTime)}return V(z.counters,"visibilityHidden",p.visibilityHidden),V(z.attributes,"style",(function($){if($)for(const K of $){const X=K.name.split("?")[0];if(Oe(X)){const ne=X.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}})(_)),V(z.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),V(z.attributes,"fogEnabled",p.fogEnabled?"true":"false"),V(z.attributes,"projection",p.projection),V(z.attributes,"zoom",p.zoom),V(z.metadata,"devicePixelRatio",P),V(z.metadata,"connectionEffectiveType",M?M.effectiveType:void 0),V(z.metadata,"navigatorUserAgent",S.navigator.userAgent),V(z.metadata,"screenWidth",S.screen.width),V(z.metadata,"screenHeight",S.screen.height),V(z.metadata,"windowWidth",S.innerWidth),V(z.metadata,"windowHeight",S.innerHeight),V(z.metadata,"mapWidth",p.width/P),V(z.metadata,"mapHeight",p.height/P),V(z.metadata,"webglRenderer",p.renderer),V(z.metadata,"webglVendor",p.vendor),V(z.metadata,"sdkVersion",A),V(z.metadata,"sdkIdentifier","mapbox-gl-js"),z})(o);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(n,c,(()=>{}),i)}},Dr=Yi.postPerformanceEvent.bind(Yi),Po=new class extends An{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,o,c){if(!O.API_URL||!O.SESSION_PATH)return;const p=jt(O.API_URL+O.SESSION_PATH);p.params.push(`sku=${n||""}`),p.params.push(`access_token=${c||O.ACCESS_TOKEN||""}`);const _={url:xt(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=(function(b,C){return Fs(wt(b,{method:"GET"}),C)})(_,(b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(c)}))}getSessionAPI(i,n,o,c){this.skuToken=n,this.errorCb=c,O.SESSION_PATH&&O.API_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(Te)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,(c=>{c?this.errorCb(c):n&&(this.success[n]=!0)}),i)}},Ti=Po.getSessionAPI.bind(Po),hs=new Set,vl={create:"create",load:"load",fullLoad:"fullLoad"},lp={mark(i){S.performance.mark(i)},measure(i,n,o){S.performance.measure(i,n,o)}};function Sh(i){const n=i.name.split("?")[0];return Be(n)&&n.includes("mapbox-gl.js")?"javascript":Be(n)&&n.includes("mapbox-gl.css")?"css":(function(o){return O.API_FONTS_REGEX.test(o)})(n)?"fontRange":Ze(n)?"sprite":Oe(n)?"style":(function(o){return O.API_TILEJSON_REGEX.test(o)})(n)?"tilejson":"other"}const sr=S.performance;function Eh(i){const n=i?i.url.toString():void 0;return sr.getEntriesByName(n)}let lu,Hr,od,ao;const Wo={now:()=>od!==void 0?od:S.performance.now(),setNow(i){od=i},restoreNow(){od=void 0},frame(i){const n=S.requestAnimationFrame(i);return{cancel:()=>S.cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:o,height:c}=i;ao||(ao=S.document.createElement("canvas"));const p=ao.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(o>ao.width||c>ao.height)&&(ao.width=o,ao.height=c),p.clearRect(-n,-n,o+2*n,c+2*n),p.drawImage(i,0,0,o,c),p.getImageData(-n,-n,o+2*n,c+2*n)},resolveURL:i=>(lu||(lu=S.document.createElement("a")),lu.href=i,lu.href),get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(Hr==null&&(Hr=S.matchMedia("(prefers-reduced-motion: reduce)")),Hr.matches)}};function sc(i,n,o){o[i]&&o[i].indexOf(n)!==-1||(o[i]=o[i]||[],o[i].push(n))}function Ch(i,n,o){if(o&&o[i]){const c=o[i].indexOf(n);c!==-1&&o[i].splice(c,1)}}class za{constructor(n,o={}){wt(this,o),this.type=n}}class lo extends za{constructor(n,o={}){super("error",wt({error:n},o))}}class ks{on(n,o){return this._listeners=this._listeners||{},sc(n,o,this._listeners),this}off(n,o){return Ch(n,o,this._listeners),Ch(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},sc(n,o,this._oneTimeListeners),this):new Promise((c=>this.once(n,c)))}fire(n,o){typeof n=="string"&&(n=new za(n,o||{}));const c=n.type;if(this.listens(c)){n.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const C of p)C.call(this,n);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const C of _)Ch(c,C,this._oneTimeListeners),C.call(this,n);const b=this._eventedParent;b&&(wt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(n))}else n instanceof lo&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Si(i,...n){for(const o of n)for(const c in o)i[c]=o[c];return i}function ai(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ri(i){if(Array.isArray(i))return i.map(Ri);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const o in i)n[o]=Ri(i[o]);return n}return ai(i)}class cp extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}var Vs=cp;class oc{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[c,p]of o)this.bindings[c]=p}concat(n){return new oc(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var ac=oc;const fa={kind:"null"},Gt={kind:"number"},Zn={kind:"string"},$n={kind:"boolean"},As={kind:"color"},Us={kind:"object"},jn={kind:"value"},$s={kind:"collator"},xl={kind:"formatted"},or={kind:"resolvedImage"};function Gs(i,n){return{kind:"array",itemType:i,N:n}}function Pr(i){if(i.kind==="array"){const n=Pr(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const ad=[fa,Gt,Zn,$n,As,xl,Us,Gs(jn),or];function Zo(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Zo(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const o of ad)if(!Zo(o,n))return null}}return`Expected ${Pr(i)} but found ${Pr(n)} instead.`}function lc(i,n){return n.some((o=>o.kind===i.kind))}function cc(i,n){return n.some((o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i))}var cu,uu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function co(i){return(i=Math.round(i))<0?0:i>255?255:i}function uo(i){return co(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Mo(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function Ko(i,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(n-i)*o*6:2*o<1?n:3*o<2?i+(n-i)*(2/3-o)*6:i}try{cu={}.parseCSSColor=function(i){var n,o=i.replace(/ /g,"").toLowerCase();if(o in uu)return uu[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var c=o.indexOf("("),p=o.indexOf(")");if(c!==-1&&p+1===o.length){var _=o.substr(0,c),b=o.substr(c+1,p-(c+1)).split(","),C=1;switch(_){case"rgba":if(b.length!==4)return null;C=Mo(b.pop());case"rgb":return b.length!==3?null:[uo(b[0]),uo(b[1]),uo(b[2]),C];case"hsla":if(b.length!==4)return null;C=Mo(b.pop());case"hsl":if(b.length!==3)return null;var P=(parseFloat(b[0])%360+360)%360/360,M=Mo(b[1]),z=Mo(b[2]),V=z<=.5?z*(M+1):z+M-z*M,$=2*z-V;return[co(255*Ko($,V,P+1/3)),co(255*Ko($,V,P)),co(255*Ko($,V,P-1/3)),C];default:return null}}return null}}catch{}class Ni{constructor(n,o,c,p=1){this.r=n,this.g=o,this.b=c,this.a=p}static parse(n){if(!n)return;if(n instanceof Ni)return n;if(typeof n!="string")return;const o=cu(n);return o?new Ni(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,c,p]=this.toArray();return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(c)},${p})`}toArray(){const{r:n,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*n/p,255*o/p,255*c/p,p]}toArray01(){const{r:n,g:o,b:c,a:p}=this;return p===0?[0,0,0,0]:[n/p,o/p,c/p,p]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:c,a:p}=this;return[n,o,c,p]}}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1),Ni.blue=new Ni(0,0,1,1);var xr=Ni;class kh{constructor(n,o,c){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ld{constructor(n,o,c,p,_){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=c,this.fontStack=p,this.textColor=_}}class ji{constructor(n){this.sections=n}static fromString(n){return new ji([new ld(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((n=>n.text.length!==0||n.image&&n.image.name.length!==0))}static factory(n){return n instanceof ji?n:ji.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map((n=>n.text)).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.name]);continue}n.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toArray())),n.push(c)}return n}}class ho{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new ho({name:n,available:!1}):null}serialize(){return["image",this.name]}}function Ah(i,n,o,c){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,n,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,n,o,c]:[i,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ba(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof xr||i instanceof kh||i instanceof ji||i instanceof ho)return!0;if(Array.isArray(i)){for(const n of i)if(!Ba(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!Ba(i[n]))return!1;return!0}return!1}function Ur(i){if(i===null)return fa;if(typeof i=="string")return Zn;if(typeof i=="boolean")return $n;if(typeof i=="number")return Gt;if(i instanceof xr)return As;if(i instanceof kh)return $s;if(i instanceof ji)return xl;if(i instanceof ho)return or;if(Array.isArray(i)){const n=i.length;let o;for(const c of i){const p=Ur(c);if(o){if(o===p)continue;o=jn;break}o=p}return Gs(o||jn,n)}return Us}function du(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof xr||i instanceof ji||i instanceof ho?i.toString():JSON.stringify(i)}class wl{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ba(n[1]))return o.error("invalid value");const c=n[1];let p=Ur(c);const _=o.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new wl(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xr?["rgba"].concat(this.value.toArray()):this.value instanceof ji?this.value.serialize():this.value}}var Io=wl,Yr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const uc={string:Zn,number:Gt,boolean:$n,object:Us};class Ph{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let c,p=1;const _=n[0];if(_==="array"){let C,P;if(n.length>2){const M=n[1];if(typeof M!="string"||!(M in uc)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);C=uc[M],p++}else C=jn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);P=n[2],p++}c=Gs(C,P)}else c=uc[_];const b=[];for(;p<n.length;p++){const C=o.parse(n[p],p,jn);if(!C)return null;b.push(C)}return new Ph(c,b)}evaluate(n){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(n);if(!Zo(this.type,Ur(c)))return c;if(o===this.args.length-1)throw new Yr(`Expected value to be of type ${Pr(this.type)}, but found ${Pr(Ur(c))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const c=n.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);const p=n.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map((c=>c.serialize())))}}var pa=Ph;class Xo{constructor(n){this.type=xl,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=n.length-1;++b){const C=n[b];if(_&&typeof C=="object"&&!Array.isArray(C)){_=!1;let P=null;if(C["font-scale"]&&(P=o.parse(C["font-scale"],1,Gt),!P))return null;let M=null;if(C["text-font"]&&(M=o.parse(C["text-font"],1,Gs(Zn)),!M))return null;let z=null;if(C["text-color"]&&(z=o.parse(C["text-color"],1,As),!z))return null;const V=p[p.length-1];V.scale=P,V.font=M,V.textColor=z}else{const P=o.parse(n[b],1,jn);if(!P)return null;const M=P.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:P,scale:null,font:null,textColor:null})}}return new Xo(p)}evaluate(n){return new ji(this.sections.map((o=>{const c=o.content.evaluate(n);return Ur(c)===or?new ld("",c,null,null,null):new ld(du(c),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)})))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),n.push(c)}return n}}class bl{constructor(n){this.type=or,this.input=n}static parse(n,o){if(n.length!==2)return o.error("Expected two arguments.");const c=o.parse(n[1],1,Zn);return c?new bl(c):o.error("No image name provided.")}evaluate(n){const o=this.input.evaluate(n),c=ho.fromString(o);return c&&n.availableImages&&(c.available=n.availableImages.indexOf(o)>-1),c}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Mh={"to-boolean":$n,"to-color":As,"to-number":Gt,"to-string":Zn};class cd{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[0];if((c==="to-boolean"||c==="to-string")&&n.length!==2)return o.error("Expected one argument.");const p=Mh[c],_=[];for(let b=1;b<n.length;b++){const C=o.parse(n[b],b,jn);if(!C)return null;_.push(C)}return new cd(p,_)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,c;for(const p of this.args){if(o=p.evaluate(n),c=null,o instanceof xr)return o;if(typeof o=="string"){const _=n.parseColor(o);if(_)return _}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ah(o[0],o[1],o[2],o[3]),!c))return new xr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Yr(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const c of this.args){if(o=c.evaluate(n),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new Yr(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?ji.fromString(du(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ho.fromString(du(this.args[0].evaluate(n))):du(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new bl(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild((o=>{n.push(o.serialize())})),n}}var Hs=cd;const fo=["Unknown","Point","LineString","Polygon"];var dc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-i[0])+this.featureDistanceData.bearing[1]*(c*n-i[1])}return 0}parseColor(i){let n=this._parseColorCache[i];return n||(n=this._parseColorCache[i]=xr.parse(i)),n}};class Fa{constructor(n,o,c,p){this.name=n,this.type=o,this._evaluate=c,this.args=p}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((n=>n.serialize())))}static parse(n,o){const c=n[0],p=Fa.definitions[c];if(!p)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,C=b.filter((([M])=>!Array.isArray(M)||M.length===n.length-1));let P=null;for(const[M,z]of C){P=new jh(o.registry,o.path,null,o.scope);const V=[];let $=!1;for(let K=1;K<n.length;K++){const X=n[K],ne=Array.isArray(M)?M[K-1]:M.type,le=P.parse(X,1+V.length,ne);if(!le){$=!0;break}V.push(le)}if(!$)if(Array.isArray(M)&&M.length!==V.length)P.error(`Expected ${M.length} arguments, but found ${V.length} instead.`);else{for(let K=0;K<V.length;K++){const X=Array.isArray(M)?M[K]:M.type,ne=V[K];P.concat(K+1).checkSubtype(X,ne.type)}if(P.errors.length===0)return new Fa(c,_,z,V)}}if(C.length===1)o.errors.push(...P.errors);else{const M=(C.length?C:b).map((([V])=>{return $=V,Array.isArray($)?`(${$.map(Pr).join(", ")})`:`(${Pr($.type)}...)`;var $})).join(" | "),z=[];for(let V=1;V<n.length;V++){const $=o.parse(n[V],1+z.length);if(!$)return null;z.push(Pr($.type))}o.error(`Expected arguments of type ${M}, but found (${z.join(", ")}) instead.`)}return null}static register(n,o){Fa.definitions=o;for(const c in o)n[c]=Fa}}var po=Fa;class Va{constructor(n,o,c){this.type=$s,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const p=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,$n);if(!p)return null;const _=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,$n);if(!_)return null;let b=null;return c.locale&&(b=o.parse(c.locale,1,Zn),!b)?null:new Va(p,_,b)}evaluate(n){return new kh(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const Yo=8192;function Ji(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function Ro(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Tl(i,n){const o=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(o*p*Yo),Math.round(c*p*Yo)]}function hc(i,n,o){const c=i[0]-n[0],p=i[1]-n[1],_=i[0]-o[0],b=i[1]-o[1];return c*b-_*p==0&&c*_<=0&&p*b<=0}function ud(i,n){let o=!1;for(let b=0,C=n.length;b<C;b++){const P=n[b];for(let M=0,z=P.length;M<z-1;M++){if(hc(i,P[M],P[M+1]))return!1;(p=P[M])[1]>(c=i)[1]!=(_=P[M+1])[1]>c[1]&&c[0]<(_[0]-p[0])*(c[1]-p[1])/(_[1]-p[1])+p[0]&&(o=!o)}}var c,p,_;return o}function hu(i,n){for(let o=0;o<n.length;o++)if(ud(i,n[o]))return!0;return!1}function fu(i,n,o,c){const p=c[0]-o[0],_=c[1]-o[1],b=(i[0]-o[0])*_-p*(i[1]-o[1]),C=(n[0]-o[0])*_-p*(n[1]-o[1]);return b>0&&C<0||b<0&&C>0}function Jo(i,n,o){for(const M of o)for(let z=0;z<M.length-1;++z)if((C=[(b=M[z+1])[0]-(_=M[z])[0],b[1]-_[1]])[0]*(P=[(p=n)[0]-(c=i)[0],p[1]-c[1]])[1]-C[1]*P[0]!=0&&fu(c,p,_,b)&&fu(_,b,c,p))return!0;var c,p,_,b,C,P;return!1}function er(i,n){for(let o=0;o<i.length;++o)if(!ud(i[o],n))return!1;for(let o=0;o<i.length-1;++o)if(Jo(i[o],i[o+1],n))return!1;return!0}function up(i,n){for(let o=0;o<n.length;o++)if(er(i,n[o]))return!0;return!1}function Ih(i,n,o){const c=[];for(let p=0;p<i.length;p++){const _=[];for(let b=0;b<i[p].length;b++){const C=Tl(i[p][b],o);Ji(n,C),_.push(C)}c.push(_)}return c}function dp(i,n,o){const c=[];for(let p=0;p<i.length;p++){const _=Ih(i[p],n,o);c.push(_)}return c}function Rh(i,n,o,c){if(i[0]<o[0]||i[0]>o[2]){const p=.5*c;let _=i[0]-o[0]>p?-c:o[0]-i[0]>p?c:0;_===0&&(_=i[0]-o[2]>p?-c:o[2]-i[0]>p?c:0),i[0]+=_}Ji(n,i)}function dd(i,n,o,c){const p=Math.pow(2,c.z)*Yo,_=[c.x*Yo,c.y*Yo],b=[];if(!i)return b;for(const C of i)for(const P of C){const M=[P.x+_[0],P.y+_[1]];Rh(M,n,o,p),b.push(M)}return b}function Nh(i,n,o,c){const p=Math.pow(2,c.z)*Yo,_=[c.x*Yo,c.y*Yo],b=[];if(!i)return b;for(const P of i){const M=[];for(const z of P){const V=[z.x+_[0],z.y+_[1]];Ji(n,V),M.push(V)}b.push(M)}if(n[2]-n[0]<=p/2){(C=n)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const P of b)for(const M of P)Rh(M,n,o,p)}var C;return b}class fc{constructor(n,o){this.type=$n,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ba(n[1])){const c=n[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const _=c.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new fc(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new fc(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new fc(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(o,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(!b)return!1;if(c.type==="Polygon"){const C=Ih(c.coordinates,_,b),P=dd(o.geometry(),p,_,b);if(!Ro(p,_))return!1;for(const M of P)if(!ud(M,C))return!1}if(c.type==="MultiPolygon"){const C=dp(c.coordinates,_,b),P=dd(o.geometry(),p,_,b);if(!Ro(p,_))return!1;for(const M of P)if(!hu(M,C))return!1}return!0})(n,this.geometries);if(n.geometryType()==="LineString")return(function(o,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(!b)return!1;if(c.type==="Polygon"){const C=Ih(c.coordinates,_,b),P=Nh(o.geometry(),p,_,b);if(!Ro(p,_))return!1;for(const M of P)if(!er(M,C))return!1}if(c.type==="MultiPolygon"){const C=dp(c.coordinates,_,b),P=Nh(o.geometry(),p,_,b);if(!Ro(p,_))return!1;for(const M of P)if(!up(M,C))return!1}return!0})(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var hd=fc;function pc(i){if(i instanceof po&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof hd)return!1;let n=!0;return i.eachChild((o=>{n&&!pc(o)&&(n=!1)})),n}function ma(i){if(i instanceof po&&i.name==="feature-state")return!1;let n=!0;return i.eachChild((o=>{n&&!ma(o)&&(n=!1)})),n}function Ua(i,n){if(i instanceof po&&n.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild((c=>{o&&!Ua(c,n)&&(o=!1)})),o}class fd{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=n[1];return o.scope.has(c)?new fd(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hp=fd;class pu{constructor(n,o=[],c,p=new ac,_=[]){this.registry=n,this.path=o,this.key=o.map((b=>`[${b}]`)).join(""),this.scope=p,this.errors=_,this.expectedType=c}parse(n,o,c,p,_={}){return o?this.concat(o,c,p)._parse(n,_):this._parse(n,_)}_parse(n,o){function c(p,_,b){return b==="assert"?new pa(_,[p]):b==="coerce"?new Hs(_,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=n[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let b=_.parse(n,this);if(!b)return null;if(this.expectedType){const C=this.expectedType,P=b.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||P.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(C,P))return null}else b=c(b,C,o.typeAnnotation||"coerce");else b=c(b,C,o.typeAnnotation||"assert")}if(!(b instanceof Io)&&b.type.kind!=="resolvedImage"&&mu(b)){const C=new dc;try{b=new Io(b.type,b.evaluate(C))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,c){const p=typeof n=="number"?this.path.concat(n):this.path,_=c?this.scope.concat(c):this.scope;return new pu(this.registry,p,o||null,_,this.errors)}error(n,...o){const c=`${this.key}${o.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Vs(c,n))}checkSubtype(n,o){const c=Zo(n,o);return c&&this.error(c),c}}var jh=pu;function mu(i){if(i instanceof hp)return mu(i.boundExpression);if(i instanceof po&&i.name==="error"||i instanceof Va||i instanceof hd)return!1;const n=i instanceof Hs||i instanceof pa;let o=!0;return i.eachChild((c=>{o=n?o&&mu(c):o&&c instanceof Io})),!!o&&pc(i)&&Ua(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function pd(i,n){const o=i.length-1;let c,p,_=0,b=o,C=0;for(;_<=b;)if(C=Math.floor((_+b)/2),c=i[C],p=i[C+1],c<=n){if(C===o||n<p)return C;_=C+1}else{if(!(c>n))throw new Yr("Input is not a number.");b=C-1}return 0}class md{constructor(n,o,c){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[p,_]of c)this.labels.push(p),this.outputs.push(_)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(n[1],1,Gt);if(!c)return null;const p=[];let _=null;o.expectedType&&o.expectedType.kind!=="value"&&(_=o.expectedType);for(let b=1;b<n.length;b+=2){const C=b===1?-1/0:n[b],P=n[b+1],M=b,z=b+1;if(typeof C!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=C)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const V=o.parse(P,z,_);if(!V)return null;_=_||V.type,p.push([C,V])}return new md(_,c,p)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const p=this.input.evaluate(n);if(p<=o[0])return c[0].evaluate(n);const _=o.length;return p>=o[_-1]?c[_-1].evaluate(n):c[pd(o,p)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}var Dh=md;function Qn(i,n,o){return i*(1-o)+n*o}var gu=Object.freeze({__proto__:null,array:function(i,n,o){return i.map(((c,p)=>Qn(c,n[p],o)))},color:function(i,n,o){return new xr(Qn(i.r,n.r,o),Qn(i.g,n.g,o),Qn(i.b,n.b,o),Qn(i.a,n.a,o))},number:Qn});const fp=.95047,Lh=1.08883,pp=4/29,Sl=6/29,Oh=3*Sl*Sl,ig=Sl*Sl*Sl,zh=Math.PI/180,yu=180/Math.PI;function Bh(i){return i>ig?Math.pow(i,1/3):i/Oh+pp}function gd(i){return i>Sl?i*i*i:Oh*(i-pp)}function yd(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function _u(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Fh(i){const n=_u(i.r),o=_u(i.g),c=_u(i.b),p=Bh((.4124564*n+.3575761*o+.1804375*c)/fp),_=Bh((.2126729*n+.7151522*o+.072175*c)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-Bh((.0193339*n+.119192*o+.9503041*c)/Lh)),alpha:i.a}}function Vh(i){let n=(i.l+16)/116,o=isNaN(i.a)?n:n+i.a/500,c=isNaN(i.b)?n:n-i.b/200;return n=1*gd(n),o=fp*gd(o),c=Lh*gd(c),new xr(yd(3.2404542*o-1.5371385*n-.4985314*c),yd(-.969266*o+1.8760108*n+.041556*c),yd(.0556434*o-.2040259*n+1.0572252*c),i.alpha)}function mc(i,n,o){const c=n-i;return i+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const vu={forward:Fh,reverse:Vh,interpolate:function(i,n,o){return{l:Qn(i.l,n.l,o),a:Qn(i.a,n.a,o),b:Qn(i.b,n.b,o),alpha:Qn(i.alpha,n.alpha,o)}}},gc={forward:function(i){const{l:n,a:o,b:c}=Fh(i),p=Math.atan2(c,o)*yu;return{h:p<0?p+360:p,c:Math.sqrt(o*o+c*c),l:n,alpha:i.a}},reverse:function(i){const n=i.h*zh,o=i.c;return Vh({l:i.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:i.alpha})},interpolate:function(i,n,o){return{h:mc(i.h,n.h,o),c:Qn(i.c,n.c,o),l:Qn(i.l,n.l,o),alpha:Qn(i.alpha,n.alpha,o)}}};var Uh=Object.freeze({__proto__:null,hcl:gc,lab:vu});class yc{constructor(n,o,c,p,_){this.type=n,this.operator=o,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[b,C]of _)this.labels.push(b),this.outputs.push(C)}static interpolationFactor(n,o,c,p){let _=0;if(n.name==="exponential")_=_d(o,n.base,c,p);else if(n.name==="linear")_=_d(o,1,c,p);else if(n.name==="cubic-bezier"){const b=n.controlPoints;_=new Ie(b[0],b[1],b[2],b[3]).solve(_d(o,1,c,p))}return _}static parse(n,o){let[c,p,_,...b]=n;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some((z=>typeof z!="number"||z<0||z>1)))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(_=o.parse(_,2,Gt),!_)return null;const C=[];let P=null;c==="interpolate-hcl"||c==="interpolate-lab"?P=As:o.expectedType&&o.expectedType.kind!=="value"&&(P=o.expectedType);for(let M=0;M<b.length;M+=2){const z=b[M],V=b[M+1],$=M+3,K=M+4;if(typeof z!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(C.length&&C[C.length-1][0]>=z)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const X=o.parse(V,K,P);if(!X)return null;P=P||X.type,C.push([z,X])}return P.kind==="number"||P.kind==="color"||P.kind==="array"&&P.itemType.kind==="number"&&typeof P.N=="number"?new yc(P,c,p,_,C):o.error(`Type ${Pr(P)} is not interpolatable.`)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const p=this.input.evaluate(n);if(p<=o[0])return c[0].evaluate(n);const _=o.length;if(p>=o[_-1])return c[_-1].evaluate(n);const b=pd(o,p),C=yc.interpolationFactor(this.interpolation,p,o[b],o[b+1]),P=c[b].evaluate(n),M=c[b+1].evaluate(n);return this.operator==="interpolate"?gu[this.type.kind.toLowerCase()](P,M,C):this.operator==="interpolate-hcl"?gc.reverse(gc.interpolate(gc.forward(P),gc.forward(M),C)):vu.reverse(vu.interpolate(vu.forward(P),vu.forward(M),C))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function _d(i,n,o,c){const p=c-o,_=i-o;return p===0?0:n===1?_/p:(Math.pow(n,_)-1)/(Math.pow(n,p)-1)}var Ps=yc;class $a{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let c=null;const p=o.expectedType;p&&p.kind!=="value"&&(c=p);const _=[];for(const C of n.slice(1)){const P=o.parse(C,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!P)return null;c=c||P.type,_.push(P)}const b=p&&_.some((C=>Zo(p,C.type)));return new $a(b?jn:c,_)}evaluate(n){let o,c=null,p=0;for(const _ of this.args){if(p++,c=_.evaluate(n),c&&c instanceof ho&&!c.available&&(o||(o=c),c=null,p===this.args.length))return o;if(c!==null)break}return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}serialize(){const n=["coalesce"];return this.eachChild((o=>{n.push(o.serialize())})),n}}var $h=$a;class El{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let _=1;_<n.length-1;_+=2){const b=n[_];if(typeof b!="string")return o.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return o.error("Variable names must contain only alphanumeric characters or '_'.",_);const C=o.parse(n[_+1],_+1);if(!C)return null;c.push([b,C])}const p=o.parse(n[n.length-1],n.length-1,o.expectedType,c);return p?new El(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,c]of this.bindings)n.push(o,c.serialize());return n.push(this.result.serialize()),n}}var mp=El;class vd{constructor(n,o,c){this.type=n,this.index=o,this.input=c}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,Gt),p=o.parse(n[2],2,Gs(o.expectedType||jn));return c&&p?new vd(p.type.itemType,c,p):null}evaluate(n){const o=this.index.evaluate(n),c=this.input.evaluate(n);if(o<0)throw new Yr(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new Yr(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new Yr(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gh=vd;class xu{constructor(n,o){this.type=$n,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,jn),p=o.parse(n[2],2,jn);return c&&p?lc(c.type,[$n,Zn,Gt,fa,jn])?new xu(c,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pr(c.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(c==null)return!1;if(!cc(o,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${Pr(Ur(o))} instead.`);if(!cc(c,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${Pr(Ur(c))} instead.`);return c.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wu=xu;class _c{constructor(n,o,c){this.type=Gt,this.needle=n,this.haystack=o,this.fromIndex=c}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,jn),p=o.parse(n[2],2,jn);if(!c||!p)return null;if(!lc(c.type,[$n,Zn,Gt,fa,jn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pr(c.type)} instead`);if(n.length===4){const _=o.parse(n[3],3,Gt);return _?new _c(c,p,_):null}return new _c(c,p)}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!cc(o,["boolean","string","number","null"]))throw new Yr(`Expected first argument to be of type boolean, string, number or null, but found ${Pr(Ur(o))} instead.`);if(!cc(c,["string","array"]))throw new Yr(`Expected second argument to be of type array or string, but found ${Pr(Ur(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(n);return c.indexOf(o,p)}return c.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Hh=_c;class qh{constructor(n,o,c,p,_,b){this.inputType=n,this.type=o,this.input=c,this.cases=p,this.outputs=_,this.otherwise=b}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let c,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const _={},b=[];for(let M=2;M<n.length-1;M+=2){let z=n[M];const V=n[M+1];Array.isArray(z)||(z=[z]);const $=o.concat(M);if(z.length===0)return $.error("Expected at least one branch label.");for(const X of z){if(typeof X!="number"&&typeof X!="string")return $.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return $.error("Numeric branch labels must be integer values.");if(c){if($.checkSubtype(c,Ur(X)))return null}else c=Ur(X);if(_[String(X)]!==void 0)return $.error("Branch labels must be unique.");_[String(X)]=b.length}const K=o.parse(V,M,p);if(!K)return null;p=p||K.type,b.push(K)}const C=o.parse(n[1],1,jn);if(!C)return null;const P=o.parse(n[n.length-1],n.length-1,p);return P?C.type.kind!=="value"&&o.concat(1).checkSubtype(c,C.type)?null:new qh(c,p,C,_,b,P):null}evaluate(n){const o=this.input.evaluate(n);return(Ur(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],p={};for(const b of o){const C=p[this.cases[b]];C===void 0?(p[this.cases[b]]=c.length,c.push([this.cases[b],[b]])):c[C][1].push(b)}const _=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,C]of c)n.push(C.length===1?_(C[0]):C.map(_)),n.push(this.outputs[b].serialize());return n.push(this.otherwise.serialize()),n}}var sg=qh;class Wh{constructor(n,o,c){this.type=n,this.branches=o,this.otherwise=c}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const p=[];for(let b=1;b<n.length-1;b+=2){const C=o.parse(n[b],b,$n);if(!C)return null;const P=o.parse(n[b+1],b+1,c);if(!P)return null;p.push([C,P]),c=c||P.type}const _=o.parse(n[n.length-1],n.length-1,c);return _?new Wh(c,p,_):null}evaluate(n){for(const[o,c]of this.branches)if(o.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,c]of this.branches)n(o),n(c);n(this.otherwise)}outputDefined(){return this.branches.every((([n,o])=>o.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild((o=>{n.push(o.serialize())})),n}}var gp=Wh;class bu{constructor(n,o,c,p){this.type=n,this.input=o,this.beginIndex=c,this.endIndex=p}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,jn),p=o.parse(n[2],2,Gt);if(!c||!p)return null;if(!lc(c.type,[Gs(jn),Zn,jn]))return o.error(`Expected first argument to be of type array or string, but found ${Pr(c.type)} instead`);if(n.length===4){const _=o.parse(n[3],3,Gt);return _?new bu(c.type,c,p,_):null}return new bu(c.type,c,p)}evaluate(n){const o=this.input.evaluate(n),c=this.beginIndex.evaluate(n);if(!cc(o,["string","array"]))throw new Yr(`Expected first argument to be of type array or string, but found ${Pr(Ur(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(n);return o.slice(c,p)}return o.slice(c)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var mo=bu;function Ga(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Zh(i,n,o,c){return c.compare(n,o)===0}function Cl(i,n,o){const c=i!=="=="&&i!=="!=";return class bN{constructor(_,b,C){this.type=$n,this.lhs=_,this.rhs=b,this.collator=C,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const C=_[0];let P=b.parse(_[1],1,jn);if(!P)return null;if(!Ga(C,P.type))return b.concat(1).error(`"${C}" comparisons are not supported for type '${Pr(P.type)}'.`);let M=b.parse(_[2],2,jn);if(!M)return null;if(!Ga(C,M.type))return b.concat(2).error(`"${C}" comparisons are not supported for type '${Pr(M.type)}'.`);if(P.type.kind!==M.type.kind&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${Pr(P.type)}' and '${Pr(M.type)}'.`);c&&(P.type.kind==="value"&&M.type.kind!=="value"?P=new pa(M.type,[P]):P.type.kind!=="value"&&M.type.kind==="value"&&(M=new pa(P.type,[M])));let z=null;if(_.length===4){if(P.type.kind!=="string"&&M.type.kind!=="string"&&P.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(z=b.parse(_[3],3,$s),!z)return null}return new bN(P,M,z)}evaluate(_){const b=this.lhs.evaluate(_),C=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const P=Ur(b),M=Ur(C);if(P.kind!==M.kind||P.kind!=="string"&&P.kind!=="number")throw new Yr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${P.kind}, ${M.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const P=Ur(b),M=Ur(C);if(P.kind!=="string"||M.kind!=="string")return n(_,b,C)}return this.collator?o(_,b,C,this.collator.evaluate(_)):n(_,b,C)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[i];return this.eachChild((b=>{_.push(b.serialize())})),_}}}const yp=Cl("==",(function(i,n,o){return n===o}),Zh),_p=Cl("!=",(function(i,n,o){return n!==o}),(function(i,n,o,c){return!Zh(0,n,o,c)})),Kh=Cl("<",(function(i,n,o){return n<o}),(function(i,n,o,c){return c.compare(n,o)<0})),og=Cl(">",(function(i,n,o){return n>o}),(function(i,n,o,c){return c.compare(n,o)>0})),ag=Cl("<=",(function(i,n,o){return n<=o}),(function(i,n,o,c){return c.compare(n,o)<=0})),kl=Cl(">=",(function(i,n,o){return n>=o}),(function(i,n,o,c){return c.compare(n,o)>=0}));class vc{constructor(n,o,c,p,_,b){this.type=Zn,this.number=n,this.locale=o,this.currency=c,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const c=o.parse(n[1],1,Gt);if(!c)return null;const p=n[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=o.parse(p.locale,1,Zn),!_))return null;let b=null;if(p.currency&&(b=o.parse(p.currency,1,Zn),!b))return null;let C=null;if(p.unit&&(C=o.parse(p.unit,1,Zn),!C))return null;let P=null;if(p["min-fraction-digits"]&&(P=o.parse(p["min-fraction-digits"],1,Gt),!P))return null;let M=null;return p["max-fraction-digits"]&&(M=o.parse(p["max-fraction-digits"],1,Gt),!M)?null:new vc(c,_,b,C,P,M)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Qo{constructor(n){this.type=Gt,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=o.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Pr(c.type)} instead.`):new Qo(c):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Yr(`Expected value to be of type string or array, but found ${Pr(Ur(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild((o=>{n.push(o.serialize())})),n}}const xd={"==":yp,"!=":_p,">":og,"<":Kh,">=":kl,"<=":ag,array:pa,at:Gh,boolean:pa,case:gp,coalesce:$h,collator:Va,format:Xo,image:bl,in:wu,"index-of":Hh,interpolate:Ps,"interpolate-hcl":Ps,"interpolate-lab":Ps,length:Qo,let:mp,literal:Io,match:sg,number:pa,"number-format":vc,object:pa,slice:mo,step:Dh,string:pa,"to-boolean":Hs,"to-color":Hs,"to-number":Hs,"to-string":Hs,var:hp,within:hd};function Xh(i,[n,o,c,p]){n=n.evaluate(i),o=o.evaluate(i),c=c.evaluate(i);const _=p?p.evaluate(i):1,b=Ah(n,o,c,_);if(b)throw new Yr(b);return new xr(n/255*_,o/255*_,c/255*_,_)}function go(i,n){return i in n}function ga(i,n){const o=n[i];return o===void 0?null:o}function Ms(i){return{type:i}}po.register(xd,{error:[{kind:"error"},[Zn],(i,[n])=>{throw new Yr(n.evaluate(i))}],typeof:[Zn,[jn],(i,[n])=>Pr(Ur(n.evaluate(i)))],"to-rgba":[Gs(Gt,4),[As],(i,[n])=>n.evaluate(i).toArray()],rgb:[As,[Gt,Gt,Gt],Xh],rgba:[As,[Gt,Gt,Gt,Gt],Xh],has:{type:$n,overloads:[[[Zn],(i,[n])=>go(n.evaluate(i),i.properties())],[[Zn,Us],(i,[n,o])=>go(n.evaluate(i),o.evaluate(i))]]},get:{type:jn,overloads:[[[Zn],(i,[n])=>ga(n.evaluate(i),i.properties())],[[Zn,Us],(i,[n,o])=>ga(n.evaluate(i),o.evaluate(i))]]},"feature-state":[jn,[Zn],(i,[n])=>ga(n.evaluate(i),i.featureState||{})],properties:[Us,[],i=>i.properties()],"geometry-type":[Zn,[],i=>i.geometryType()],id:[jn,[],i=>i.id()],zoom:[Gt,[],i=>i.globals.zoom],pitch:[Gt,[],i=>i.globals.pitch||0],"distance-from-center":[Gt,[],i=>i.distanceFromCenter()],"heatmap-density":[Gt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Gt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Gt,[],i=>i.globals.skyRadialProgress||0],accumulated:[jn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Gt,Ms(Gt),(i,n)=>{let o=0;for(const c of n)o+=c.evaluate(i);return o}],"*":[Gt,Ms(Gt),(i,n)=>{let o=1;for(const c of n)o*=c.evaluate(i);return o}],"-":{type:Gt,overloads:[[[Gt,Gt],(i,[n,o])=>n.evaluate(i)-o.evaluate(i)],[[Gt],(i,[n])=>-n.evaluate(i)]]},"/":[Gt,[Gt,Gt],(i,[n,o])=>n.evaluate(i)/o.evaluate(i)],"%":[Gt,[Gt,Gt],(i,[n,o])=>n.evaluate(i)%o.evaluate(i)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(i,[n,o])=>Math.pow(n.evaluate(i),o.evaluate(i))],sqrt:[Gt,[Gt],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[Gt,[Gt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[Gt,[Gt],(i,[n])=>Math.log(n.evaluate(i))],log2:[Gt,[Gt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[Gt,[Gt],(i,[n])=>Math.sin(n.evaluate(i))],cos:[Gt,[Gt],(i,[n])=>Math.cos(n.evaluate(i))],tan:[Gt,[Gt],(i,[n])=>Math.tan(n.evaluate(i))],asin:[Gt,[Gt],(i,[n])=>Math.asin(n.evaluate(i))],acos:[Gt,[Gt],(i,[n])=>Math.acos(n.evaluate(i))],atan:[Gt,[Gt],(i,[n])=>Math.atan(n.evaluate(i))],min:[Gt,Ms(Gt),(i,n)=>Math.min(...n.map((o=>o.evaluate(i))))],max:[Gt,Ms(Gt),(i,n)=>Math.max(...n.map((o=>o.evaluate(i))))],abs:[Gt,[Gt],(i,[n])=>Math.abs(n.evaluate(i))],round:[Gt,[Gt],(i,[n])=>{const o=n.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Gt,[Gt],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[Gt,[Gt],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[$n,[Zn,jn],(i,[n,o])=>i.properties()[n.value]===o.value],"filter-id-==":[$n,[jn],(i,[n])=>i.id()===n.value],"filter-type-==":[$n,[Zn],(i,[n])=>i.geometryType()===n.value],"filter-<":[$n,[Zn,jn],(i,[n,o])=>{const c=i.properties()[n.value],p=o.value;return typeof c==typeof p&&c<p}],"filter-id-<":[$n,[jn],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o<c}],"filter->":[$n,[Zn,jn],(i,[n,o])=>{const c=i.properties()[n.value],p=o.value;return typeof c==typeof p&&c>p}],"filter-id->":[$n,[jn],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o>c}],"filter-<=":[$n,[Zn,jn],(i,[n,o])=>{const c=i.properties()[n.value],p=o.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[$n,[jn],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o<=c}],"filter->=":[$n,[Zn,jn],(i,[n,o])=>{const c=i.properties()[n.value],p=o.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[$n,[jn],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o>=c}],"filter-has":[$n,[jn],(i,[n])=>n.value in i.properties()],"filter-has-id":[$n,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$n,[Gs(Zn)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[$n,[Gs(jn)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[$n,[Zn,Gs(jn)],(i,[n,o])=>o.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[$n,[Zn,Gs(jn)],(i,[n,o])=>(function(c,p,_,b){for(;_<=b;){const C=_+b>>1;if(p[C]===c)return!0;p[C]>c?b=C-1:_=C+1}return!1})(i.properties()[n.value],o.value,0,o.value.length-1)],all:{type:$n,overloads:[[[$n,$n],(i,[n,o])=>n.evaluate(i)&&o.evaluate(i)],[Ms($n),(i,n)=>{for(const o of n)if(!o.evaluate(i))return!1;return!0}]]},any:{type:$n,overloads:[[[$n,$n],(i,[n,o])=>n.evaluate(i)||o.evaluate(i)],[Ms($n),(i,n)=>{for(const o of n)if(o.evaluate(i))return!0;return!1}]]},"!":[$n,[$n],(i,[n])=>!n.evaluate(i)],"is-supported-script":[$n,[Zn],(i,[n])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(n.evaluate(i))}],upcase:[Zn,[Zn],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[Zn,[Zn],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[Zn,Ms(jn),(i,n)=>n.map((o=>du(o.evaluate(i)))).join("")],"resolved-locale":[Zn,[$s],(i,[n])=>n.evaluate(i).resolvedLocale()]});var xc=xd;function Tu(i){return{result:"success",value:i}}function Ha(i){return{result:"error",value:i}}function Al(i){return i["property-type"]==="data-driven"}function Su(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Eu(i){return!!i.expression&&i.expression.interpolated}function tr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function wc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ya(i){return i}function bc(i,n){const o=n.type==="color",c=i.stops&&typeof i.stops[0][0]=="object",p=c||!(c||i.property!==void 0),_=i.type||(Eu(n)?"exponential":"interval");if(o&&((i=Si({},i)).stops&&(i.stops=i.stops.map((M=>[M[0],xr.parse(M[1])]))),i.default=xr.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Uh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let b,C,P;if(_==="exponential")b=qs;else if(_==="interval")b=wd;else if(_==="categorical"){b=vp,C=Object.create(null);for(const M of i.stops)C[M[0]]=M[1];P=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=xp}if(c){const M={},z=[];for(let K=0;K<i.stops.length;K++){const X=i.stops[K],ne=X[0].zoom;M[ne]===void 0&&(M[ne]={zoom:ne,type:i.type,property:i.property,default:i.default,stops:[]},z.push(ne)),M[ne].stops.push([X[0].value,X[1]])}const V=[];for(const K of z)V.push([M[K].zoom,bc(M[K],n)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Ps.interpolationFactor.bind(void 0,$),zoomStops:V.map((K=>K[0])),evaluate:({zoom:K},X)=>qs({stops:V,base:i.base},n,K).evaluate(K,X)}}if(p){const M=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Ps.interpolationFactor.bind(void 0,M),zoomStops:i.stops.map((z=>z[0])),evaluate:({zoom:z})=>b(i,n,z,C,P)}}return{kind:"source",evaluate(M,z){const V=z&&z.properties?z.properties[i.property]:void 0;return V===void 0?qa(i.default,n.default):b(i,n,V,C,P)}}}function qa(i,n,o){return i!==void 0?i:n!==void 0?n:o!==void 0?o:void 0}function vp(i,n,o,c,p){return qa(typeof o===p?c[o]:void 0,i.default,n.default)}function wd(i,n,o){if(tr(o)!=="number")return qa(i.default,n.default);const c=i.stops.length;if(c===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[c-1][0])return i.stops[c-1][1];const p=pd(i.stops.map((_=>_[0])),o);return i.stops[p][1]}function qs(i,n,o){const c=i.base!==void 0?i.base:1;if(tr(o)!=="number")return qa(i.default,n.default);const p=i.stops.length;if(p===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[p-1][0])return i.stops[p-1][1];const _=pd(i.stops.map((z=>z[0])),o),b=(function(z,V,$,K){const X=K-$,ne=z-$;return X===0?0:V===1?ne/X:(Math.pow(V,ne)-1)/(Math.pow(V,X)-1)})(o,c,i.stops[_][0],i.stops[_+1][0]),C=i.stops[_][1],P=i.stops[_+1][1];let M=gu[n.type]||ya;if(i.colorSpace&&i.colorSpace!=="rgb"){const z=Uh[i.colorSpace];M=(V,$)=>z.reverse(z.interpolate(z.forward(V),z.forward($),b))}return typeof C.evaluate=="function"?{evaluate(...z){const V=C.evaluate.apply(void 0,z),$=P.evaluate.apply(void 0,z);if(V!==void 0&&$!==void 0)return M(V,$,b)}}:M(C,P,b)}function xp(i,n,o){return n.type==="color"?o=xr.parse(o):n.type==="formatted"?o=ji.fromString(o.toString()):n.type==="resolvedImage"?o=ho.fromString(o.toString()):tr(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),qa(o,i.default,n.default)}class Cu{constructor(n,o){this.expression=n,this._warningHistory={},this._evaluator=new dc,this._defaultValue=o?(function(c){return c.type==="color"&&(wc(c.default)||Array.isArray(c.default))?new xr(0,0,0,0):c.type==="color"?xr.parse(c.default)||null:c.default===void 0?null:c.default})(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,c,p,_,b,C,P){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,c,p,_,b,C,P){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=P||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Yr(`Expected value to be one of ${Object.keys(this._enumValues).map((z=>JSON.stringify(z))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Pl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in xc}function yr(i,n){const o=new jh(xc,[],n?(function(p){const _={color:As,string:Zn,number:Gt,enum:Zn,boolean:$n,formatted:xl,resolvedImage:or};return p.type==="array"?Gs(_[p.value]||jn,p.length):_[p.type]})(n):void 0),c=o.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Tu(new Cu(c,n)):Ha(o.errors)}class ku{constructor(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!ma(o.expression)}evaluateWithoutErrorHandling(n,o,c,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,p,_,b)}evaluate(n,o,c,p,_,b){return this._styleExpression.evaluate(n,o,c,p,_,b)}}class Wa{constructor(n,o,c,p){this.kind=n,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!ma(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(n,o,c,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,p,_,b)}evaluate(n,o,c,p,_,b){return this._styleExpression.evaluate(n,o,c,p,_,b)}interpolationFactor(n,o,c){return this.interpolationType?Ps.interpolationFactor(this.interpolationType,n,o,c):0}}function _a(i,n){if((i=yr(i,n)).result==="error")return i;const o=i.value.expression,c=pc(o);if(!c&&!Al(n))return Ha([new Vs("","data expressions not supported")]);const p=Ua(o,["zoom","pitch","distance-from-center"]);if(!p&&!Su(n))return Ha([new Vs("","zoom expressions not supported")]);const _=Tc(o);return _||p?_ instanceof Vs?Ha([_]):_ instanceof Ps&&!Eu(n)?Ha([new Vs("",'"interpolate" expressions cannot be used with this property')]):Tu(_?new Wa(c?"camera":"composite",i.value,_.labels,_ instanceof Ps?_.interpolation:void 0):new ku(c?"constant":"source",i.value)):Ha([new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Au{constructor(n,o){this._parameters=n,this._specification=o,Si(this,bc(this._parameters,this._specification))}static deserialize(n){return new Au(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Tc(i){let n=null;if(i instanceof mp)n=Tc(i.result);else if(i instanceof $h){for(const o of i.args)if(n=Tc(o),n)break}else(i instanceof Dh||i instanceof Ps)&&i.input instanceof po&&i.input.name==="zoom"&&(n=i);return n instanceof Vs||i.eachChild((o=>{const c=Tc(o);c instanceof Vs?n=c:!n&&c?n=new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&c&&n!==c&&(n=new Vs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}class Ft{constructor(n,o,c,p){this.message=(n?`${n}: `:"")+c,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function Is(i){const n=i.key,o=i.value,c=i.valueSpec||{},p=i.objectElementValidators||{},_=i.style,b=i.styleSpec;let C=[];const P=tr(o);if(P!=="object")return[new Ft(n,o,`object expected, ${P} found`)];for(const M in o){const z=M.split(".")[0];let V;p[z]?V=p[z]:c[z]?V=Kn:p["*"]?V=p["*"]:c["*"]&&(V=Kn),V?C=C.concat(V({key:(n&&`${n}.`)+M,value:o[M],valueSpec:c[z]||c["*"],style:_,styleSpec:b,object:o,objectKey:M},o)):C.push(new Ft(n,o[M],`unknown property "${M}"`))}for(const M in c)p[M]||c[M].required&&c[M].default===void 0&&o[M]===void 0&&C.push(new Ft(n,o,`missing required property "${M}"`));return C}function Ml(i){const n=i.value,o=i.valueSpec,c=i.style,p=i.styleSpec,_=i.key,b=i.arrayElementValidator||Kn;if(tr(n)!=="array")return[new Ft(_,n,`array expected, ${tr(n)} found`)];if(o.length&&n.length!==o.length)return[new Ft(_,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new Ft(_,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let C={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};p.$version<7&&(C.function=o.function),tr(o.value)==="object"&&(C=o.value);let P=[];for(let M=0;M<n.length;M++)P=P.concat(b({array:n,arrayIndex:M,value:n[M],valueSpec:C,style:c,styleSpec:p,key:`${_}[${M}]`}));return P}function Sc(i){const n=i.key,o=i.value,c=i.valueSpec;let p=tr(o);if(p==="number"&&o!=o&&(p="NaN"),p!=="number")return[new Ft(n,o,`number expected, ${p} found`)];if("minimum"in c){let _=c.minimum;if(tr(c.minimum)==="array"&&(_=c.minimum[i.arrayIndex]),o<_)return[new Ft(n,o,`${o} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if(tr(c.maximum)==="array"&&(_=c.maximum[i.arrayIndex]),o>_)return[new Ft(n,o,`${o} is greater than the maximum value ${_}`)]}return[]}function Pu(i){const n=i.valueSpec,o=ai(i.value.type);let c,p,_,b={};const C=o!=="categorical"&&i.value.property===void 0,P=!C,M=tr(i.value.stops)==="array"&&tr(i.value.stops[0])==="array"&&tr(i.value.stops[0][0])==="object",z=Is({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(K){if(o==="identity")return[new Ft(K.key,K.value,'identity function may not have a "stops" property')];let X=[];const ne=K.value;return X=X.concat(Ml({key:K.key,value:ne,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:V})),tr(ne)==="array"&&ne.length===0&&X.push(new Ft(K.key,ne,"array must have at least one stop")),X},default:function(K){return Kn({key:K.key,value:K.value,valueSpec:n,style:K.style,styleSpec:K.styleSpec})}}});return o==="identity"&&C&&z.push(new Ft(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||z.push(new Ft(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!Eu(i.valueSpec)&&z.push(new Ft(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(P&&!Al(i.valueSpec)?z.push(new Ft(i.key,i.value,"property functions not supported")):C&&!Su(i.valueSpec)&&z.push(new Ft(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!M||i.value.property!==void 0||z.push(new Ft(i.key,i.value,'"property" property is required')),z;function V(K){let X=[];const ne=K.value,le=K.key;if(tr(ne)!=="array")return[new Ft(le,ne,`array expected, ${tr(ne)} found`)];if(ne.length!==2)return[new Ft(le,ne,`array length 2 expected, length ${ne.length} found`)];if(M){if(tr(ne[0])!=="object")return[new Ft(le,ne,`object expected, ${tr(ne[0])} found`)];if(ne[0].zoom===void 0)return[new Ft(le,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new Ft(le,ne,"object stop key must have value")];const me=ai(ne[0].zoom);if(typeof me!="number")return[new Ft(le,ne[0].zoom,"stop zoom values must be numbers")];if(_&&_>me)return[new Ft(le,ne[0].zoom,"stop zoom values must appear in ascending order")];me!==_&&(_=me,p=void 0,b={}),X=X.concat(Is({key:`${le}[0]`,value:ne[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Sc,value:$}}))}else X=X.concat($({key:`${le}[0]`,value:ne[0],style:K.style,styleSpec:K.styleSpec},ne));return Pl(Ri(ne[1]))?X.concat([new Ft(`${le}[1]`,ne[1],"expressions are not allowed in function stops.")]):X.concat(Kn({key:`${le}[1]`,value:ne[1],valueSpec:n,style:K.style,styleSpec:K.styleSpec}))}function $(K,X){const ne=tr(K.value),le=ai(K.value),me=K.value!==null?K.value:X;if(c){if(ne!==c)return[new Ft(K.key,me,`${ne} stop domain type must match previous stop domain type ${c}`)]}else c=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof le!="number"&&typeof le!="string"&&typeof le!="boolean")return[new Ft(K.key,me,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&o!=="categorical"){let Ce=`number expected, ${ne} found`;return Al(n)&&o===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ft(K.key,me,Ce)]}return o!=="categorical"||ne!=="number"||typeof le=="number"&&isFinite(le)&&Math.floor(le)===le?o!=="categorical"&&ne==="number"&&typeof le=="number"&&typeof p=="number"&&p!==void 0&&le<p?[new Ft(K.key,me,"stop domain values must appear in ascending order")]:(p=le,o==="categorical"&&le in b?[new Ft(K.key,me,"stop domain values must be unique")]:(b[le]=!0,[])):[new Ft(K.key,me,`integer expected, found ${String(le)}`)]}}function Di(i){const n=(i.expressionContext==="property"?_a:yr)(Ri(i.value),i.valueSpec);if(n.result==="error")return n.value.map((c=>new Ft(`${i.key}${c.key}`,i.value,c.message)));const o=n.value.expression||n.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Ft(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ma(o))return[new Ft(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Ec(o,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ua(o,["zoom","feature-state"]))return[new Ft(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!pc(o))return[new Ft(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ec(i,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const p of n.valueSpec.expression.parameters)o.delete(p);if(o.size===0)return[];const c=[];return i instanceof po&&o.has(i.name)?[new Ft(n.key,n.value,`["${i.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(i.eachChild((p=>{c.push(...Ec(p,n))})),c)}function Il(i){const n=i.key,o=i.value,c=i.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(ai(o))===-1&&p.push(new Ft(n,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(ai(o))===-1&&p.push(new Ft(n,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function Cc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!Cc(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function kc(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cc(i)||(i=Pc(i));const o=i;let c=!0;try{c=(function(M){if(!Za(M))return M;let z=Ri(M);return Ac(z),z=bd(z),z})(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const p=ht[`filter_${n}`],_=yr(c,p);let b=null;if(_.result==="error")throw new Error(_.value.map((M=>`${M.key}: ${M.message}`)).join(", "));b=(M,z,V)=>_.value.evaluate(M,z,{},V);let C=null,P=null;if(c!==o){const M=yr(o,p);if(M.result==="error")throw new Error(M.value.map((z=>`${z.key}: ${z.message}`)).join(", "));C=(z,V,$,K,X)=>M.value.evaluate(z,V,{},$,void 0,void 0,K,X),P=!pc(M.value.expression)}return{filter:b,dynamicFilter:C||void 0,needGeometry:bp(c),needFeature:!!P}}function bd(i){if(!Array.isArray(i))return i;const n=(function(o){if(Yh.has(o[0])){for(let c=1;c<o.length;c++)if(Za(o[c]))return!0}return o})(i);return n===!0?n:n.map((o=>bd(o)))}function Ac(i){let n=!1;const o=[];if(i[0]==="case"){for(let c=1;c<i.length-1;c+=2)n=n||Za(i[c]),o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="match"){n=n||Za(i[1]);for(let c=2;c<i.length-1;c+=2)o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="step"){n=n||Za(i[1]);for(let c=1;c<i.length-1;c+=2)o.push(i[c+1])}n&&(i.length=0,i.push("any",...o));for(let c=1;c<i.length;c++)Ac(i[c])}function Za(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<i.length;o++)if(Za(i[o]))return!0;return!1}const Yh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wp(i,n){return i<n?-1:i>n?1:0}function bp(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let n=1;n<i.length;n++)if(bp(i[n]))return!0;return!1}function Pc(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?Mu(i[1],i[2],"=="):n==="!="?va(Mu(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Mu(i[1],i[2],n):n==="any"?(o=i.slice(1),["any"].concat(o.map(Pc))):n==="all"?["all"].concat(i.slice(1).map(Pc)):n==="none"?["all"].concat(i.slice(1).map(Pc).map(va)):n==="in"?ea(i[1],i.slice(2)):n==="!in"?va(ea(i[1],i.slice(2))):n==="has"?Td(i[1]):n==="!has"?va(Td(i[1])):n!=="within"||i;var o}function Mu(i,n,o){switch(i){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,i,n]}}function ea(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some((o=>typeof o!=typeof n[0]))?["filter-in-large",i,["literal",n.sort(wp)]]:["filter-in-small",i,["literal",n]]}}function Td(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function va(i){return["!",i]}function Rs(i){return Cc(Ri(i.value))?Di(Si({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):xa(i)}function xa(i){const n=i.value,o=i.key;if(tr(n)!=="array")return[new Ft(o,n,`array expected, ${tr(n)} found`)];const c=i.styleSpec;let p,_=[];if(n.length<1)return[new Ft(o,n,"filter array must have at least 1 element")];switch(_=_.concat(Il({key:`${o}[0]`,value:n[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),ai(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&ai(n[1])==="$type"&&_.push(new Ft(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&_.push(new Ft(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(p=tr(n[1]),p!=="string"&&_.push(new Ft(`${o}[1]`,n[1],`string expected, ${p} found`)));for(let b=2;b<n.length;b++)p=tr(n[b]),ai(n[1])==="$type"?_=_.concat(Il({key:`${o}[${b}]`,value:n[b],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Ft(`${o}[${b}]`,n[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)_=_.concat(xa({key:`${o}[${b}]`,value:n[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=tr(n[1]),n.length!==2?_.push(new Ft(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Ft(`${o}[1]`,n[1],`string expected, ${p} found`));break;case"within":p=tr(n[1]),n.length!==2?_.push(new Ft(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="object"&&_.push(new Ft(`${o}[1]`,n[1],`object expected, ${p} found`))}return _}function No(i,n){const o=i.key,c=i.style,p=i.styleSpec,_=i.value,b=i.objectKey,C=p[`${n}_${i.layerType}`];if(!C)return[];const P=b.match(/^(.*)-transition$/);if(n==="paint"&&P&&C[P[1]]&&C[P[1]].transition)return Kn({key:o,value:_,valueSpec:p.transition,style:c,styleSpec:p});const M=i.valueSpec||C[b];if(!M)return[new Ft(o,_,`unknown property "${b}"`)];let z;if(tr(_)==="string"&&Al(M)&&!M.tokens&&(z=/^{([^}]+)}$/.exec(_))){const $=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new Ft(o,_,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const V=[];return i.layerType==="symbol"&&(b==="text-field"&&c&&!c.glyphs&&V.push(new Ft(o,_,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&wc(Ri(_))&&ai(_.type)==="identity"&&V.push(new Ft(o,_,'"text-font" does not support identity functions'))),V.concat(Kn({key:i.key,value:_,valueSpec:M,style:c,styleSpec:p,expressionContext:"property",propertyType:n,propertyKey:b}))}function Sd(i){return No(i,"paint")}function Jh(i){return No(i,"layout")}function Tp(i){let n=[];const o=i.value,c=i.key,p=i.style,_=i.styleSpec;o.type||o.ref||n.push(new Ft(c,o,'either "type" or "ref" is required'));let b=ai(o.type);const C=ai(o.ref);if(o.id){const P=ai(o.id);for(let M=0;M<i.arrayIndex;M++){const z=p.layers[M];ai(z.id)===P&&n.push(new Ft(c,o.id,`duplicate layer id "${o.id}", previously used at line ${z.id.__line__}`))}}if("ref"in o){let P;["type","source","source-layer","filter","layout"].forEach((M=>{M in o&&n.push(new Ft(c,o[M],`"${M}" is prohibited for ref layers`))})),p.layers.forEach((M=>{ai(M.id)===C&&(P=M)})),P?P.ref?n.push(new Ft(c,o.ref,"ref cannot reference another ref layer")):b=ai(P.type):typeof C=="string"&&n.push(new Ft(c,o.ref,`ref layer "${C}" not found`))}else if(b!=="background"&&b!=="sky")if(o.source){const P=p.sources&&p.sources[o.source],M=P&&ai(P.type);P?M==="vector"&&b==="raster"?n.push(new Ft(c,o.source,`layer "${o.id}" requires a raster source`)):M==="raster"&&b!=="raster"?n.push(new Ft(c,o.source,`layer "${o.id}" requires a vector source`)):M!=="vector"||o["source-layer"]?M==="raster-dem"&&b!=="hillshade"?n.push(new Ft(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||M==="geojson"&&P.lineMetrics||n.push(new Ft(c,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Ft(c,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new Ft(c,o.source,`source "${o.source}" not found`))}else n.push(new Ft(c,o,'missing required property "source"'));return n=n.concat(Is({key:c,value:o,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Kn({key:`${c}.type`,value:o.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:P=>Rs(Si({layerType:b},P)),layout:P=>Is({layer:o,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>Jh(Si({layerType:b},M))}}),paint:P=>Is({layer:o,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":M=>Sd(Si({layerType:b},M))}})}})),n}function Ns(i){const n=i.value,o=i.key,c=tr(n);return c!=="string"?[new Ft(o,n,`string expected, ${c} found`)]:[]}const Mc={promoteId:function({key:i,value:n}){if(tr(n)==="string")return Ns({key:i,value:n});{const o=[];for(const c in n)o.push(...Ns({key:`${i}.${c}`,value:n[c]}));return o}}};function Rl(i){const n=i.value,o=i.key,c=i.styleSpec,p=i.style;if(!n.type)return[new Ft(o,n,'"type" is required')];const _=ai(n.type);let b;switch(_){case"vector":case"raster":case"raster-dem":return b=Is({key:o,value:n,valueSpec:c[`source_${_.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:Mc}),b;case"geojson":if(b=Is({key:o,value:n,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:Mc}),n.cluster)for(const C in n.clusterProperties){const[P,M]=n.clusterProperties[C],z=typeof P=="string"?[P,["accumulated"],["get",C]]:P;b.push(...Di({key:`${o}.${C}.map`,value:M,expressionContext:"cluster-map"})),b.push(...Di({key:`${o}.${C}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Is({key:o,value:n,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return Is({key:o,value:n,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new Ft(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Il({key:`${o}.type`,value:n.type,valueSpec:{values:Ed(c)}})}}function Ed(i){return i.source.reduce(((n,o)=>{const c=i[o];return c.type.type==="enum"&&(n=n.concat(Object.keys(c.type.values))),n}),[])}function Cd(i){const n=i.value,o=i.styleSpec,c=o.light,p=i.style;let _=[];const b=tr(n);if(n===void 0)return _;if(b!=="object")return _=_.concat([new Ft("light",n,`object expected, ${b} found`)]),_;for(const C in n){const P=C.match(/^(.*)-transition$/);_=_.concat(P&&c[P[1]]&&c[P[1]].transition?Kn({key:C,value:n[C],valueSpec:o.transition,style:p,styleSpec:o}):c[C]?Kn({key:C,value:n[C],valueSpec:c[C],style:p,styleSpec:o}):[new Ft(C,n[C],`unknown property "${C}"`)])}return _}function Ka(i){const n=i.value,o=i.key,c=i.style,p=i.styleSpec,_=p.terrain;let b=[];const C=tr(n);if(n===void 0)return b;if(C!=="object")return b=b.concat([new Ft("terrain",n,`object expected, ${C} found`)]),b;for(const P in n){const M=P.match(/^(.*)-transition$/);b=b.concat(M&&_[M[1]]&&_[M[1]].transition?Kn({key:P,value:n[P],valueSpec:p.transition,style:c,styleSpec:p}):_[P]?Kn({key:P,value:n[P],valueSpec:_[P],style:c,styleSpec:p}):[new Ft(P,n[P],`unknown property "${P}"`)])}if(n.source){const P=c.sources&&c.sources[n.source],M=P&&ai(P.type);P?M!=="raster-dem"&&b.push(new Ft(o,n.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):b.push(new Ft(o,n.source,`source "${n.source}" not found`))}else b.push(new Ft(o,n,'terrain is missing required property "source"'));return b}function wa(i){const n=i.value,o=i.style,c=i.styleSpec,p=c.fog;let _=[];const b=tr(n);if(n===void 0)return _;if(b!=="object")return _=_.concat([new Ft("fog",n,`object expected, ${b} found`)]),_;for(const C in n){const P=C.match(/^(.*)-transition$/);_=_.concat(P&&p[P[1]]&&p[P[1]].transition?Kn({key:C,value:n[C],valueSpec:c.transition,style:o,styleSpec:c}):p[C]?Kn({key:C,value:n[C],valueSpec:p[C],style:o,styleSpec:c}):[new Ft(C,n[C],`unknown property "${C}"`)])}return _}const Lr={"*":()=>[],array:Ml,boolean:function(i){const n=i.value,o=i.key,c=tr(n);return c!=="boolean"?[new Ft(o,n,`boolean expected, ${c} found`)]:[]},number:Sc,color:function(i){const n=i.key,o=i.value,c=tr(o);return c!=="string"?[new Ft(n,o,`color expected, ${c} found`)]:cu(o)===null?[new Ft(n,o,`color expected, "${o}" found`)]:[]},enum:Il,filter:Rs,function:Pu,layer:Tp,object:Is,source:Rl,light:Cd,terrain:Ka,fog:wa,string:Ns,formatted:function(i){return Ns(i).length===0?[]:Di(i)},resolvedImage:function(i){return Ns(i).length===0?[]:Di(i)},projection:function(i){const n=i.value,o=i.styleSpec,c=o.projection,p=i.style;let _=[];const b=tr(n);if(b==="object")for(const C in n)_=_.concat(Kn({key:C,value:n[C],valueSpec:c[C],style:p,styleSpec:o}));else b!=="string"&&(_=_.concat([new Ft("projection",n,`object or string expected, ${b} found`)]));return _}};function Kn(i){const n=i.value,o=i.valueSpec,c=i.styleSpec;return o.expression&&wc(ai(n))?Pu(i):o.expression&&Pl(Ri(n))?Di(i):o.type&&Lr[o.type]?Lr[o.type](i):Is(Si({},i,{valueSpec:o.type?c[o.type]:o}))}function Xa(i){const n=i.value,o=i.key,c=Ns(i);return c.length||(n.indexOf("{fontstack}")===-1&&c.push(new Ft(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&c.push(new Ft(o,n,'"glyphs" url must include a "{range}" token'))),c}function Gi(i,n=ht){return Hi(Kn({key:"",value:i,valueSpec:n.$root,styleSpec:n,style:i,objectElementValidators:{glyphs:Xa,"*":()=>[]}}))}const js=i=>Hi(Sd(i)),Nl=i=>Hi(Jh(i));function Hi(i){return i.slice().sort(((n,o)=>n.line&&o.line?n.line-o.line:0))}function fs(i,n){let o=!1;if(n&&n.length)for(const c of n)i.fire(new lo(new Error(c.message))),o=!0;return o}var kd=jo,yo=3;function jo(i,n,o){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(n=p[1])+2*(o=p[2]);for(var _=0;_<this.d*this.d;_++){var b=p[yo+_],C=p[yo+_+1];c.push(b===C?null:p.subarray(b,C))}var P=p[yo+c.length+1];this.keys=p.subarray(p[yo+c.length],P),this.bboxes=p.subarray(P),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var M=0;M<this.d*this.d;M++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=o,this.scale=n/i,this.uid=0;var z=o/n*i;this.min=-z,this.max=i+z}jo.prototype.insert=function(i,n,o,c,p){this._forEachCell(n,o,c,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p)},jo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},jo.prototype._insertCell=function(i,n,o,c,p,_){this.cells[p].push(_)},jo.prototype.query=function(i,n,o,c,p){var _=this.min,b=this.max;if(i<=_&&n<=_&&b<=o&&b<=c&&!p)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(i,n,o,c,this._queryCell,C,{},p),C},jo.prototype._queryCell=function(i,n,o,c,p,_,b,C){var P=this.cells[p];if(P!==null)for(var M=this.keys,z=this.bboxes,V=0;V<P.length;V++){var $=P[V];if(b[$]===void 0){var K=4*$;(C?C(z[K+0],z[K+1],z[K+2],z[K+3]):i<=z[K+2]&&n<=z[K+3]&&o>=z[K+0]&&c>=z[K+1])?(b[$]=!0,_.push(M[$])):b[$]=!1}}},jo.prototype._forEachCell=function(i,n,o,c,p,_,b,C){for(var P=this._convertToCellCoord(i),M=this._convertToCellCoord(n),z=this._convertToCellCoord(o),V=this._convertToCellCoord(c),$=P;$<=z;$++)for(var K=M;K<=V;K++){var X=this.d*K+$;if((!C||C(this._convertFromCellCoord($),this._convertFromCellCoord(K),this._convertFromCellCoord($+1),this._convertFromCellCoord(K+1)))&&p.call(this,i,n,o,c,X,_,b,C))return}},jo.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},jo.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},jo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=yo+this.cells.length+1+1,o=0,c=0;c<this.cells.length;c++)o+=this.cells[c].length;var p=new Int32Array(n+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var _=n,b=0;b<i.length;b++){var C=i[b];p[yo+b]=_,p.set(C,_),_+=C.length}return p[yo+i.length]=_,p.set(this.keys,_),p[yo+i.length+1]=_+=this.keys.length,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer};var ta=ie(kd);const Iu={};function Ut(i,n,o={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writeable:!1}),Iu[n]={klass:i,omit:o.omit||[]}}Ut(Object,"Object"),ta.serialize=function(i,n){const o=i.toArrayBuffer();return n&&n.push(o),{buffer:o}},ta.deserialize=function(i){return new ta(i.buffer)},Object.defineProperty(ta,"name",{value:"Grid"}),Ut(ta,"Grid"),Ut(xr,"Color"),Ut(Error,"Error"),Ut(ds,"AJAXError"),Ut(ho,"ResolvedImage"),Ut(Au,"StylePropertyFunction"),Ut(Cu,"StyleExpression",{omit:["_evaluator"]}),Ut(Wa,"ZoomDependentExpression"),Ut(ku,"ZoomConstantExpression"),Ut(po,"CompoundExpression",{omit:["_evaluate"]});for(const i in xc)Iu[xc[i]._classRegistryKey]||Ut(xc[i],`Expression${i}`);function Ic(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ru(i){return S.ImageBitmap&&i instanceof S.ImageBitmap}function jl(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ic(i)||Ru(i))return n&&n.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return n&&n.push(o.buffer),o}if(i instanceof S.ImageData)return n&&n.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const c of i)o.push(jl(c,n));return o}if(typeof i=="object"){const o=i.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=o.serialize?o.serialize(i,n):{};if(!o.serialize){for(const _ in i)i.hasOwnProperty(_)&&(Iu[c].omit.indexOf(_)>=0||(p[_]=jl(i[_],n)));i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof i)}function Dl(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ic(i)||Ru(i)||ArrayBuffer.isView(i)||i instanceof S.ImageData)return i;if(Array.isArray(i))return i.map(Dl);if(typeof i=="object"){const n=i.$name||"Object",{klass:o}=Iu[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(i);const c=Object.create(o.prototype);for(const p of Object.keys(i))p!=="$name"&&(c[p]=Dl(i[p]));return c}throw new Error("can't deserialize object of type "+typeof i)}const Bt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ya(i){for(const n of i)if(Nc(n.charCodeAt(0)))return!0;return!1}function Rc(i){for(const n of i)if(!Nu(n.charCodeAt(0)))return!1;return!0}function Nu(i){return!(Bt.Arabic(i)||Bt["Arabic Supplement"](i)||Bt["Arabic Extended-A"](i)||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i))}function Nc(i){return!(i!==746&&i!==747&&(i<4352||!(Bt["Bopomofo Extended"](i)||Bt.Bopomofo(i)||Bt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Bt["CJK Compatibility Ideographs"](i)||Bt["CJK Compatibility"](i)||Bt["CJK Radicals Supplement"](i)||Bt["CJK Strokes"](i)||!(!Bt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Bt["CJK Unified Ideographs Extension A"](i)||Bt["CJK Unified Ideographs"](i)||Bt["Enclosed CJK Letters and Months"](i)||Bt["Hangul Compatibility Jamo"](i)||Bt["Hangul Jamo Extended-A"](i)||Bt["Hangul Jamo Extended-B"](i)||Bt["Hangul Jamo"](i)||Bt["Hangul Syllables"](i)||Bt.Hiragana(i)||Bt["Ideographic Description Characters"](i)||Bt.Kanbun(i)||Bt["Kangxi Radicals"](i)||Bt["Katakana Phonetic Extensions"](i)||Bt.Katakana(i)&&i!==12540||!(!Bt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Bt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Bt["Unified Canadian Aboriginal Syllabics"](i)||Bt["Unified Canadian Aboriginal Syllabics Extended"](i)||Bt["Vertical Forms"](i)||Bt["Yijing Hexagram Symbols"](i)||Bt["Yi Syllables"](i)||Bt["Yi Radicals"](i))))}function Ws(i){return!(Nc(i)||(function(n){return!!(Bt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Bt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Bt["Letterlike Symbols"](n)||Bt["Number Forms"](n)||Bt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Bt["Control Pictures"](n)&&n!==9251||Bt["Optical Character Recognition"](n)||Bt["Enclosed Alphanumerics"](n)||Bt["Geometric Shapes"](n)||Bt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Bt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Bt["CJK Symbols and Punctuation"](n)||Bt.Katakana(n)||Bt["Private Use Area"](n)||Bt["CJK Compatibility Forms"](n)||Bt["Small Form Variants"](n)||Bt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)})(i))}function Zs(i){return i>=1424&&i<=2303||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i)}function Ll(i,n){return!(!n&&Zs(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Bt.Khmer(i))}function ba(i){for(const n of i)if(Zs(n.charCodeAt(0)))return!0;return!1}const Do="deferred",Ta="loading",Ad="loaded";let Ja=null,y="unavailable",a=null;const h=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(y="error"),Ja&&Ja(i)};function x(){T.fire(new za("pluginStateChange",{pluginStatus:y,pluginURL:a}))}const T=new ks,k=function(){return y},N=function(){if(y!==Do||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");y=Ta,x(),a&&oo({url:a},(i=>{i?h(i):(y=Ad,x())}))},D={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>y===Ad||D.applyArabicShaping!=null,isLoading:()=>y===Ta,setState(i){y=i.pluginStatus,a=i.pluginURL},isParsed:()=>D.applyArabicShaping!=null&&D.processBidirectionalText!=null&&D.processStyledBidirectionalText!=null,getPluginURL:()=>a};class B{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(n){return(function(o,c){for(const p of o)if(!Ll(p.charCodeAt(0),c))return!1;return!0})(n,D.isLoaded())}}class H{constructor(n,o){this.property=n,this.value=o,this.expression=(function(c,p){if(wc(c))return new Au(c,p);if(Pl(c)){const _=_a(c,p);if(_.result==="error")throw new Error(_.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return _.value}{let _=c;return typeof c=="string"&&p.type==="color"&&(_=xr.parse(c)),{kind:"constant",evaluate:()=>_}}})(o===void 0?n.specification.default:o,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,c){return this.property.possiblyEvaluate(this,n,o,c)}}class G{constructor(n){this.property=n,this.value=new H(n,void 0)}transitioned(n,o){return new ae(this.property,this.value,o,wt({},n.transition,this.transition),n.now)}untransitioned(){return new ae(this.property,this.value,null,{},0)}}class ee{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return vr(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new G(this._values[n].property)),this._values[n].value=new H(this._values[n].property,o===null?void 0:vr(o))}getTransition(n){return vr(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new G(this._values[n].property)),this._values[n].transition=vr(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c);const p=this.getTransition(o);p!==void 0&&(n[`${o}-transition`]=p)}return n}transitioned(n,o){const c=new ue(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(n,o._values[p]);return c}untransitioned(){const n=new ue(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class ae{constructor(n,o,c,p,_){const b=p.delay||0,C=p.duration||0;_=_||0,this.property=n,this.value=o,this.begin=_+b,this.end=this.begin+C,n.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(n,o,c){const p=n.now||0,_=this.value.possiblyEvaluate(n,o,c),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(n,o,c);{const C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(n,o,c),_,it(C))}}return _}}class ue{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,c){const p=new pe(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(n,o,c);return p}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class fe{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return vr(this._values[n].value)}setValue(n,o){this._values[n]=new H(this._values[n].property,o===null?void 0:vr(o))}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c)}return n}possiblyEvaluate(n,o,c){const p=new pe(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(n,o,c);return p}}class he{constructor(n,o,c){this.property=n,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,c,p){return this.property.evaluate(this.value,this.parameters,n,o,c,p)}}class pe{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class te{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,c){const p=gu[this.specification.type];return p?p(n,o,c):n}}class ce{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,c,p){return new he(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},c,p)}:n.expression,o)}interpolate(n,o,c){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new he(this,{kind:"constant",value:void 0},n.parameters);const p=gu[this.specification.type];return p?new he(this,{kind:"constant",value:p(n.value.value,o.value.value,c)},n.parameters):n}evaluate(n,o,c,p,_,b){return n.kind==="constant"?n.value:n.evaluate(o,c,p,_,b)}}class ye{constructor(n){this.specification=n}possiblyEvaluate(n,o,c,p){return!!n.expression.evaluate(o,null,{},c,p)}interpolate(){return!1}}class ve{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new B(0,{});for(const c in n){const p=n[c];p.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new H(p,void 0),b=this.defaultTransitionablePropertyValues[c]=new G(p);this.defaultTransitioningPropertyValues[c]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate(o)}}}function Ne(i,n){return 256*(i=we(Math.floor(i),0,255))+we(Math.floor(n),0,255)}Ut(ce,"DataDrivenProperty"),Ut(te,"DataConstantProperty"),Ut(ye,"ColorRampProperty");const De={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class je{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ge{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $e(i,n=1){let o=0,c=0;return{members:i.map((p=>{const _=De[p.type].BYTES_PER_ELEMENT,b=o=Ye(o,Math.max(n,_)),C=p.components||1;return c=Math.max(c,_),o+=_*C,{name:p.name,type:p.type,components:C,offset:b}})),size:Ye(o,Math.max(c,n)),alignment:n}}function Ye(i,n){return Math.ceil(i/n)*n}class kt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const p=2*n;return this.int16[p+0]=o,this.int16[p+1]=c,n}}kt.prototype.bytesPerElement=4,Ut(kt,"StructArrayLayout2i4");class qe extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c)}emplace(n,o,c,p){const _=3*n;return this.int16[_+0]=o,this.int16[_+1]=c,this.int16[_+2]=p,n}}qe.prototype.bytesPerElement=6,Ut(qe,"StructArrayLayout3i6");class at extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,p)}emplace(n,o,c,p,_){const b=4*n;return this.int16[b+0]=o,this.int16[b+1]=c,this.int16[b+2]=p,this.int16[b+3]=_,n}}at.prototype.bytesPerElement=8,Ut(at,"StructArrayLayout4i8");class Qe extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C){const P=this.length;return this.resize(P+1),this.emplace(P,n,o,c,p,_,b,C)}emplace(n,o,c,p,_,b,C,P){const M=6*n,z=12*n,V=3*n;return this.int16[M+0]=o,this.int16[M+1]=c,this.uint8[z+4]=p,this.uint8[z+5]=_,this.uint8[z+6]=b,this.uint8[z+7]=C,this.float32[V+2]=P,n}}Qe.prototype.bytesPerElement=12,Ut(Qe,"StructArrayLayout2i4ub1f12");class Et extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,p)}emplace(n,o,c,p,_){const b=4*n;return this.float32[b+0]=o,this.float32[b+1]=c,this.float32[b+2]=p,this.float32[b+3]=_,n}}Et.prototype.bytesPerElement=16,Ut(Et,"StructArrayLayout4f16");class Xe extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,c,p,_)}emplace(n,o,c,p,_,b){const C=6*n,P=3*n;return this.uint16[C+0]=o,this.uint16[C+1]=c,this.uint16[C+2]=p,this.uint16[C+3]=_,this.float32[P+2]=b,n}}Xe.prototype.bytesPerElement=12,Ut(Xe,"StructArrayLayout4ui1f12");class ut extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,p)}emplace(n,o,c,p,_){const b=4*n;return this.uint16[b+0]=o,this.uint16[b+1]=c,this.uint16[b+2]=p,this.uint16[b+3]=_,n}}ut.prototype.bytesPerElement=8,Ut(ut,"StructArrayLayout4ui8");class Tt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,c,p,_,b)}emplace(n,o,c,p,_,b,C){const P=6*n;return this.int16[P+0]=o,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+3]=_,this.int16[P+4]=b,this.int16[P+5]=C,n}}Tt.prototype.bytesPerElement=12,Ut(Tt,"StructArrayLayout6i12");class vt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C,P,M,z,V,$){const K=this.length;return this.resize(K+1),this.emplace(K,n,o,c,p,_,b,C,P,M,z,V,$)}emplace(n,o,c,p,_,b,C,P,M,z,V,$,K){const X=12*n;return this.int16[X+0]=o,this.int16[X+1]=c,this.int16[X+2]=p,this.int16[X+3]=_,this.uint16[X+4]=b,this.uint16[X+5]=C,this.uint16[X+6]=P,this.uint16[X+7]=M,this.int16[X+8]=z,this.int16[X+9]=V,this.int16[X+10]=$,this.int16[X+11]=K,n}}vt.prototype.bytesPerElement=24,Ut(vt,"StructArrayLayout4i4ui4i24");class At extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,c,p,_,b)}emplace(n,o,c,p,_,b,C){const P=10*n,M=5*n;return this.int16[P+0]=o,this.int16[P+1]=c,this.int16[P+2]=p,this.float32[M+2]=_,this.float32[M+3]=b,this.float32[M+4]=C,n}}At.prototype.bytesPerElement=20,Ut(At,"StructArrayLayout3i3f20");class tn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}tn.prototype.bytesPerElement=4,Ut(tn,"StructArrayLayout1ul4");class _n extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C,P,M,z,V,$,K){const X=this.length;return this.resize(X+1),this.emplace(X,n,o,c,p,_,b,C,P,M,z,V,$,K)}emplace(n,o,c,p,_,b,C,P,M,z,V,$,K,X){const ne=20*n,le=10*n;return this.int16[ne+0]=o,this.int16[ne+1]=c,this.int16[ne+2]=p,this.int16[ne+3]=_,this.int16[ne+4]=b,this.float32[le+3]=C,this.float32[le+4]=P,this.float32[le+5]=M,this.float32[le+6]=z,this.int16[ne+14]=V,this.uint32[le+8]=$,this.uint16[ne+18]=K,this.uint16[ne+19]=X,n}}_n.prototype.bytesPerElement=40,Ut(_n,"StructArrayLayout5i4f1i1ul2ui40");class Zt extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C){const P=this.length;return this.resize(P+1),this.emplace(P,n,o,c,p,_,b,C)}emplace(n,o,c,p,_,b,C,P){const M=8*n;return this.int16[M+0]=o,this.int16[M+1]=c,this.int16[M+2]=p,this.int16[M+4]=_,this.int16[M+5]=b,this.int16[M+6]=C,this.int16[M+7]=P,n}}Zt.prototype.bytesPerElement=16,Ut(Zt,"StructArrayLayout3i2i2i16");class hn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,c,p,_)}emplace(n,o,c,p,_,b){const C=4*n,P=8*n;return this.float32[C+0]=o,this.float32[C+1]=c,this.float32[C+2]=p,this.int16[P+6]=_,this.int16[P+7]=b,n}}hn.prototype.bytesPerElement=16,Ut(hn,"StructArrayLayout2f1f2i16");class zn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,p)}emplace(n,o,c,p,_){const b=12*n,C=3*n;return this.uint8[b+0]=o,this.uint8[b+1]=c,this.float32[C+1]=p,this.float32[C+2]=_,n}}zn.prototype.bytesPerElement=12,Ut(zn,"StructArrayLayout2ub2f12");class Gn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c)}emplace(n,o,c,p){const _=3*n;return this.float32[_+0]=o,this.float32[_+1]=c,this.float32[_+2]=p,n}}Gn.prototype.bytesPerElement=12,Ut(Gn,"StructArrayLayout3f12");class nn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c)}emplace(n,o,c,p){const _=3*n;return this.uint16[_+0]=o,this.uint16[_+1]=c,this.uint16[_+2]=p,n}}nn.prototype.bytesPerElement=6,Ut(nn,"StructArrayLayout3ui6");class Wn extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re)}emplace(n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re,Pe){const et=30*n,Ke=15*n,pt=60*n;return this.int16[et+0]=o,this.int16[et+1]=c,this.int16[et+2]=p,this.float32[Ke+2]=_,this.float32[Ke+3]=b,this.uint16[et+8]=C,this.uint16[et+9]=P,this.uint32[Ke+5]=M,this.uint32[Ke+6]=z,this.uint32[Ke+7]=V,this.uint16[et+16]=$,this.uint16[et+17]=K,this.uint16[et+18]=X,this.float32[Ke+10]=ne,this.float32[Ke+11]=le,this.uint8[pt+48]=me,this.uint8[pt+49]=Ce,this.uint8[pt+50]=ge,this.uint32[Ke+13]=Ee,this.int16[et+28]=Re,this.uint8[pt+58]=Pe,n}}Wn.prototype.bytesPerElement=60,Ut(Wn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class lr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re,Pe,et,Ke,pt,Pt,nt,yt,_t,Ct){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re,Pe,et,Ke,pt,Pt,nt,yt,_t,Ct)}emplace(n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le,me,Ce,ge,Ee,Re,Pe,et,Ke,pt,Pt,nt,yt,_t,Ct,Rt){const dt=38*n,Vt=19*n;return this.int16[dt+0]=o,this.int16[dt+1]=c,this.int16[dt+2]=p,this.float32[Vt+2]=_,this.float32[Vt+3]=b,this.int16[dt+8]=C,this.int16[dt+9]=P,this.int16[dt+10]=M,this.int16[dt+11]=z,this.int16[dt+12]=V,this.int16[dt+13]=$,this.uint16[dt+14]=K,this.uint16[dt+15]=X,this.uint16[dt+16]=ne,this.uint16[dt+17]=le,this.uint16[dt+18]=me,this.uint16[dt+19]=Ce,this.uint16[dt+20]=ge,this.uint16[dt+21]=Ee,this.uint16[dt+22]=Re,this.uint16[dt+23]=Pe,this.uint16[dt+24]=et,this.uint16[dt+25]=Ke,this.uint16[dt+26]=pt,this.uint16[dt+27]=Pt,this.uint16[dt+28]=nt,this.uint32[Vt+15]=yt,this.float32[Vt+16]=_t,this.float32[Vt+17]=Ct,this.float32[Vt+18]=Rt,n}}lr.prototype.bytesPerElement=76,Ut(lr,"StructArrayLayout3i2f6i15ui1ul3f76");class cr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}cr.prototype.bytesPerElement=4,Ut(cr,"StructArrayLayout1f4");class ir extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,c,p,_)}emplace(n,o,c,p,_,b){const C=5*n;return this.float32[C+0]=o,this.float32[C+1]=c,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=b,n}}ir.prototype.bytesPerElement=20,Ut(ir,"StructArrayLayout5f20");class Li extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,p)}emplace(n,o,c,p,_){const b=6*n;return this.uint32[3*n+0]=o,this.uint16[b+2]=c,this.uint16[b+3]=p,this.uint16[b+4]=_,n}}Li.prototype.bytesPerElement=12,Ut(Li,"StructArrayLayout1ul3ui12");class qr extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const p=2*n;return this.uint16[p+0]=o,this.uint16[p+1]=c,n}}qr.prototype.bytesPerElement=4,Ut(qr,"StructArrayLayout2ui4");class Ks extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Ks.prototype.bytesPerElement=2,Ut(Ks,"StructArrayLayout1ui2");class _o extends Ge{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const p=2*n;return this.float32[p+0]=o,this.float32[p+1]=c,n}}_o.prototype.bytesPerElement=8,Ut(_o,"StructArrayLayout2f8");class Mn extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Mn.prototype.size=40;class mr extends _n{get(n){return new Mn(this,n)}}Ut(mr,"CollisionBoxArray");class nr extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}nr.prototype.size=60;class Wr extends Wn{get(n){return new nr(this,n)}}Ut(Wr,"PlacedSymbolArray");class Oi extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Oi.prototype.size=76;class wr extends lr{get(n){return new Oi(this,n)}}Ut(wr,"SymbolInstanceArray");class pi extends cr{getoffsetX(n){return this.float32[1*n+0]}}Ut(pi,"GlyphOffsetArray");class Or extends kt{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ut(Or,"SymbolLineVertexArray");class Fr extends je{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fr.prototype.size=12;class Jr extends Li{get(n){return new Fr(this,n)}}Ut(Jr,"FeatureIndexArray");class vo extends qr{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ut(vo,"FillExtrusionCentroidArray");const xo=$e([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Lo=$e([{name:"a_dash",components:4,type:"Uint16"}]);var Pd={exports:{}},mi={exports:{}};mi.exports=function(i,n){var o,c,p,_,b,C,P,M;for(c=i.length-(o=3&i.length),p=n,b=3432918353,C=461845907,M=0;M<c;)P=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,p=27492+(65535&(_=5*(65535&(p=(p^=P=(65535&(P=(P=(65535&P)*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*C+(((P>>>16)*C&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(P=0,o){case 3:P^=(255&i.charCodeAt(M+2))<<16;case 2:P^=(255&i.charCodeAt(M+1))<<8;case 1:p^=P=(65535&(P=(P=(65535&(P^=255&i.charCodeAt(M)))*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*C+(((P>>>16)*C&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var ju=mi.exports,Sp={exports:{}};Sp.exports=function(i,n){for(var o,c=i.length,p=n^c,_=0;c>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++_;switch(c){case 3:p^=(255&i.charCodeAt(_+2))<<16;case 2:p^=(255&i.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Ep=ju,Qa=Sp.exports;Pd.exports=Ep,Pd.exports.murmur3=Ep,Pd.exports.murmur2=Qa;var wo=ie(Pd.exports);class jc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,o,c,p){this.ids.push(Cp(n)),this.positions.push(o,c,p)}getPositions(n){const o=Cp(n);let c=0,p=this.ids.length-1;for(;c<p;){const b=c+p>>1;this.ids[b]>=o?p=b:c=b+1}const _=[];for(;this.ids[c]===o;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(n,o){const c=new Float64Array(n.ids),p=new Uint32Array(n.positions);return Qh(c,p,0,c.length-1),o&&o.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(n){const o=new jc;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o}}function Cp(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:wo(String(i))}function Qh(i,n,o,c){for(;o<c;){const p=i[o+c>>1];let _=o-1,b=c+1;for(;;){do _++;while(i[_]<p);do b--;while(i[b]>p);if(_>=b)break;ef(i,_,b),ef(n,3*_,3*b),ef(n,3*_+1,3*b+1),ef(n,3*_+2,3*b+2)}b-o<c-b?(Qh(i,n,o,b),o=b+1):(Qh(i,n,b+1,c),c=b)}}function ef(i,n,o){const c=i[n];i[n]=i[o],i[o]=c}Ut(jc,"FeaturePositionMap");class el{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}}class tf extends el{constructor(n){super(n),this.current=0}set(n,o,c){this.fetchUniformLocation(n,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class lg extends el{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,c){this.fetchUniformLocation(n,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class cg extends el{constructor(n){super(n),this.current=xr.transparent}set(n,o,c){this.fetchUniformLocation(n,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const f_=new Float32Array(16),p_=new Float32Array(9),m_=new Float32Array(4);function Du(i){return[Ne(255*i.r,255*i.g),Ne(255*i.b,255*i.a)]}class Md{constructor(n,o,c){this.value=n,this.uniformNames=o.map((p=>`u_${p}`)),this.type=c}setUniform(n,o,c,p,_){o.set(n,_,p.constantOr(this.value))}getBinding(n,o){return this.type==="color"?new cg(n):new tf(n)}}class Ol{constructor(n,o){this.uniformNames=o.map((c=>`u_${c}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,c,p,_){const b=_==="u_pattern"||_==="u_dash"?this.pattern:_==="u_pixel_ratio"?this.pixelRatio:null;b&&o.set(n,_,b)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new lg(n):new tf(n)}}class na{constructor(n,o,c,p){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map((_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(n,o,c,p,_,b){const C=this.paintVertexArray.length,P=this.expression.evaluate(new B(0),o,{},_,p,b);this.paintVertexArray.resize(n),this._setPaintValue(C,n,P)}updatePaintArray(n,o,c,p,_){const b=this.expression.evaluate({zoom:0},c,p,void 0,_);this._setPaintValue(n,o,b)}_setPaintValue(n,o,c){if(this.type==="color"){const p=Du(c);for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ra{constructor(n,o,c,p,_,b){this.expression=n,this.uniformNames=o.map((C=>`u_${C}_t`)),this.type=c,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map((C=>({name:`a_${C}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(n,o,c,p,_,b){const C=this.expression.evaluate(new B(this.zoom),o,{},_,p,b),P=this.expression.evaluate(new B(this.zoom+1),o,{},_,p,b),M=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(M,n,C,P)}updatePaintArray(n,o,c,p,_){const b=this.expression.evaluate({zoom:this.zoom},c,p,void 0,_),C=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,_);this._setPaintValue(n,o,b,C)}_setPaintValue(n,o,c,p){if(this.type==="color"){const _=Du(c),b=Du(p);for(let C=n;C<o;C++)this.paintVertexArray.emplace(C,_[0],_[1],b[0],b[1])}else{for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,c,p,_){const b=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,C=we(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);o.set(n,_,C)}getBinding(n,o){return new tf(n)}}class tl{constructor(n,o,c,p,_){this.expression=n,this.layerId=_,this.paintVertexAttributes=(c==="array"?Lo:xo).members;for(let b=0;b<o.length;++b);this.paintVertexArray=new p}populatePaintArray(n,o,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(n,o,c,p,_,b){this._setPaintValues(n,o,c.patterns&&c.patterns[this.layerId],b)}_setPaintValues(n,o,c,p){if(!p||!c)return;const _=p[c];if(!_)return;const{tl:b,br:C,pixelRatio:P}=_;for(let M=n;M<o;M++)this.paintVertexArray.emplace(M,b[0],b[1],C[0],C[1],P)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zl{constructor(n,o,c=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const _ in n.paint._values){if(!c(_))continue;const b=n.paint.get(_);if(!(b instanceof he&&Al(b.property.specification)))continue;const C=y_(_,n.type),P=b.value,M=b.property.specification.type,z=!!b.property.useIntegerZoom,V=_==="line-dasharray"||_.endsWith("pattern"),$=_==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||$)if(P.kind==="source"||$||V){const K=dg(_,M,"source");this.binders[_]=V?new tl(P,C,M,K,n.id):new na(P,C,M,K),p.push(`/a_${_}`)}else{const K=dg(_,M,"composite");this.binders[_]=new ra(P,C,M,z,o,K),p.push(`/z_${_}`)}else this.binders[_]=V?new Ol(P.value,C):new Md(P.value,C,M),p.push(`/u_${_}`)}this.cacheKey=p.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof na||o instanceof ra?o.maxValue:0}populatePaintArrays(n,o,c,p,_,b){for(const C in this.binders){const P=this.binders[C];(P instanceof na||P instanceof ra||P instanceof tl)&&P.populatePaintArray(n,o,c,p,_,b)}}setConstantPatternPositions(n){for(const o in this.binders){const c=this.binders[o];c instanceof Ol&&c.setConstantPatternPositions(n)}}updatePaintArrays(n,o,c,p,_,b){let C=!1;for(const P in n){const M=o.getPositions(P);for(const z of M){const V=c.feature(z.index);for(const $ in this.binders){const K=this.binders[$];if((K instanceof na||K instanceof ra||K instanceof tl)&&K.expression.isStateDependent===!0){const X=p.paint.get($);K.expression=X.value,K.updatePaintArray(z.start,z.end,V,n[P],_,b),C=!0}}}}return C}defines(){const n=[];for(const o in this.binders){const c=this.binders[o];(c instanceof Md||c instanceof Ol)&&n.push(...c.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof na||c instanceof ra||c instanceof tl)for(let p=0;p<c.paintVertexAttributes.length;p++)n.push(c.paintVertexAttributes[p].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Md||c instanceof Ol||c instanceof ra)for(const p of c.uniformNames)n.push(p)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Md||p instanceof Ol||p instanceof ra)for(const _ of p.uniformNames)o.push({name:_,property:c,binding:p.getBinding(n,_)})}return o}setUniforms(n,o,c,p,_){for(const{name:b,property:C,binding:P}of c)this.binders[C].setUniform(n,P,_,p.get(C),b)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof na||o instanceof ra||o instanceof tl)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const c=this.binders[o];(c instanceof na||c instanceof ra||c instanceof tl)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof na||o instanceof ra||o instanceof tl)&&o.destroy()}}}class Dc{constructor(n,o,c=(()=>!0)){this.programConfigurations={};for(const p of n)this.programConfigurations[p.id]=new zl(p,o,c);this.needsUpload=!1,this._featureMap=new jc,this._bufferOffset=0}populatePaintArrays(n,o,c,p,_,b,C){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(n,o,p,_,b,C);o.id!==void 0&&this._featureMap.add(o.id,c,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,c,p,_){for(const b of c)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(n,this._featureMap,o,b,p,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const g_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function y_(i,n){return g_[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const ug={"line-pattern":{source:Xe,composite:Xe},"fill-pattern":{source:Xe,composite:Xe},"fill-extrusion-pattern":{source:Xe,composite:Xe},"line-dasharray":{source:ut,composite:ut}},__={color:{source:_o,composite:Et},number:{source:cr,composite:_o}};function dg(i,n,o){const c=ug[i];return c&&c[o]||__[n][o]}Ut(Md,"ConstantBinder"),Ut(Ol,"PatternConstantBinder"),Ut(na,"SourceExpressionBinder"),Ut(tl,"PatternCompositeBinder"),Ut(ra,"CompositeExpressionBinder"),Ut(zl,"ProgramConfiguration",{omit:["_buffers"]}),Ut(Dc,"ProgramConfigurationSet");const hg="-transition";class Sa extends ks{constructor(n,o){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),o.layout&&(this._unevaluatedLayout=new fe(o.layout)),o.paint)){this._transitionablePaint=new ee(o.paint);for(const c in n.paint)this.setPaintProperty(c,n.paint[c],{validate:!1});for(const c in n.layout)this.setLayoutProperty(c,n.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pe(o.paint)}}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o,c={}){o!=null&&this._validate(Nl,`layers.${this.id}.layout.${n}`,n,o,c)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,o):this.visibility=o)}getPaintProperty(n){return Rn(n,hg)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,c={}){if(o!=null&&this._validate(js,`layers.${this.id}.paint.${n}`,n,o,c))return!1;if(Rn(n,hg))return this._transitionablePaint.setTransition(n.slice(0,-11),o||void 0),!1;{const p=this._transitionablePaint._values[n],_=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(n,o),this._handleSpecialPaintPropertyUpdate(n);const C=this._transitionablePaint._values[n].value,P=C.isDataDriven(),M=Rn(n,"pattern")||n==="line-dasharray";return P||_||M||this._handleOverridablePaintPropertyUpdate(n,b,C)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,o,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),kr(n,((o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length)))}_validate(n,o,c,p,_={}){return(!_||_.validate!==!1)&&fs(this,n.call(Gi,{key:o,layerType:this.type,objectKey:c,value:p,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof he&&Al(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const v_=$e([{name:"a_pos",components:2,type:"Int16"}],4),ix=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class li{constructor(n=[]){this.segments=n}prepareSegment(n,o,c,p){let _=this.segments[this.segments.length-1];return n>li.MAX_VERTEX_ARRAY_LENGTH&&Jn(`Max vertices per segment is ${li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!_||_.vertexLength+n>li.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,c,p){return new li([{vertexOffset:n,primitiveOffset:o,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut(li,"SegmentVector");var ln=8192;class Bl{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof fn?new fn(n.lng,n.lat):fn.convert(n),this}setSouthWest(n){return this._sw=n instanceof fn?new fn(n.lng,n.lat):fn.convert(n),this}extend(n){const o=this._sw,c=this._ne;let p,_;if(n instanceof fn)p=n,_=n;else{if(!(n instanceof Bl))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Bl.convert(n)):this.extend(fn.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(fn.convert(n)):this;if(p=n._sw,_=n._ne,!p||!_)return this}return o||c?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new fn(p.lng,p.lat),this._ne=new fn(_.lng,_.lat)),this}getCenter(){return new fn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fn(this.getWest(),this.getNorth())}getSouthEast(){return new fn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:c}=fn.convert(n);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(n){return!n||n instanceof Bl?n:new Bl(n)}}var nf=1e-6,ps=typeof Float32Array<"u"?Float32Array:Array;function x_(){var i=new ps(9);return ps!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function w_(i,n,o){var c=n[0],p=n[1],_=n[2],b=n[3],C=n[4],P=n[5],M=n[6],z=n[7],V=n[8],$=o[0],K=o[1],X=o[2],ne=o[3],le=o[4],me=o[5],Ce=o[6],ge=o[7],Ee=o[8];return i[0]=$*c+K*b+X*M,i[1]=$*p+K*C+X*z,i[2]=$*_+K*P+X*V,i[3]=ne*c+le*b+me*M,i[4]=ne*p+le*C+me*z,i[5]=ne*_+le*P+me*V,i[6]=Ce*c+ge*b+Ee*M,i[7]=Ce*p+ge*C+Ee*z,i[8]=Ce*_+ge*P+Ee*V,i}function Ea(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Oo(i,n){var o=n[0],c=n[1],p=n[2],_=n[3],b=n[4],C=n[5],P=n[6],M=n[7],z=n[8],V=n[9],$=n[10],K=n[11],X=n[12],ne=n[13],le=n[14],me=n[15],Ce=o*C-c*b,ge=o*P-p*b,Ee=o*M-_*b,Re=c*P-p*C,Pe=c*M-_*C,et=p*M-_*P,Ke=z*ne-V*X,pt=z*le-$*X,Pt=z*me-K*X,nt=V*le-$*ne,yt=V*me-K*ne,_t=$*me-K*le,Ct=Ce*_t-ge*yt+Ee*nt+Re*Pt-Pe*pt+et*Ke;return Ct?(i[0]=(C*_t-P*yt+M*nt)*(Ct=1/Ct),i[1]=(p*yt-c*_t-_*nt)*Ct,i[2]=(ne*et-le*Pe+me*Re)*Ct,i[3]=($*Pe-V*et-K*Re)*Ct,i[4]=(P*Pt-b*_t-M*pt)*Ct,i[5]=(o*_t-p*Pt+_*pt)*Ct,i[6]=(le*Ee-X*et-me*ge)*Ct,i[7]=(z*et-$*Ee+K*ge)*Ct,i[8]=(b*yt-C*Pt+M*Ke)*Ct,i[9]=(c*Pt-o*yt-_*Ke)*Ct,i[10]=(X*Pe-ne*Ee+me*Ce)*Ct,i[11]=(V*Ee-z*Pe-K*Ce)*Ct,i[12]=(C*pt-b*nt-P*Ke)*Ct,i[13]=(o*nt-c*pt+p*Ke)*Ct,i[14]=(ne*ge-X*Re-le*Ce)*Ct,i[15]=(z*Re-V*ge+$*Ce)*Ct,i):null}function Fl(i,n,o){var c=n[0],p=n[1],_=n[2],b=n[3],C=n[4],P=n[5],M=n[6],z=n[7],V=n[8],$=n[9],K=n[10],X=n[11],ne=n[12],le=n[13],me=n[14],Ce=n[15],ge=o[0],Ee=o[1],Re=o[2],Pe=o[3];return i[0]=ge*c+Ee*C+Re*V+Pe*ne,i[1]=ge*p+Ee*P+Re*$+Pe*le,i[2]=ge*_+Ee*M+Re*K+Pe*me,i[3]=ge*b+Ee*z+Re*X+Pe*Ce,i[4]=(ge=o[4])*c+(Ee=o[5])*C+(Re=o[6])*V+(Pe=o[7])*ne,i[5]=ge*p+Ee*P+Re*$+Pe*le,i[6]=ge*_+Ee*M+Re*K+Pe*me,i[7]=ge*b+Ee*z+Re*X+Pe*Ce,i[8]=(ge=o[8])*c+(Ee=o[9])*C+(Re=o[10])*V+(Pe=o[11])*ne,i[9]=ge*p+Ee*P+Re*$+Pe*le,i[10]=ge*_+Ee*M+Re*K+Pe*me,i[11]=ge*b+Ee*z+Re*X+Pe*Ce,i[12]=(ge=o[12])*c+(Ee=o[13])*C+(Re=o[14])*V+(Pe=o[15])*ne,i[13]=ge*p+Ee*P+Re*$+Pe*le,i[14]=ge*_+Ee*M+Re*K+Pe*me,i[15]=ge*b+Ee*z+Re*X+Pe*Ce,i}function Lc(i,n,o){var c,p,_,b,C,P,M,z,V,$,K,X,ne=o[0],le=o[1],me=o[2];return n===i?(i[12]=n[0]*ne+n[4]*le+n[8]*me+n[12],i[13]=n[1]*ne+n[5]*le+n[9]*me+n[13],i[14]=n[2]*ne+n[6]*le+n[10]*me+n[14],i[15]=n[3]*ne+n[7]*le+n[11]*me+n[15]):(p=n[1],_=n[2],b=n[3],C=n[4],P=n[5],M=n[6],z=n[7],V=n[8],$=n[9],K=n[10],X=n[11],i[0]=c=n[0],i[1]=p,i[2]=_,i[3]=b,i[4]=C,i[5]=P,i[6]=M,i[7]=z,i[8]=V,i[9]=$,i[10]=K,i[11]=X,i[12]=c*ne+C*le+V*me+n[12],i[13]=p*ne+P*le+$*me+n[13],i[14]=_*ne+M*le+K*me+n[14],i[15]=b*ne+z*le+X*me+n[15]),i}function Oc(i,n,o){var c=o[0],p=o[1],_=o[2];return i[0]=n[0]*c,i[1]=n[1]*c,i[2]=n[2]*c,i[3]=n[3]*c,i[4]=n[4]*p,i[5]=n[5]*p,i[6]=n[6]*p,i[7]=n[7]*p,i[8]=n[8]*_,i[9]=n[9]*_,i[10]=n[10]*_,i[11]=n[11]*_,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function kp(i,n,o){var c=Math.sin(o),p=Math.cos(o),_=n[4],b=n[5],C=n[6],P=n[7],M=n[8],z=n[9],V=n[10],$=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=_*p+M*c,i[5]=b*p+z*c,i[6]=C*p+V*c,i[7]=P*p+$*c,i[8]=M*p-_*c,i[9]=z*p-b*c,i[10]=V*p-C*c,i[11]=$*p-P*c,i}function rf(i,n,o){var c=Math.sin(o),p=Math.cos(o),_=n[0],b=n[1],C=n[2],P=n[3],M=n[8],z=n[9],V=n[10],$=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=_*p-M*c,i[1]=b*p-z*c,i[2]=C*p-V*c,i[3]=P*p-$*c,i[8]=_*c+M*p,i[9]=b*c+z*p,i[10]=C*c+V*p,i[11]=P*c+$*p,i}function Ap(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lu(i,n,o){var c,p,_,b=o[0],C=o[1],P=o[2],M=Math.hypot(b,C,P);return M<nf?null:(b*=M=1/M,C*=M,P*=M,c=Math.sin(n),p=Math.cos(n),i[0]=b*b*(_=1-p)+p,i[1]=C*b*_+P*c,i[2]=P*b*_-C*c,i[3]=0,i[4]=b*C*_-P*c,i[5]=C*C*_+p,i[6]=P*C*_+b*c,i[7]=0,i[8]=b*P*_+C*c,i[9]=C*P*_-b*c,i[10]=P*P*_+p,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var fg=Fl;function sf(){var i=new ps(3);return ps!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function b_(i){var n=new ps(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n}function Id(i){return Math.hypot(i[0],i[1],i[2])}function Ou(i,n,o){var c=new ps(3);return c[0]=i,c[1]=n,c[2]=o,c}function nl(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i}function Pp(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i}function pg(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i}function of(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i}function Qi(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i}function Vr(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i}function Rd(i,n,o,c){return i[0]=n[0]+o[0]*c,i[1]=n[1]+o[1]*c,i[2]=n[2]+o[2]*c,i}function ms(i,n){var o=n[0],c=n[1],p=n[2],_=o*o+c*c+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=n[0]*_,i[1]=n[1]*_,i[2]=n[2]*_,i}function zo(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}function Mp(i,n,o){var c=n[0],p=n[1],_=n[2],b=o[0],C=o[1],P=o[2];return i[0]=p*P-_*C,i[1]=_*b-c*P,i[2]=c*C-p*b,i}function Zr(i,n,o){var c=n[0],p=n[1],_=n[2],b=o[3]*c+o[7]*p+o[11]*_+o[15];return i[0]=(o[0]*c+o[4]*p+o[8]*_+o[12])/(b=b||1),i[1]=(o[1]*c+o[5]*p+o[9]*_+o[13])/b,i[2]=(o[2]*c+o[6]*p+o[10]*_+o[14])/b,i}function Ip(i,n,o){var c=o[0],p=o[1],_=o[2],b=n[0],C=n[1],P=n[2],M=p*P-_*C,z=_*b-c*P,V=c*C-p*b,$=p*V-_*z,K=_*M-c*V,X=c*z-p*M,ne=2*o[3];return z*=ne,V*=ne,K*=2,X*=2,i[0]=b+(M*=ne)+($*=2),i[1]=C+z+K,i[2]=P+V+X,i}var Nd,Bo=Pp,T_=pg,S_=Id;function Rp(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i}function Np(i,n){var o=n[0],c=n[1],p=n[2],_=n[3],b=o*o+c*c+p*p+_*_;return b>0&&(b=1/Math.sqrt(b)),i[0]=o*b,i[1]=c*b,i[2]=p*b,i[3]=_*b,i}function zc(i,n,o){var c=n[0],p=n[1],_=n[2],b=n[3];return i[0]=o[0]*c+o[4]*p+o[8]*_+o[12]*b,i[1]=o[1]*c+o[5]*p+o[9]*_+o[13]*b,i[2]=o[2]*c+o[6]*p+o[10]*_+o[14]*b,i[3]=o[3]*c+o[7]*p+o[11]*_+o[15]*b,i}function jp(){var i=new ps(4);return ps!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function af(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function E_(i,n,o){o*=.5;var c=n[0],p=n[1],_=n[2],b=n[3],C=Math.sin(o),P=Math.cos(o);return i[0]=c*P+b*C,i[1]=p*P+_*C,i[2]=_*P-p*C,i[3]=b*P-c*C,i}function mg(i,n,o){o*=.5;var c=n[0],p=n[1],_=n[2],b=n[3],C=Math.sin(o),P=Math.cos(o);return i[0]=c*P-_*C,i[1]=p*P+b*C,i[2]=_*P+c*C,i[3]=b*P-p*C,i}sf(),Nd=new ps(4),ps!=Float32Array&&(Nd[0]=0,Nd[1]=0,Nd[2]=0,Nd[3]=0);var gg=Np;sf(),Ou(1,0,0),Ou(0,1,0),jp(),jp(),x_();const C_=$e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lf}=C_,rl=$e([{name:"a_pos_3",components:3,type:"Int16"}]);var cf=$e([{name:"a_pos",type:"Int16",components:2}]);class Dp{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,c){const p=zo(o,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/p;return c[0]=this.pos[0]+this.dir[0]*_,c[1]=this.pos[1]+this.dir[1]*_,c[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(n,o,c){if((function(K,X){var ne=K[0],le=K[1],me=K[2],Ce=X[0],ge=X[1],Ee=X[2];return Math.abs(ne-Ce)<=nf*Math.max(1,Math.abs(ne),Math.abs(Ce))&&Math.abs(le-ge)<=nf*Math.max(1,Math.abs(le),Math.abs(ge))&&Math.abs(me-Ee)<=nf*Math.max(1,Math.abs(me),Math.abs(Ee))})(this.pos,n)||o===0)return c[0]=c[1]=c[2]=0,!1;const[p,_,b]=this.dir,C=this.pos[0]-n[0],P=this.pos[1]-n[1],M=this.pos[2]-n[2],z=p*p+_*_+b*b,V=2*(C*p+P*_+M*b),$=V*V-4*z*(C*C+P*P+M*M-o*o);if($<0){const K=Math.max(-V/2,0),X=C+p*K,ne=P+_*K,le=M+b*K,me=Math.hypot(X,ne,le);return c[0]=X*o/me,c[1]=ne*o/me,c[2]=le*o/me,!1}{const K=(-V-Math.sqrt($))/(2*z);if(K<0){const X=Math.hypot(C,P,M);return c[0]=C*o/X,c[1]=P*o/X,c[2]=M*o/X,!1}return c[0]=C+p*K,c[1]=P+_*K,c[2]=M+b*K,!0}}}class uf{constructor(n,o,c,p,_){this.TL=n,this.TR=o,this.BR=c,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(n,o,c){const p=[-1,1,1],_=[1,1,1],b=[1,-1,1],C=[-1,-1,1],P=Zr(p,p,n),M=Zr(_,_,n),z=Zr(b,b,n),V=Zr(C,C,n);return new uf(P,M,z,V,o/c)}}class Lp{constructor(n,o){this.points=n,this.planes=o}static fromInvProjectionMatrix(n,o,c,p){const _=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const M=zc([],P,n),z=1/M[3]/o*_;return(function(V,$,K){return V[0]=$[0]*K[0],V[1]=$[1]*K[1],V[2]=$[2]*K[2],V[3]=$[3]*K[3],V})(M,M,[z,z,p?1/M[3]:z,z])})),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const M=ms([],Mp([],Bo([],b[P[0]],b[P[1]]),Bo([],b[P[2]],b[P[1]]))),z=-zo(M,b[P[1]]);return M.concat(z)}));return new Lp(b,C)}}class gs{static fromPoints(n){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of n)of(o,o,p),Qi(c,c,p);return new gs(o,c)}static applyTransform(n,o){const c=n.getCorners();for(let p=0;p<c.length;++p)Zr(c[p],c[p],o);return gs.fromPoints(c)}constructor(n,o){this.min=n,this.max=o,this.center=Vr([],nl([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],c=b_(this.min),p=b_(this.max);for(let _=0;_<o.length;_++)c[_]=o[_]?this.min[_]:this.center[_],p[_]=o[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new gs(c,p)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){const o=this.getCorners();let c=!0;for(let p=0;p<n.planes.length;p++){const _=n.planes[p];let b=0;for(let C=0;C<o.length;C++)b+=zo(_,o[C])+_[3]>=0;if(b===0)return 0;b!==o.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let _=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let C=0;C<n.points.length;C++){const P=n.points[C][p]-this.min[p];_=Math.min(_,P),b=Math.max(b,P)}if(b<0||_>this.max[p]-this.min[p])return 0}return 1}}const zu=5,ys=6,il=ln/Math.PI/2,sx=16383,sl=64,zi=[sl,32,16],ia=-il,Qt=il,jd=[new gs([ia,ia,ia],[Qt,Qt,Qt]),new gs([ia,ia,ia],[0,0,Qt]),new gs([0,ia,ia],[Qt,0,Qt]),new gs([ia,0,ia],[0,Qt,Qt]),new gs([0,0,ia],[Qt,Qt,Qt])];function Dd(i){return i*il/Bc}function yg(i,n,o,c=!0){const p=Vr([],i._camera.position,i.worldSize),_=[n,o,1,1];zc(_,_,i.pixelMatrixInverse),Rp(_,_,1/_[3]);const b=ms([],Bo([],_,p)),C=i.globeMatrix,P=[C[12],C[13],C[14]],M=Bo([],P,p),z=Id(M),V=ms([],M),$=i.worldSize/(2*Math.PI),K=zo(V,b),X=Math.asin($/z);if(X<Math.acos(K)){if(!c)return null;const Pt=[],nt=[];Vr(Pt,b,z/K),ms(nt,Bo(nt,Pt,M)),ms(b,nl(b,M,Vr(b,nt,Math.tan(X)*z)))}const ne=[];new Dp(p,b).closestPointOnSphere(P,$,ne);const le=ms([],zs(C,0)),me=ms([],zs(C,1)),Ce=ms([],zs(C,2)),ge=zo(le,ne),Ee=zo(me,ne),Re=zo(Ce,ne),Pe=gt(Math.asin(-Ee/$));let et=gt(Math.atan2(ge,Re));et=i.center.lng+(function(Pt,nt){const yt=(nt-Pt+180)%360-180;return yt<-180?yt+360:yt})(i.center.lng,et);const Ke=Mr(et),pt=we($r(Pe),0,1);return new Fc(Ke,pt)}class ox{constructor(n,o,c){this.a=Bo([],n,c),this.b=Bo([],o,c),this.center=c;const p=ms([],this.a),_=ms([],this.b);this.angle=Math.acos(zo(p,_))}}function Bu(i,n){if(i.angle===0)return null;let o;return o=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:(function(c,p,_,b){const C=Math.sin(_);return c*(Math.sin((1-b)*_)/C)+p*(Math.sin(b*_)/C)})(i.a[n],i.b[n],i.angle,we(o,0,1))+i.center[n]}function Fo(i){if(i.z<=1)return jd[i.z+2*i.y+i.x];const n=df(Ld(i));return gs.fromPoints(n)}function Vl(i,n,o){return Vr(i,i,1-o),Rd(i,i,n,o)}function _g(i,n){const o=Od(n.zoom);if(o===0)return Fo(i);const c=Ld(i),p=df(c),_=Mr(c.getWest())*n.worldSize,b=Mr(c.getEast())*n.worldSize,C=$r(c.getNorth())*n.worldSize,P=$r(c.getSouth())*n.worldSize,M=[_,C,0],z=[b,C,0],V=[_,P,0],$=[b,P,0],K=Oo([],n.globeMatrix);return Zr(M,M,K),Zr(z,z,K),Zr(V,V,K),Zr($,$,K),p[0]=Vl(p[0],V,o),p[1]=Vl(p[1],$,o),p[2]=Vl(p[2],z,o),p[3]=Vl(p[3],M,o),gs.fromPoints(p)}function vg(i,n,o){for(const c of i)Zr(c,c,n),Vr(c,c,o)}function k_(i,n,o){const c=n/i.worldSize,p=i.globeMatrix;if(o.z<=1){const Ke=Fo(o).getCorners();return vg(Ke,p,c),gs.fromPoints(Ke)}const _=Ld(o),b=df(_);vg(b,p,c);const C=Number.MAX_VALUE,P=[-C,-C,-C],M=[C,C,C];if(_.contains(i.center)){for(const Pt of b)of(M,M,Pt),Qi(P,P,Pt);P[2]=0;const Ke=i.point,pt=[Ke.x*c,Ke.y*c,0];return of(M,M,pt),Qi(P,P,pt),new gs(M,P)}const z=[p[12]*c,p[13]*c,p[14]*c],V=_.getCenter(),$=we(i.center.lat,-Qr,Qr),K=we(V.lat,-Qr,Qr),X=Mr(i.center.lng),ne=$r($);let le=X-Mr(V.lng);const me=ne-$r(K);le>.5?le-=1:le<-.5&&(le+=1);let Ce=0;Math.abs(le)>Math.abs(me)?Ce=le>=0?1:3:(Ce=me>=0?0:2,Rd(z,z,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(mt(me>=0?_.getSouth():_.getNorth()))*il));const ge=b[Ce],Ee=b[(Ce+1)%4],Re=new ox(ge,Ee,z),Pe=[Bu(Re,0)||ge[0],Bu(Re,1)||ge[1],Bu(Re,2)||ge[2]],et=Od(i.zoom);if(et>0){const Ke=(function({x:Pt,y:nt,z:yt},_t,Ct,Rt,dt){const Vt=1/(1<<yt);let en=Pt*Vt,Ht=en+Vt,Dn=nt*Vt,Dt=Dn+Vt,dn=0;const Ln=(en+Ht)/2-Rt;return Ln>.5?dn=-1:Ln<-.5&&(dn=1),en=((en+dn)*_t-(Rt*=_t))*Ct+Rt,Ht=((Ht+dn)*_t-Rt)*Ct+Rt,Dn=(Dn*_t-(dt*=_t))*Ct+dt,Dt=(Dt*_t-dt)*Ct+dt,[[en,Dt,0],[Ht,Dt,0],[Ht,Dn,0],[en,Dn,0]]})(o,n,i._pixelsPerMercatorPixel,X,ne);for(let Pt=0;Pt<b.length;Pt++)Vl(b[Pt],Ke[Pt],et);const pt=nl([],Ke[Ce],Ke[(Ce+1)%4]);Vr(pt,pt,.5),Vl(Pe,pt,et)}for(const Ke of b)of(M,M,Ke),Qi(P,P,Ke);return M[2]=Math.min(ge[2],Ee[2]),of(M,M,Pe),Qi(P,P,Pe),new gs(M,P)}function Ld({x:i,y:n,z:o}){const c=1/(1<<o),p=new fn(es(i*c),ur((n+1)*c)),_=new fn(es((i+1)*c),ur(n*c));return new Bl(p,_)}function df(i){const n=mt(i.getNorth()),o=mt(i.getSouth()),c=Math.cos(n),p=Math.cos(o),_=Math.sin(n),b=Math.sin(o),C=i.getWest(),P=i.getEast();return[gi(p,b,C),gi(p,b,P),gi(c,_,P),gi(c,_,C)]}function gi(i,n,o,c=il){return o=mt(o),[i*Math.sin(o)*c,-n*c,i*Math.cos(o)*c]}function Ds(i,n,o){return gi(Math.cos(mt(i)),Math.sin(mt(i)),n,o)}function sa(i,n,o,c){const p=1<<o.z,_=(i/ln+o.x)/p;return Ds(ur((n/ln+o.y)/p),es(_),c)}function hf({min:i,max:n}){return sx/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const xg=new Float64Array(16);function Xs(i){const n=hf(i),o=Ap(xg,[n,n,n]);return Lc(o,o,((c=[])[0]=-(p=i.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function Op(i){const n=(c=i.min,(o=xg)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=c[0],o[13]=c[1],o[14]=c[2],o[15]=1,o);var o,c;const p=1/hf(i);return Oc(n,n,[p,p,p])}function Ca(i,n,o,c,p){const _=(function(P){const M=ln/(2*Math.PI);return P/(2*Math.PI)/M})(o),b=[i,n,-o/(2*Math.PI)],C=Ea(new Float64Array(16));return Lc(C,C,b),Oc(C,C,[_,_,_]),kp(C,C,mt(-p)),rf(C,C,mt(-c)),C}function Od(i){return st(zu,ys,i)}function wg(i,n){const o=Ds(n.lat,n.lng),c=(function(X){const ne=Ds(X._center.lat,X._center.lng);let le=Mp([],Ou(0,1,0),ne);const me=Lu([],-X.angle,ne);le=Zr(le,le,me),Lu(me,-X._pitch,le);const Ce=ms([],ne);return Vr(Ce,Ce,Dd(X.cameraToCenterDistance/X.pixelsPerMeter)),Zr(Ce,Ce,me),nl([],ne,Ce)})(i);return b=(p=Pp([],c,o))[0],C=p[1],P=p[2],M=(_=o)[0],z=_[1],V=_[2],K=($=Math.sqrt(b*b+C*C+P*P)*Math.sqrt(M*M+z*z+V*V))&&zo(p,_)/$,Math.acos(Math.min(Math.max(K,-1),1));var p,_,b,C,P,M,z,V,$,K}function zp(i,n){return wg(i,n)>Math.PI/2*1.01}const bg=mt(85),A_=Math.cos(bg),ax=Math.sin(bg),Bc=63710088e-1,Bp=2*Math.PI*Bc;class qi{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qi(ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,c=this.lat*o,p=n.lat*o,_=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((n.lng-this.lng)*o);return Bc*Math.acos(Math.min(_,1))}toBounds(n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new Bl(new qi(this.lng-c,this.lat-o),new qi(this.lng+c,this.lat+o))}toEcef(n){const o=Dd(n);return Ds(this.lat,this.lng,il+o)}static convert(n){if(n instanceof qi)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new qi(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new qi(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var fn=qi;function Bi(i){return Bp*Math.cos(i*Math.PI/180)}function Mr(i){return(180+i)/360}function $r(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ci(i,n){return i/Bi(n)}function es(i){return 360*i-180}function ur(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function zd(i,n){return i*Bi(ur(n))}const Qr=85.051129;function ff(i){return 1/Math.cos(i*Math.PI/180)}class Fc{constructor(n,o,c=0){this.x=+n,this.y=+o,this.z=+c}static fromLngLat(n,o=0){const c=fn.convert(n);return new Fc(Mr(c.lng),$r(c.lat),ci(o,c.lat))}toLngLat(){return new fn(es(this.x),ur(this.y))}toAltitude(){return zd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bp*ff(ur(this.y))}}function Fu(i,n,o,c,p,_,b,C,P){const M=(n+c)/2,z=(o+p)/2,V=new Me(M,z);C(V),(function($,K,X,ne,le,me){const Ce=X-le,ge=ne-me;return Math.abs((ne-K)*Ce-(X-$)*ge)/Math.hypot(Ce,ge)})(V.x,V.y,_.x,_.y,b.x,b.y)>=P?(Fu(i,n,o,M,z,_,V,C,P),Fu(i,M,z,c,p,V,b,C,P)):i.push(b)}function Ys(i,n,o){let c=i[0],p=c.x,_=c.y;n(c);const b=[c];for(let C=1;C<i.length;C++){const P=i[C],{x:M,y:z}=P;n(P),Fu(b,p,_,M,z,c,P,n,o),p=M,_=z,c=P}return b}function pf(i,n,o,c){if(c(n,o)){const p=n.add(o)._mult(.5);pf(i,n,p,c),pf(i,p,o,c)}else i.push(o)}function Bd(i,n){let o=i[0];const c=[o];for(let p=1;p<i.length;p++){const _=i[p];pf(c,o,_,n),o=_}return c}const ka=Math.pow(2,14)-1,mf=-ka-1;function Tg(i,n){const o=Math.round(i.x*n),c=Math.round(i.y*n);return i.x=we(o,mf,ka),i.y=we(c,mf,ka),(o<i.x||o>i.x+1||c<i.y||c>i.y+1)&&Jn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Ls(i,n,o){const c=i.loadGeometry(),p=i.extent,_=ln/p;if(n&&o&&o.projection.isReprojectedInTileSpace){const b=1<<n.z,{scale:C,x:P,y:M,projection:z}=o,V=$=>{const K=es((n.x+$.x/p)/b),X=ur((n.y+$.y/p)/b),ne=z.project(K,X);$.x=(ne.x*C-P)*p,$.y=(ne.y*C-M)*p};for(let $=0;$<c.length;$++)if(i.type!==1)c[$]=Ys(c[$],V,1);else{const K=[];for(const X of c[$])X.x<0||X.x>=p||X.y<0||X.y>=p||(V(X),K.push(X));c[$]=K}}for(const b of c)for(const C of b)Tg(C,_);return c}function ol(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?Ls(i):[]}}function Aa(i,n,o,c,p){i.emplaceBack(2*n+(c+1)/2,2*o+(p+1)/2)}function Vu(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Uu{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new kt,this.indexArray=new nn,this.segments=new li,this.programConfigurations=new Dc(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(n,o,c,p){const _=this.layers[0],b=[];let C=null;_.type==="circle"&&(C=_.layout.get("circle-sort-key"));for(const{feature:M,id:z,index:V,sourceLayerIndex:$}of n){const K=this.layers[0]._featureFilter.needGeometry,X=ol(M,K);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),X,c))continue;const ne=C?C.evaluate(X,{},c):void 0,le={id:z,properties:M.properties,type:M.type,sourceLayerIndex:$,index:V,geometry:K?X.geometry:Ls(M,c,p),patterns:{},sortKey:ne};b.push(le)}C&&b.sort(((M,z)=>M.sortKey-z.sortKey));let P=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Tt,P=p.projection);for(const M of b){const{geometry:z,index:V,sourceLayerIndex:$}=M,K=n[V].feature;this.addFeature(M,z,V,o.availableImages,c,P),o.featureIndex.insert(K,z,V,$,this.index)}}update(n,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,v_.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,ix.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,c,p,_,b){for(const C of o)for(const P of C){const M=P.x,z=P.y;if(M<0||M>=ln||z<0||z>=ln)continue;if(b){const K=b.projectTilePoint(M,z,_),X=b.upVector(_,M,z),ne=this.globeExtVertexArray;Vu(ne,K,X),Vu(ne,K,X),Vu(ne,K,X),Vu(ne,K,X)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),$=V.vertexLength;Aa(this.layoutVertexArray,M,z,-1,-1),Aa(this.layoutVertexArray,M,z,1,-1),Aa(this.layoutVertexArray,M,z,1,1),Aa(this.layoutVertexArray,M,z,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},p,_)}}function Fp(i,n){for(let o=0;o<i.length;o++)if(Ul(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(Ul(i,n[o]))return!0;return!!al(i,n)}function Vp(i,n,o){return!!Ul(i,n)||!!Os(n,i,o)}function gf(i,n){if(i.length===1)return Up(n,i[0]);for(let o=0;o<n.length;o++){const c=n[o];for(let p=0;p<c.length;p++)if(Ul(i,c[p]))return!0}for(let o=0;o<i.length;o++)if(Up(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(al(i,n[o]))return!0;return!1}function Js(i,n,o){if(i.length>1){if(al(i,n))return!0;for(let c=0;c<n.length;c++)if(Os(n[c],i,o))return!0}for(let c=0;c<i.length;c++)if(Os(i[c],n,o))return!0;return!1}function al(i,n){if(i.length===0||n.length===0)return!1;for(let o=0;o<i.length-1;o++){const c=i[o],p=i[o+1];for(let _=0;_<n.length-1;_++)if(Pa(c,p,n[_],n[_+1]))return!0}return!1}function Pa(i,n,o,c){return Ar(i,o,c)!==Ar(n,o,c)&&Ar(i,n,o)!==Ar(i,n,c)}function Os(i,n,o){const c=o*o;if(n.length===1)return i.distSqr(n[0])<c;for(let p=1;p<n.length;p++)if(Sg(i,n[p-1],n[p])<c)return!0;return!1}function Sg(i,n,o){const c=n.distSqr(o);if(c===0)return i.distSqr(n);const p=((i.x-n.x)*(o.x-n.x)+(i.y-n.y)*(o.y-n.y))/c;return i.distSqr(p<0?n:p>1?o:o.sub(n)._mult(p)._add(n))}function Up(i,n){let o,c,p,_=!1;for(let b=0;b<i.length;b++){o=i[b];for(let C=0,P=o.length-1;C<o.length;P=C++)c=o[C],p=o[P],c.y>n.y!=p.y>n.y&&n.x<(p.x-c.x)*(n.y-c.y)/(p.y-c.y)+c.x&&(_=!_)}return _}function Ul(i,n){let o=!1;for(let c=0,p=i.length-1;c<i.length;p=c++){const _=i[c],b=i[p];_.y>n.y!=b.y>n.y&&n.x<(b.x-_.x)*(n.y-_.y)/(b.y-_.y)+_.x&&(o=!o)}return o}function P_(i,n,o,c,p){for(const b of i)if(n<=b.x&&o<=b.y&&c>=b.x&&p>=b.y)return!0;const _=[new Me(n,o),new Me(n,p),new Me(c,p),new Me(c,o)];if(i.length>2){for(const b of _)if(Ul(i,b))return!0}for(let b=0;b<i.length-1;b++)if(Vc(i[b],i[b+1],_))return!0;return!1}function Vc(i,n,o){const c=o[0],p=o[2];if(i.x<c.x&&n.x<c.x||i.x>p.x&&n.x>p.x||i.y<c.y&&n.y<c.y||i.y>p.y&&n.y>p.y)return!1;const _=Ar(i,n,o[0]);return _!==Ar(i,n,o[1])||_!==Ar(i,n,o[2])||_!==Ar(i,n,o[3])}function $u(i,n,o){const c=n.paint.get(i).value;return c.kind==="constant"?c.value:o.programConfigurations.get(n.id).getMaxValue(i)}function Fd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Uc(i,n,o,c,p){if(!n[0]&&!n[1])return i;const _=Me.convert(n)._mult(p);o==="viewport"&&_._rotate(-c);const b=[];for(let C=0;C<i.length;C++)b.push(i[C].sub(_));return b}function $p(i,n,o,c){const p=Me.convert(i)._mult(c);return n==="viewport"&&p._rotate(-o),p}Ut(Uu,"CircleBucket",{omit:["layers"]});const Gu=new ve({"circle-sort-key":new ce(ht.layout_circle["circle-sort-key"])});var M_={paint:new ve({"circle-radius":new ce(ht.paint_circle["circle-radius"]),"circle-color":new ce(ht.paint_circle["circle-color"]),"circle-blur":new ce(ht.paint_circle["circle-blur"]),"circle-opacity":new ce(ht.paint_circle["circle-opacity"]),"circle-translate":new te(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new te(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new te(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new te(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ce(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ce(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ce(ht.paint_circle["circle-stroke-opacity"])}),layout:Gu};function Eg(i,n,o,c,p,_,b,C,P){if(_&&i.queryGeometry.isAboveHorizon)return!1;_&&(P*=i.pixelToTileUnitsFactor);const M=i.tileID.canonical,z=o.projection.upVectorScale(M,o.center.lat,o.worldSize).metersToTile;for(const V of n)for(const $ of V){const K=$.add(C),X=p&&o.elevation?o.elevation.exaggeration()*p.getElevationAt(K.x,K.y,!0):0,ne=o.projection.projectTilePoint(K.x,K.y,M);if(X>0){const ge=o.projection.upVector(M,K.x,K.y);ne.x+=ge[0]*z*X,ne.y+=ge[1]*z*X,ne.z+=ge[2]*z*X}const le=_?K:Cg(ne.x,ne.y,ne.z,c),me=_?i.tilespaceRays.map((ge=>cx(ge,X))):i.queryGeometry.screenGeometry,Ce=zc([],[ne.x,ne.y,ne.z,1],c);if(!b&&_?P*=Ce[3]/o.cameraToCenterDistance:b&&!_&&(P*=o.cameraToCenterDistance/Ce[3]),_){const ge=ur(($.y/ln+M.y)/(1<<M.z));P/=o.projection.pixelsPerMeter(ge,1)/ci(1,ge)}if(Vp(me,le,P))return!0}return!1}function Cg(i,n,o,c){const p=zc([],[i,n,o,1],c);return new Me(p[0]/p[3],p[1]/p[3])}const yf=Ou(0,0,0),lx=Ou(0,0,1);function cx(i,n){const o=sf();return yf[2]=n,i.intersectsPlane(yf,lx,o),new Me(o[0],o[1])}class kg extends Uu{}function Ag(i,{width:n,height:o},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*o*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(n*o*c);return i.width=n,i.height=o,i.data=p,i}function $c(i,n,o){const{width:c,height:p}=n;c===i.width&&p===i.height||(Pg(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,c),height:Math.min(i.height,p)},o),i.width=c,i.height=p,i.data=n.data)}function Pg(i,n,o,c,p,_){if(p.width===0||p.height===0)return n;if(p.width>i.width||p.height>i.height||o.x>i.width-p.width||o.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||c.x>n.width-p.width||c.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,C=n.data;for(let P=0;P<p.height;P++){const M=((o.y+P)*i.width+o.x)*_,z=((c.y+P)*n.width+c.x)*_;for(let V=0;V<p.width*_;V++)C[z+V]=b[M+V]}return n}Ut(kg,"HeatmapBucket",{omit:["layers"]});class bo{constructor(n,o){Ag(this,n,1,o)}resize(n){$c(this,new bo(n),1)}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,p,_){Pg(n,o,c,p,_,1)}}class Qs{constructor(n,o){Ag(this,n,4,o)}resize(n){$c(this,new Qs(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,p,_){Pg(n,o,c,p,_,4)}}Ut(bo,"AlphaImage"),Ut(Qs,"RGBAImage");var yi={paint:new ve({"heatmap-radius":new ce(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ce(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new te(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ye(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new te(ht.paint_heatmap["heatmap-opacity"])})};function Mg(i){const n={},o=i.resolution||256,c=i.clips?i.clips.length:1,p=i.image||new Qs({width:o,height:c}),_=(b,C,P)=>{n[i.evaluationKey]=P;const M=i.expression.evaluate(n);p.data[b+C+0]=Math.floor(255*M.r/M.a),p.data[b+C+1]=Math.floor(255*M.g/M.a),p.data[b+C+2]=Math.floor(255*M.b/M.a),p.data[b+C+3]=Math.floor(255*M.a)};if(i.clips)for(let b=0,C=0;b<c;++b,C+=4*o)for(let P=0,M=0;P<o;P++,M+=4){const z=P/(o-1),{start:V,end:$}=i.clips[b];_(C,M,V*(1-z)+$*z)}else for(let b=0,C=0;b<o;b++,C+=4)_(0,C,b/(o-1));return p}var I_={paint:new ve({"hillshade-illumination-direction":new te(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new te(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new te(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new te(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new te(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new te(ht.paint_hillshade["hillshade-accent-color"])})};const ux=$e([{name:"a_pos",components:2,type:"Int16"}],4),{members:dx}=ux;var Gp={exports:{}};function _f(i,n,o){o=o||2;var c,p,_,b,C,P,M,z=n&&n.length,V=z?n[0]*o:i.length,$=R_(i,0,V,o,!0),K=[];if(!$||$.next===$.prev)return K;if(z&&($=(function(ne,le,me,Ce){var ge,Ee,Re,Pe=[];for(ge=0,Ee=le.length;ge<Ee;ge++)(Re=R_(ne,le[ge]*Ce,ge<Ee-1?le[ge+1]*Ce:ne.length,Ce,!1))===Re.next&&(Re.steiner=!0),Pe.push(jg(Re));for(Pe.sort(qp),ge=0;ge<Pe.length;ge++)me=Ig(Pe[ge],me);return me})(i,n,$,o)),i.length>80*o){c=_=i[0],p=b=i[1];for(var X=o;X<V;X+=o)(C=i[X])<c&&(c=C),(P=i[X+1])<p&&(p=P),C>_&&(_=C),P>b&&(b=P);M=(M=Math.max(_-c,b-p))!==0?32767/M:0}return Hu($,K,o,c,p,M,0),K}function R_(i,n,o,c,p){var _,b;if(p===$d(i,n,o,c)>0)for(_=n;_<o;_+=c)b=Wp(_,i[_],i[_+1],b);else for(_=o-c;_>=n;_-=c)b=Wp(_,i[_],i[_+1],b);return b&&Wu(b,b.next)&&(Hc(b),b=b.next),b}function ts(i,n){if(!i)return i;n||(n=i);var o,c=i;do if(o=!1,c.steiner||!Wu(c,c.next)&&ei(c.prev,c,c.next)!==0)c=c.next;else{if(Hc(c),(c=n=c.prev)===c.next)break;o=!0}while(o||c!==n);return n}function Hu(i,n,o,c,p,_,b){if(i){!b&&_&&(function(z,V,$,K){var X=z;do X.z===0&&(X.z=Ng(X.x,X.y,V,$,K)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==z);X.prevZ.nextZ=null,X.prevZ=null,(function(ne){var le,me,Ce,ge,Ee,Re,Pe,et,Ke=1;do{for(me=ne,ne=null,Ee=null,Re=0;me;){for(Re++,Ce=me,Pe=0,le=0;le<Ke&&(Pe++,Ce=Ce.nextZ);le++);for(et=Ke;Pe>0||et>0&&Ce;)Pe!==0&&(et===0||!Ce||me.z<=Ce.z)?(ge=me,me=me.nextZ,Pe--):(ge=Ce,Ce=Ce.nextZ,et--),Ee?Ee.nextZ=ge:ne=ge,ge.prevZ=Ee,Ee=ge;me=Ce}Ee.nextZ=null,Ke*=2}while(Re>1)})(X)})(i,c,p,_);for(var C,P,M=i;i.prev!==i.next;)if(C=i.prev,P=i.next,_?Gc(i,c,p,_):hx(i))n.push(C.i/o|0),n.push(i.i/o|0),n.push(P.i/o|0),Hc(i),i=P.next,M=P.next;else if((i=P)===M){b?b===1?Hu(i=Hp(ts(i),n,o),n,o,c,p,_,2):b===2&&qu(i,n,o,c,p,_):Hu(ts(i),n,o,c,p,_,1);break}}}function hx(i){var n=i.prev,o=i,c=i.next;if(ei(n,o,c)>=0)return!1;for(var p=n.x,_=o.x,b=c.x,C=n.y,P=o.y,M=c.y,z=p<_?p<b?p:b:_<b?_:b,V=C<P?C<M?C:M:P<M?P:M,$=p>_?p>b?p:b:_>b?_:b,K=C>P?C>M?C:M:P>M?P:M,X=c.next;X!==n;){if(X.x>=z&&X.x<=$&&X.y>=V&&X.y<=K&&Vd(p,C,_,P,b,M,X.x,X.y)&&ei(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Gc(i,n,o,c){var p=i.prev,_=i,b=i.next;if(ei(p,_,b)>=0)return!1;for(var C=p.x,P=_.x,M=b.x,z=p.y,V=_.y,$=b.y,K=C<P?C<M?C:M:P<M?P:M,X=z<V?z<$?z:$:V<$?V:$,ne=C>P?C>M?C:M:P>M?P:M,le=z>V?z>$?z:$:V>$?V:$,me=Ng(K,X,n,o,c),Ce=Ng(ne,le,n,o,c),ge=i.prevZ,Ee=i.nextZ;ge&&ge.z>=me&&Ee&&Ee.z<=Ce;){if(ge.x>=K&&ge.x<=ne&&ge.y>=X&&ge.y<=le&&ge!==p&&ge!==b&&Vd(C,z,P,V,M,$,ge.x,ge.y)&&ei(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Ee.x>=K&&Ee.x<=ne&&Ee.y>=X&&Ee.y<=le&&Ee!==p&&Ee!==b&&Vd(C,z,P,V,M,$,Ee.x,Ee.y)&&ei(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;ge&&ge.z>=me;){if(ge.x>=K&&ge.x<=ne&&ge.y>=X&&ge.y<=le&&ge!==p&&ge!==b&&Vd(C,z,P,V,M,$,ge.x,ge.y)&&ei(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Ee&&Ee.z<=Ce;){if(Ee.x>=K&&Ee.x<=ne&&Ee.y>=X&&Ee.y<=le&&Ee!==p&&Ee!==b&&Vd(C,z,P,V,M,$,Ee.x,Ee.y)&&ei(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function Hp(i,n,o){var c=i;do{var p=c.prev,_=c.next.next;!Wu(p,_)&&vf(p,c,c.next,_)&&wf(p,_)&&wf(_,p)&&(n.push(p.i/o|0),n.push(c.i/o|0),n.push(_.i/o|0),Hc(c),Hc(c.next),c=i=_),c=c.next}while(c!==i);return ts(c)}function qu(i,n,o,c,p,_){var b=i;do{for(var C=b.next.next;C!==b.prev;){if(b.i!==C.i&&N_(b,C)){var P=Dg(b,C);return b=ts(b,b.next),P=ts(P,P.next),Hu(b,n,o,c,p,_,0),void Hu(P,n,o,c,p,_,0)}C=C.next}b=b.next}while(b!==i)}function qp(i,n){return i.x-n.x}function Ig(i,n){var o=(function(p,_){var b,C=_,P=p.x,M=p.y,z=-1/0;do{if(M<=C.y&&M>=C.next.y&&C.next.y!==C.y){var V=C.x+(M-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(V<=P&&V>z&&(z=V,b=C.x<C.next.x?C:C.next,V===P))return b}C=C.next}while(C!==_);if(!b)return null;var $,K=b,X=b.x,ne=b.y,le=1/0;C=b;do P>=C.x&&C.x>=X&&P!==C.x&&Vd(M<ne?P:z,M,X,ne,M<ne?z:P,M,C.x,C.y)&&($=Math.abs(M-C.y)/(P-C.x),wf(C,p)&&($<le||$===le&&(C.x>b.x||C.x===b.x&&Rg(b,C)))&&(b=C,le=$)),C=C.next;while(C!==K);return b})(i,n);if(!o)return n;var c=Dg(o,i);return ts(c,c.next),ts(o,o.next)}function Rg(i,n){return ei(i.prev,i,n.prev)<0&&ei(n.next,i,i.next)<0}function Ng(i,n,o,c,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-c)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function jg(i){var n=i,o=i;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==i);return o}function Vd(i,n,o,c,p,_,b,C){return(p-b)*(n-C)>=(i-b)*(_-C)&&(i-b)*(c-C)>=(o-b)*(n-C)&&(o-b)*(_-C)>=(p-b)*(c-C)}function N_(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!(function(o,c){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==c.i&&p.next.i!==c.i&&vf(p,p.next,o,c))return!0;p=p.next}while(p!==o);return!1})(i,n)&&(wf(i,n)&&wf(n,i)&&(function(o,c){var p=o,_=!1,b=(o.x+c.x)/2,C=(o.y+c.y)/2;do p.y>C!=p.next.y>C&&p.next.y!==p.y&&b<(p.next.x-p.x)*(C-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==o);return _})(i,n)&&(ei(i.prev,i,n.prev)||ei(i,n.prev,n))||Wu(i,n)&&ei(i.prev,i,i.next)>0&&ei(n.prev,n,n.next)>0)}function ei(i,n,o){return(n.y-i.y)*(o.x-n.x)-(n.x-i.x)*(o.y-n.y)}function Wu(i,n){return i.x===n.x&&i.y===n.y}function vf(i,n,o,c){var p=Ud(ei(i,n,o)),_=Ud(ei(i,n,c)),b=Ud(ei(o,c,i)),C=Ud(ei(o,c,n));return p!==_&&b!==C||!(p!==0||!xf(i,o,n))||!(_!==0||!xf(i,c,n))||!(b!==0||!xf(o,i,c))||!(C!==0||!xf(o,n,c))}function xf(i,n,o){return n.x<=Math.max(i.x,o.x)&&n.x>=Math.min(i.x,o.x)&&n.y<=Math.max(i.y,o.y)&&n.y>=Math.min(i.y,o.y)}function Ud(i){return i>0?1:i<0?-1:0}function wf(i,n){return ei(i.prev,i,i.next)<0?ei(i,n,i.next)>=0&&ei(i,i.prev,n)>=0:ei(i,n,i.prev)<0||ei(i,i.next,n)<0}function Dg(i,n){var o=new bf(i.i,i.x,i.y),c=new bf(n.i,n.x,n.y),p=i.next,_=n.prev;return i.next=n,n.prev=i,o.next=p,p.prev=o,c.next=o,o.prev=c,_.next=c,c.prev=_,c}function Wp(i,n,o,c){var p=new bf(i,n,o);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Hc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function bf(i,n,o){this.i=i,this.x=n,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $d(i,n,o,c){for(var p=0,_=n,b=o-c;_<o;_+=c)p+=(i[b]-i[_])*(i[_+1]+i[b+1]),b=_;return p}Gp.exports=_f,Gp.exports.default=_f,_f.deviation=function(i,n,o,c){var p=n&&n.length,_=Math.abs($d(i,0,p?n[0]*o:i.length,o));if(p)for(var b=0,C=n.length;b<C;b++)_-=Math.abs($d(i,n[b]*o,b<C-1?n[b+1]*o:i.length,o));var P=0;for(b=0;b<c.length;b+=3){var M=c[b]*o,z=c[b+1]*o,V=c[b+2]*o;P+=Math.abs((i[M]-i[V])*(i[z+1]-i[M+1])-(i[M]-i[z])*(i[V+1]-i[M+1]))}return _===0&&P===0?0:Math.abs((P-_)/_)},_f.flatten=function(i){for(var n=i[0][0].length,o={vertices:[],holes:[],dimensions:n},c=0,p=0;p<i.length;p++){for(var _=0;_<i[p].length;_++)for(var b=0;b<n;b++)o.vertices.push(i[p][_][b]);p>0&&o.holes.push(c+=i[p-1].length)}return o};var Zp=ie(Gp.exports);function fx(i,n,o,c,p){Tf(i,n,o,c||i.length-1,p||Ef)}function Tf(i,n,o,c,p){for(;c>o;){if(c-o>600){var _=c-o+1,b=n-o+1,C=Math.log(_),P=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*P*(_-P)/_)*(b-_/2<0?-1:1);Tf(i,n,Math.max(o,Math.floor(n-b*P/_+M)),Math.min(c,Math.floor(n+(_-b)*P/_+M)),p)}var z=i[n],V=o,$=c;for(Sf(i,o,n),p(i[c],z)>0&&Sf(i,o,c);V<$;){for(Sf(i,V,$),V++,$--;p(i[V],z)<0;)V++;for(;p(i[$],z)>0;)$--}p(i[o],z)===0?Sf(i,o,$):Sf(i,++$,c),$<=n&&(o=$+1),n<=$&&(c=$-1)}}function Sf(i,n,o){var c=i[n];i[n]=i[o],i[o]=c}function Ef(i,n){return i<n?-1:i>n?1:0}function Lg(i,n){const o=i.length;if(o<=1)return[i];const c=[];let p,_;for(let b=0;b<o;b++){const C=io(i[b]);C!==0&&(i[b].area=Math.abs(C),_===void 0&&(_=C<0),_===C<0?(p&&c.push(p),p=[i[b]]):p.push(i[b]))}if(p&&c.push(p),n>1)for(let b=0;b<c.length;b++)c[b].length<=n||(fx(c[b],n,1,c[b].length-1,Kp),c[b]=c[b].slice(0,n));return c}function Kp(i,n){return n.area-i.area}function d(i,n,o){const c=o.patternDependencies;let p=!1;for(const _ of n){const b=_.paint.get(`${i}-pattern`);b.isConstant()||(p=!0);const C=b.constantOr(null);C&&(p=!0,c[C]=!0)}return p}function m(i,n,o,c,p){const _=p.patternDependencies;for(const b of n){const C=b.paint.get(`${i}-pattern`).value;if(C.kind!=="constant"){let P=C.evaluate({zoom:c},o,{},p.availableImages);P=P&&P.name?P.name:P,_[P]=!0,o.patterns[b.id]=P}}return o}class E{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kt,this.indexArray=new nn,this.indexArray2=new qr,this.programConfigurations=new Dc(n.layers,n.zoom),this.segments=new li,this.segments2=new li,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.projection=n.projection}populate(n,o,c,p){this.hasPattern=d("fill",this.layers,o);const _=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:C,id:P,index:M,sourceLayerIndex:z}of n){const V=this.layers[0]._featureFilter.needGeometry,$=ol(C,V);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),$,c))continue;const K=_?_.evaluate($,{},c,o.availableImages):void 0,X={id:P,properties:C.properties,type:C.type,sourceLayerIndex:z,index:M,geometry:V?$.geometry:Ls(C,c,p),patterns:{},sortKey:K};b.push(X)}_&&b.sort(((C,P)=>C.sortKey-P.sortKey));for(const C of b){const{geometry:P,index:M,sourceLayerIndex:z}=C;if(this.hasPattern){const V=m("fill",this.layers,C,this.zoom,o);this.patternFeatures.push(V)}else this.addFeature(C,P,M,c,{},o.availableImages);o.featureIndex.insert(n[M].feature,P,M,z,this.index)}}update(n,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,p)}addFeatures(n,o,c,p,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dx),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,c,p,_,b=[]){for(const C of Lg(o,500)){let P=0;for(const X of C)P+=X.length;const M=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),z=M.vertexLength,V=[],$=[];for(const X of C){if(X.length===0)continue;X!==C[0]&&$.push(V.length/2);const ne=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),le=ne.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(le+X.length-1,le),V.push(X[0].x),V.push(X[0].y);for(let me=1;me<X.length;me++)this.layoutVertexArray.emplaceBack(X[me].x,X[me].y),this.indexArray2.emplaceBack(le+me-1,le+me),V.push(X[me].x),V.push(X[me].y);ne.vertexLength+=X.length,ne.primitiveLength+=X.length}const K=Zp(V,$);for(let X=0;X<K.length;X+=3)this.indexArray.emplaceBack(z+K[X],z+K[X+1],z+K[X+2]);M.vertexLength+=P,M.primitiveLength+=K.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,_,b,p)}}Ut(E,"FillBucket",{omit:["layers","patternFeatures"]});const R=new ve({"fill-sort-key":new ce(ht.layout_fill["fill-sort-key"])});var F={paint:new ve({"fill-antialias":new te(ht.paint_fill["fill-antialias"]),"fill-opacity":new ce(ht.paint_fill["fill-opacity"]),"fill-color":new ce(ht.paint_fill["fill-color"]),"fill-outline-color":new ce(ht.paint_fill["fill-outline-color"]),"fill-translate":new te(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new te(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new ce(ht.paint_fill["fill-pattern"])}),layout:R};const Z=$e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),oe=$e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ae=$e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Fe}=Z;var ot={},Ot=Ue,zt=It;function It(i,n,o,c,p){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=p,i.readFields(on,this,n)}function on(i,n,o){i==1?n.id=o.readVarint():i==2?(function(c,p){for(var _=c.readVarint()+c.pos;c.pos<_;){var b=p._keys[c.readVarint()],C=p._values[c.readVarint()];p.properties[b]=C}})(o,n):i==3?n.type=o.readVarint():i==4&&(n._geometry=o.pos)}function pn(i){for(var n,o,c=0,p=0,_=i.length,b=_-1;p<_;b=p++)c+=((o=i[b]).x-(n=i[p]).x)*(n.y+o.y);return c}It.types=["Unknown","Point","LineString","Polygon"],It.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,o=i.readVarint()+i.pos,c=1,p=0,_=0,b=0,C=[];i.pos<o;){if(p<=0){var P=i.readVarint();c=7&P,p=P>>3}if(p--,c===1||c===2)_+=i.readSVarint(),b+=i.readSVarint(),c===1&&(n&&C.push(n),n=[]),n.push(new Ot(_,b));else{if(c!==7)throw new Error("unknown command "+c);n&&n.push(n[0].clone())}}return n&&C.push(n),C},It.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,o=1,c=0,p=0,_=0,b=1/0,C=-1/0,P=1/0,M=-1/0;i.pos<n;){if(c<=0){var z=i.readVarint();o=7&z,c=z>>3}if(c--,o===1||o===2)(p+=i.readSVarint())<b&&(b=p),p>C&&(C=p),(_+=i.readSVarint())<P&&(P=_),_>M&&(M=_);else if(o!==7)throw new Error("unknown command "+o)}return[b,P,C,M]},It.prototype.toGeoJSON=function(i,n,o){var c,p,_=this.extent*Math.pow(2,o),b=this.extent*i,C=this.extent*n,P=this.loadGeometry(),M=It.types[this.type];function z(K){for(var X=0;X<K.length;X++){var ne=K[X];K[X]=[360*(ne.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+C)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(c=0;c<P.length;c++)V[c]=P[c][0];z(P=V);break;case 2:for(c=0;c<P.length;c++)z(P[c]);break;case 3:for(P=(function(K){var X=K.length;if(X<=1)return[K];for(var ne,le,me=[],Ce=0;Ce<X;Ce++){var ge=pn(K[Ce]);ge!==0&&(le===void 0&&(le=ge<0),le===ge<0?(ne&&me.push(ne),ne=[K[Ce]]):ne.push(K[Ce]))}return ne&&me.push(ne),me})(P),c=0;c<P.length;c++)for(p=0;p<P[c].length;p++)z(P[c][p])}P.length===1?P=P[0]:M="Multi"+M;var $={type:"Feature",geometry:{type:M,coordinates:P},properties:this.properties};return"id"in this&&($.id=this.id),$};var mn=zt,_i=tt;function tt(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(He,this,n),this.length=this._features.length}function He(i,n,o){i===15?n.version=o.readVarint():i===1?n.name=o.readString():i===5?n.extent=o.readVarint():i===2?n._features.push(o.pos):i===3?n._keys.push(o.readString()):i===4&&n._values.push((function(c){for(var p=null,_=c.readVarint()+c.pos;c.pos<_;){var b=c.readVarint()>>3;p=b===1?c.readString():b===2?c.readFloat():b===3?c.readDouble():b===4?c.readVarint64():b===5?c.readVarint():b===6?c.readSVarint():b===7?c.readBoolean():null}return p})(o))}tt.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new mn(this._pbf,n,this.extent,this._keys,this._values)};var rt=_i;function $t(i,n,o){if(i===3){var c=new rt(o,o.readVarint()+o.pos);c.length&&(n[c.name]=c)}}var gn=ot.VectorTile=function(i,n){this.layers=i.readFields($t,{},n)},Cn=ot.VectorTileFeature=zt;function kn(i,n,o,c){const p=[],_=c===0?(b,C,P,M,z,V)=>{b.push(new Me(V,P+(V-C)/(M-C)*(z-P)))}:(b,C,P,M,z,V)=>{b.push(new Me(C+(V-P)/(z-P)*(M-C),V))};for(const b of i){const C=[];for(const P of b){if(P.length<=2)continue;const M=[];for(let $=0;$<P.length-1;$++){const K=P[$].x,X=P[$].y,ne=P[$+1].x,le=P[$+1].y,me=c===0?K:X,Ce=c===0?ne:le;me<n?Ce>n&&_(M,K,X,ne,le,n):me>o?Ce<o&&_(M,K,X,ne,le,o):M.push(P[$]),Ce<n&&me>=n&&_(M,K,X,ne,le,n),Ce>o&&me<=o&&_(M,K,X,ne,le,o)}let z=P[P.length-1];const V=c===0?z.x:z.y;V>=n&&V<=o&&M.push(z),M.length&&(z=M[M.length-1],M[0].x===z.x&&M[0].y===z.y||M.push(M[0]),C.push(M))}C.length&&p.push(C)}return p}ot.VectorTileLayer=_i;const Hn=Cn.types,ns=Math.pow(2,13);function dr(i,n,o,c,p,_,b,C){i.emplaceBack((n<<1)+b,(o<<1)+_,(Math.floor(c*ns)<<1)+p,Math.round(C))}function oa(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class j_{constructor(){this.acc=new Me(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Me(n.x,n.y),this.max=new Me(n.x,n.y))}append(n,o){this.currentPolyCount.edges++,this.acc._add(n);const c=this.min,p=this.max;n.x<c.x?c.x=n.x:n.x>p.x&&(p.x=n.x),n.y<c.y?c.y=n.y:n.y>p.y&&(p.y=n.y),((n.x===0||n.x===ln)&&n.x===o.x)!=((n.y===0||n.y===ln)&&n.y===o.y)&&this.processBorderOverlap(n,o),o.x<0!=n.x<0&&this.addBorderIntersection(0,Qn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>ln!=n.x>ln&&this.addBorderIntersection(1,Qn(o.y,n.y,(ln-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Qn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>ln!=n.y>ln&&this.addBorderIntersection(3,Qn(o.x,n.x,(ln-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[n];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const c=n.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,n.y)}else{const c=n.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,n.x)}}centroid(){const n=this.polyCount.reduce(((o,c)=>o+c.edges),0);return n!==0?this.acc.div(n)._round():new Me(0,0)}span(){return new Me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((n,o)=>n+ +(o[0]!==Number.MAX_VALUE)),0)}}class Og{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.layoutVertexArray=new at,this.centroidVertexArray=new vo,this.indexArray=new nn,this.programConfigurations=new Dc(n.layers,n.zoom),this.segments=new li,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.enableTerrain=n.enableTerrain}populate(n,o,c,p){this.features=[],this.hasPattern=d("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(function(_){const b=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*b/(b*b+1)/ln/(1<<_.z)})(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:b,index:C,sourceLayerIndex:P}of n){const M=this.layers[0]._featureFilter.needGeometry,z=ol(_,M);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),z,c))continue;const V={id:b,sourceLayerIndex:P,index:C,geometry:M?z.geometry:Ls(_,c,p),properties:_.properties,type:_.type,patterns:{}},$=this.layoutVertexArray.length;this.hasPattern?this.features.push(m("fill-extrusion",this.layers,V,this.zoom,o)):this.addFeature(V,V.geometry,C,c,{},o.availableImages,p),o.featureIndex.insert(_,V.geometry,C,P,this.index,$)}this.sortBorders()}addFeatures(n,o,c,p,_){for(const b of this.features){const{geometry:C}=b;this.addFeature(b,C,b.index,o,c,p,_)}this.sortBorders()}update(n,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Fe),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,Ae.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,oe.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,c,p,_,b,C){const P=[new Me(0,0),new Me(ln,ln)],M=C.projection,z=M.name==="globe",V=this.enableTerrain&&!z?new j_:null,$=Hn[n.type]==="Polygon";z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Tt);const K=Lg(o,500);for(let me=K.length-1;me>=0;me--){const Ce=K[me];(Ce.length===0||(X=Ce[0]).every((ge=>ge.x<=0))||X.every((ge=>ge.x>=ln))||X.every((ge=>ge.y<=0))||X.every((ge=>ge.y>=ln)))&&K.splice(me,1)}var X;let ne;if(z)ne=rS(K,P,p);else{ne=[];for(const me of K)ne.push({polygon:me,bounds:P})}const le=$?this.edgeRadius:0;for(const{polygon:me,bounds:Ce}of ne){let ge=0,Ee=0;for(const Pe of me)$&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),Ee+=$?Pe.length-1:Pe.length;const Re=this.segments.prepareSegment(($?5:4)*Ee,this.layoutVertexArray,this.indexArray);if($){const Pe=[],et=[];ge=Re.vertexLength;for(const pt of me){let Pt,nt;pt.length&&pt!==me[0]&&et.push(Pe.length/2),Pt=pt[1].sub(pt[0])._perp()._unit();for(let yt=1;yt<pt.length;yt++){const _t=pt[yt],Ct=pt[yt===pt.length-1?1:yt+1];let{x:Rt,y:dt}=_t;if(le){nt=Ct.sub(_t)._perp()._unit();const Vt=Pt.add(nt)._unit(),en=le*Math.min(4,1/(Pt.x*Vt.x+Pt.y*Vt.y));Rt+=en*Vt.x,dt+=en*Vt.y,Pt=nt}dr(this.layoutVertexArray,Rt,dt,0,0,1,1,0),Re.vertexLength++,Pe.push(_t.x,_t.y),z&&oa(this.layoutVertexExtArray,M.projectTilePoint(Rt,dt,p),M.upVector(p,Rt,dt))}}const Ke=Zp(Pe,et);for(let pt=0;pt<Ke.length;pt+=3)this.indexArray.emplaceBack(ge+Ke[pt],ge+Ke[pt+2],ge+Ke[pt+1]),Re.primitiveLength++}for(const Pe of me){V&&Pe.length&&V.startRing(Pe[0]);let et,Ke,pt,Pt=Pe.length>4&&eS(Pe[Pe.length-2],Pe[0],Pe[1]),nt=le?A3(Pe[Pe.length-2],Pe[0],Pe[1],le):0;Ke=Pe[1].sub(Pe[0])._perp()._unit();let yt=!0;for(let _t=1,Ct=0;_t<Pe.length;_t++){let Rt=Pe[_t-1],dt=Pe[_t];const Vt=Pe[_t===Pe.length-1?1:_t+1];if(V&&$&&V.currentPolyCount.top++,QT(dt,Rt,Ce)){le&&(Ke=Vt.sub(dt)._perp()._unit(),yt=!yt);continue}V&&V.append(dt,Rt);const en=dt.sub(Rt)._perp(),Ht=en.x/(Math.abs(en.x)+Math.abs(en.y)),Dn=en.y>0?1:0,Dt=Rt.dist(dt);if(Ct+Dt>32768&&(Ct=0),le){pt=Vt.sub(dt)._perp()._unit();let On=JT(Rt,dt,Vt,YT(Ke,pt),le);isNaN(On)&&(On=0);const Tn=dt.sub(Rt)._unit();Rt=Rt.add(Tn.mult(nt))._round(),dt=dt.add(Tn.mult(-On))._round(),nt=On,Ke=pt}const dn=Re.vertexLength,Ln=Pe.length>4&&eS(Rt,dt,Vt);let hr=tS(Ct,Pt,yt);if(dr(this.layoutVertexArray,Rt.x,Rt.y,Ht,Dn,0,0,hr),dr(this.layoutVertexArray,Rt.x,Rt.y,Ht,Dn,0,1,hr),Ct+=Dt,hr=tS(Ct,Ln,!yt),Pt=Ln,dr(this.layoutVertexArray,dt.x,dt.y,Ht,Dn,0,0,hr),dr(this.layoutVertexArray,dt.x,dt.y,Ht,Dn,0,1,hr),Re.vertexLength+=4,this.indexArray.emplaceBack(dn+0,dn+1,dn+2),this.indexArray.emplaceBack(dn+1,dn+3,dn+2),Re.primitiveLength+=2,le){const On=ge+(_t===1?Pe.length-2:_t-2),Tn=_t===1?ge:On+1;if(this.indexArray.emplaceBack(dn+1,On,dn+3),this.indexArray.emplaceBack(On,Tn,dn+3),Re.primitiveLength+=2,et===void 0&&(et=dn),!QT(Vt,Pe[_t],Ce)){const zr=_t===Pe.length-1?et:Re.vertexLength;this.indexArray.emplaceBack(dn+2,dn+3,zr),this.indexArray.emplaceBack(dn+3,zr+1,zr),this.indexArray.emplaceBack(dn+3,Tn,zr+1),Re.primitiveLength+=3}yt=!yt}if(z){const On=this.layoutVertexExtArray,Tn=M.projectTilePoint(Rt.x,Rt.y,p),zr=M.projectTilePoint(dt.x,dt.y,p),Bn=M.upVector(p,Rt.x,Rt.y),Fn=M.upVector(p,dt.x,dt.y);oa(On,Tn,Bn),oa(On,Tn,Bn),oa(On,zr,Fn),oa(On,zr,Fn)}}$&&(ge+=Pe.length-1)}}if(V&&V.polyCount.length>0){if(V.borders){V.vertexArrayOffset=this.centroidVertexArray.length;const me=V.borders,Ce=this.featuresOnBorder.push(V)-1;for(let ge=0;ge<4;ge++)me[ge][0]!==Number.MAX_VALUE&&this.borders[ge].push(Ce)}this.encodeCentroid(V.borders?void 0:V.centroid(),V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,_,b,p)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort(((o,c)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[c].borders[n][0]))}encodeCentroid(n,o,c=!0){let p,_;if(n)if(n.y!==0){const C=o.span()._mult(this.tileToMeter);p=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(C.x/10)),_=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else p=Math.ceil(7*(n.x+450)),_=0;else p=0,_=+c;let b=c?this.centroidVertexArray.length:o.vertexArrayOffset;for(const C of o.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let P=0;P<C.top;P++)this.centroidVertexArray.emplace(b++,p,_);for(let P=0;P<2*C.edges;P++)this.centroidVertexArray.emplace(b++,0,_),this.centroidVertexArray.emplace(b++,p,_)}}}function YT(i,n){const o=i.add(n)._unit();return i.x*o.x+i.y*o.y}function A3(i,n,o,c){const p=n.sub(i)._perp()._unit(),_=o.sub(n)._perp()._unit();return JT(i,n,o,YT(p,_),c)}function JT(i,n,o,c,p){const _=Math.sqrt(1-c*c);return Math.min(i.dist(n)/3,n.dist(o)/3,p*_/c)}function QT(i,n,o){return i.x<o[0].x&&n.x<o[0].x||i.x>o[1].x&&n.x>o[1].x||i.y<o[0].y&&n.y<o[0].y||i.y>o[1].y&&n.y>o[1].y}function eS(i,n,o){if(i.x<0||i.x>=ln||n.x<0||n.x>=ln||o.x<0||o.x>=ln)return!1;const c=o.sub(n),p=c.perp(),_=i.sub(n);return(c.x*_.x+c.y*_.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function tS(i,n,o){const c=n?2|i:-3&i;return o?1|c:-2&c}function nS(){const i=Math.PI/32,n=Math.tan(i),o=Bc;return o*Math.sqrt(1+2*n*n)-o}function rS(i,n,o){const c=1<<o.z,p=es(o.x/c),_=es((o.x+1)/c),b=ur(o.y/c),C=ur((o.y+1)/c);return(function(P,M,z,V,$=0,K){const X=[];if(!P.length||!z||!V)return X;const ne=(Pe,et)=>{for(const Ke of Pe)X.push({polygon:Ke,bounds:et})},le=Math.ceil(Math.log2(z)),me=Math.ceil(Math.log2(V)),Ce=le-me,ge=[];for(let Pe=0;Pe<Math.abs(Ce);Pe++)ge.push(Ce>0?0:1);for(let Pe=0;Pe<Math.min(le,me);Pe++)ge.push(0),ge.push(1);let Ee=P;if(Ee=kn(Ee,M[0].y-$,M[1].y+$,1),Ee=kn(Ee,M[0].x-$,M[1].x+$,0),!Ee.length)return X;const Re=[];for(ge.length?Re.push({polygons:Ee,bounds:M,depth:0}):ne(Ee,M);Re.length;){const Pe=Re.pop(),et=Pe.depth,Ke=ge[et],pt=Pe.bounds[0],Pt=Pe.bounds[1],nt=Ke===0?pt.x:pt.y,yt=Ke===0?Pt.x:Pt.y,_t=K?K(Ke,nt,yt):.5*(nt+yt),Ct=kn(Pe.polygons,nt-$,_t+$,Ke),Rt=kn(Pe.polygons,_t-$,yt+$,Ke);if(Ct.length){const dt=[pt,new Me(Ke===0?_t:Pt.x,Ke===1?_t:Pt.y)];ge.length>et+1?Re.push({polygons:Ct,bounds:dt,depth:et+1}):ne(Ct,dt)}if(Rt.length){const dt=[new Me(Ke===0?_t:pt.x,Ke===1?_t:pt.y),Pt];ge.length>et+1?Re.push({polygons:Rt,bounds:dt,depth:et+1}):ne(Rt,dt)}}return X})(i,n,Math.ceil((_-p)/11.25),Math.ceil((b-C)/11.25),1,((P,M,z)=>{if(P===0)return .5*(M+z);{const V=ur((o.y+M/ln)/c);return($r(.5*(ur((o.y+z/ln)/c)+V))*c-o.y)*ln}}))}Ut(Og,"FillExtrusionBucket",{omit:["layers","features"]}),Ut(j_,"PartMetadata");const P3=new ve({"fill-extrusion-edge-radius":new te(ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var M3={paint:new ve({"fill-extrusion-opacity":new te(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ce(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new te(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new te(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ce(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ce(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ce(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new te(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new te(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new te(ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new te(ht["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:P3};function iS(i,n,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[i*c-2*Math.PI*6378137/2,n*c-2*Math.PI*6378137/2]}class D_{constructor(n,o,c){this.z=n,this.x=o,this.y=c,this.key=zg(0,n,n,o,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const c=(function(_,b,C){var P=iS(256*_,256*(b=Math.pow(2,C)-b-1),C),M=iS(256*(_+1),256*(b+1),C);return P[0]+","+P[1]+","+M[0]+","+M[1]})(this.x,this.y,this.z),p=(function(_,b,C){let P,M="";for(let z=_;z>0;z--)P=1<<z-1,M+=(b&P?1:0)+(C&P?2:0);return M})(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sS{constructor(n,o){this.wrap=n,this.canonical=o,this.key=zg(n,o.z,o.z,o.x,o.y)}}class To{constructor(n,o,c,p,_){this.overscaledZ=n,this.wrap=o,this.canonical=new D_(c,+p,+_),this.key=o===0&&n===c?this.canonical.key:zg(o,n,c,p,_)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new To(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new To(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return zg(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-n;return zg(this.wrap*+o,n,n,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new To(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new To(o,this.wrap,o,c,p),new To(o,this.wrap,o,c+1,p),new To(o,this.wrap,o,c,p+1),new To(o,this.wrap,o,c+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new To(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new To(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sS(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zg(i,n,o,c,p){const _=1<<Math.min(o,22);let b=_*(p%_)+c%_;return i&&o<22&&(b+=_*_*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*b+o)+(n-o)}Ut(D_,"CanonicalTileID"),Ut(To,"OverscaledTileID",{omit:["projMatrix"]});class Xp extends Me{constructor(n,o,c){super(n,o),this.z=c}}function Bg(i,n){return i.x*n.x+i.y*n.y}function oS(i,n){if(i.length===1){let o=0;const c=n[o++];let p;for(;!p||c.equals(p);)if(p=n[o++],!p)return 1/0;for(;o<n.length;o++){const _=n[o],b=i[0],C=p.sub(c),P=_.sub(c),M=b.sub(c),z=Bg(C,C),V=Bg(C,P),$=Bg(P,P),K=Bg(M,C),X=Bg(M,P),ne=z*$-V*V,le=($*K-V*X)/ne,me=(z*X-V*K)/ne,Ce=c.z*(1-le-me)+p.z*le+_.z*me;if(isFinite(Ce))return Ce}return 1/0}{let o=1/0;for(const c of n)o=Math.min(o,c.z);return o}}function aS(i,n,o,c,p,_,b,C){const P=b*p.getElevationAt(i,n,!0,!0),M=_[0]!==0,z=M?_[1]===0?b*(_[0]/7-450):b*(function(V,$,K){const X=Math.floor($[0]/8),ne=Math.floor($[1]/8),le=10*($[0]-8*X),me=10*($[1]-8*ne),Ce=V.getElevationAt(X,ne,!0,!0),ge=V.getMeterToDEM(K),Ee=Math.floor(.5*(le*ge-1)),Re=Math.floor(.5*(me*ge-1)),Pe=V.tileCoordToPixel(X,ne),et=2*Ee+1,Ke=2*Re+1,pt=(function(Rt,dt,Vt,en,Ht){return[Rt.getElevationAtPixel(dt,Vt,!0),Rt.getElevationAtPixel(dt+Ht,Vt,!0),Rt.getElevationAtPixel(dt,Vt+Ht,!0),Rt.getElevationAtPixel(dt+en,Vt+Ht,!0)]})(V,Pe.x-Ee,Pe.y-Re,et,Ke),Pt=Math.abs(pt[0]-pt[1]),nt=Math.abs(pt[2]-pt[3]),yt=Math.abs(pt[0]-pt[2])+Math.abs(pt[1]-pt[3]),_t=Math.min(.25,.5*ge*(Pt+nt)/et),Ct=Math.min(.25,.5*ge*yt/Ke);return Ce+Math.max(_t*le,Ct*me)})(p,_,C):P;return{base:P+(o===0)?-1:o,top:M?Math.max(z+c,P+o+2):P+c}}const I3=$e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:R3}=I3,N3=$e([{name:"a_packed",components:4,type:"Float32"}]),{members:j3}=N3,D3=Cn.types,L3=Math.cos(Math.PI/180*37.5);class L_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((o=>{this.gradients[o.id]={}})),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new Et,this.indexArray=new nn,this.programConfigurations=new Dc(n.layers,n.zoom),this.segments=new li,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id))}populate(n,o,c,p){this.hasPattern=d("line",this.layers,o);const _=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:z,id:V,index:$,sourceLayerIndex:K}of n){const X=this.layers[0]._featureFilter.needGeometry,ne=ol(z,X);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),ne,c))continue;const le=_?_.evaluate(ne,{},c):void 0,me={id:V,properties:z.properties,type:z.type,sourceLayerIndex:K,index:$,geometry:X?ne.geometry:Ls(z,c,p),patterns:{},sortKey:le};b.push(me)}_&&b.sort(((z,V)=>z.sortKey-V.sortKey));const{lineAtlas:C,featureIndex:P}=o,M=this.addConstantDashes(C);for(const z of b){const{geometry:V,index:$,sourceLayerIndex:K}=z;if(M&&this.addFeatureDashes(z,C),this.hasPattern){const X=m("line",this.layers,z,this.zoom,o);this.patternFeatures.push(X)}else this.addFeature(z,V,$,c,C.positions,o.availableImages);P.insert(n[$].feature,V,$,K,this.index)}}addConstantDashes(n){let o=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,_=c.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")o=!0;else{const b=_.value,C=p.value;if(!C)continue;n.addDash(C,b)}}return o}addFeatureDashes(n,o){const c=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(_.kind==="constant"&&b.kind==="constant")continue;let C,P;if(_.kind==="constant"){if(C=_.value,!C)continue}else C=_.evaluate({zoom:c},n);P=b.kind==="constant"?b.value:b.evaluate({zoom:c},n),o.addDash(C,P),n.patterns[p.id]=o.getKey(C,P)}}update(n,o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,p)}addFeatures(n,o,c,p,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,j3)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,R3),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,c,p,_,b){const C=this.layers[0].layout,P=C.get("line-join").evaluate(n,{}),M=C.get("line-cap").evaluate(n,{}),z=C.get("line-miter-limit"),V=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const $ of o)this.addLine($,n,P,M,z,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,_,b,p)}addLine(n,o,c,p,_,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<n.length-1;me++)this.totalDistance+=n[me].dist(n[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=D3[o.type]==="Polygon";let P=n.length;for(;P>=2&&n[P-1].equals(n[P-2]);)P--;let M=0;for(;M<P-1&&n[M].equals(n[M+1]);)M++;if(P<(C?3:2))return;c==="bevel"&&(_=1.05);const z=this.overscaling<=16?15*ln/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let $,K,X,ne,le;this.e1=this.e2=-1,C&&($=n[P-2],le=n[M].sub($)._unit()._perp());for(let me=M;me<P;me++){if(X=me===P-1?C?n[M+1]:void 0:n[me+1],X&&n[me].equals(X))continue;le&&(ne=le),$&&(K=$),$=n[me],le=X?X.sub($)._unit()._perp():ne,ne=ne||le;let Ce=ne.add(le);Ce.x===0&&Ce.y===0||Ce._unit();const ge=ne.x*le.x+ne.y*le.y,Ee=Ce.x*le.x+Ce.y*le.y,Re=Ee!==0?1/Ee:1/0,Pe=2*Math.sqrt(2-2*Ee),et=Ee<L3&&K&&X,Ke=ne.x*le.y-ne.y*le.x>0;if(et&&me>M){const nt=$.dist(K);if(nt>2*z){const yt=$.sub($.sub(K)._mult(z/nt)._round());this.updateDistance(K,yt),this.addCurrentVertex(yt,ne,0,0,V),K=yt}}const pt=K&&X;let Pt=pt?c:C?"butt":p;if(pt&&Pt==="round"&&(Re<b?Pt="miter":Re<=2&&(Pt="fakeround")),Pt==="miter"&&Re>_&&(Pt="bevel"),Pt==="bevel"&&(Re>2&&(Pt="flipbevel"),Re<_&&(Pt="miter")),K&&this.updateDistance(K,$),Pt==="miter")Ce._mult(Re),this.addCurrentVertex($,Ce,0,0,V);else if(Pt==="flipbevel"){if(Re>100)Ce=le.mult(-1);else{const nt=Re*ne.add(le).mag()/ne.sub(le).mag();Ce._perp()._mult(nt*(Ke?-1:1))}this.addCurrentVertex($,Ce,0,0,V),this.addCurrentVertex($,Ce.mult(-1),0,0,V)}else if(Pt==="bevel"||Pt==="fakeround"){const nt=-Math.sqrt(Re*Re-1),yt=Ke?nt:0,_t=Ke?0:nt;if(K&&this.addCurrentVertex($,ne,yt,_t,V),Pt==="fakeround"){const Ct=Math.round(180*Pe/Math.PI/20);for(let Rt=1;Rt<Ct;Rt++){let dt=Rt/Ct;if(dt!==.5){const en=dt-.5;dt+=dt*en*(dt-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*en*en+(.848013+ge*(.215638*ge-1.06021)))}const Vt=le.sub(ne)._mult(dt)._add(ne)._unit()._mult(Ke?-1:1);this.addHalfVertex($,Vt.x,Vt.y,!1,Ke,0,V)}}X&&this.addCurrentVertex($,le,-yt,-_t,V)}else if(Pt==="butt")this.addCurrentVertex($,Ce,0,0,V);else if(Pt==="square"){const nt=K?1:-1;K||this.addCurrentVertex($,Ce,nt,nt,V),this.addCurrentVertex($,Ce,0,0,V),K&&this.addCurrentVertex($,Ce,nt,nt,V)}else Pt==="round"&&(K&&(this.addCurrentVertex($,ne,0,0,V),this.addCurrentVertex($,ne,1,1,V,!0)),X&&(this.addCurrentVertex($,le,-1,-1,V,!0),this.addCurrentVertex($,le,0,0,V)));if(et&&me<P-1){const nt=$.dist(X);if(nt>2*z){const yt=$.add(X.sub($)._mult(z/nt)._round());this.updateDistance($,yt),this.addCurrentVertex(yt,le,0,0,V),$=yt}}}}addCurrentVertex(n,o,c,p,_,b=!1){const C=o.y*p-o.x,P=-o.y-o.x*p;this.addHalfVertex(n,o.x+o.y*c,o.y-o.x*c,b,!1,c,_),this.addHalfVertex(n,C,P,b,!0,-p,_)}addHalfVertex({x:n,y:o},c,p,_,b,C,P){this.layoutVertexArray.emplaceBack((n<<1)+(_?1:0),(o<<1)+(b?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(C===0?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),P.primitiveLength++),b?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}Ut(L_,"LineBucket",{omit:["layers","patternFeatures"]});const O3=new ve({"line-cap":new ce(ht.layout_line["line-cap"]),"line-join":new ce(ht.layout_line["line-join"]),"line-miter-limit":new te(ht.layout_line["line-miter-limit"]),"line-round-limit":new te(ht.layout_line["line-round-limit"]),"line-sort-key":new ce(ht.layout_line["line-sort-key"])});var lS={paint:new ve({"line-opacity":new ce(ht.paint_line["line-opacity"]),"line-color":new ce(ht.paint_line["line-color"]),"line-translate":new te(ht.paint_line["line-translate"]),"line-translate-anchor":new te(ht.paint_line["line-translate-anchor"]),"line-width":new ce(ht.paint_line["line-width"]),"line-gap-width":new ce(ht.paint_line["line-gap-width"]),"line-offset":new ce(ht.paint_line["line-offset"]),"line-blur":new ce(ht.paint_line["line-blur"]),"line-dasharray":new ce(ht.paint_line["line-dasharray"]),"line-pattern":new ce(ht.paint_line["line-pattern"]),"line-gradient":new ye(ht.paint_line["line-gradient"]),"line-trim-offset":new te(ht.paint_line["line-trim-offset"])}),layout:O3};const cS=new class extends ce{possiblyEvaluate(i,n){return n=new B(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(i,n)}evaluate(i,n,o,c){return n=wt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(i,n,o,c)}}(lS.paint.properties["line-width"].specification);function uS(i,n){return n>0?n+2*i:i}cS.useIntegerZoom=!0;const z3=$e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B3=$e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),F3=$e([{name:"a_projected_pos",components:4,type:"Float32"}],4);$e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const V3=$e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),U3=$e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dS=$e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$3=$e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$e([{name:"triangle",components:3,type:"Uint16"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),$e([{type:"Float32",name:"offsetX"}]),$e([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _s=24;const $l=128;function px(i,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new B(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=o;let _=0;for(;_<c.length&&c[_]<=i;)_++;_=Math.max(0,_-1);let b=_;for(;b<c.length&&c[b]<i+1;)b++;b=Math.min(c.length-1,b);const C=c[_],P=c[b];return o.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:C,maxZoom:P,minSize:o.evaluate(new B(C)),maxSize:o.evaluate(new B(P)),interpolationType:p}}}function O_(i,{uSize:n,uSizeT:o},{lowerSize:c,upperSize:p}){return i.kind==="source"?c/$l:i.kind==="composite"?Qn(c/$l,p/$l,o):n}function Yp(i,n){let o=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:b}=i,C=p?we(Ps.interpolationFactor(p,n,_,b),0,1):0;i.kind==="camera"?c=Qn(i.minSize,i.maxSize,C):o=C}return{uSizeT:o,uSize:c}}var G3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:$l,evaluateSizeForFeature:O_,evaluateSizeForZoom:Yp,getSizeData:px});function H3(i,n,o){return i.sections.forEach((c=>{c.text=(function(p,_,b){const C=_.layout.get("text-transform").evaluate(b,{});return C==="uppercase"?p=p.toLocaleUpperCase():C==="lowercase"&&(p=p.toLocaleLowerCase()),D.applyArabicShaping&&(p=D.applyArabicShaping(p)),p})(c.text,n,o)})),i}const Fg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function q3(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function W3(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}var hS=Ir,fS=function(i,n,o,c,p){var _,b,C=8*p-c-1,P=(1<<C)-1,M=P>>1,z=-7,V=p-1,$=-1,K=i[n+V];for(V+=$,_=K&(1<<-z)-1,K>>=-z,z+=C;z>0;_=256*_+i[n+V],V+=$,z-=8);for(b=_&(1<<-z)-1,_>>=-z,z+=c;z>0;b=256*b+i[n+V],V+=$,z-=8);if(_===0)_=1-M;else{if(_===P)return b?NaN:1/0*(K?-1:1);b+=Math.pow(2,c),_-=M}return(K?-1:1)*b*Math.pow(2,_-c)},pS=function(i,n,o,c,p,_){var b,C,P,M=8*_-p-1,z=(1<<M)-1,V=z>>1,$=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=0,X=1,ne=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(C=isNaN(n)?1:0,b=z):(b=Math.floor(Math.log(n)/Math.LN2),n*(P=Math.pow(2,-b))<1&&(b--,P*=2),(n+=b+V>=1?$/P:$*Math.pow(2,1-V))*P>=2&&(b++,P/=2),b+V>=z?(C=0,b=z):b+V>=1?(C=(n*P-1)*Math.pow(2,p),b+=V):(C=n*Math.pow(2,V-1)*Math.pow(2,p),b=0));p>=8;i[o+K]=255&C,K+=X,C/=256,p-=8);for(b=b<<p|C,M+=p;M>0;i[o+K]=255&b,K+=X,b/=256,M-=8);i[o+K-X]|=128*ne};function Ir(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ir.Varint=0,Ir.Fixed64=1,Ir.Bytes=2,Ir.Fixed32=5;var mx=4294967296,mS=1/mx,gS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Zu(i){return i.type===Ir.Bytes?i.readVarint()+i.pos:i.pos+1}function Jp(i,n,o){return o?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function yS(i,n,o){var c=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(c);for(var p=o.pos-1;p>=i;p--)o.buf[p+c]=o.buf[p]}function Z3(i,n){for(var o=0;o<i.length;o++)n.writeVarint(i[o])}function K3(i,n){for(var o=0;o<i.length;o++)n.writeSVarint(i[o])}function X3(i,n){for(var o=0;o<i.length;o++)n.writeFloat(i[o])}function Y3(i,n){for(var o=0;o<i.length;o++)n.writeDouble(i[o])}function J3(i,n){for(var o=0;o<i.length;o++)n.writeBoolean(i[o])}function Q3(i,n){for(var o=0;o<i.length;o++)n.writeFixed32(i[o])}function e4(i,n){for(var o=0;o<i.length;o++)n.writeSFixed32(i[o])}function t4(i,n){for(var o=0;o<i.length;o++)n.writeFixed64(i[o])}function n4(i,n){for(var o=0;o<i.length;o++)n.writeSFixed64(i[o])}function z_(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function Qp(i,n,o){i[o]=n,i[o+1]=n>>>8,i[o+2]=n>>>16,i[o+3]=n>>>24}function _S(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}Ir.prototype={destroy:function(){this.buf=null},readFields:function(i,n,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),p=c>>3,_=this.pos;this.type=7&c,i(p,n,this),this.pos===_&&this.skip(c)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=z_(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=_S(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=z_(this.buf,this.pos)+z_(this.buf,this.pos+4)*mx;return this.pos+=8,i},readSFixed64:function(){var i=z_(this.buf,this.pos)+_S(this.buf,this.pos+4)*mx;return this.pos+=8,i},readFloat:function(){var i=fS(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=fS(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,o,c=this.buf;return n=127&(o=c[this.pos++]),o<128?n:(n|=(127&(o=c[this.pos++]))<<7,o<128?n:(n|=(127&(o=c[this.pos++]))<<14,o<128?n:(n|=(127&(o=c[this.pos++]))<<21,o<128?n:(function(p,_,b){var C,P,M=b.buf;if(C=(112&(P=M[b.pos++]))>>4,P<128||(C|=(127&(P=M[b.pos++]))<<3,P<128)||(C|=(127&(P=M[b.pos++]))<<10,P<128)||(C|=(127&(P=M[b.pos++]))<<17,P<128)||(C|=(127&(P=M[b.pos++]))<<24,P<128)||(C|=(1&(P=M[b.pos++]))<<31,P<128))return Jp(p,C,_);throw new Error("Expected varint not more than 10 bytes")})(n|=(15&(o=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&gS?(function(o,c,p){return gS.decode(o.subarray(c,p))})(this.buf,n,i):(function(o,c,p){for(var _="",b=c;b<p;){var C,P,M,z=o[b],V=null,$=z>239?4:z>223?3:z>191?2:1;if(b+$>p)break;$===1?z<128&&(V=z):$===2?(192&(C=o[b+1]))==128&&(V=(31&z)<<6|63&C)<=127&&(V=null):$===3?(P=o[b+2],(192&(C=o[b+1]))==128&&(192&P)==128&&((V=(15&z)<<12|(63&C)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):$===4&&(P=o[b+2],M=o[b+3],(192&(C=o[b+1]))==128&&(192&P)==128&&(192&M)==128&&((V=(15&z)<<18|(63&C)<<12|(63&P)<<6|63&M)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,$=1):V>65535&&(V-=65536,_+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),_+=String.fromCharCode(V),b+=$}return _})(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==Ir.Bytes)return i.push(this.readVarint(n));var o=Zu(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSVarint());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ir.Bytes)return i.push(this.readBoolean());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFloat());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ir.Bytes)return i.push(this.readDouble());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFixed32());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSFixed32());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ir.Bytes)return i.push(this.readFixed64());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ir.Bytes)return i.push(this.readSFixed64());var n=Zu(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===Ir.Varint)for(;this.buf[this.pos++]>127;);else if(n===Ir.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Ir.Fixed32)this.pos+=4;else{if(n!==Ir.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Qp(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Qp(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Qp(this.buf,-1&i,this.pos),Qp(this.buf,Math.floor(i*mS),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Qp(this.buf,-1&i,this.pos),Qp(this.buf,Math.floor(i*mS),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?(function(n,o){var c,p;if(n>=0?(c=n%4294967296|0,p=n/4294967296|0):(p=~(-n/4294967296),4294967295^(c=~(-n%4294967296))?c=c+1|0:(c=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(_,b,C){C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,C.buf[C.pos]=127&(_>>>=7)})(c,0,o),(function(_,b){var C=(7&_)<<4;b.buf[b.pos++]|=C|((_>>>=3)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_)))))})(p,o)})(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=(function(c,p,_){for(var b,C,P=0;P<p.length;P++){if((b=p.charCodeAt(P))>55295&&b<57344){if(!C){b>56319||P+1===p.length?(c[_++]=239,c[_++]=191,c[_++]=189):C=b;continue}if(b<56320){c[_++]=239,c[_++]=191,c[_++]=189,C=b;continue}b=C-55296<<10|b-56320|65536,C=null}else C&&(c[_++]=239,c[_++]=191,c[_++]=189,C=null);b<128?c[_++]=b:(b<2048?c[_++]=b>>6|192:(b<65536?c[_++]=b>>12|224:(c[_++]=b>>18|240,c[_++]=b>>12&63|128),c[_++]=b>>6&63|128),c[_++]=63&b|128)}return _})(this.buf,i,this.pos);var o=this.pos-n;o>=128&&yS(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),pS(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),pS(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,n){this.pos++;var o=this.pos;i(n,this);var c=this.pos-o;c>=128&&yS(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,n,o){this.writeTag(i,Ir.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,Z3,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,K3,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,J3,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,X3,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,Y3,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,Q3,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,e4,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,t4,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,n4,n)},writeBytesField:function(i,n){this.writeTag(i,Ir.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,Ir.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,Ir.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,Ir.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,Ir.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,Ir.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,Ir.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,Ir.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,Ir.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,Ir.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var B_=ie(hS);const gx=3;function r4(i,n,o){n.glyphs=[],i===1&&o.readMessage(i4,n)}function i4(i,n,o){if(i===3){const{id:c,bitmap:p,width:_,height:b,left:C,top:P,advance:M}=o.readMessage(s4,{});n.glyphs.push({id:c,bitmap:new bo({width:_+2*gx,height:b+2*gx},p),metrics:{width:_,height:b,left:C,top:P,advance:M}})}else i===4?n.ascender=o.readSVarint():i===5&&(n.descender=o.readSVarint())}function s4(i,n,o){i===1?n.id=o.readVarint():i===2?n.bitmap=o.readBytes():i===3?n.width=o.readVarint():i===4?n.height=o.readVarint():i===5?n.left=o.readSVarint():i===6?n.top=o.readSVarint():i===7&&(n.advance=o.readVarint())}const vS=gx;function yx(i){let n=0,o=0;for(const b of i)n+=b.w*b.h,o=Math.max(o,b.w);i.sort(((b,C)=>C.h-b.h));const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let p=0,_=0;for(const b of i)for(let C=c.length-1;C>=0;C--){const P=c[C];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===P.w&&b.h===P.h){const M=c.pop();C<c.length&&(c[C]=M)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(c.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:p,h:_,fill:n/(p*_)||0}}const Vo=1;class _x{constructor(n,{pixelRatio:o,version:c,stretchX:p,stretchY:_,content:b}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=p,this.stretchY=_,this.content=b,this.version=c}get tl(){return[this.paddedRect.x+Vo,this.paddedRect.y+Vo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vo,this.paddedRect.y+this.paddedRect.h-Vo]}get displaySize(){return[(this.paddedRect.w-2*Vo)/this.pixelRatio,(this.paddedRect.h-2*Vo)/this.pixelRatio]}}class xS{constructor(n,o){const c={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(n,c,_),this.addImages(o,p,_);const{w:b,h:C}=yx(_),P=new Qs({width:b||1,height:C||1});for(const M in n){const z=n[M],V=c[M].paddedRect;Qs.copy(z.data,P,{x:0,y:0},{x:V.x+Vo,y:V.y+Vo},z.data)}for(const M in o){const z=o[M],V=p[M].paddedRect,$=V.x+Vo,K=V.y+Vo,X=z.data.width,ne=z.data.height;Qs.copy(z.data,P,{x:0,y:0},{x:$,y:K},z.data),Qs.copy(z.data,P,{x:0,y:ne-1},{x:$,y:K-1},{width:X,height:1}),Qs.copy(z.data,P,{x:0,y:0},{x:$,y:K+ne},{width:X,height:1}),Qs.copy(z.data,P,{x:X-1,y:0},{x:$-1,y:K},{width:1,height:ne}),Qs.copy(z.data,P,{x:0,y:0},{x:$+X,y:K},{width:1,height:ne})}this.image=P,this.iconPositions=c,this.patternPositions=p}addImages(n,o,c){for(const p in n){const _=n[p],b={x:0,y:0,w:_.data.width+2*Vo,h:_.data.height+2*Vo};c.push(b),o[p]=new _x(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((c=>n.hasImage(c))),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in n.updatedImages)this.patchUpdatedImage(this.iconPositions[c],n.getImage(c),o),this.patchUpdatedImage(this.patternPositions[c],n.getImage(c),o)}patchUpdatedImage(n,o,c){if(!n||!o||n.version===o.version)return;n.version=o.version;const[p,_]=n.tl;c.update(o.data,void 0,{x:p,y:_})}}Ut(_x,"ImagePosition"),Ut(xS,"ImageAtlas");const Ma={horizontal:1,vertical:2,horizontalOnly:3},wS=-17;class Vg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const c=new Vg;return c.scale=n||1,c.fontStack=o,c}static forImage(n){const o=new Vg;return o.imageName=n,o}}class em{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const c=new em;for(let p=0;p<n.sections.length;p++){const _=n.sections[p];_.image?c.addImageSection(_):c.addTextSection(_,o)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=(function(o,c){let p="";for(let _=0;_<o.length;_++){const b=o.charCodeAt(_+1)||null,C=o.charCodeAt(_-1)||null;p+=!c&&(b&&Ws(b)&&!Fg[o[_+1]]||C&&Ws(C)&&!Fg[o[_-1]])||!Fg[o[_]]?o[_]:Fg[o[_]]}return p})(this.text,n)}trim(){let n=0;for(let c=0;c<this.text.length&&F_[this.text.charCodeAt(c)];c++)n++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&F_[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const c=new em;return c.text=this.text.substring(n,o),c.sectionIndex=this.sectionIndex.slice(n,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((n,o)=>Math.max(n,this.sections[o].scale)),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(Vg.forText(n.scale,n.fontStack||o));const c=this.sections.length-1;for(let p=0;p<n.text.length;++p)this.sectionIndex.push(c)}addImageSection(n){const o=n.image?n.image.name:"";if(o.length===0)return void Jn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Vg.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Jn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vx(i,n,o,c,p,_,b,C,P,M,z,V,$,K,X){const ne=em.fromFeature(i,p);V===Ma.vertical&&ne.verticalizePunctuation($);let le=[];const me=(function(Pe,et,Ke,pt,Pt,nt){if(!Pe)return[];const yt=[],_t=(function(Vt,en,Ht,Dn,Dt,dn){let Ln=0;for(let hr=0;hr<Vt.length();hr++){const On=Vt.getSection(hr);Ln+=bS(Vt.getCharCode(hr),On,Dn,Dt,en,dn)}return Ln/Math.max(1,Math.ceil(Ln/Ht))})(Pe,et,Ke,pt,Pt,nt),Ct=Pe.text.indexOf("")>=0;let Rt=0;for(let Vt=0;Vt<Pe.length();Vt++){const en=Pe.getSection(Vt),Ht=Pe.getCharCode(Vt);if(F_[Ht]||(Rt+=bS(Ht,en,pt,Pt,et,nt)),Vt<Pe.length()-1){const Dn=!((dt=Ht)<11904||!(Bt["Bopomofo Extended"](dt)||Bt.Bopomofo(dt)||Bt["CJK Compatibility Forms"](dt)||Bt["CJK Compatibility Ideographs"](dt)||Bt["CJK Compatibility"](dt)||Bt["CJK Radicals Supplement"](dt)||Bt["CJK Strokes"](dt)||Bt["CJK Symbols and Punctuation"](dt)||Bt["CJK Unified Ideographs Extension A"](dt)||Bt["CJK Unified Ideographs"](dt)||Bt["Enclosed CJK Letters and Months"](dt)||Bt["Halfwidth and Fullwidth Forms"](dt)||Bt.Hiragana(dt)||Bt["Ideographic Description Characters"](dt)||Bt["Kangxi Radicals"](dt)||Bt["Katakana Phonetic Extensions"](dt)||Bt.Katakana(dt)||Bt["Vertical Forms"](dt)||Bt["Yi Radicals"](dt)||Bt["Yi Syllables"](dt)));(o4[Ht]||Dn||en.imageName)&&yt.push(SS(Vt+1,Rt,_t,yt,a4(Ht,Pe.getCharCode(Vt+1),Dn&&Ct),!1))}}var dt;return ES(SS(Pe.length(),Rt,_t,yt,0,!0))})(ne,M,_,n,c,K),{processBidirectionalText:Ce,processStyledBidirectionalText:ge}=D;if(Ce&&ne.sections.length===1){const Pe=Ce(ne.toString(),me);for(const et of Pe){const Ke=new em;Ke.text=et,Ke.sections=ne.sections;for(let pt=0;pt<et.length;pt++)Ke.sectionIndex.push(0);le.push(Ke)}}else if(ge){const Pe=ge(ne.text,ne.sectionIndex,me);for(const et of Pe){const Ke=new em;Ke.text=et[0],Ke.sectionIndex=et[1],Ke.sections=ne.sections,le.push(Ke)}}else le=(function(Pe,et){const Ke=[],pt=Pe.text;let Pt=0;for(const nt of et)Ke.push(Pe.substring(Pt,nt)),Pt=nt;return Pt<pt.length&&Ke.push(Pe.substring(Pt,pt.length)),Ke})(ne,me);const Ee=[],Re={positionedLines:Ee,text:ne.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return(function(Pe,et,Ke,pt,Pt,nt,yt,_t,Ct,Rt,dt,Vt){let en=0,Ht=0,Dn=0;const Dt=_t==="right"?1:_t==="left"?0:.5;let dn=!1;for(const Bn of Pt){const Fn=Bn.getSections();for(const Tr of Fn){if(Tr.imageName)continue;const Rr=et[Tr.fontStack];if(Rr&&(dn=Rr.ascender!==void 0&&Rr.descender!==void 0,!dn))break}if(!dn)break}let Ln=0;for(const Bn of Pt){Bn.trim();const Fn=Bn.getMaxScale(),Tr=(Fn-1)*_s,Rr={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Ln]=Rr;const Nr=Rr.positionedGlyphs;let Sr=0;if(!Bn.length()){Ht+=nt,++Ln;continue}let Kr=0,ui=0;for(let Er=0;Er<Bn.length();Er++){const Fi=Bn.getSection(Er),Ci=Bn.getSectionIndex(Er),ti=Bn.getCharCode(Er);let gr=Fi.scale,ki=null,jr=null,So=null,Ai=_s,vs=0;const rs=!(Ct===Ma.horizontal||!dt&&!Nc(ti)||dt&&(F_[ti]||(hr=ti,Bt.Arabic(hr)||Bt["Arabic Supplement"](hr)||Bt["Arabic Extended-A"](hr)||Bt["Arabic Presentation Forms-A"](hr)||Bt["Arabic Presentation Forms-B"](hr))));if(Fi.imageName){const Eo=pt[Fi.imageName];if(!Eo)continue;So=Fi.imageName,Pe.iconsInText=Pe.iconsInText||!0,jr=Eo.paddedRect;const is=Eo.displaySize;gr=gr*_s/Vt,ki={width:is[0],height:is[1],left:Vo,top:-vS,advance:rs?is[1]:is[0],localGlyph:!1},vs=dn?-ki.height*gr:wS+Fn*_s-is[1]*gr,Ai=ki.advance;const ql=(rs?is[0]:is[1])*gr-_s*Fn;ql>0&&ql>Sr&&(Sr=ql)}else{const Eo=Ke[Fi.fontStack];if(!Eo)continue;Eo[ti]&&(jr=Eo[ti]);const is=et[Fi.fontStack];if(!is)continue;const ql=is.glyphs[ti];if(!ql)continue;if(ki=ql.metrics,Ai=ti!==8203?_s:0,dn){const am=is.ascender!==void 0?Math.abs(is.ascender):0,Yg=is.descender!==void 0?Math.abs(is.descender):0,Jg=(am+Yg)*gr;Kr<Jg&&(Kr=Jg,ui=(am-Yg)/2*gr),vs=-am*gr}else vs=wS+(Fn-gr)*_s}rs?(Pe.verticalizable=!0,Nr.push({glyph:ti,imageName:So,x:en,y:Ht+vs,vertical:rs,scale:gr,localGlyph:ki.localGlyph,fontStack:Fi.fontStack,sectionIndex:Ci,metrics:ki,rect:jr}),en+=Ai*gr+Rt):(Nr.push({glyph:ti,imageName:So,x:en,y:Ht+vs,vertical:rs,scale:gr,localGlyph:ki.localGlyph,fontStack:Fi.fontStack,sectionIndex:Ci,metrics:ki,rect:jr}),en+=ki.advance*gr+Rt)}Nr.length!==0&&(Dn=Math.max(en-Rt,Dn),dn?CS(Nr,Dt,Sr,ui,nt*Fn/2):CS(Nr,Dt,Sr,0,nt/2)),en=0;const Ei=nt*Fn+Sr;Rr.lineOffset=Math.max(Sr,Tr),Ht+=Ei,++Ln}var hr;const On=Ht,{horizontalAlign:Tn,verticalAlign:zr}=xx(yt);(function(Bn,Fn,Tr,Rr,Nr,Sr){const Kr=(Fn-Tr)*Nr,ui=-Sr*Rr;for(const Ei of Bn)for(const Er of Ei.positionedGlyphs)Er.x+=Kr,Er.y+=ui})(Pe.positionedLines,Dt,Tn,zr,Dn,On),Pe.top+=-zr*On,Pe.bottom=Pe.top+On,Pe.left+=-Tn*Dn,Pe.right=Pe.left+Dn,Pe.hasBaseline=dn})(Re,n,o,c,le,b,C,P,V,M,$,X),!(function(Pe){for(const et of Pe)if(et.positionedGlyphs.length!==0)return!1;return!0})(Ee)&&Re}const F_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},o4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bS(i,n,o,c,p,_){if(n.imageName){const b=c[n.imageName];return b?b.displaySize[0]*n.scale*_s/_+p:0}{const b=o[n.fontStack],C=b&&b.glyphs[i];return C?C.metrics.advance*n.scale+p:0}}function TS(i,n,o,c){const p=Math.pow(i-n,2);return c?i<n?p/2:2*p:p+Math.abs(o)*o}function a4(i,n,o){let c=0;return i===10&&(c-=1e4),o&&(c+=150),i!==40&&i!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function SS(i,n,o,c,p,_){let b=null,C=TS(n,o,p,_);for(const P of c){const M=TS(n-P.x,o,p,_)+P.badness;M<=C&&(b=P,C=M)}return{index:i,x:n,priorBreak:b,badness:C}}function ES(i){return i?ES(i.priorBreak).concat(i.index):[]}function xx(i){let n=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function CS(i,n,o,c,p){if(!(n||o||c||p))return;const _=i.length-1,b=i[_],C=(b.x+b.metrics.advance*b.scale)*n;for(let P=0;P<=_;P++)i[P].x-=C,i[P].y+=o+c+p}function l4(i,n,o){const{horizontalAlign:c,verticalAlign:p}=xx(o),_=n[0]-i.displaySize[0]*c,b=n[1]-i.displaySize[1]*p;return{image:i,top:b,bottom:b+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function kS(i,n,o,c,p,_){const b=i.image;let C;if(b.content){const le=b.content,me=b.pixelRatio||1;C=[le[0]/me,le[1]/me,b.displaySize[0]-le[2]/me,b.displaySize[1]-le[3]/me]}const P=n.left*_,M=n.right*_;let z,V,$,K;o==="width"||o==="both"?(K=p[0]+P-c[3],V=p[0]+M+c[1]):(K=p[0]+(P+M-b.displaySize[0])/2,V=K+b.displaySize[0]);const X=n.top*_,ne=n.bottom*_;return o==="height"||o==="both"?(z=p[1]+X-c[0],$=p[1]+ne+c[2]):(z=p[1]+(X+ne-b.displaySize[1])/2,$=z+b.displaySize[1]),{image:b,top:z,right:V,bottom:$,left:K,collisionPadding:C}}class Ku extends Me{constructor(n,o,c,p,_){super(n,o),this.angle=p,this.z=c,_!==void 0&&(this.segment=_)}clone(){return new Ku(this.x,this.y,this.z,this.angle,this.segment)}}function AS(i,n,o,c,p){if(n.segment===void 0)return!0;let _=n,b=n.segment+1,C=0;for(;C>-o/2;){if(b--,b<0)return!1;C-=i[b].dist(_),_=i[b]}C+=i[b].dist(i[b+1]),b++;const P=[];let M=0;for(;C<o/2;){const z=i[b],V=i[b+1];if(!V)return!1;let $=i[b-1].angleTo(z)-z.angleTo(V);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:C,angleDelta:$}),M+=$;C-P[0].distance>c;)M-=P.shift().angleDelta;if(M>p)return!1;b++,C+=z.dist(V)}return!0}function PS(i){let n=0;for(let o=0;o<i.length-1;o++)n+=i[o].dist(i[o+1]);return n}function MS(i,n,o){return i?.6*n*o:0}function IS(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function c4(i,n,o,c,p,_){const b=MS(o,p,_),C=IS(o,c)*_;let P=0;const M=PS(i)/2;for(let z=0;z<i.length-1;z++){const V=i[z],$=i[z+1],K=V.dist($);if(P+K>M){const X=(M-P)/K,ne=Qn(V.x,$.x,X),le=Qn(V.y,$.y,X),me=new Ku(ne,le,0,$.angleTo(V),z);return!b||AS(i,me,C,b,n)?me:void 0}P+=K}}function u4(i,n,o,c,p,_,b,C,P){const M=MS(c,_,b),z=IS(c,p),V=z*b,$=i[0].x===0||i[0].x===P||i[0].y===0||i[0].y===P;return n-V<n/4&&(n=V+n/4),RS(i,$?n/2*C%n:(z/2+2*_)*b*C%n,n,M,o,V,$,!1,P)}function RS(i,n,o,c,p,_,b,C,P){const M=_/2,z=PS(i);let V=0,$=n-o,K=[];for(let X=0;X<i.length-1;X++){const ne=i[X],le=i[X+1],me=ne.dist(le),Ce=le.angleTo(ne);for(;$+o<V+me;){$+=o;const ge=($-V)/me,Ee=Qn(ne.x,le.x,ge),Re=Qn(ne.y,le.y,ge);if(Ee>=0&&Ee<P&&Re>=0&&Re<P&&$-M>=0&&$+M<=z){const Pe=new Ku(Ee,Re,0,Ce,X);Pe._round(),c&&!AS(i,Pe,_,c,p)||K.push(Pe)}}V+=me}return C||K.length||b||(K=RS(i,V/2,o,c,p,_,b,!0,P)),K}function NS(i,n,o,c,p){const _=[];for(let b=0;b<i.length;b++){const C=i[b];let P;for(let M=0;M<C.length-1;M++){let z=C[M],V=C[M+1];z.x<n&&V.x<n||(z.x<n?z=new Me(n,z.y+(n-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x<n&&(V=new Me(n,z.y+(n-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y<o&&V.y<o||(z.y<o?z=new Me(z.x+(o-z.y)/(V.y-z.y)*(V.x-z.x),o)._round():V.y<o&&(V=new Me(z.x+(o-z.y)/(V.y-z.y)*(V.x-z.x),o)._round()),z.x>=c&&V.x>=c||(z.x>=c?z=new Me(c,z.y+(c-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x>=c&&(V=new Me(c,z.y+(c-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y>=p&&V.y>=p||(z.y>=p?z=new Me(z.x+(p-z.y)/(V.y-z.y)*(V.x-z.x),p)._round():V.y>=p&&(V=new Me(z.x+(p-z.y)/(V.y-z.y)*(V.x-z.x),p)._round()),P&&z.equals(P[P.length-1])||(P=[z],_.push(P)),P.push(V)))))}}return _}Ut(Ku,"Anchor");const Ug=1e20;function jS(i,n,o,c,p,_,b,C,P){for(let M=n;M<n+c;M++)DS(i,o*_+M,_,p,b,C,P);for(let M=o;M<o+p;M++)DS(i,M*_+n,1,c,b,C,P)}function DS(i,n,o,c,p,_,b){_[0]=0,b[0]=-Ug,b[1]=Ug,p[0]=i[n];for(let C=1,P=0,M=0;C<c;C++){p[C]=i[n+C*o];const z=C*C;do{const V=_[P];M=(p[C]-p[V]+z-V*V)/(C-V)/2}while(M<=b[P]&&--P>-1);P++,_[P]=C,b[P]=M,b[P+1]=Ug}for(let C=0,P=0;C<c;C++){for(;b[P+1]<C;)P++;const M=_[P],z=C-M;i[n+C*o]=p[M]+z*z}}const Gl=2,wx={none:0,ideographs:1,all:2};class tm{constructor(n,o,c){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,o){const c=[];for(const p in n)for(const _ of n[p])c.push({stack:p,id:_});Ve(c,(({stack:p,id:_},b)=>{let C=this.entries[p];C||(C=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=C.glyphs[_];if(P!==void 0)return void b(null,{stack:p,id:_,glyph:P});if(P=this._tinySDF(C,p,_),P)return C.glyphs[_]=P,void b(null,{stack:p,id:_,glyph:P});const M=Math.floor(_/256);if(256*M>65535)return void b(new Error("glyphs > 65535 not supported"));if(C.ranges[M])return void b(null,{stack:p,id:_,glyph:P});let z=C.requests[M];z||(z=C.requests[M]=[],tm.loadGlyphRange(p,M,this.url,this.requestManager,((V,$)=>{if($){C.ascender=$.ascender,C.descender=$.descender;for(const K in $.glyphs)this._doesCharSupportLocalGlyph(+K)||(C.glyphs[+K]=$.glyphs[+K]);C.ranges[M]=!0}for(const K of z)K(V,$);delete C.requests[M]}))),z.push(((V,$)=>{V?b(V):$&&b(null,{stack:p,id:_,glyph:$.glyphs[_]||null})}))}),((p,_)=>{if(p)o(p);else if(_){const b={};for(const{stack:C,id:P,glyph:M}of _)b[C]===void 0&&(b[C]={}),b[C].glyphs===void 0&&(b[C].glyphs={}),b[C].glyphs[P]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[C].ascender=this.entries[C].ascender,b[C].descender=this.entries[C].descender;o(null,b)}}))}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==wx.none&&(this.localGlyphMode===wx.all?!!this.localFontFamily:!!this.localFontFamily&&(Bt["CJK Unified Ideographs"](n)||Bt["Hangul Syllables"](n)||Bt.Hiragana(n)||Bt.Katakana(n)||Bt["CJK Symbols and Punctuation"](n)))}_tinySDF(n,o,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let _=n.tinySDF;if(!_){let ne="400";/bold/i.test(o)?ne="900":/medium/i.test(o)?ne="500":/light/i.test(o)&&(ne="200"),_=n.tinySDF=new tm.TinySDF({fontFamily:p,fontWeight:ne,fontSize:24*Gl,buffer:3*Gl,radius:8*Gl}),_.fontWeight=ne}if(this.localGlyphs[_.fontWeight][c])return this.localGlyphs[_.fontWeight][c];const b=String.fromCharCode(c),{data:C,width:P,height:M,glyphWidth:z,glyphHeight:V,glyphLeft:$,glyphTop:K,glyphAdvance:X}=_.draw(b);return this.localGlyphs[_.fontWeight][c]={id:c,bitmap:new bo({width:P,height:M},C),metrics:{width:z/Gl,height:V/Gl,left:$/Gl,top:K/Gl-27,advance:X/Gl,localGlyph:!0}}}}tm.loadGlyphRange=function(i,n,o,c,p){const _=256*n,b=_+255,C=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${_}-${b}`),Ii.Glyphs);oo(C,((P,M)=>{if(P)p(P);else if(M){const z={},V=(function($){return new B_($).readFields(r4,{})})(M);for(const $ of V.glyphs)z[$.id]=$;p(null,{glyphs:z,ascender:V.ascender,descender:V.descender})}}))},tm.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:o=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:b="normal"}={}){this.buffer=n,this.cutoff=c,this.radius=o;const C=this.size=i+4*n,P=this._createCanvas(C),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${b} ${_} ${i}px ${p}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(i),b=Math.ceil(o),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),P=Math.min(this.size-this.buffer,b+Math.ceil(c)),M=C+2*this.buffer,z=P+2*this.buffer,V=Math.max(M*z,0),$=new Uint8ClampedArray(V),K={data:$,width:M,height:z,glyphWidth:C,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:n};if(C===0||P===0)return K;const{ctx:X,buffer:ne,gridInner:le,gridOuter:me}=this;X.clearRect(ne,ne,C,P),X.fillText(i,ne,ne+b);const Ce=X.getImageData(ne,ne,C,P);me.fill(Ug,0,V),le.fill(0,0,V);for(let ge=0;ge<P;ge++)for(let Ee=0;Ee<C;Ee++){const Re=Ce.data[4*(ge*C+Ee)+3]/255;if(Re===0)continue;const Pe=(ge+ne)*M+Ee+ne;if(Re===1)me[Pe]=0,le[Pe]=Ug;else{const et=.5-Re;me[Pe]=et>0?et*et:0,le[Pe]=et<0?et*et:0}}jS(me,0,0,M,z,M,this.f,this.v,this.z),jS(le,ne,ne,C,P,M,this.f,this.v,this.z);for(let ge=0;ge<V;ge++){const Ee=Math.sqrt(me[ge])-Math.sqrt(le[ge]);$[ge]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return K}};const nm=Vo;function LS(i,n,o,c){const p=[],_=i.image,b=_.pixelRatio,C=_.paddedRect.w-2*nm,P=_.paddedRect.h-2*nm,M=i.right-i.left,z=i.bottom-i.top,V=_.stretchX||[[0,C]],$=_.stretchY||[[0,P]],K=(nt,yt)=>nt+yt[1]-yt[0],X=V.reduce(K,0),ne=$.reduce(K,0),le=C-X,me=P-ne;let Ce=0,ge=X,Ee=0,Re=ne,Pe=0,et=le,Ke=0,pt=me;if(_.content&&c){const nt=_.content;Ce=V_(V,0,nt[0]),Ee=V_($,0,nt[1]),ge=V_(V,nt[0],nt[2]),Re=V_($,nt[1],nt[3]),Pe=nt[0]-Ce,Ke=nt[1]-Ee,et=nt[2]-nt[0]-ge,pt=nt[3]-nt[1]-Re}const Pt=(nt,yt,_t,Ct)=>{const Rt=U_(nt.stretch-Ce,ge,M,i.left),dt=$_(nt.fixed-Pe,et,nt.stretch,X),Vt=U_(yt.stretch-Ee,Re,z,i.top),en=$_(yt.fixed-Ke,pt,yt.stretch,ne),Ht=U_(_t.stretch-Ce,ge,M,i.left),Dn=$_(_t.fixed-Pe,et,_t.stretch,X),Dt=U_(Ct.stretch-Ee,Re,z,i.top),dn=$_(Ct.fixed-Ke,pt,Ct.stretch,ne),Ln=new Me(Rt,Vt),hr=new Me(Ht,Vt),On=new Me(Ht,Dt),Tn=new Me(Rt,Dt),zr=new Me(dt/b,en/b),Bn=new Me(Dn/b,dn/b),Fn=n*Math.PI/180;if(Fn){const Nr=Math.sin(Fn),Sr=Math.cos(Fn),Kr=[Sr,-Nr,Nr,Sr];Ln._matMult(Kr),hr._matMult(Kr),Tn._matMult(Kr),On._matMult(Kr)}const Tr=nt.stretch+nt.fixed,Rr=yt.stretch+yt.fixed;return{tl:Ln,tr:hr,bl:Tn,br:On,tex:{x:_.paddedRect.x+nm+Tr,y:_.paddedRect.y+nm+Rr,w:_t.stretch+_t.fixed-Tr,h:Ct.stretch+Ct.fixed-Rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zr,pixelOffsetBR:Bn,minFontScaleX:et/b/M,minFontScaleY:pt/b/z,isSDF:o}};if(c&&(_.stretchX||_.stretchY)){const nt=OS(V,le,X),yt=OS($,me,ne);for(let _t=0;_t<nt.length-1;_t++){const Ct=nt[_t],Rt=nt[_t+1];for(let dt=0;dt<yt.length-1;dt++)p.push(Pt(Ct,yt[dt],Rt,yt[dt+1]))}}else p.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:P+1}));return p}function V_(i,n,o){let c=0;for(const p of i)c+=Math.max(n,Math.min(o,p[1]))-Math.max(n,Math.min(o,p[0]));return c}function OS(i,n,o){const c=[{fixed:-nm,stretch:0}];for(const[p,_]of i){const b=c[c.length-1];c.push({fixed:p-b.stretch,stretch:b.stretch}),c.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return c.push({fixed:n+nm,stretch:o}),c}function U_(i,n,o,c){return i/n*o+c}function $_(i,n,o,c){return i-n*o/c}function d4(i,n,o,c){const p=n+i.positionedLines[c].lineOffset;return c===0?o+p/2:o+(p+(n+i.positionedLines[c-1].lineOffset))/2}class h4{constructor(n=[],o=f4){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:c}=this,p=o[n];for(;n>0;){const _=n-1>>1,b=o[_];if(c(p,b)>=0)break;o[n]=b,n=_}o[n]=p}_down(n){const{data:o,compare:c}=this,p=this.length>>1,_=o[n];for(;n<p;){let b=1+(n<<1),C=o[b];const P=b+1;if(P<this.length&&c(o[P],C)<0&&(b=P,C=o[P]),c(C,_)>=0)break;o[n]=C,n=b}o[n]=_}}function f4(i,n){return i<n?-1:i>n?1:0}function p4(i,n=1,o=!1){let c=1/0,p=1/0,_=-1/0,b=-1/0;const C=i[0];for(let K=0;K<C.length;K++){const X=C[K];(!K||X.x<c)&&(c=X.x),(!K||X.y<p)&&(p=X.y),(!K||X.x>_)&&(_=X.x),(!K||X.y>b)&&(b=X.y)}const P=Math.min(_-c,b-p);let M=P/2;const z=new h4([],m4);if(P===0)return new Me(c,p);for(let K=c;K<_;K+=P)for(let X=p;X<b;X+=P)z.push(new rm(K+M,X+M,M,i));let V=(function(K){let X=0,ne=0,le=0;const me=K[0];for(let Ce=0,ge=me.length,Ee=ge-1;Ce<ge;Ee=Ce++){const Re=me[Ce],Pe=me[Ee],et=Re.x*Pe.y-Pe.x*Re.y;ne+=(Re.x+Pe.x)*et,le+=(Re.y+Pe.y)*et,X+=3*et}return new rm(ne/X,le/X,0,K)})(i),$=z.length;for(;z.length;){const K=z.pop();(K.d>V.d||!V.d)&&(V=K,o&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,$)),K.max-V.d<=n||(M=K.h/2,z.push(new rm(K.p.x-M,K.p.y-M,M,i)),z.push(new rm(K.p.x+M,K.p.y-M,M,i)),z.push(new rm(K.p.x-M,K.p.y+M,M,i)),z.push(new rm(K.p.x+M,K.p.y+M,M,i)),$+=4)}return o&&(console.log(`num probes: ${$}`),console.log(`best distance: ${V.d}`)),V.p}function m4(i,n){return n.max-i.max}class rm{constructor(n,o,c,p){this.p=new Me(n,o),this.h=c,this.d=(function(_,b){let C=!1,P=1/0;for(let M=0;M<b.length;M++){const z=b[M];for(let V=0,$=z.length,K=$-1;V<$;K=V++){const X=z[V],ne=z[K];X.y>_.y!=ne.y>_.y&&_.x<(ne.x-X.x)*(_.y-X.y)/(ne.y-X.y)+X.x&&(C=!C),P=Math.min(P,Sg(_,X,ne))}}return(C?1:-1)*Math.sqrt(P)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const im=7,bx=Number.POSITIVE_INFINITY,g4=Math.sqrt(2);function zS(i,[n,o]){let c=0,p=0;if(o===bx){n<0&&(n=0);const _=n/g4;switch(i){case"top-right":case"top-left":p=_-im;break;case"bottom-right":case"bottom-left":p=-_+im;break;case"bottom":p=-n+im;break;case"top":p=n-im}switch(i){case"top-right":case"bottom-right":c=-_;break;case"top-left":case"bottom-left":c=_;break;case"left":c=n;break;case"right":c=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),i){case"top-right":case"top-left":case"top":p=o-im;break;case"bottom-right":case"bottom-left":case"bottom":p=-o+im}switch(i){case"top-right":case"bottom-right":case"right":c=-n;break;case"top-left":case"bottom-left":case"left":c=n}}return[c,p]}function y4(i,n,o,c,p,_,b,C,P,M){i.createArrays(),i.tilePixelRatio=ln/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const z=i.layers[0].layout,V=i.layers[0]._unevaluatedLayout._values,$={};if(i.textSizeData.kind==="composite"){const{minZoom:ne,maxZoom:le}=i.textSizeData;$.compositeTextSizes=[V["text-size"].possiblyEvaluate(new B(ne),C),V["text-size"].possiblyEvaluate(new B(le),C)]}if(i.iconSizeData.kind==="composite"){const{minZoom:ne,maxZoom:le}=i.iconSizeData;$.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new B(ne),C),V["icon-size"].possiblyEvaluate(new B(le),C)]}$.layoutTextSize=V["text-size"].possiblyEvaluate(new B(P+1),C),$.layoutIconSize=V["icon-size"].possiblyEvaluate(new B(P+1),C),$.textMaxSize=V["text-size"].possiblyEvaluate(new B(18),C);const K=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",X=z.get("text-size");for(const ne of i.features){const le=z.get("text-font").evaluate(ne,{},C).join(","),me=X.evaluate(ne,{},C),Ce=$.layoutTextSize.evaluate(ne,{},C),ge=($.layoutIconSize.evaluate(ne,{},C),{horizontal:{},vertical:void 0}),Ee=ne.text;let Re,Pe=[0,0];if(Ee){const pt=Ee.toString(),Pt=z.get("text-letter-spacing").evaluate(ne,{},C)*_s,nt=z.get("text-line-height").evaluate(ne,{},C)*_s,yt=Rc(pt)?Pt:0,_t=z.get("text-anchor").evaluate(ne,{},C),Ct=z.get("text-variable-anchor");if(!Ct){const Ht=z.get("text-radial-offset").evaluate(ne,{},C);Pe=Ht?zS(_t,[Ht*_s,bx]):z.get("text-offset").evaluate(ne,{},C).map((Dn=>Dn*_s))}let Rt=K?"center":z.get("text-justify").evaluate(ne,{},C);const dt=z.get("symbol-placement")==="point",Vt=dt?z.get("text-max-width").evaluate(ne,{},C)*_s:1/0,en=Ht=>{i.allowVerticalPlacement&&Ya(pt)&&(ge.vertical=vx(Ee,n,o,p,le,Vt,nt,_t,Ht,yt,Pe,Ma.vertical,!0,Ce,me))};if(!K&&Ct){const Ht=Rt==="auto"?Ct.map((Dt=>Tx(Dt))):[Rt];let Dn=!1;for(let Dt=0;Dt<Ht.length;Dt++){const dn=Ht[Dt];if(!ge.horizontal[dn])if(Dn)ge.horizontal[dn]=ge.horizontal[0];else{const Ln=vx(Ee,n,o,p,le,Vt,nt,"center",dn,yt,Pe,Ma.horizontal,!1,Ce,me);Ln&&(ge.horizontal[dn]=Ln,Dn=Ln.positionedLines.length===1)}}en("left")}else{if(Rt==="auto"&&(Rt=Tx(_t)),dt||z.get("text-writing-mode").indexOf("horizontal")>=0||!Ya(pt)){const Ht=vx(Ee,n,o,p,le,Vt,nt,_t,Rt,yt,Pe,Ma.horizontal,!1,Ce,me);Ht&&(ge.horizontal[Rt]=Ht)}en(dt?"left":Rt)}}let et=!1;if(ne.icon&&ne.icon.name){const pt=c[ne.icon.name];pt&&(Re=l4(p[ne.icon.name],z.get("icon-offset").evaluate(ne,{},C),z.get("icon-anchor").evaluate(ne,{},C)),et=pt.sdf,i.sdfIcons===void 0?i.sdfIcons=pt.sdf:i.sdfIcons!==pt.sdf&&Jn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==i.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ke=FS(ge.horizontal)||ge.vertical;i.iconsInText||(i.iconsInText=!!Ke&&Ke.iconsInText),(Ke||Re)&&_4(i,ne,ge,Re,c,$,Ce,0,Pe,et,b,C,M)}_&&i.generateCollisionDebugBuffers(P,i.collisionBoxArray)}function Tx(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _4(i,n,o,c,p,_,b,C,P,M,z,V,$){let K=_.textMaxSize.evaluate(n,{},V);K===void 0&&(K=b);const X=i.layers[0].layout,ne=X.get("icon-offset").evaluate(n,{},V),le=FS(o.horizontal)||o.vertical,me=$.name==="globe",Ce=_s,ge=b/Ce,Ee=i.tilePixelRatio*K/Ce,Re=(_t=i.overscaling,i.zoom>18&&_t>2&&(_t>>=1),Math.max(ln/(512*_t),1)*X.get("symbol-spacing")),Pe=X.get("text-padding")*i.tilePixelRatio,et=X.get("icon-padding")*i.tilePixelRatio,Ke=mt(X.get("text-max-angle")),pt=X.get("text-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Pt=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",nt=X.get("symbol-placement"),yt=Re/2;var _t;const Ct=X.get("icon-text-fit");let Rt;c&&Ct!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(Rt=kS(c,o.vertical,Ct,X.get("icon-text-fit-padding"),ne,ge)),le&&(c=kS(c,le,Ct,X.get("icon-text-fit-padding"),ne,ge)));const dt=(Vt,en,Ht)=>{if(en.x<0||en.x>=ln||en.y<0||en.y>=ln)return;let Dn=null;if(me){const{x:Dt,y:dn,z:Ln}=$.projectTilePoint(en.x,en.y,Ht);Dn={anchor:new Ku(Dt,dn,Ln,0,void 0),up:$.upVector(Ht,en.x,en.y)}}(function(Dt,dn,Ln,hr,On,Tn,zr,Bn,Fn,Tr,Rr,Nr,Sr,Kr,ui,Ei,Er,Fi,Ci,ti,gr,ki,jr,So,Ai){const vs=Dt.addToLineVertexArray(dn,hr);let rs,Eo,is,ql,am,Yg,Jg,vE=0,xE=0,wE=0,bE=0,zx=-1,Bx=-1;const Kc={};let TE=wo("");const Af=Ln?Ln.anchor:dn;let Fx=0,Vx=0;if(Fn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fx,Vx]=Fn.layout.get("text-offset").evaluate(gr,{},Ai).map((aa=>aa*_s)):(Fx=Fn.layout.get("text-radial-offset").evaluate(gr,{},Ai)*_s,Vx=bx),Dt.allowVerticalPlacement&&On.vertical){const aa=On.vertical;if(ui)Yg=Sx(aa),Bn&&(Jg=Sx(Bn));else{const la=Fn.layout.get("text-rotate").evaluate(gr,{},Ai)+90;is=G_(Tr,Af,dn,Rr,Nr,Sr,aa,Kr,la,Ei),Bn&&(ql=G_(Tr,Af,dn,Rr,Nr,Sr,Bn,Fi,la))}}if(Tn){const aa=Fn.layout.get("icon-rotate").evaluate(gr,{},Ai),la=Fn.layout.get("icon-text-fit")!=="none",Qg=LS(Tn,aa,jr,la),$x=Bn?LS(Bn,aa,jr,la):void 0;Eo=G_(Tr,Af,dn,Rr,Nr,Sr,Tn,Fi,aa),vE=4*Qg.length;const SE=Dt.iconSizeData;let Pf=null;SE.kind==="source"?(Pf=[$l*Fn.layout.get("icon-size").evaluate(gr,{},Ai)],Pf[0]>Gd&&Jn(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${$g}. Reduce your "icon-size".`)):SE.kind==="composite"&&(Pf=[$l*ki.compositeIconSizes[0].evaluate(gr,{},Ai),$l*ki.compositeIconSizes[1].evaluate(gr,{},Ai)],(Pf[0]>Gd||Pf[1]>Gd)&&Jn(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${$g}. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,Qg,Pf,ti,Ci,gr,!1,Ln,dn,vs.lineStartIndex,vs.lineLength,-1,So,Ai),zx=Dt.icon.placedSymbolArray.length-1,$x&&(xE=4*$x.length,Dt.addSymbols(Dt.icon,$x,Pf,ti,Ci,gr,Ma.vertical,Ln,dn,vs.lineStartIndex,vs.lineLength,-1,So,Ai),Bx=Dt.icon.placedSymbolArray.length-1)}for(const aa in On.horizontal){const la=On.horizontal[aa];rs||(TE=wo(la.text),ui?am=Sx(la):rs=G_(Tr,Af,dn,Rr,Nr,Sr,la,Kr,Fn.layout.get("text-rotate").evaluate(gr,{},Ai),Ei));const Qg=la.positionedLines.length===1;if(wE+=BS(Dt,Ln,dn,la,zr,Fn,ui,gr,Ei,vs,On.vertical?Ma.horizontal:Ma.horizontalOnly,Qg?Object.keys(On.horizontal):[aa],Kc,zx,ki,So,Ai),Qg)break}On.vertical&&(bE+=BS(Dt,Ln,dn,On.vertical,zr,Fn,ui,gr,Ei,vs,Ma.vertical,["vertical"],Kc,Bx,ki,So,Ai));let Xd=-1;const Ux=(aa,la)=>aa?Math.max(aa,la):la;Xd=Ux(am,Xd),Xd=Ux(Yg,Xd),Xd=Ux(Jg,Xd);const q4=Xd>-1?1:0;Dt.glyphOffsetArray.length>=qd.MAX_GLYPHS&&Jn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gr.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,gr.sortKey),Dt.symbolInstances.emplaceBack(Af.x,Af.y,Af.z,dn.x,dn.y,Kc.right>=0?Kc.right:-1,Kc.center>=0?Kc.center:-1,Kc.left>=0?Kc.left:-1,Kc.vertical>=0?Kc.vertical:-1,zx,Bx,TE,rs!==void 0?rs:Dt.collisionBoxArray.length,rs!==void 0?rs+1:Dt.collisionBoxArray.length,is!==void 0?is:Dt.collisionBoxArray.length,is!==void 0?is+1:Dt.collisionBoxArray.length,Eo!==void 0?Eo:Dt.collisionBoxArray.length,Eo!==void 0?Eo+1:Dt.collisionBoxArray.length,ql||Dt.collisionBoxArray.length,ql?ql+1:Dt.collisionBoxArray.length,Rr,wE,bE,vE,xE,q4,0,Fx,Vx,Xd)})(i,en,Dn,Vt,o,c,p,Rt,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,Pe,pt,P,0,et,Pt,ne,n,_,M,z,V)};if(nt==="line")for(const Vt of NS(n.geometry,0,0,ln,ln)){const en=u4(Vt,Re,Ke,o.vertical||le,c,Ce,Ee,i.overscaling,ln);for(const Ht of en)le&&v4(i,le.text,yt,Ht)||dt(Vt,Ht,V)}else if(nt==="line-center"){for(const Vt of n.geometry)if(Vt.length>1){const en=c4(Vt,Ke,o.vertical||le,c,Ce,Ee);en&&dt(Vt,en,V)}}else if(n.type==="Polygon")for(const Vt of Lg(n.geometry,0)){const en=p4(Vt,16);dt(Vt[0],new Ku(en.x,en.y,0,0,void 0),V)}else if(n.type==="LineString")for(const Vt of n.geometry)dt(Vt,new Ku(Vt[0].x,Vt[0].y,0,0,void 0),V);else if(n.type==="Point")for(const Vt of n.geometry)for(const en of Vt)dt([en],new Ku(en.x,en.y,0,0,void 0),V)}const $g=255,Gd=$g*$l;function BS(i,n,o,c,p,_,b,C,P,M,z,V,$,K,X,ne,le){const me=(function(Ee,Re,Pe,et,Ke,pt,Pt,nt){const yt=[];if(Re.positionedLines.length===0)return yt;const _t=et.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Ct=(function(Ht){const Dn=Ht[0],Dt=Ht[1],dn=Dn*Dt;return dn>0?[Dn,-Dt]:dn<0?[-Dn,Dt]:Dn===0?[Dt,Dn]:[Dt,-Dn]})(Pe);let Rt=Math.abs(Re.top-Re.bottom);for(const Ht of Re.positionedLines)Rt-=Ht.lineOffset;const dt=Re.positionedLines.length,Vt=Rt/dt;let en=Re.top-Pe[1];for(let Ht=0;Ht<dt;++Ht){const Dn=Re.positionedLines[Ht];en=d4(Re,Vt,en,Ht);for(const Dt of Dn.positionedGlyphs){if(!Dt.rect)continue;const dn=Dt.rect||{};let Ln=vS+1,hr=!0,On=1,Tn=0;if(Dt.imageName){const jr=Pt[Dt.imageName];if(!jr)continue;if(jr.sdf){Jn("SDF images are not supported in formatted text and will be ignored.");continue}hr=!1,On=jr.pixelRatio,Ln=Vo/On}const zr=(Ke||nt)&&Dt.vertical,Bn=Dt.metrics.advance*Dt.scale/2,Fn=Dt.metrics,Tr=Dt.rect;if(Tr===null)continue;nt&&Re.verticalizable&&(Tn=Dt.imageName?Bn-Dt.metrics.width*Dt.scale/2:0);const Rr=Ke?[Dt.x+Bn,Dt.y]:[0,0];let Nr=[0,0],Sr=[0,0],Kr=!1;Ke||(zr?(Sr=[Dt.x+Bn+Ct[0],Dt.y+Ct[1]-Tn],Kr=!0):Nr=[Dt.x+Bn+Pe[0],Dt.y+Pe[1]-Tn]);const ui=Tr.w*Dt.scale/(On*(Dt.localGlyph?Gl:1)),Ei=Tr.h*Dt.scale/(On*(Dt.localGlyph?Gl:1));let Er,Fi,Ci,ti;if(zr){const jr=Dt.y-en,So=new Me(-Bn,Bn-jr),Ai=-Math.PI/2,vs=new Me(...Sr);Er=new Me(-Bn+Nr[0],Nr[1]),Er._rotateAround(Ai,So)._add(vs),Er.x+=-jr+Bn,Er.y-=(Fn.left-Ln)*Dt.scale;const rs=Dt.imageName?Fn.advance*Dt.scale:_s*Dt.scale,Eo=String.fromCharCode(Dt.glyph);q3(Eo)?Er.x+=(1-Ln)*Dt.scale:W3(Eo)?Er.x+=rs-Fn.height*Dt.scale+(-Ln-1)*Dt.scale:Er.x+=Dt.imageName||Fn.width+2*Ln===Tr.w&&Fn.height+2*Ln===Tr.h?(rs-Ei)/2:(rs-(Fn.height+2*Ln)*Dt.scale)/2,Fi=new Me(Er.x,Er.y-ui),Ci=new Me(Er.x+Ei,Er.y),ti=new Me(Er.x+Ei,Er.y-ui)}else{const jr=(Fn.left-Ln)*Dt.scale-Bn+Nr[0],So=(-Fn.top-Ln)*Dt.scale+Nr[1],Ai=jr+ui,vs=So+Ei;Er=new Me(jr,So),Fi=new Me(Ai,So),Ci=new Me(jr,vs),ti=new Me(Ai,vs)}if(_t){let jr;jr=Ke?new Me(0,0):Kr?new Me(Ct[0],Ct[1]):new Me(Pe[0],Pe[1]),Er._rotateAround(_t,jr),Fi._rotateAround(_t,jr),Ci._rotateAround(_t,jr),ti._rotateAround(_t,jr)}const gr=new Me(0,0),ki=new Me(0,0);yt.push({tl:Er,tr:Fi,bl:Ci,br:ti,tex:dn,writingMode:Re.writingMode,glyphOffset:Rr,sectionIndex:Dt.sectionIndex,isSDF:hr,pixelOffsetTL:gr,pixelOffsetBR:ki,minFontScaleX:0,minFontScaleY:0})}}return yt})(0,c,P,_,b,C,p,i.allowVerticalPlacement),Ce=i.textSizeData;let ge=null;Ce.kind==="source"?(ge=[$l*_.layout.get("text-size").evaluate(C,{},le)],ge[0]>Gd&&Jn(`${i.layerIds[0]}: Value for "text-size" is >= ${$g}. Reduce your "text-size".`)):Ce.kind==="composite"&&(ge=[$l*X.compositeTextSizes[0].evaluate(C,{},le),$l*X.compositeTextSizes[1].evaluate(C,{},le)],(ge[0]>Gd||ge[1]>Gd)&&Jn(`${i.layerIds[0]}: Value for "text-size" is >= ${$g}. Reduce your "text-size".`)),i.addSymbols(i.text,me,ge,P,b,C,z,n,o,M.lineStartIndex,M.lineLength,K,ne,le);for(const Ee of V)$[Ee]=i.text.placedSymbolArray.length-1;return 4*me.length}function FS(i){for(const n in i)return i[n];return null}function G_(i,n,o,c,p,_,b,C,P,M){let z=b.top,V=b.bottom,$=b.left,K=b.right;const X=b.collisionPadding;if(X&&($-=X[0],z-=X[1],K+=X[2],V+=X[3]),P){const ne=new Me($,z),le=new Me(K,z),me=new Me($,V),Ce=new Me(K,V),ge=mt(P);let Ee=new Me(0,0);M&&(Ee=new Me(M[0],M[1])),ne._rotateAround(ge,Ee),le._rotateAround(ge,Ee),me._rotateAround(ge,Ee),Ce._rotateAround(ge,Ee),$=Math.min(ne.x,le.x,me.x,Ce.x),K=Math.max(ne.x,le.x,me.x,Ce.x),z=Math.min(ne.y,le.y,me.y,Ce.y),V=Math.max(ne.y,le.y,me.y,Ce.y)}return i.emplaceBack(n.x,n.y,n.z,o.x,o.y,$,z,K,V,C,c,p,_),i.length-1}function Sx(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function v4(i,n,o,c){const p=i.compareText;if(n in p){const _=p[n];for(let b=_.length-1;b>=0;b--)if(c.dist(_[b])<o)return!0}else p[n]=[];return p[n].push(c),!1}function VS(i,n){const o=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,p=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),_=Math.sin(o)*p/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),b=Math.sin(i._pitch)*_+p;return Math.min(1.01*b,p*(1/i._horizonShift))}function Cf(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const o=Math.pow(2,-i.z),c=i.x*o,p=(i.x+1)*o,_=i.y*o,b=(i.y+1)*o,C=es(c),P=es(p),M=ur(_),z=ur(b),V=n.project(C,M),$=n.project(P,M),K=n.project(P,z),X=n.project(C,z);let ne=Math.min(V.x,$.x,K.x,X.x),le=Math.min(V.y,$.y,K.y,X.y),me=Math.max(V.x,$.x,K.x,X.x),Ce=Math.max(V.y,$.y,K.y,X.y);const ge=o/16;function Ee(Pe,et,Ke,pt,Pt,nt){const yt=(Ke+Pt)/2,_t=(pt+nt)/2,Ct=n.project(es(yt),ur(_t)),Rt=Math.max(0,ne-Ct.x,le-Ct.y,Ct.x-me,Ct.y-Ce);ne=Math.min(ne,Ct.x),me=Math.max(me,Ct.x),le=Math.min(le,Ct.y),Ce=Math.max(Ce,Ct.y),Rt>ge&&(Ee(Pe,Ct,Ke,pt,yt,_t),Ee(Ct,et,yt,_t,Pt,nt))}Ee(V,$,c,_,p,_),Ee($,K,p,_,p,b),Ee(K,X,p,b,c,b),Ee(X,V,c,b,c,_),ne-=ge,le-=ge,me+=ge,Ce+=ge;const Re=1/Math.max(me-ne,Ce-le);return{scale:Re,x:ne*Re,y:le*Re,x2:me*Re,y2:Ce*Re,projection:n}}const x4=Ea(new Float32Array(16));class Hd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new fn(0,0)}projectTilePoint(n,o,c){return{x:n,y:o,z:0}}locationPoint(n,o,c=!0){return n._coordinatePoint(n.locationCoordinate(o),c)}pixelsPerMeter(n,o){return ci(1,n)*o}pixelSpaceConversion(n,o,c){return 1}farthestPixelDistance(n){return VS(n,n.pixelsPerMeter)}pointCoordinate(n,o,c,p){const _=n.horizonLineFromTop(!1),b=new Me(o,Math.max(_,c));return n.rayIntersectionCoordinate(n.pointRayIntersection(b,p))}pointCoordinate3D(n,o,c){const p=new Me(o,c);if(n.elevation)return n.elevation.pointCoordinate(p);{const _=this.pointCoordinate(n,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(n,o){if(n.elevation)return!this.pointCoordinate3D(n,o.x,o.y);const c=n.horizonLineFromTop();return o.y<c}createInversionMatrix(n,o){return x4}createTileMatrix(n,o,c){let p,_,b;const C=c.canonical,P=Ea(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Cf(C,this);p=1,_=M.x+c.wrap*M.scale,b=M.y,Oc(P,P,[p/M.scale,p/M.scale,n.pixelsPerMeter/o])}else p=o/n.zoomScale(C.z),_=(C.x+Math.pow(2,C.z)*c.wrap)*p,b=C.y*p;return Lc(P,P,[_,b,0]),Oc(P,P,[p/ln,p/ln,1]),P}upVector(n,o,c){return[0,0,1]}upVectorScale(n,o,c){return{metersToTile:1}}}class w4 extends Hd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,c]=this.parallels=n.parallels||[29.5,45.5],p=Math.sin(mt(o));this.n=(p+Math.sin(mt(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:c,c:p,r0:_}=this,b=mt(n-this.center[0]),C=mt(o),P=Math.sqrt(p-2*c*Math.sin(C))/c;return{x:P*Math.sin(b*c),y:P*Math.cos(b*c)-_,z:0}}unproject(n,o){const{n:c,c:p,r0:_}=this,b=_+o;let C=Math.atan2(n,Math.abs(b))*Math.sign(b);b*c<0&&(C-=Math.PI*Math.sign(n)*Math.sign(b));const P=mt(this.center[0])*c;C=ke(C,-Math.PI-P,Math.PI-P);const M=we(gt(C/c)+this.center[0],-180,180),z=Math.asin(we((p-(n*n+b*b)*c*c)/(2*c),-1,1)),V=we(gt(z),-Qr,Qr);return new fn(M,V)}}const Gg=1.340264,Hg=-.081106,qg=893e-6,Wg=.003796,H_=Math.sqrt(3)/2;class b4 extends Hd{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const c=Math.asin(H_*Math.sin(o)),p=c*c,_=p*p*p;return{x:.5*(n*Math.cos(c)/(H_*(Gg+3*Hg*p+_*(7*qg+9*Wg*p)))/Math.PI+.5),y:1-.5*(c*(Gg+Hg*p+_*(qg+Wg*p))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=c*c,_=p*p*p;for(let z,V,$,K=0;K<12&&(V=c*(Gg+Hg*p+_*(qg+Wg*p))-o,$=Gg+3*Hg*p+_*(7*qg+9*Wg*p),z=V/$,c=we(c-z,-Math.PI/3,Math.PI/3),p=c*c,_=p*p*p,!(Math.abs(z)<1e-12));++K);const b=H_*n*(Gg+3*Hg*p+_*(7*qg+9*Wg*p))/Math.cos(c),C=Math.asin(Math.sin(c)/H_),P=we(180*b/Math.PI,-180,180),M=we(180*C/Math.PI,-Qr,Qr);return new fn(P,M)}}class T4 extends Hd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const c=360*(n-.5),p=we(360*(.5-o),-Qr,Qr);return new fn(c,p)}}const sm=Math.PI/2;function q_(i){return Math.tan((sm+i)/2)}class S4 extends Hd{constructor(n){super(n),this.center=n.center||[0,30];const[o,c]=this.parallels=n.parallels||[30,30];let p=mt(o),_=mt(c);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const b=Math.cos(p),C=q_(p);this.n=p===_?Math.sin(p):Math.log(b/Math.cos(_))/Math.log(q_(_)/C),this.f=b*Math.pow(q_(p),this.n)/this.n}project(n,o){o=mt(o),this.southernCenter&&(o=-o),n=mt(n-this.center[0]);const c=1e-6,{n:p,f:_}=this;_>0?o<-sm+c&&(o=-sm+c):o>sm-c&&(o=sm-c);const b=_/Math.pow(q_(o),p);let C=b*Math.sin(p*n),P=_-b*Math.cos(p*n);return C=.5*(C/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:C,y:this.southernCenter?P:1-P,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:p}=this,_=p-o,b=Math.sign(_),C=Math.sign(c)*Math.sqrt(n*n+_*_);let P=Math.atan2(n,Math.abs(_))*b;_*c<0&&(P-=Math.PI*Math.sign(n)*b);const M=we(gt(P/c)+this.center[0],-180,180),z=we(gt(2*Math.atan(Math.pow(p/C,1/c))-sm),-Qr,Qr);return new fn(M,this.southernCenter?-z:z)}}class US extends Hd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:Mr(n),y:$r(o),z:0}}unproject(n,o){const c=es(n),p=ur(o);return new fn(c,p)}}const $S=mt(Qr);class E4 extends Hd{project(n,o){const c=(o=mt(o))*o,p=c*c;return{x:.5*((n=mt(n))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,p=25,_=0,b=c*c;do{b=c*c;const M=b*b;_=(c*(1.007226+b*(.015085+M*(.028874*b-.044475-.005916*M)))-o)/(1.007226+b*(.045255+M*(.259866*b-.311325-.005916*11*M))),c=we(c-_,-$S,$S)}while(Math.abs(_)>1e-6&&--p>0);b=c*c;const C=we(gt(n/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),P=gt(c);return new fn(C,P)}}const GS=mt(Qr);class C4 extends Hd{project(n,o){o=mt(o),n=mt(n);const c=Math.cos(o),p=2/Math.PI,_=Math.acos(c*Math.cos(n/2)),b=Math.sin(_)/_,C=.5*(n*p+2*c*Math.sin(n/2)/b)||0,P=.5*(o+Math.sin(o)/b)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(n,o){let c=n=(2*n-.5)*Math.PI,p=o=(2*(1-o)-1)*Math.PI,_=25;const b=1e-6;let C=0,P=0;do{const M=Math.cos(p),z=Math.sin(p),V=2*z*M,$=z*z,K=M*M,X=Math.cos(c/2),ne=Math.sin(c/2),le=2*X*ne,me=ne*ne,Ce=1-K*X*X,ge=Ce?1/Ce:0,Ee=Ce?Math.acos(M*X)*Math.sqrt(1/Ce):0,Re=.5*(2*Ee*M*ne+2*c/Math.PI)-n,Pe=.5*(Ee*z+p)-o,et=.5*ge*(K*me+Ee*M*X*$)+1/Math.PI,Ke=ge*(le*V/4-Ee*z*ne),pt=.125*ge*(V*ne-Ee*z*K*le),Pt=.5*ge*($*X+Ee*me*M)+.5,nt=Ke*pt-Pt*et;C=(Pe*Ke-Re*Pt)/nt,P=(Re*pt-Pe*et)/nt,c=we(c-C,-Math.PI,Math.PI),p=we(p-P,-GS,GS)}while((Math.abs(C)>b||Math.abs(P)>b)&&--_>0);return new fn(gt(c),gt(p))}}class HS extends Hd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:c,cosPhi:p}=this;return{x:mt(n)*p*c+.5,y:-Math.sin(mt(o))/p*c+.5,z:0}}unproject(n,o){const{scale:c,cosPhi:p}=this,_=-(o-.5)/c,b=we(gt((n-.5)/c)/p,-180,180),C=Math.asin(we(_*p,-1,1)),P=we(gt(C),-Qr,Qr);return new fn(b,P)}}class k4 extends US{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,c){const p=sa(n,o,c);return Zr(p,p,Xs(Fo(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(n,o){const c=Ds(o.lat,o.lng),p=ms([],c),_=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude;Rd(c,c,p,ci(1,0)*ln*_);const b=Ea(new Float64Array(16));return Fl(b,n.pixelMatrix,n.globeMatrix),Zr(c,c,b),new Me(c[0],c[1])}pixelsPerMeter(n,o){return ci(1,0)*o}pixelSpaceConversion(n,o,c){const p=ci(1,n)*o,_=Qn(ci(1,45)*o,p,c);return this.pixelsPerMeter(n,o)/_}createTileMatrix(n,o,c){const p=Op(Fo(c.canonical));return Fl(new Float64Array(16),n.globeMatrix,p)}createInversionMatrix(n,o){const{center:c}=n,p=Xs(Fo(o));return rf(p,p,mt(c.lng)),kp(p,p,mt(c.lat)),Oc(p,p,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(n,o,c,p){return yg(n,o,c,!0)||new Fc(0,0)}pointCoordinate3D(n,o,c){const p=this.pointCoordinate(n,o,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(n,o){return!yg(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=(function(p,_){const b=p.cameraToCenterDistance,C=p._centerAltitude*_,P=p._camera,M=p._camera.forward(),z=nl([],Vr([],M,-b),[0,0,C]),V=p.worldSize/(2*Math.PI),$=[0,0,-V],K=p.width/p.height,X=Math.tan(p.fovAboveCenter),ne=Vr([],P.up(),X),le=Vr([],P.right(),X*K),me=ms([],nl([],nl([],M,ne),le)),Ce=[];let ge;if(new Dp(z,me).closestPointOnSphere($,V,Ce)){const Ee=nl([],Ce,$),Re=Bo([],Ee,z);ge=Math.cos(p.fovAboveCenter)*Id(Re)}else{const Ee=Bo([],z,$),Re=Bo([],$,z);ms(Re,Re);const Pe=Id(Ee)-V;ge=Math.sqrt(Pe*(Pe+2*V));const et=Math.acos(ge/(V+Pe))-Math.acos(zo(M,Re));ge*=Math.cos(et)}return 1.01*ge})(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),c=Od(n.zoom);if(c>0){const p=VS(n,ci(1,n.center.lat)*n.worldSize),_=n.worldSize/(2*Math.PI),b=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Qn(o,p+_*(1-Math.cos(b)),Math.pow(c,10))}return o}upVector(n,o,c){return sa(o,c,n,1)}upVectorScale(n){return{metersToTile:Dd(hf(Fo(n)))}}}function qS(i){const n=i.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new US(i);case"equirectangular":return new T4(i);case"naturalEarth":return new E4(i);case"equalEarth":return new b4(i);case"winkelTripel":return new C4(i);case"albers":return o?new HS(i):new w4(i);case"lambertConformalConic":return o?new HS(i):new S4(i);case"globe":return new k4(i)}throw new Error(`Invalid projection name: ${i.name}`)}const A4=Cn.types,P4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function W_(i,n,o,c,p,_,b,C,P,M,z,V,$){const K=C?Math.min(Gd,Math.round(C[0])):0,X=C?Math.min(Gd,Math.round(C[1])):0;i.emplaceBack(n,o,Math.round(32*c),Math.round(32*p),_,b,(K<<1)+(P?1:0),X,16*M,16*z,256*V,256*$)}function Z_(i,n,o,c,p,_,b){i.emplaceBack(n,o,c,p,_,b)}function K_(i,n,o,c,p){i.emplaceBack(n,o,c,p),i.emplaceBack(n,o,c,p),i.emplaceBack(n,o,c,p),i.emplaceBack(n,o,c,p)}function M4(i){for(const n of i.sections)if(ba(n.text))return!0;return!1}class Ex{constructor(n){this.layoutVertexArray=new vt,this.indexArray=new nn,this.programConfigurations=n,this.segments=new li,this.dynamicLayoutVertexArray=new Et,this.opacityVertexArray=new tn,this.placedSymbolArray=new Wr,this.globeExtVertexArray=new At}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,o,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,z3.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,F3.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,P4,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,B3.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ut(Ex,"SymbolBuffers");class Cx{constructor(n,o,c){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new c,this.segments=new li,this.collisionVertexArray=new zn,this.collisionVertexArrayExt=new Gn}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,V3.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,U3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ut(Cx,"CollisionBuffers");class qd{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ea([]),this.placementViewportMatrix=Ea([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=px(this.zoom,o["text-size"]),this.iconSizeData=px(this.zoom,o["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map((b=>Ma[b])),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Ex(new Dc(this.layers,this.zoom,(n=>/^text/.test(n)))),this.icon=new Ex(new Dc(this.layers,this.zoom,(n=>/^icon/.test(n)))),this.glyphOffsetArray=new pi,this.lineVertexArray=new Or,this.symbolInstances=new wr}calculateGlyphDependencies(n,o,c,p,_){for(let b=0;b<n.length;b++)if(o[n.charCodeAt(b)]=!0,p&&_){const C=Fg[n.charAt(b)];C&&(o[C.charCodeAt(0)]=!0)}}populate(n,o,c,p){const _=this.layers[0],b=_.layout,C=this.projection.name==="globe",P=b.get("text-font"),M=b.get("text-field"),z=b.get("icon-image"),V=(M.value.kind!=="constant"||M.value.value instanceof ji&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,K=b.get("symbol-sort-key");if(this.features=[],!V&&!$)return;const X=o.iconDependencies,ne=o.glyphDependencies,le=o.availableImages,me=new B(this.zoom);for(const{feature:Ce,id:ge,index:Ee,sourceLayerIndex:Re}of n){const Pe=_._featureFilter.needGeometry,et=ol(Ce,Pe);if(!_._featureFilter.filter(me,et,c))continue;if(Pe||(et.geometry=Ls(Ce,c,p)),C&&Ce.type!==1&&c.z<=5){const nt=et.geometry,yt=.98078528056,_t=(Ct,Rt)=>zo(sa(Ct.x,Ct.y,c,1),sa(Rt.x,Rt.y,c,1))<yt;for(let Ct=0;Ct<nt.length;Ct++)nt[Ct]=Bd(nt[Ct],_t)}let Ke,pt;if(V){const nt=_.getValueAndResolveTokens("text-field",et,c,le),yt=ji.factory(nt);M4(yt)&&(this.hasRTLText=!0),(!this.hasRTLText||k()==="unavailable"||this.hasRTLText&&D.isParsed())&&(Ke=H3(yt,_,et))}if($){const nt=_.getValueAndResolveTokens("icon-image",et,c,le);pt=nt instanceof ho?nt:ho.fromString(nt)}if(!Ke&&!pt)continue;const Pt=this.sortFeaturesByKey?K.evaluate(et,{},c):void 0;if(this.features.push({id:ge,text:Ke,icon:pt,index:Ee,sourceLayerIndex:Re,geometry:et.geometry,properties:Ce.properties,type:A4[Ce.type],sortKey:Pt}),pt&&(X[pt.name]=!0),Ke){const nt=P.evaluate(et,{},c).join(","),yt=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ma.vertical)>=0;for(const _t of Ke.sections)if(_t.image)X[_t.image.name]=!0;else{const Ct=Ya(Ke.toString()),Rt=_t.fontStack||nt,dt=ne[Rt]=ne[Rt]||{};this.calculateGlyphDependencies(_t.text,dt,yt,this.allowVerticalPlacement,Ct)}}}b.get("symbol-placement")==="line"&&(this.features=(function(Ce){const ge={},Ee={},Re=[];let Pe=0;function et(nt){Re.push(Ce[nt]),Pe++}function Ke(nt,yt,_t){const Ct=Ee[nt];return delete Ee[nt],Ee[yt]=Ct,Re[Ct].geometry[0].pop(),Re[Ct].geometry[0]=Re[Ct].geometry[0].concat(_t[0]),Ct}function pt(nt,yt,_t){const Ct=ge[yt];return delete ge[yt],ge[nt]=Ct,Re[Ct].geometry[0].shift(),Re[Ct].geometry[0]=_t[0].concat(Re[Ct].geometry[0]),Ct}function Pt(nt,yt,_t){const Ct=_t?yt[0][yt[0].length-1]:yt[0][0];return`${nt}:${Ct.x}:${Ct.y}`}for(let nt=0;nt<Ce.length;nt++){const yt=Ce[nt],_t=yt.geometry,Ct=yt.text?yt.text.toString():null;if(!Ct){et(nt);continue}const Rt=Pt(Ct,_t),dt=Pt(Ct,_t,!0);if(Rt in Ee&&dt in ge&&Ee[Rt]!==ge[dt]){const Vt=pt(Rt,dt,_t),en=Ke(Rt,dt,Re[Vt].geometry);delete ge[Rt],delete Ee[dt],Ee[Pt(Ct,Re[en].geometry,!0)]=en,Re[Vt].geometry=null}else Rt in Ee?Ke(Rt,dt,_t):dt in ge?pt(Rt,dt,_t):(et(nt),ge[Rt]=Pe-1,Ee[dt]=Pe-1)}return Re.filter((nt=>nt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Ce,ge)=>Ce.sortKey-ge.sortKey))}update(n,o,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,c,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=qS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const c=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:p,y:_}of o)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,o,c,p,_,b,C,P,M,z,V,$,K,X){const ne=n.indexArray,le=n.layoutVertexArray,me=n.globeExtVertexArray,Ce=n.segments.prepareSegment(4*o.length,le,ne,this.canOverlap?b.sortKey:void 0),ge=this.glyphOffsetArray.length,Ee=Ce.vertexLength,Re=this.allowVerticalPlacement&&C===Ma.vertical?Math.PI/2:0,Pe=b.text&&b.text.sections;for(let Ke=0;Ke<o.length;Ke++){const{tl:pt,tr:Pt,bl:nt,br:yt,tex:_t,pixelOffsetTL:Ct,pixelOffsetBR:Rt,minFontScaleX:dt,minFontScaleY:Vt,glyphOffset:en,isSDF:Ht,sectionIndex:Dn}=o[Ke],Dt=Ce.vertexLength,dn=en[1];if(W_(le,M.x,M.y,pt.x,dn+pt.y,_t.x,_t.y,c,Ht,Ct.x,Ct.y,dt,Vt),W_(le,M.x,M.y,Pt.x,dn+Pt.y,_t.x+_t.w,_t.y,c,Ht,Rt.x,Ct.y,dt,Vt),W_(le,M.x,M.y,nt.x,dn+nt.y,_t.x,_t.y+_t.h,c,Ht,Ct.x,Rt.y,dt,Vt),W_(le,M.x,M.y,yt.x,dn+yt.y,_t.x+_t.w,_t.y+_t.h,c,Ht,Rt.x,Rt.y,dt,Vt),P){const{x:Ln,y:hr,z:On}=P.anchor,[Tn,zr,Bn]=P.up;Z_(me,Ln,hr,On,Tn,zr,Bn),Z_(me,Ln,hr,On,Tn,zr,Bn),Z_(me,Ln,hr,On,Tn,zr,Bn),Z_(me,Ln,hr,On,Tn,zr,Bn),K_(n.dynamicLayoutVertexArray,Ln,hr,On,Re)}else K_(n.dynamicLayoutVertexArray,M.x,M.y,M.z,Re);ne.emplaceBack(Dt,Dt+1,Dt+2),ne.emplaceBack(Dt+1,Dt+2,Dt+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(en[0]),Ke!==o.length-1&&Dn===o[Ke+1].sectionIndex||n.programConfigurations.populatePaintArrays(le.length,b,b.index,{},K,X,Pe&&Pe[Dn])}const et=P?P.anchor:M;n.placedSymbolArray.emplaceBack(et.x,et.y,et.z,M.x,M.y,ge,this.glyphOffsetArray.length-ge,Ee,z,V,M.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],C,0,!1,0,$,0)}_commitLayoutVertex(n,o,c,p,_,b,C){n.emplaceBack(o,c,p,_,b,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(n,o,c,p,_,b,C){const P=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),M=P.vertexLength,z=C.tileAnchorX,V=C.tileAnchorY;for(let K=0;K<4;K++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(o,-n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,n.padding),c.collisionVertexArrayExt.emplaceBack(o,-n.padding,n.padding),this._commitLayoutVertex(c.layoutVertexArray,p,_,b,z,V,new Me(n.x1,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,_,b,z,V,new Me(n.x2,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,_,b,z,V,new Me(n.x2,n.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,_,b,z,V,new Me(n.x1,n.y2)),P.vertexLength+=4;const $=c.indexArray;$.emplaceBack(M,M+1),$.emplaceBack(M+1,M+2),$.emplaceBack(M+2,M+3),$.emplaceBack(M+3,M),P.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,c,p,_,b){for(let C=p;C<_;C++){const P=c.get(C),M=this.getSymbolInstanceTextSize(n,b,o,C);this._addCollisionDebugVertices(P,M,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(n,o,c,p,_,b){for(let C=p;C<_;C++){const P=c.get(C),M=this.getSymbolInstanceIconSize(n,o,b.placedIconSymbolIndex);this._addCollisionDebugVertices(P,M,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,b)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cx(Zt,dS.members,qr),this.iconCollisionBox=new Cx(Zt,dS.members,qr);const c=Yp(this.iconSizeData,n),p=Yp(this.textSizeData,n);for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,n,o,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,n,o,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(c,n,o,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(c,n,o,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(n,o,c,p){const _=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:p),b=O_(this.textSizeData,n,_)/_s;return this.tilePixelRatio*b}getSymbolInstanceIconSize(n,o,c){const p=this.icon.placedSymbolArray.get(c),_=O_(this.iconSizeData,n,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(n,o,c){n.emplaceBack(o,-c,-c),n.emplaceBack(o,c,-c),n.emplaceBack(o,c,c),n.emplaceBack(o,-c,c)}_updateTextDebugCollisionBoxes(n,o,c,p,_,b){for(let C=p;C<_;C++){const P=c.get(C),M=this.getSymbolInstanceTextSize(n,b,o,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,P.padding)}}_updateIconDebugCollisionBoxes(n,o,c,p,_,b){for(let C=p;C<_;C++){const P=c.get(C),M=this.getSymbolInstanceIconSize(n,o,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,P.padding)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Yp(this.iconSizeData,n),p=Yp(this.textSizeData,n);for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(p,n,o,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(p,n,o,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(c,n,o,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,n,o,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,c,p,_,b,C,P,M){const z={};if(o<c){const{x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee,featureIndex:Re}=n.get(o);z.textBox={x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee},z.textFeatureIndex=Re}if(p<_){const{x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee,featureIndex:Re}=n.get(p);z.verticalTextBox={x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee},z.verticalTextFeatureIndex=Re}if(b<C){const{x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee,featureIndex:Re}=n.get(b);z.iconBox={x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee},z.iconFeatureIndex=Re}if(P<M){const{x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee,featureIndex:Re}=n.get(P);z.verticalIconBox={x1:V,y1:$,x2:K,y2:X,padding:ne,projectedAnchorX:le,projectedAnchorY:me,projectedAnchorZ:Ce,tileAnchorX:ge,tileAnchorY:Ee},z.verticalIconFeatureIndex=Re}return z}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,o){const c=n.placedSymbolArray.get(o),p=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<p;_+=4)n.indexArray.emplaceBack(_,_+1,_+2),n.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),c=Math.cos(n),p=[],_=[],b=[];for(let C=0;C<this.symbolInstances.length;++C){b.push(C);const P=this.symbolInstances.get(C);p.push(0|Math.round(o*P.tileAnchorX+c*P.tileAnchorY)),_.push(P.featureIndex)}return b.sort(((C,P)=>p[C]-p[P]||_[P]-_[C])),b}addToSortKeyRanges(n,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:C,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:M}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&b!==_&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),C>=0&&this.addIndicesForPlacedSymbol(this.text,C),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ut(qd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qd.MAX_GLYPHS=65535,qd.addDynamicAttributes=K_;const I4=new ve({"symbol-placement":new te(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new te(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new te(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ce(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new te(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new te(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new te(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new te(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new te(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new ce(ht.layout_symbol["icon-size"]),"icon-text-fit":new te(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new te(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new ce(ht.layout_symbol["icon-image"]),"icon-rotate":new ce(ht.layout_symbol["icon-rotate"]),"icon-padding":new te(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new te(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new ce(ht.layout_symbol["icon-offset"]),"icon-anchor":new ce(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new te(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new te(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new te(ht.layout_symbol["text-rotation-alignment"]),"text-field":new ce(ht.layout_symbol["text-field"]),"text-font":new ce(ht.layout_symbol["text-font"]),"text-size":new ce(ht.layout_symbol["text-size"]),"text-max-width":new ce(ht.layout_symbol["text-max-width"]),"text-line-height":new ce(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new ce(ht.layout_symbol["text-letter-spacing"]),"text-justify":new ce(ht.layout_symbol["text-justify"]),"text-radial-offset":new ce(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new te(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new ce(ht.layout_symbol["text-anchor"]),"text-max-angle":new te(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new te(ht.layout_symbol["text-writing-mode"]),"text-rotate":new ce(ht.layout_symbol["text-rotate"]),"text-padding":new te(ht.layout_symbol["text-padding"]),"text-keep-upright":new te(ht.layout_symbol["text-keep-upright"]),"text-transform":new ce(ht.layout_symbol["text-transform"]),"text-offset":new ce(ht.layout_symbol["text-offset"]),"text-allow-overlap":new te(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new te(ht.layout_symbol["text-ignore-placement"]),"text-optional":new te(ht.layout_symbol["text-optional"])});var kx={paint:new ve({"icon-opacity":new ce(ht.paint_symbol["icon-opacity"]),"icon-color":new ce(ht.paint_symbol["icon-color"]),"icon-halo-color":new ce(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new ce(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ce(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new te(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new te(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new ce(ht.paint_symbol["text-opacity"]),"text-color":new ce(ht.paint_symbol["text-color"],{runtimeType:As,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ce(ht.paint_symbol["text-halo-color"]),"text-halo-width":new ce(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new ce(ht.paint_symbol["text-halo-blur"]),"text-translate":new te(ht.paint_symbol["text-translate"]),"text-translate-anchor":new te(ht.paint_symbol["text-translate-anchor"])}),layout:I4};class WS{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:fa,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut(WS,"FormatSectionOverride",{omit:["defaultValue"]});class X_ extends Sa{constructor(n){super(n,kx)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const _ of c)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,o,c,p){const _=this.layout.get(n).evaluate(o,{},c,p),b=this._unevaluatedLayout._values[n];return b.isDataDriven()||Pl(b.value)||!_?_:(function(C,P){return P.replace(/{([^{}]+)}/g,((M,z)=>z in C?String(C[z]):""))})(o.properties,_)}createBucket(n){return new qd(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of kx.paint.overridableProperties){if(!X_.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),c=new WS(o),p=new Cu(c,o.property.specification);let _=null;_=o.value.kind==="constant"||o.value.kind==="source"?new ku("source",p):new Wa("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new he(o.property,_,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&X_.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const c=n.get("text-field"),p=kx.paint.properties[o];let _=!1;const b=C=>{for(const P of C)if(p.overrides&&p.overrides.hasOverride(P))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ji)b(c.value.value.sections);else if(c.value.kind==="source"){const C=M=>{_||(M instanceof Io&&Ur(M.value)===xl?b(M.value.sections):M instanceof Xo?b(M.sections):M.eachChild(C))},P=c.value;P._styleExpression&&C(P._styleExpression.expression)}return _}getProgramConfiguration(n){return new zl(this,n)}}var R4={paint:new ve({"background-color":new te(ht.paint_background["background-color"]),"background-pattern":new te(ht.paint_background["background-pattern"]),"background-opacity":new te(ht.paint_background["background-opacity"])})},N4={paint:new ve({"raster-opacity":new te(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new te(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new te(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new te(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new te(ht.paint_raster["raster-saturation"]),"raster-contrast":new te(ht.paint_raster["raster-contrast"]),"raster-resampling":new te(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new te(ht.paint_raster["raster-fade-duration"])})};class j4 extends Sa{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var D4={paint:new ve({"sky-type":new te(ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new te(ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new te(ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new te(ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new te(ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new ye(ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new te(ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new te(ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new te(ht.paint_sky["sky-opacity"])})};function Ax(i,n,o){const c=[0,0,1],p=af([]);return mg(p,p,o?-mt(i)+Math.PI:mt(i)),E_(p,p,-mt(n)),Ip(c,c,p),ms(c,c)}const L4={circle:class extends Sa{constructor(i){super(i,M_)}createBucket(i){return new Uu(i)}queryRadius(i){const n=i;return $u("circle-radius",this,n)+$u("circle-stroke-width",this,n)+Fd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,o,c,p,_,b,C){const P=$p(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return Eg(i,c,_,b,C,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",P,M)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new zl(this,i)}},heatmap:class extends Sa{createBucket(i){return new kg(i)}constructor(i){super(i,yi),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return $u("heatmap-radius",this,i)}queryIntersectsFeature(i,n,o,c,p,_,b,C){const P=this.paint.get("heatmap-radius").evaluate(n,o);return Eg(i,c,_,b,C,!0,!0,new Me(0,0),P)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new zl(this,i)}},hillshade:class extends Sa{constructor(i){super(i,I_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Sa{constructor(i){super(i,F)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(i){return new zl(this,i)}recalculate(i,n){super.recalculate(i,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new E(i)}queryRadius(){return Fd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,o,c,p,_){return!i.queryGeometry.isAboveHorizon&&gf(Uc(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Sa{constructor(i){super(i,M3)}createBucket(i){return new Og(i)}queryRadius(){return Fd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new zl(this,i)}queryIntersectsFeature(i,n,o,c,p,_,b,C,P){const M=$p(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),z=this.paint.get("fill-extrusion-height").evaluate(n,o),V=this.paint.get("fill-extrusion-base").evaluate(n,o),$=[0,0],K=C&&_.elevation,X=_.elevation?_.elevation.exaggeration():1,ne=i.tile.getBucket(this);if(K&&ne instanceof Og){const Ee=ne.centroidVertexArray,Re=P+1;Re<Ee.length&&($[0]=Ee.geta_centroid_pos0(Re),$[1]=Ee.geta_centroid_pos1(Re))}if($[0]===0&&$[1]===1)return!1;_.projection.name==="globe"&&(c=rS([c],[new Me(0,0),new Me(ln,ln)],i.tileID.canonical).map((Ee=>Ee.polygon)).flat());const le=K?C:null,[me,Ce]=(function(Ee,Re,Pe,et,Ke,pt,Pt,nt,yt,_t,Ct){return Ee.projection.name==="globe"?(function(Rt,dt,Vt,en,Ht,Dn,Dt,dn,Ln,hr,On){const Tn=[],zr=[],Bn=Rt.projection.upVectorScale(On,Rt.center.lat,Rt.worldSize).metersToTile,Fn=[0,0,0,1],Tr=[0,0,0,1],Rr=(Sr,Kr,ui,Ei)=>{Sr[0]=Kr,Sr[1]=ui,Sr[2]=Ei,Sr[3]=1},Nr=nS();Vt>0&&(Vt+=Nr),en+=Nr;for(const Sr of dt){const Kr=[],ui=[];for(const Ei of Sr){const Er=Ei.x+Ht.x,Fi=Ei.y+Ht.y,Ci=Rt.projection.projectTilePoint(Er,Fi,On),ti=Rt.projection.upVector(On,Ei.x,Ei.y);let gr=Vt,ki=en;if(Dt){const jr=aS(Er,Fi,Vt,en,Dt,dn,Ln,hr);gr+=jr.base,ki+=jr.top}Vt!==0?Rr(Fn,Ci.x+ti[0]*Bn*gr,Ci.y+ti[1]*Bn*gr,Ci.z+ti[2]*Bn*gr):Rr(Fn,Ci.x,Ci.y,Ci.z),Rr(Tr,Ci.x+ti[0]*Bn*ki,Ci.y+ti[1]*Bn*ki,Ci.z+ti[2]*Bn*ki),Zr(Fn,Fn,Dn),Zr(Tr,Tr,Dn),Kr.push(new Xp(Fn[0],Fn[1],Fn[2])),ui.push(new Xp(Tr[0],Tr[1],Tr[2]))}Tn.push(Kr),zr.push(ui)}return[Tn,zr]})(Ee,Re,Pe,et,Ke,pt,Pt,nt,yt,_t,Ct):Pt?(function(Rt,dt,Vt,en,Ht,Dn,Dt,dn,Ln){const hr=[],On=[],Tn=[0,0,0,1];for(const zr of Rt){const Bn=[],Fn=[];for(const Tr of zr){const Rr=Tr.x+en.x,Nr=Tr.y+en.y,Sr=aS(Rr,Nr,dt,Vt,Dn,Dt,dn,Ln);Tn[0]=Rr,Tn[1]=Nr,Tn[2]=Sr.base,Tn[3]=1,zc(Tn,Tn,Ht),Tn[3]=Math.max(Tn[3],1e-5);const Kr=new Xp(Tn[0]/Tn[3],Tn[1]/Tn[3],Tn[2]/Tn[3]);Tn[0]=Rr,Tn[1]=Nr,Tn[2]=Sr.top,Tn[3]=1,zc(Tn,Tn,Ht),Tn[3]=Math.max(Tn[3],1e-5);const ui=new Xp(Tn[0]/Tn[3],Tn[1]/Tn[3],Tn[2]/Tn[3]);Bn.push(Kr),Fn.push(ui)}hr.push(Bn),On.push(Fn)}return[hr,On]})(Re,Pe,et,Ke,pt,Pt,nt,yt,_t):(function(Rt,dt,Vt,en,Ht){const Dn=[],Dt=[],dn=Ht[8]*dt,Ln=Ht[9]*dt,hr=Ht[10]*dt,On=Ht[11]*dt,Tn=Ht[8]*Vt,zr=Ht[9]*Vt,Bn=Ht[10]*Vt,Fn=Ht[11]*Vt;for(const Tr of Rt){const Rr=[],Nr=[];for(const Sr of Tr){const Kr=Sr.x+en.x,ui=Sr.y+en.y,Ei=Ht[0]*Kr+Ht[4]*ui+Ht[12],Er=Ht[1]*Kr+Ht[5]*ui+Ht[13],Fi=Ht[2]*Kr+Ht[6]*ui+Ht[14],Ci=Ht[3]*Kr+Ht[7]*ui+Ht[15],ti=Ei+dn,gr=Er+Ln,ki=Fi+hr,jr=Math.max(Ci+On,1e-5),So=Ei+Tn,Ai=Er+zr,vs=Fi+Bn,rs=Math.max(Ci+Fn,1e-5);Rr.push(new Xp(ti/jr,gr/jr,ki/jr)),Nr.push(new Xp(So/rs,Ai/rs,vs/rs))}Dn.push(Rr),Dt.push(Nr)}return[Dn,Dt]})(Re,Pe,et,Ke,pt)})(_,c,V,z,M,b,le,$,X,_.center.lat,i.tileID.canonical),ge=i.queryGeometry;return(function(Ee,Re,Pe){let et=1/0;gf(Pe,Re)&&(et=oS(Pe,Re[0]));for(let Ke=0;Ke<Re.length;Ke++){const pt=Re[Ke],Pt=Ee[Ke];for(let nt=0;nt<pt.length-1;nt++){const yt=pt[nt],_t=[yt,pt[nt+1],Pt[nt+1],Pt[nt],yt];Fp(Pe,_t)&&(et=Math.min(et,oS(Pe,_t)))}}return et!==1/0&&et})(me,Ce,ge.isPointQuery()?ge.screenBounds:ge.screenGeometry)}},line:class extends Sa{constructor(i){super(i,lS),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Dh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=cS.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new L_(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new zl(this,i)}queryRadius(i){const n=i,o=uS($u("line-width",this,n),$u("line-gap-width",this,n)),c=$u("line-offset",this,n);return o/2+Math.abs(c)+Fd(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,o,c,p,_){if(i.queryGeometry.isAboveHorizon)return!1;const b=Uc(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,i.pixelToTileUnitsFactor),C=i.pixelToTileUnitsFactor/2*uS(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),P=this.paint.get("line-offset").evaluate(n,o);return P&&(c=(function(M,z){const V=[],$=new Me(0,0);for(let K=0;K<M.length;K++){const X=M[K],ne=[];for(let le=0;le<X.length;le++){const me=X[le],Ce=X[le+1],ge=le===0?$:me.sub(X[le-1])._unit()._perp(),Ee=le===X.length-1?$:Ce.sub(me)._unit()._perp(),Re=ge._add(Ee)._unit();Re._mult(1/(Re.x*Ee.x+Re.y*Ee.y)),ne.push(Re._mult(z)._add(me))}V.push(ne)}return V})(c,P*i.pixelToTileUnitsFactor)),(function(M,z,V){for(let $=0;$<z.length;$++){const K=z[$];if(M.length>=3){for(let X=0;X<K.length;X++)if(Ul(M,K[X]))return!0}if(Js(M,K,V))return!0}return!1})(b,c,C)}isTileClipped(){return!0}},symbol:X_,background:class extends Sa{constructor(i){super(i,R4)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Sa{constructor(i){super(i,N4)}getProgramIds(){return["raster"]}},sky:class extends Sa{constructor(i){super(i,D4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,_=i.style.light,b=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&Jn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Ax(b.azimuthal,90-b.polar,n):Ax(c[0],90-c[1],n)}const o=this.paint.get("sky-gradient-center");return Ax(o[0],90-o[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class Zg{constructor(n,o,c,p){this.context=n,this.format=c,this.texture=n.gl.createTexture(),this.update(o,p)}update(n,o,c){const{width:p,height:_}=n,{context:b}=this,{gl:C}=b,{HTMLImageElement:P,HTMLCanvasElement:M,HTMLVideoElement:z,ImageData:V,ImageBitmap:$}=S;if(C.bindTexture(C.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!o||o.premultiply!==!1)),c||this.size&&this.size[0]===p&&this.size[1]===_){const{x:K,y:X}=c||{x:0,y:0};n instanceof P||n instanceof M||n instanceof z||n instanceof V||$&&n instanceof $?C.texSubImage2D(C.TEXTURE_2D,0,K,X,C.RGBA,C.UNSIGNED_BYTE,n):C.texSubImage2D(C.TEXTURE_2D,0,K,X,p,_,C.RGBA,C.UNSIGNED_BYTE,n.data)}else this.size=[p,_],n instanceof P||n instanceof M||n instanceof z||n instanceof V||$&&n instanceof $?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,n):C.texImage2D(C.TEXTURE_2D,0,this.format,p,_,0,this.format,C.UNSIGNED_BYTE,n.data);this.useMipmap=!!(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&C.generateMipmap(C.TEXTURE_2D)}bind(n,o){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:n),this.filter=n),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class O4{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class z4{constructor(){this.tasks={},this.taskQueue=[],un(["process"],this),this.invoker=new O4(this.process),this.nextId=0}add(n,o){const c=this.nextId++,p=(function({type:_,isSymbolTile:b,zoom:C}){return C=C||0,_==="message"?0:_!=="maybePrepare"||b?_!=="parseTile"||b?_==="parseTile"&&b?300-C:_==="maybePrepare"&&b?400-C:500:200-C:100-C})(o);return p===0?(wi(),n(),{cancel:()=>{}}):(this.tasks[c]={fn:n,metadata:o,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}})}process(){wi();{if(this.taskQueue=this.taskQueue.filter((c=>!!this.tasks[c])),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}}pick(){let n=null,o=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<o&&(o=_.priority,n=p)}if(n===null)return null;const c=this.taskQueue[n];return this.taskQueue.splice(n,1),c}remove(){this.invoker.remove()}}class ZS{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const c=n[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const B4=["tile","layer","source","sourceLayer","state"];class KS{constructor(n,o,c,p,_){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=c,this._y=p,this.properties=n.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const o of B4)this[o]!==void 0&&(n[o]=this[o]);return n}}const ll=32,qc=33,Wd=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,o=0,c=0,p=0,_=0,b=0,C=0;for(1&n?p=_=b=ll:o=c=C=ll;(n>>=1)>1;){const M=o+p>>1,z=c+_>>1;1&n?(p=o,_=c,o=b,c=C):(o=p,c=_,p=b,_=C),b=M,C=z}const P=4*i;Wd[P+0]=o,Wd[P+1]=c,Wd[P+2]=p,Wd[P+3]=_}const Wc=new Uint16Array(2178),Zd=new Uint8Array(1089),Y_=new Uint16Array(1089);function XS(i){return i===0?-.03125:i===32?.03125:0}var YS=$e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const JS={type:2,extent:ln,loadGeometry:()=>[[new Me(0,0),new Me(ln+1,0),new Me(ln+1,ln+1),new Me(0,ln+1),new Me(0,0)]]};class Px{constructor(n,o,c,p,_){this.tileID=n,this.uid=Mt(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<Wo.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Cf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,c){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=(function(p,_){const b={};if(!_)return b;for(const C of p){const P=C.layerIds.map((M=>_.getLayer(M))).filter(Boolean);if(P.length!==0){C.layers=P,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map((M=>P.filter((z=>z.id===M))[0])));for(const M of P)b[M.id]=C}}return b})(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof qd){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof qd&&_.hasRTLText){this.hasRTLText=!0,D.isLoading()||D.isLoaded()||k()!=="deferred"||N();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(_))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new mr}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(n)}const o=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Zg(n,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zg(n,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Zg(n,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,o,c,p,_,b,C,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:C,transform:b,params:_,tileTransform:this.tileTransform},n,o,c):{}}querySourceFeatures(n,o){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),_=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[_];if(!b)return;const C=kc(o&&o.filter),{z:P,x:M,y:z}=this.tileID.canonical,V={z:P,x:M,y:z};for(let $=0;$<b.length;$++){const K=b.feature($);if(C.needGeometry){const le=ol(K,!0);if(!C.filter(new B(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!C.filter(new B(this.tileID.overscaledZ),K))continue;const X=c.getId(K,_),ne=new KS(K,P,M,z,X);ne.tile=V,n.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const c=Xr(n.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const _=this.expirationTime-o;_?this.expirationTime=c+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!o)return;const c=this.latestFeatureIndex.loadVTLayers(),p=o.style.listImages();for(const _ in this.buckets){if(!o.style.hasLayer(_))continue;const b=this.buckets[_],C=b.layers[0].sourceLayer||"_geojsonTileLayer",P=c[C],M=n[C];if(!P||!M||Object.keys(M).length===0)continue;if(b.update(M,P,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof L_||b instanceof E){const V=o.style._getSourceCache(b.layers[0].source);o._terrain&&o._terrain.enabled&&V&&b.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(V.id,this.tileID)}const z=o&&o.style&&o.style.getLayer(_);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Wo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Wo.now()+n}setTexture(n,o){const c=o.context,p=c.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new Zg(c,n,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(n,o){const c={};for(const p of o)c[p]=!0;this.dependencies[n]=c}hasDependency(n,o){for(const c of n){const p=this.dependencies[c];if(p){for(const _ of o)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const c=Ls(JS,this.tileID.canonical,this.tileTransform)[0],p=new kt,_=new Ks;for(let b=0;b<c.length;b++){const{x:C,y:P}=c[b];p.emplaceBack(C,P),_.emplaceBack(b)}_.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(_),this._tileDebugBuffer=n.createVertexBuffer(p,cf.members),this._tileDebugSegments=li.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const c=Ls(JS,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const b=(function(C,P){const M=Cf(C,P),z=Math.pow(2,C.z);for(let le=0;le<qc;le++)for(let me=0;me<qc;me++){const Ce=es((C.x+(me+XS(me))/ll)/z),ge=ur((C.y+(le+XS(le))/ll)/z),Ee=P.project(Ce,ge),Re=le*qc+me;Wc[2*Re+0]=Math.round((Ee.x*M.scale-M.x)*ln),Wc[2*Re+1]=Math.round((Ee.y*M.scale-M.y)*ln)}Zd.fill(0),Y_.fill(0);for(let le=2045;le>=0;le--){const me=4*le,Ce=Wd[me+0],ge=Wd[me+1],Ee=Wd[me+2],Re=Wd[me+3],Pe=Ce+Ee>>1,et=ge+Re>>1,Ke=Pe+et-ge,pt=et+Ce-Pe,Pt=ge*qc+Ce,nt=Re*qc+Ee,yt=et*qc+Pe,_t=Math.hypot((Wc[2*Pt+0]+Wc[2*nt+0])/2-Wc[2*yt+0],(Wc[2*Pt+1]+Wc[2*nt+1])/2-Wc[2*yt+1])>=16;Zd[yt]=Zd[yt]||(_t?1:0),le<1022&&(Zd[yt]=Zd[yt]||Zd[(ge+pt>>1)*qc+(Ce+Ke>>1)]||Zd[(Re+pt>>1)*qc+(Ee+Ke>>1)])}const V=new at,$=new nn;let K=0;function X(le,me){const Ce=me*qc+le;return Y_[Ce]===0&&(V.emplaceBack(Wc[2*Ce+0],Wc[2*Ce+1],le*ln/ll,me*ln/ll),Y_[Ce]=++K),Y_[Ce]-1}function ne(le,me,Ce,ge,Ee,Re){const Pe=le+Ce>>1,et=me+ge>>1;if(Math.abs(le-Ee)+Math.abs(me-Re)>1&&Zd[et*qc+Pe])ne(Ee,Re,le,me,Pe,et),ne(Ce,ge,Ee,Re,Pe,et);else{const Ke=X(le,me),pt=X(Ce,ge),Pt=X(Ee,Re);$.emplaceBack(Ke,pt,Pt)}}return ne(0,0,ll,ll,ll,0),ne(ll,ll,0,0,0,ll),{vertices:V,indices:$}})(this.tileID.canonical,o);p=b.vertices,_=b.indices}else{p=new at,_=new nn;for(const{x:C,y:P}of c)p.emplaceBack(C,P,0,0);const b=Zp(p.int16,void 0,4);for(let C=0;C<b.length;C+=3)_.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=n.createVertexBuffer(p,YS.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(_),this._tileBoundsSegments=li.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(n,o){const c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;const p=this.tileID.canonical,_=Xs(_g(p,o)),b=Od(o.zoom);let C;b>0&&(C=Oo(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,p,o,_,C,b),this._makeGlobeTileDebugTextBuffer(n,p,o,_,C,b)}_globePoint(n,o,c,p,_,b,C){let P=sa(n,o,c);if(b){const M=1<<c.z,z=Mr(p.center.lng),V=$r(p.center.lat),$=(c.x+.5)/M-z;let K=0;$>.5?K=-1:$<-.5&&(K=1);let X=(n/ln+c.x)/M+K,ne=(o/ln+c.y)/M;X=(X-z)*p._pixelsPerMercatorPixel+z,ne=(ne-V)*p._pixelsPerMercatorPixel+V;const le=[X*p.worldSize,ne*p.worldSize,0];Zr(le,le,b),P=Vl(P,le,C)}return Zr(P,P,_)}_makeGlobeTileDebugBorderBuffer(n,o,c,p,_,b){const C=new kt,P=new Ks,M=new qe,z=($,K,X,ne,le)=>{const me=(X-$)/(le-1),Ce=(ne-K)/(le-1),ge=C.length;for(let Ee=0;Ee<le;Ee++){const Re=$+Ee*me,Pe=K+Ee*Ce;C.emplaceBack(Re,Pe);const et=this._globePoint(Re,Pe,o,c,p,_,b);M.emplaceBack(et[0],et[1],et[2]),P.emplaceBack(ge+Ee)}},V=ln;z(0,0,V,0,16),z(V,0,V,V,16),z(V,V,0,V,16),z(0,V,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(P),this._tileDebugBuffer=n.createVertexBuffer(C,cf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(M,rl.members),this._tileDebugSegments=li.simpleSegment(0,0,C.length,P.length)}_makeGlobeTileDebugTextBuffer(n,o,c,p,_,b){const C=ln/4,P=new kt,M=new nn,z=new qe,V=25;M.reserve(32),P.reserve(V),z.reserve(V);const $=(K,X)=>V*K+X;for(let K=0;K<V;K++){const X=K*C;for(let ne=0;ne<V;ne++){const le=ne*C;P.emplaceBack(le,X);const me=this._globePoint(le,X,o,c,p,_,b);z.emplaceBack(me[0],me[1],me[2])}}for(let K=0;K<4;K++)for(let X=0;X<4;X++){const ne=$(K,X),le=$(K,X+1),me=$(K+1,X),Ce=$(K+1,X+1);M.emplaceBack(ne,le,me),M.emplaceBack(me,le,Ce)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(M),this._tileDebugTextBuffer=n.createVertexBuffer(P,cf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,rl.members),this._tileDebugTextSegments=li.simpleSegment(0,0,V,32)}}class F4{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,c){const p=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},wt(this.stateChanges[n][p],c),this.deletedStates[n]===null){this.deletedStates[n]={};for(const _ in this.state[n])_!==p&&(this.deletedStates[n][_]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][p]===null){this.deletedStates[n][p]={};for(const _ in this.state[n][p])c[_]||(this.deletedStates[n][p][_]=null)}else for(const _ in c)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][_]===null&&delete this.deletedStates[n][p][_]}removeFeatureState(n,o,c){if(this.deletedStates[n]===null)return;const p=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},c&&o!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][c]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(c in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][c]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}getState(n,o){const c=String(o),p=wt({},(this.state[n]||{})[c],(this.stateChanges[n]||{})[c]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const _=this.deletedStates[n][o];if(_===null)return{};for(const b in _)delete p[b]}return p}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),wt(this.state[p][b],this.stateChanges[p][b]),_[b]=this.state[p][b];c[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const b in this.state[p])_[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else if(this.state[p][b])for(const C of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][C];_[b]=this.state[p][b]}c[p]=c[p]||{},wt(c[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in n)n[p].setFeatureState(c,o)}}class QS{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const c=this.toIdx(n,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function eE(i,n,o,c){let p=0,_=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(c[b])<1e-15){if(o[b]<i[b]||o[b]>n[b])return null}else{const C=1/c[b];let P=(i[b]-o[b])*C,M=(n[b]-o[b])*C;if(P>M){const z=P;P=M,M=z}if(P>p&&(p=P),M<_&&(_=M),p>_)return null}return p}function tE(i,n,o,c,p,_,b,C,P,M,z){const V=c-i,$=p-n,K=_-o,X=b-i,ne=C-n,le=P-o,me=z[1]*le-z[2]*ne,Ce=z[2]*X-z[0]*le,ge=z[0]*ne-z[1]*X,Ee=V*me+$*Ce+K*ge;if(Math.abs(Ee)<1e-15)return null;const Re=1/Ee,Pe=M[0]-i,et=M[1]-n,Ke=M[2]-o,pt=(Pe*me+et*Ce+Ke*ge)*Re;if(pt<0||pt>1)return null;const Pt=et*K-Ke*$,nt=Ke*V-Pe*K,yt=Pe*$-et*V,_t=(z[0]*Pt+z[1]*nt+z[2]*yt)*Re;return _t<0||pt+_t>1?null:(X*Pt+ne*nt+le*yt)*Re}function nE(i,n,o){return(i-n)/(o-n)}function rE(i,n,o,c,p,_,b,C,P){const M=1<<o,z=_-c,V=b-p,$=(i+1)/M*z+c,K=(n+0)/M*V+p,X=(n+1)/M*V+p;C[0]=(i+0)/M*z+c,C[1]=K,P[0]=$,P[1]=X}class iE{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=(function(_){const b=Math.ceil(Math.log2(_.dim/8)),C=[];let P=Math.ceil(Math.pow(2,b));const M=1/P,z=(K,X,ne,le,me)=>{const Ce=le?1:0,ge=(K+1)*ne-Ce,Ee=X*ne,Re=(X+1)*ne-Ce;me[0]=K*ne,me[1]=Ee,me[2]=ge,me[3]=Re};let V=new QS(P);const $=[];for(let K=0;K<P*P;K++){z(K%P,Math.floor(K/P),M,!1,$);const X=Kd($[0],$[1],_),ne=Kd($[2],$[1],_),le=Kd($[2],$[3],_),me=Kd($[0],$[3],_);V.minimums.push(Math.min(X,ne,le,me)),V.maximums.push(Math.max(X,ne,le,me)),V.leaves.push(1)}for(C.push(V),P/=2;P>=1;P/=2){const K=C[C.length-1];V=new QS(P);for(let X=0;X<P*P;X++){z(X%P,Math.floor(X/P),2,!0,$);const ne=K.getElevation($[0],$[1]),le=K.getElevation($[2],$[1]),me=K.getElevation($[2],$[3]),Ce=K.getElevation($[0],$[3]),ge=K.isLeaf($[0],$[1]),Ee=K.isLeaf($[2],$[1]),Re=K.isLeaf($[2],$[3]),Pe=K.isLeaf($[0],$[3]),et=Math.min(ne.min,le.min,me.min,Ce.min),Ke=Math.max(ne.max,le.max,me.max,Ce.max),pt=ge&&Ee&&Re&&Pe;V.maximums.push(Ke),V.minimums.push(et),V.leaves.push(Ke-et<=5&&pt?1:0)}C.push(V)}return C})(this.dem),c=o.length-1,p=o[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(n,o,c,p,_,b,C=1){return eE([n,o,-100],[c,p,this.maximums[0]*C],_,b)}raycast(n,o,c,p,_,b,C=1){if(!this.nodeCount)return null;const P=this.raycastRoot(n,o,c,p,_,b,C);if(P==null)return null;const M=[],z=[],V=[],$=[],K=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;K.length>0;){const{idx:X,t:ne,nodex:le,nodey:me,depth:Ce}=K.pop();if(this.leaves[X]){rE(le,me,Ce,n,o,c,p,V,$);const Ee=1<<Ce,Re=(le+0)/Ee,Pe=(le+1)/Ee,et=(me+0)/Ee,Ke=(me+1)/Ee,pt=Kd(Re,et,this.dem)*C,Pt=Kd(Pe,et,this.dem)*C,nt=Kd(Pe,Ke,this.dem)*C,yt=Kd(Re,Ke,this.dem)*C,_t=tE(V[0],V[1],pt,$[0],V[1],Pt,$[0],$[1],nt,_,b),Ct=tE($[0],$[1],nt,V[0],$[1],yt,V[0],V[1],pt,_,b),Rt=Math.min(_t!==null?_t:Number.MAX_VALUE,Ct!==null?Ct:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const dt=Rd([],_,b,ne);if(sE(pt,Pt,yt,nt,nE(dt[0],V[0],$[0]),nE(dt[1],V[1],$[1]))>=dt[2])return ne}continue}let ge=0;for(let Ee=0;Ee<this._siblingOffset.length;Ee++){rE((le<<1)+this._siblingOffset[Ee][0],(me<<1)+this._siblingOffset[Ee][1],Ce+1,n,o,c,p,V,$),V[2]=-100,$[2]=this.maximums[this.childOffsets[X]+Ee]*C;const Re=eE(V,$,_,b);if(Re!=null){const Pe=Re;M[Ee]=Pe;let et=!1;for(let Ke=0;Ke<ge&&!et;Ke++)Pe>=M[z[Ke]]&&(z.splice(Ke,0,Ee),et=!0);et||(z[ge]=Ee),ge++}}for(let Ee=0;Ee<ge;Ee++){const Re=z[Ee];K.push({idx:this.childOffsets[X]+Re,t:M[Re],nodex:(le<<1)+this._siblingOffset[Re][0],nodey:(me<<1)+this._siblingOffset[Re][1],depth:Ce+1})}}return null}_addNode(n,o,c){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,c,p,_){if(n[p].isLeaf(o,c)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const b=p-1,C=n[b];let P=0,M=0;for(let z=0;z<this._siblingOffset.length;z++){const V=2*o+this._siblingOffset[z][0],$=2*c+this._siblingOffset[z][1],K=C.getElevation(V,$),X=C.isLeaf(V,$),ne=this._addNode(K.min,K.max,X);X&&(P|=1<<z),M||(M=ne)}for(let z=0;z<this._siblingOffset.length;z++)P&1<<z||this._construct(n,2*o+this._siblingOffset[z][0],2*c+this._siblingOffset[z][1],b,M+z)}}function sE(i,n,o,c,p,_){return Qn(Qn(i,o,_),Qn(n,c,_),p)}function Kd(i,n,o){const c=o.dim,p=we(i*c-.5,0,c-1),_=we(n*c-.5,0,c-1),b=Math.floor(p),C=Math.floor(_),P=Math.min(b+1,c-1),M=Math.min(C+1,c-1);return sE(o.get(b,C),o.get(P,C),o.get(b,M),o.get(P,M),p-b,_-C)}const oE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function V4(i,n,o){return(256*i*256+256*n+o)/10-1e4}function U4(i,n,o){return 256*i+n+o/256-32768}class J_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,c,p=!1,_=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Jn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const b=this.dim=o.height-2,C=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let P=0;P<b;P++)C[this._idx(-1,P)]=C[this._idx(0,P)],C[this._idx(b,P)]=C[this._idx(b-1,P)],C[this._idx(P,-1)]=C[this._idx(P,0)],C[this._idx(P,b)]=C[this._idx(P,b-1)];C[this._idx(-1,-1)]=C[this._idx(0,0)],C[this._idx(b,-1)]=C[this._idx(b-1,0)],C[this._idx(-1,b)]=C[this._idx(0,b-1)],C[this._idx(b,b)]=C[this._idx(b-1,b-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new iE(this)}get(n,o,c=!1){c&&(n=we(n,-1,this.dim),o=we(o,-1,this.dim));const p=4*this._idx(n,o);return(this.encoding==="terrarium"?U4:V4)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(n){return oE[n]}get unpackVector(){return oE[this.encoding]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const c=[0,0,0,0],p=J_.getUnpackVector(o);let _=Math.floor((n+p[3])/p[2]);return c[2]=_%256,_=Math.floor(_/256),c[1]=_%256,_=Math.floor(_/256),c[0]=_,c}getPixels(){return new Qs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,_=o*this.dim+this.dim,b=c*this.dim,C=c*this.dim+this.dim;switch(o){case-1:p=_-1;break;case 1:_=p+1}switch(c){case-1:b=C-1;break;case 1:C=b+1}const P=-o*this.dim,M=-c*this.dim;for(let z=b;z<C;z++)for(let V=p;V<_;V++){const $=4*this._idx(V,z),K=4*this._idx(V+P,z+M);this.pixels[$+0]=n.pixels[K+0],this.pixels[$+1]=n.pixels[K+1],this.pixels[$+2]=n.pixels[K+2],this.pixels[$+3]=n.pixels[K+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ut(J_,"DEMData"),Ut(iE,"DemMinMaxQuadTree",{omit:["dem"]});class $4{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,c){const p=n.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:o,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout((()=>{this.remove(n,_)}),c)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const c=n.wrapped().key,p=o===void 0?0:this.data[c].indexOf(o),_=this.data[c][p];return this.data[c].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const c in this.data)for(const p of this.data[c])n(p.value)||o.push(p);for(const c of o)this.remove(c.value.tileID,c)}}class om{constructor(n,o,c){this.func=n,this.mask=o,this.range=c}}om.ReadOnly=!1,om.ReadWrite=!0,om.disabled=new om(519,om.ReadOnly,[0,1]);const Mx=7680;class Ix{constructor(n,o,c,p,_,b){this.test=n,this.ref=o,this.mask=c,this.fail=p,this.depthFail=_,this.pass=b}}Ix.disabled=new Ix({func:519,mask:0},0,0,Mx,Mx,Mx);class Zc{constructor(n,o,c){this.blendFunction=n,this.blendColor=o,this.mask=c}}Zc.Replace=[1,0],Zc.disabled=new Zc(Zc.Replace,xr.transparent,[!1,!1,!1,!1]),Zc.unblended=new Zc(Zc.Replace,xr.transparent,[!0,!0,!0,!0]),Zc.alphaBlended=new Zc([1,771],xr.transparent,[!0,!0,!0,!0]);const Rx=1029,Nx=2305;class Hl{constructor(n,o,c){this.enable=n,this.mode=o,this.frontFace=c}}Hl.disabled=new Hl(!1,Rx,Nx),Hl.backCCW=new Hl(!0,Rx,Nx),Hl.backCW=new Hl(!0,Rx,2304),Hl.frontCW=new Hl(!0,1028,2304),Hl.frontCCW=new Hl(!0,1028,Nx);class kf extends ks{constructor(n,o,c){super(),this.id=n,this._onlySymbols=c,o.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),o.on("error",(()=>{this._sourceErrored=!0})),this._source=o,this._tiles={},this._cache=new $4(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new F4,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,(()=>{}))}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,(()=>{}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const c=this._tiles[o];c.upload(n),c.prepare(this.map.style.imageManager)}}getIds(){return bt(this._tiles).map((n=>n.tileID)).sort(aE).map((n=>n.key))}getRenderableIds(n){const o=[];for(const c in this._tiles)this._isIdRenderable(+c,n)&&o.push(this._tiles[c]);return n?o.sort(((c,p)=>{const _=c.tileID,b=p.tileID,C=new Me(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),P=new Me(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-b.overscaledZ||P.y-C.y||P.x-C.x})).map((c=>c.tileID.key)):o.map((c=>c.tileID)).sort(aE).map((c=>c.key))}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const c=this._tiles[n];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,n,o)))}_tileLoaded(n,o,c,p){if(p)if(n.state="errored",p.status!==404)this._source.fire(new lo(p,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=Wo.now(),c==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new za("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const _=o[p];if(n.neighboringTiles&&n.neighboringTiles[_]){const b=this.getTileByID(_);c(n,b),c(b,n)}}function c(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let b=_.tileID.canonical.x-p.tileID.canonical.x;const C=_.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),M=_.tileID.key;b===0&&C===0||Math.abs(C)>1||(Math.abs(b)>1&&(Math.abs(b+P)===1?b+=P:Math.abs(b-P)===1&&(b-=P)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,b,C),p.neighboringTiles&&p.neighboringTiles[M]&&(p.neighboringTiles[M].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,c,p){for(const _ in this._tiles){let b=this._tiles[_];if(p[_]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>c)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const M=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[M.key],b&&b.hasData()&&(C=M)}let P=C;for(;P.overscaledZ>o;)if(P=P.scaledTo(P.overscaledZ-1),n[P.key]){p[C.key]=C;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const c=this._loadedParentTiles[n.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=n.overscaledZ-1;c>=o;c--){const p=n.scaledTo(c),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const c=Math.ceil(n.width/o)+1,p=Math.ceil(n.height/o)+1,_=Math.floor(c*p*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const c={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),c[_.tileID.key]=_}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(n,o,c){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((C=>new To(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y))):(p=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter((C=>this._source.hasTile(C))))):p=[];const _=this._updateRetainedTiles(p);if(lE(this._source.type)&&p.length!==0){const C={},P={},M=Object.keys(_);for(const V of M){const $=_[V],K=this._tiles[V];if(!K||K.fadeEndTime&&K.fadeEndTime<=Wo.now())continue;const X=this.findLoadedParent($,Math.max($.overscaledZ-kf.maxOverzooming,this._source.minzoom));X&&(this._addTile(X.tileID),C[X.tileID.key]=X.tileID),P[V]=$}const z=p[p.length-1].overscaledZ;for(const V in this._tiles){const $=this._tiles[V];if(_[V]||!$.hasData())continue;let K=$.tileID;for(;K.overscaledZ>z;){K=K.scaledTo(K.overscaledZ-1);const X=this._tiles[K.key];if(X&&X.hasData()&&P[K.key]){_[V]=$.tileID;break}}}for(const V in C)_[V]||(this._coveredTiles[V]=!0,_[V]=C[V])}for(const C in _)this._tiles[C].clearFadeHold();const b=(function(C,P){const M=[];for(const z in C)z in P||M.push(z);return M})(this._tiles,_);for(const C of b){const P=this._tiles[C];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const c={},p=n.reduce(((M,z)=>Math.min(M,z.overscaledZ)),1/0),_=n[0].overscaledZ,b=Math.max(_-kf.maxOverzooming,this._source.minzoom),C=Math.max(_+kf.maxUnderzooming,this._source.minzoom),P={};for(const M of n){const z=this._addTile(M);o[M.key]=M,z.hasData()||p<this._source.maxzoom&&(P[M.key]=M)}this._retainLoadedChildren(P,p,C,o);for(const M of n){let z=this._tiles[M.key];if(z.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const $=M.children(this._source.maxzoom)[0],K=this.getTile($);if(K&&K.hasData()){o[$.key]=$;continue}}else{const $=M.children(this._source.maxzoom);if(o[$[0].key]&&o[$[1].key]&&o[$[2].key]&&o[$[3].key])continue}let V=z.wasRequested();for(let $=M.overscaledZ-1;$>=b;--$){const K=M.scaledTo($);if(c[K.key]||(c[K.key]=!0,z=this.getTile(K),!z&&V&&(z=this._addTile(K)),z&&(o[K.key]=K,V=z.wasRequested(),z.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let c,p=this._tiles[n].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}o.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;p=_}for(const _ of o)this._loadedParentTiles[_]=c}}_addTile(n){let o=this._tiles[n.key];if(o)return o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const c=!!o;if(!c){const p=this.map?this.map.painter:null;o=new Px(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,c||this._source.fire(new za("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const c=o.getExpiryTimeout();c&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),c))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,c){const p=[],_=this.transform;if(!_)return p;const b=_.projection.name==="globe",C=Mr(_.center.lng);for(const P in this._tiles){const M=this._tiles[P];if(c&&M.clearQueryDebugViz(),M.holdingForFade())continue;let z;if(b){const V=M.tileID.canonical;if(V.z===0){const $=[Math.abs(we(C,...Kg(V,-1))-C),Math.abs(we(C,...Kg(V,1))-C)];z=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(we(C,...Kg(V,-1))-C),Math.abs(we(C,...Kg(V,0))-C),Math.abs(we(C,...Kg(V,1))-C)];z=[$.indexOf(Math.min(...$))-1]}}else z=[0];for(const V of z){const $=n.containsTile(M,_,o,V);$&&p.push($)}}return p}getVisibleCoordinates(n){const o=this.getRenderableIds(n).map((c=>this._tiles[c].tileID));for(const c of o)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(lE(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=Wo.now())return!0}return!1}setFeatureState(n,o,c){this._state.updateState(n=n||"_geojsonTileLayer",o,c)}removeFeatureState(n,o,c){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,c)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,c){const p=this._tiles[n];p&&p.setDependencies(o,c)}reloadTilesForDependencies(n,o){for(const c in this._tiles)this._tiles[c].hasDependency(n,o)&&this._reloadTile(+c,"reloading");this._cache.filter((c=>!c.hasDependency(n,o)))}_preloadTiles(n,o){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(n,o))};return void this._source.on("data",C)}const c=new Map,p=Array.isArray(n)?n:[n],_=this.map.painter.terrain,b=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const C of p){const P=C.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of P)c.set(M.key,M);this.usedForTerrain&&C.updateElevation(!1)}Ve(Array.from(c.values()),((C,P)=>{const M=new Px(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,(z=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),P(z,M)}))}),o)}}function aE(i,n){const o=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||c-o||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function lE(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function Kg(i,n){const o=1<<i.z;return[i.x/o+n,(i.x+1)/o+n]}kf.maxOverzooming=10,kf.maxUnderzooming=3;class Q_{constructor(n,o,c){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(n,o,c){const p=c||n.findDEMTileFor(o);if(!p||!p.dem)return;const _=p.dem,b=p.tileID,C=1<<o.canonical.z-b.canonical.z;return new Q_(p,p.tileSize/ln/C,[(o.canonical.x/C-b.canonical.x)*_.dim,(o.canonical.y/C-b.canonical.y)*_.dim])}tileCoordToPixel(n,o){const c=o*this._scale+this._offset[1],p=Math.floor(n*this._scale+this._offset[0]),_=Math.floor(c);return new Me(p,_)}getElevationAt(n,o,c,p){const _=n*this._scale+this._offset[0],b=o*this._scale+this._offset[1],C=Math.floor(_),P=Math.floor(b),M=this._dem;return p=!!p,c?Qn(Qn(M.get(C,P,p),M.get(C,P+1,p),b-P),Qn(M.get(C+1,P,p),M.get(C+1,P+1,p),b-P),_-C):M.get(C,P,p)}getElevationAtPixel(n,o,c){return this._dem.get(n,o,!!c)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*ci(1,n)*this._dem.stride}}class cE{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ta(ln,16,0),this.featureIndexArray=new Jr,this.promoteId=o}insert(n,o,c,p,_,b=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,_,b);const P=this.grid;for(let M=0;M<o.length;M++){const z=o[M],V=[1/0,1/0,-1/0,-1/0];for(let $=0;$<z.length;$++){const K=z[$];V[0]=Math.min(V[0],K.x),V[1]=Math.min(V[1],K.y),V[2]=Math.max(V[2],K.x),V[3]=Math.max(V[3],K.y)}V[0]<ln&&V[1]<ln&&V[2]>=0&&V[3]>=0&&P.insert(C,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gn(new B_(this.rawTileData)).layers,this.sourceLayerCoder=new ZS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,c,p){this.loadVTLayers();const _=n.params||{},b=kc(_.filter),C=n.tileResult,P=n.transform,M=C.bufferedTilespaceBounds,z=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,((X,ne,le,me)=>P_(C.bufferedTilespaceGeometry,X,ne,le,me)));z.sort(G4);let V=null;P.elevation&&z.length>0&&(V=Q_.create(P.elevation,this.tileID));const $={};let K;for(let X=0;X<z.length;X++){const ne=z[X];if(ne===K)continue;K=ne;const le=this.featureIndexArray.get(ne);let me=null;this.loadMatchingFeature($,le,b,_.layers,_.availableImages,o,c,p,((Ce,ge,Ee,Re=0)=>(me||(me=Ls(Ce,this.tileID.canonical,n.tileTransform)),ge.queryIntersectsFeature(C,Ce,Ee,me,this.z,n.transform,n.pixelPosMatrix,V,Re))))}return $}loadMatchingFeature(n,o,c,p,_,b,C,P,M){const{featureIndex:z,bucketIndex:V,sourceLayerIndex:$,layoutVertexArrayOffset:K}=o,X=this.bucketLayerIDs[V];if(p&&!(function(Ce,ge){for(let Ee=0;Ee<Ce.length;Ee++)if(ge.indexOf(Ce[Ee])>=0)return!0;return!1})(p,X))return;const ne=this.sourceLayerCoder.decode($),le=this.vtLayers[ne].feature(z);if(c.needGeometry){const Ce=ol(le,!0);if(!c.filter(new B(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!c.filter(new B(this.tileID.overscaledZ),le))return;const me=this.getId(le,ne);for(let Ce=0;Ce<X.length;Ce++){const ge=X[Ce];if(p&&p.indexOf(ge)<0)continue;const Ee=b[ge];if(!Ee)continue;let Re={};me!==void 0&&P&&(Re=P.getState(Ee.sourceLayer||"_geojsonTileLayer",me));const Pe=wt({},C[ge]);Pe.paint=uE(Pe.paint,Ee.paint,le,Re,_),Pe.layout=uE(Pe.layout,Ee.layout,le,Re,_);const et=!M||M(le,Ee,Re,K);if(!et)continue;const Ke=new KS(le,this.z,this.x,this.y,me);Ke.layer=Pe;let pt=n[ge];pt===void 0&&(pt=n[ge]=[]),pt.push({featureIndex:z,feature:Ke,intersectionZ:et})}}lookupSymbolFeatures(n,o,c,p,_,b,C,P){const M={};this.loadVTLayers();const z=kc(_);for(const V of n)this.loadMatchingFeature(M,{bucketIndex:c,sourceLayerIndex:p,featureIndex:V,layoutVertexArrayOffset:0},z,b,C,P,o);return M}loadFeature(n){const{featureIndex:o,sourceLayerIndex:c}=n;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),_=this.vtFeatures[p];if(_[o])return _[o];const b=this.vtLayers[p].feature(o);return _[o]=b,b}hasLayer(n){for(const o of this.bucketLayerIDs)for(const c of o)if(n===c)return!0;return!1}getId(n,o){let c=n.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];p!=null&&(c=n.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function uE(i,n,o,c,p){return sn(i,((_,b)=>{const C=n instanceof pe?n.get(b):null;return C&&C.evaluate?C.evaluate(o,c,p):C}))}function G4(i,n){return n-i}Ut(cE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class dE{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new bo({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const c=this.getKey(n,o);return this.positions[c]}trim(){const n=this.width,o=this.height=Nt(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,c){const p=[];let _=n.length%2==1?-n[n.length-1]*c:0,b=n[0]*c,C=!0;p.push({left:_,right:b,isDash:C,zeroLength:n[0]===0});let P=n[0];for(let M=1;M<n.length;M++){C=!C;const z=n[M];_=P*c,P+=z,b=P*c,p.push({left:_,right:b,isDash:C,zeroLength:z===0})}return p}addRoundDash(n,o,c){const p=o/2;for(let _=-c;_<=c;_++){const b=this.width*(this.nextRow+c+_);let C=0,P=n[C];for(let M=0;M<this.width;M++){M/P.right>1&&(P=n[++C]);const z=Math.abs(M-P.left),V=Math.abs(M-P.right),$=Math.min(z,V);let K;const X=_/c*(p+1);if(P.isDash){const ne=p-Math.abs(X);K=Math.sqrt($*$+ne*ne)}else K=p-Math.sqrt($*$+X*X);this.image.data[b+M]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(n,o){for(let P=n.length-1;P>=0;--P){const M=n[P],z=n[P+1];M.zeroLength?n.splice(P,1):z&&z.isDash===M.isDash&&(z.left=M.left,n.splice(P,1))}const c=n[0],p=n[n.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const _=this.width*this.nextRow;let b=0,C=n[b];for(let P=0;P<this.width;P++){P/C.right>1&&(C=n[++b]);const M=Math.abs(P-C.left),z=Math.abs(P-C.right),V=Math.min(M,z);this.image.data[_+P]=Math.max(0,Math.min(255,(C.isDash?V:-V)+o+128))}}addDash(n,o){const c=this.getKey(n,o);if(this.positions[c])return this.positions[c];const p=o==="round",_=p?7:0,b=2*_+1;if(this.nextRow+b>this.height)return Jn("LineAtlas out of space"),null;n.length===0&&n.push(1);let C=0;for(let z=0;z<n.length;z++)n[z]<0&&(Jn("Negative value is found in line dasharray, replacing values with 0"),n[z]=0),C+=n[z];if(C!==0){const z=this.width/C,V=this.getDashRanges(n,this.width,z);p?this.addRoundDash(V,z,_):this.addRegularDash(V,o==="square"?.5*z:0)}const P=this.nextRow+_;this.nextRow+=b;const M={tl:[P,_],br:[C,0]};return this.positions[c]=M,M}}Ut(dE,"LineAtlas");const hE=1*Gl;class fE{constructor(n){const o={},c=[];for(const C in n){const P=n[C],M=o[C]={};for(const z in P.glyphs){const V=P.glyphs[+z];if(!V||V.bitmap.width===0||V.bitmap.height===0)continue;const $=V.metrics.localGlyph?hE:1,K={x:0,y:0,w:V.bitmap.width+2*$,h:V.bitmap.height+2*$};c.push(K),M[z]=K}}const{w:p,h:_}=yx(c),b=new bo({width:p||1,height:_||1});for(const C in n){const P=n[C];for(const M in P.glyphs){const z=P.glyphs[+M];if(!z||z.bitmap.width===0||z.bitmap.height===0)continue;const V=o[C][M],$=z.metrics.localGlyph?hE:1;bo.copy(z.bitmap,b,{x:0,y:0},{x:V.x+$,y:V.y+$},z.bitmap)}}this.image=b,this.positions=o}}Ut(fE,"GlyphAtlas");class H4{constructor(n){this.tileID=new To(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=Cf(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,o,c,p,_){this.status="parsing",this.data=n,this.collisionBoxArray=new mr;const b=new ZS(Object.keys(n.layers).sort()),C=new cE(this.tileID,this.promoteId);C.bucketLayerIDs=[];const P={},M=new dE(256,256),z={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:c},V=o.familiesBySource[this.source];for(const Re in V){const Pe=n.layers[Re];if(!Pe)continue;let et=!1,Ke=!1;for(const nt of V[Re])nt[0].type==="symbol"?et=!0:Ke=!0;if(this.isSymbolTile===!0&&!et||this.isSymbolTile===!1&&!Ke)continue;Pe.version===1&&Jn(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pt=b.encode(Re),Pt=[];for(let nt=0;nt<Pe.length;nt++){const yt=Pe.feature(nt),_t=C.getId(yt,Re);Pt.push({feature:yt,id:_t,index:nt,sourceLayerIndex:pt})}for(const nt of V[Re]){const yt=nt[0];this.isSymbolTile!==void 0&&yt.type==="symbol"!==this.isSymbolTile||yt.minzoom&&this.zoom<Math.floor(yt.minzoom)||yt.maxzoom&&this.zoom>=yt.maxzoom||yt.visibility!=="none"&&(jx(nt,this.zoom,c),(P[yt.id]=yt.createBucket({index:C.bucketLayerIDs.length,layers:nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(Pt,z,this.tileID.canonical,this.tileTransform),C.bucketLayerIDs.push(nt.map((_t=>_t.id))))}}let $,K,X,ne;M.trim();const le={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},me=()=>{if($)return _($);if(K&&X&&ne){const Re=new fE(K),Pe=new xS(X,ne);for(const et in P){const Ke=P[et];Ke instanceof qd?(jx(Ke.layers,this.zoom,c),y4(Ke,K,Re.positions,X,Pe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Ke.hasPattern&&(Ke instanceof L_||Ke instanceof E||Ke instanceof Og)&&(jx(Ke.layers,this.zoom,c),Ke.addFeatures(z,this.tileID.canonical,Pe.patternPositions,c,this.tileTransform))}this.status="done",_(null,{buckets:bt(P).filter((et=>!et.isEmpty())),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Re.image,lineAtlas:M,imageAtlas:Pe,glyphMap:this.returnDependencies?K:null,iconMap:this.returnDependencies?X:null,glyphPositions:this.returnDependencies?Re.positions:null})}},Ce=sn(z.glyphDependencies,(Re=>Object.keys(Re).map(Number)));Object.keys(Ce).length?p.send("getGlyphs",{uid:this.uid,stacks:Ce},((Re,Pe)=>{$||($=Re,K=Pe,me())}),void 0,!1,le):K={};const ge=Object.keys(z.iconDependencies);ge.length?p.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"icons"},((Re,Pe)=>{$||($=Re,X=Pe,me())}),void 0,!1,le):X={};const Ee=Object.keys(z.patternDependencies);Ee.length?p.send("getImages",{icons:Ee,source:this.source,tileID:this.tileID,type:"patterns"},((Re,Pe)=>{$||($=Re,ne=Pe,me())}),void 0,!1,le):ne={},me()}}function jx(i,n,o){const c=new B(n);for(const p of i)p.recalculate(c,o)}class pE{constructor(n){this.entries={},this.scheduler=n}request(n,o,c,p){const _=this.entries[n]=this.entries[n]||{callbacks:[]};if(_.result){const[b,C]=_.result;return this.scheduler?this.scheduler.add((()=>{p(b,C)}),o):p(b,C),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=c(((b,C)=>{_.result=[b,C];for(const P of _.callbacks)this.scheduler?this.scheduler.add((()=>{P(b,C)}),o):P(b,C);setTimeout((()=>delete this.entries[n]),3e3)}))),()=>{_.result||(_.callbacks=_.callbacks.filter((b=>b!==p)),_.callbacks.length||(_.cancel(),delete this.entries[n]))}}}function mE(i,n,o){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},(p=>{const _=oo(i.request,((b,C,P,M)=>{b?p(b):C&&p(null,{vectorTile:o?void 0:new gn(new B_(C)),rawData:C,cacheControl:P,expires:M})}));return()=>{_.cancel(),p()}}),n)}const gE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dx{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=gE[15&c];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(n,2,1),[C]=new Uint32Array(n,4,1);return new Dx(C,b,_,n)}constructor(n,o=64,c=Float64Array,p){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const _=gE.indexOf(this.ArrayType),b=2*n*this.ArrayType.BYTES_PER_ELEMENT,C=n*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-C%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+C+P,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+b+C+P),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+C+P,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=n,this.coords[this._pos++]=o,c}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Lx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:C}=this,P=[0,_.length-1,0],M=[];for(;P.length;){const z=P.pop()||0,V=P.pop()||0,$=P.pop()||0;if(V-$<=C){for(let le=$;le<=V;le++){const me=b[2*le],Ce=b[2*le+1];me>=n&&me<=c&&Ce>=o&&Ce<=p&&M.push(_[le])}continue}const K=$+V>>1,X=b[2*K],ne=b[2*K+1];X>=n&&X<=c&&ne>=o&&ne<=p&&M.push(_[K]),(z===0?n<=X:o<=ne)&&(P.push($),P.push(K-1),P.push(1-z)),(z===0?c>=X:p>=ne)&&(P.push(K+1),P.push(V),P.push(1-z))}return M}within(n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,C=[0,p.length-1,0],P=[],M=c*c;for(;C.length;){const z=C.pop()||0,V=C.pop()||0,$=C.pop()||0;if(V-$<=b){for(let le=$;le<=V;le++)_E(_[2*le],_[2*le+1],n,o)<=M&&P.push(p[le]);continue}const K=$+V>>1,X=_[2*K],ne=_[2*K+1];_E(X,ne,n,o)<=M&&P.push(p[K]),(z===0?n-c<=X:o-c<=ne)&&(C.push($),C.push(K-1),C.push(1-z)),(z===0?n+c>=X:o+c>=ne)&&(C.push(K+1),C.push(V),C.push(1-z))}return P}}function Lx(i,n,o,c,p,_){if(p-c<=o)return;const b=c+p>>1;yE(i,n,b,c,p,_),Lx(i,n,o,c,b-1,1-_),Lx(i,n,o,b+1,p,1-_)}function yE(i,n,o,c,p,_){for(;p>c;){if(p-c>600){const M=p-c+1,z=o-c+1,V=Math.log(M),$=.5*Math.exp(2*V/3),K=.5*Math.sqrt(V*$*(M-$)/M)*(z-M/2<0?-1:1);yE(i,n,o,Math.max(c,Math.floor(o-z*$/M+K)),Math.min(p,Math.floor(o+(M-z)*$/M+K)),_)}const b=n[2*o+_];let C=c,P=p;for(Xg(i,n,c,o),n[2*p+_]>b&&Xg(i,n,c,p);C<P;){for(Xg(i,n,C,P),C++,P--;n[2*C+_]<b;)C++;for(;n[2*P+_]>b;)P--}n[2*c+_]===b?Xg(i,n,c,P):(P++,Xg(i,n,P,p)),P<=o&&(c=P+1),o<=P&&(p=P-1)}}function Xg(i,n,o,c){Ox(i,o,c),Ox(n,2*o,2*c),Ox(n,2*o+1,2*c+1)}function Ox(i,n,o){const c=i[n];i[n]=i[o],i[o]=c}function _E(i,n,o,c){const p=i-o,_=n-c;return p*p+_*_}s.ARRAY_TYPE=ps,s.AUTH_ERR_MSG=Te,s.Aabb=gs,s.Actor=class{constructor(i,n,o){this.target=i,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},un(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=wi()?i:S,this.scheduler=new z4}send(i,n,o,c,p=!1,_){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=_,this.callbacks[b]=o);const C=cs(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:i,hasCallback:!!o,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:jl(n,C)},C),{cancel:()=>{o&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(i){const n=i.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(n.mustQueue||wi()){const c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add((()=>this.processTask(o,n)),c&&c.metadata||{type:"message"})}else this.processTask(o,n)}processTask(i,n){if(n.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(n.error?o(Dl(n.error)):o(null,Dl(n.data)))}else{const o=cs(this.globalScope)?void 0:[],c=n.hasCallback?(_,b)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?jl(_):null,data:jl(b,o)},o)}:_=>{},p=Dl(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,p,c);else if(this.parent.getWorkerSource){const _=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,_[0],p.source)[_[1]](p,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=D_,s.Color=xr,s.ColorMode=Zc,s.CullFaceMode=Hl,s.DEMData=J_,s.DataConstantProperty=te,s.DedupedRequest=pE,s.DepthMode=om,s.EXTENT=ln,s.Elevation=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const o=n.getSource().maxzoom,c=1<<o,p=Math.floor(i.x),_=Math.floor((i.x-p)*c),b=Math.floor(i.y*c),C=this.findDEMTileFor(new To(o,p,o,_,b));return!(!C||!C.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const c=this._source();if(!c||i.y<0||i.y>1)return n;const p=c.getSource().maxzoom,_=1<<p,b=Math.floor(i.x),C=i.x-b,P=new To(p,b,p,Math.floor(C*_),Math.floor(i.y*_)),M=this.findDEMTileFor(P);if(!M||!M.dem)return n;const z=M.dem,V=1<<M.tileID.canonical.z,$=(C*V-M.tileID.canonical.x)*z.dim,K=(i.y*V-M.tileID.canonical.y)*z.dim,X=Math.floor($),ne=Math.floor(K);return(o?this.exaggeration():1)*Qn(Qn(z.get(X,ne),z.get(X,ne+1),K-ne),Qn(z.get(X+1,ne),z.get(X+1,ne+1),K-ne),$-X)}getAtTileOffset(i,n,o){const c=1<<i.canonical.z;return this.getAtPointOrZero(new Fc(i.wrap+(i.canonical.x+n/ln)/c,(i.canonical.y+o/ln)/c))}getAtTileOffsetFunc(i,n,o,c){return p=>{const _=this.getAtTileOffset(i,p.x,p.y),b=c.upVector(i.canonical,p.x,p.y);return Vr(b,b,_*c.upVectorScale(i.canonical,n,o).metersToTile),b}}getForTilePoints(i,n,o,c){if(this.isUsingMockSource())return!1;const p=Q_.create(this,i,c);return!!p&&(n.forEach((_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],o)})),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const o=n.dem.tree,c=n.tileID,p=1<<i.canonical.z-c.canonical.z;let _=i.canonical.x/p-c.canonical.x,b=i.canonical.y/p-c.canonical.y,C=0;for(let P=0;P<i.canonical.z-c.canonical.z&&!o.leaves[C];P++){_*=2,b*=2;const M=2*Math.floor(b)+Math.floor(_);C=o.childOffsets[C]+M,_%=1,b%=1}return{min:this.exaggeration()*o.minimums[C],max:this.exaggeration()*o.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=lo,s.EvaluationParameters=B,s.Event=za,s.Evented=ks,s.FillExtrusionBucket=Og,s.Frustum=Lp,s.FrustumCorners=uf,s.GLOBE_RADIUS=il,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=ys,s.GLOBE_ZOOM_THRESHOLD_MIN=zu,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,n){const o=new kt,c=new nn,p=[],_=i+1+2,b=n[0]+1,C=n[0]+1+(1+n.length),P=(M,z,V)=>{let $=M===_-1?M-2:M===0?M:M-1;return $+=V?24575:0,[$,z]};for(let M=0;M<_;++M)o.emplaceBack(...P(M,0,!0));for(let M=0;M<b;++M)for(let z=0;z<_;++z)o.emplaceBack(...P(z,M,(z===0||z===_-1)&&!0));for(let M=0;M<n.length;++M){const z=n[M];for(let V=0;V<_;++V)o.emplaceBack(...P(V,z,!0))}for(let M=0;M<n.length;++M){const z=c.length,V=n[M]+1+2,$=new nn;for(let ne=0;ne<V-1;ne++){const le=ne===V-2,me=le?_*(C-n.length+M-ne):_;for(let Ce=0;Ce<_-1;Ce++){const ge=ne*_+Ce;ne===0||le||Ce===0||Ce===_-2?($.emplaceBack(ge+1,ge,ge+me),$.emplaceBack(ge+me,ge+me+1,ge+1)):(c.emplaceBack(ge+1,ge,ge+me),c.emplaceBack(ge+me,ge+me+1,ge+1))}}const K=li.simpleSegment(0,z,o.length,c.length-z);for(let ne=0;ne<$.uint16.length;ne+=3)c.emplaceBack($.uint16[ne],$.uint16[ne+1],$.uint16[ne+2]);const X=li.simpleSegment(0,z,o.length,c.length-z);p.push({withoutSkirts:K,withSkirts:X})}return{vertices:o,indices:c,segments:p}}_createGrid(i){const n=this._fillGridMeshWithLods(sl,zi);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,cf.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new nn;for(let p=0;p<=sl;p++)n.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const o=new ir,c=new ir;this._poleSegments=[];for(let p=0,_=0;p<zu;p++){const b=360/(1<<p);o.emplaceBack(0,-il,0,.5,0),c.emplaceBack(0,-il,0,.5,1);for(let C=0;C<=sl;C++){const P=C/sl,M=Qn(0,b,P),[z,V,$]=gi(A_,ax,M,il);o.emplaceBack(z,V,$,P,0),c.emplaceBack(z,V,$,P,1)}this._poleSegments.push(li.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,lf,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(c,lf,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,n){if(!this._wireframeSegments){const o=new qr,c=sl,p=c+1+2,_=1;this._wireframeSegments=[];for(let b=0,C=0;b<zi.length;b++){const P=zi[b];for(let z=_;z<P+_;z++)for(let V=_;V<c+_;V++){const $=z*p+V;o.emplaceBack($,$+1),o.emplaceBack($,$+p),o.emplaceBack($,$+p+1)}const M=P*c*3;this._wireframeSegments.push(li.simpleSegment(0,C,(P+1)*p,M)),C+=M}this._wireframeIndexBuffer=i.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[n]]}},s.GlyphManager=tm,s.ImagePosition=_x,s.KDBush=Dx,s.LivePerformanceUtils=lp,s.LngLat=fn,s.LngLatBounds=Bl,s.LocalGlyphMode=wx,s.MAX_MERCATOR_LATITUDE=Qr,s.MercatorCoordinate=Fc,s.ONE_EM=_s,s.OverscaledTileID=To,s.PerformanceMarkers=vl,s.Point=Me,s.Properties=ve,s.RGBAImage=Qs,s.Ray=Dp,s.RequestManager=class{constructor(i,n,o){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=(function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Y,n].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!xe(i))return i;const o=jt(i);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!xe(i))return i;const o=jt(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(i,n,o,c){if(!xe(i))return i;const p=jt(i);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),o&&p.params.push(`language=${o}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||n)}normalizeSpriteURL(i,n,o,c){const p=jt(i);return xe(i)?(p.path=`/styles/v1${p.path}/sprite${n}${o}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${n}${o}`,xt(p))}normalizeTileURL(i,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!xe(i))return i;const c=jt(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&c.authority!=="raster"&&o===512?"@2x":""}${L.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${O.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${O.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||(function(_){for(const b of _){const C=b.match(/^access_token=(.*)$/);if(C)return C[1]}return null})(c.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(i,n){const o=jt(i);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let p=o.params;return n&&(p=p.filter((_=>!_.match(/^access_token=/)))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(i,n){const o=!!n&&xe(n),c=[];for(const p of i.tiles||[])ze(p)?c.push(this.canonicalizeTileURL(p,o)):c.push(p);return c}_makeAPIURL(i,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=jt(O.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,i.protocol==="http"){const p=i.params.indexOf("secure");p>=0&&i.params.splice(p,1)}if(c.path!=="/"&&(i.path=`${c.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return xt(i);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter((p=>p.indexOf("access_token")===-1)),i.params.push(`access_token=${n||""}`),xt(i)}},s.ResourceType=Ii,s.SegmentVector=li,s.SourceCache=kf,s.StencilMode=Ix,s.StructArrayLayout1ui2=Ks,s.StructArrayLayout2f1f2i16=hn,s.StructArrayLayout2i4=kt,s.StructArrayLayout2ui4=qr,s.StructArrayLayout3f12=Gn,s.StructArrayLayout3ui6=nn,s.StructArrayLayout4i8=at,s.StructArrayLayout5f20=ir,s.Texture=Zg,s.Tile=Px,s.Transitionable=ee,s.Uniform1f=tf,s.Uniform1i=class extends el{constructor(i){super(i),this.current=0}set(i,n,o){this.fetchUniformLocation(i,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},s.Uniform2f=class extends el{constructor(i){super(i),this.current=[0,0]}set(i,n,o){this.fetchUniformLocation(i,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},s.Uniform3f=class extends el{constructor(i){super(i),this.current=[0,0,0]}set(i,n,o){this.fetchUniformLocation(i,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},s.Uniform4f=lg,s.UniformColor=cg,s.UniformMatrix2f=class extends el{constructor(i){super(i),this.current=m_}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}},s.UniformMatrix3f=class extends el{constructor(i){super(i),this.current=p_}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},s.UniformMatrix4f=class extends el{constructor(i){super(i),this.current=f_}set(i,n,o){if(this.fetchUniformLocation(i,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},s.UnwrappedTileID=sS,s.ValidationError=Ft,s.VectorTileFeature=Cn,s.VectorTileWorkerSource=class extends ks{constructor(i,n,o,c,p){super(),this.actor=i,this.layerIndex=n,this.availableImages=o,this.loadVectorData=p||mE,this.loading={},this.loaded={},this.deduped=new pE(i.scheduler),this.isSpriteLoaded=c,this.scheduler=i.scheduler}loadTile(i,n){const o=i.uid,c=i&&i.request,p=c&&c.collectResourceTiming,_=this.loading[o]=new H4(i);_.abort=this.loadVectorData(i,((b,C)=>{const P=!this.loading[o];if(delete this.loading[o],P||b||!C)return _.status="done",P||(this.loaded[o]=_),n(b);const M=C.rawData,z={};C.expires&&(z.expires=C.expires),C.cacheControl&&(z.cacheControl=C.cacheControl),_.vectorTile=C.vectorTile||new gn(new B_(M));const V=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(($,K)=>{if($||!K)return n($);const X={};if(p){const ne=Eh(c);ne.length>0&&(X.resourceTiming=JSON.parse(JSON.stringify(ne)))}n(null,wt({rawTileData:M.slice(0)},K,z,X))}))};this.isSpriteLoaded?V():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):V()})),this.loaded=this.loaded||{},this.loaded[o]=_}))}reloadTile(i,n){const o=this.loaded,c=i.uid,p=this;if(o&&o[c]){const _=o[c];_.showCollisionBoxes=i.showCollisionBoxes,_.enableTerrain=!!i.enableTerrain,_.projection=i.projection,_.tileTransform=Cf(i.tileID.canonical,i.projection);const b=(C,P)=>{const M=_.reloadCallback;M&&(delete _.reloadCallback,_.parse(_.vectorTile,p.layerIndex,this.availableImages,p.actor,M)),n(C,P)};_.status==="parsing"?_.reloadCallback=b:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(i,n){const o=i.uid,c=this.loading[o];c&&(c.abort&&c.abort(),delete this.loading[o]),n()}removeTile(i,n){const o=this.loaded,c=i.uid;o&&o[c]&&delete o[c],n()}},s.WritingMode=Ma,s.ZoomDependentExpression=Wa,s.add=nl,s.addDynamicAttributes=K_,s.adjoint=function(i,n){var o=n[0],c=n[1],p=n[2],_=n[3],b=n[4],C=n[5],P=n[6],M=n[7],z=n[8];return i[0]=b*z-C*M,i[1]=p*M-c*z,i[2]=c*C-p*b,i[3]=C*P-_*z,i[4]=o*z-p*P,i[5]=p*_-o*C,i[6]=_*M-b*P,i[7]=c*P-o*M,i[8]=o*b-c*_,i},s.asyncAll=Ve,s.bezier=We,s.bindAll=un,s.boundsAttributes=YS,s.bufferConvexPolygon=function(i,n){const o=[];for(let c=0;c<i.length;c++){const p=ke(c-1,-1,i.length-1),_=ke(c+1,-1,i.length-1),b=i[c],C=i[_],P=i[p].sub(b).unit(),M=C.sub(b).unit(),z=M.angleWithSep(P.x,P.y),V=P.add(M).unit().mult(-1*n/Math.sin(z/2));o.push(b.add(V))}return o},s.cacheEntryPossiblyAdded=function(i){so++,so>us&&(i.getActor().send("enforceCacheSizeLimit",Gr),so=0)},s.calculateGlobeLabelMatrix=function(i,n){const{x:o,y:c}=i.point,p=Ca(o,c,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Fl(p,p,Op(Fo(n)))},s.calculateGlobeMatrix=function(i){const{x:n,y:o}=i.point,{lng:c,lat:p}=i._center;return Ca(n,o,i.worldSize,c,p)},s.calculateGlobeMercatorMatrix=function(i){const n=i.pixelsPerMeter,o=n/ci(1,i.center.lat),c=Ea(new Float64Array(16));return Lc(c,c,[i.point.x,i.point.y,0]),Oc(c,c,[o,o,n]),Float32Array.from(c)},s.circumferenceAtLatitude=Bi,s.clamp=we,s.clearTileCache=function(i){if(!Xi())return;const n=S.caches.delete(Cs);i&&n.catch(i).then((()=>i()))},s.clipLine=NS,s.clone=function(i){var n=new ps(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},s.clone$1=vr,s.collisionCircleLayout=$3,s.config=O,s.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},s.create=function(){var i=new ps(16);return ps!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=x_,s.createExpression=yr,s.createLayout=$e,s.createStyleLayer=function(i){return i.type==="custom"?new j4(i):new L4[i.type](i)},s.cross=Mp,s.degToRad=mt,s.distance=function(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])},s.div=function(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i},s.dot=zo,s.earthRadius=Bc,s.ease=Le,s.easeCubicInOut=it,s.ecefToLatLng=function([i,n,o]){const c=Math.hypot(i,n,o),p=Math.atan2(i,o),_=.5*Math.PI-Math.acos(-n/c);return new fn(gt(p),gt(_))},s.emitValidationErrors=fs,s.endsWith=Rn,s.enforceCacheSizeLimit=function(i){Mi(),bi&&bi.then((n=>{n.keys().then((o=>{for(let c=0;c<o.length-i;c++)n.delete(o[c])}))}))},s.evaluateSizeForFeature=O_,s.evaluateSizeForZoom=Yp,s.evaluateVariableOffset=zS,s.evented=T,s.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},s.exactEquals$1=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},s.exported=Wo,s.exported$1=L,s.extend=wt,s.extend$1=Si,s.fillExtrusionHeightLift=nS,s.filterObject=kr,s.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},s.fromQuat=function(i,n){var o=n[0],c=n[1],p=n[2],_=n[3],b=o+o,C=c+c,P=p+p,M=o*b,z=c*b,V=c*C,$=p*b,K=p*C,X=p*P,ne=_*b,le=_*C,me=_*P;return i[0]=1-V-X,i[1]=z+me,i[2]=$-le,i[3]=0,i[4]=z-me,i[5]=1-M-X,i[6]=K+ne,i[7]=0,i[8]=$+le,i[9]=K-ne,i[10]=1-M-V,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,n){var o=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=o,i[2]=0,i[3]=-o,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=Ap,s.furthestTileCorner=function(i){const n=Math.round((i+45+360)%360/90)%4;return Lt[n]},s.getAABBPointSquareDist=function(i,n,o){let c=0;for(let p=0;p<2;++p){const _=o?o[p]:0;i[p]>_&&(c+=(i[p]-_)*(i[p]-_)),n[p]<_&&(c+=(_-n[p])*(_-n[p]))}return c},s.getAnchorAlignment=xx,s.getAnchorJustification=Tx,s.getBounds=function(i){let n=1/0,o=1/0,c=-1/0,p=-1/0;for(const _ of i)n=Math.min(n,_.x),o=Math.min(o,_.y),c=Math.max(c,_.x),p=Math.max(p,_.y);return{min:new Me(n,o),max:new Me(c,p)}},s.getColumn=zs,s.getDefaultExportFromCjs=ie,s.getGridMatrix=function(i,n,o,c){const p=n.getNorth(),_=n.getSouth(),b=n.getWest(),C=n.getEast(),P=1<<i.z,M=C-b,z=p-_,V=M/sl,$=-z/zi[o],K=[0,V,0,$,0,0,p,b,0];if(i.z>0){const X=180/c;w_(K,K,[X/M+1,0,0,0,X/z+1,0,-.5*X/V,.5*X/$,1])}return K[2]=P,K[5]=i.x,K[8]=i.y,K},s.getImage=de,s.getJSON=function(i,n){return Fs(wt(i,{type:"json"}),n)},s.getLatitudinalLod=function(i){const n=Qr-5;i=we(i,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(mt(i))),3);return Math.round(o*(zi.length-1))},s.getMapSessionAPI=Ti,s.getPerformanceMeasurement=Eh,s.getProjection=qS,s.getRTLTextPluginStatus=k,s.getReferrer=si,s.getTilePoint=function(i,{x:n,y:o},c=0){return new Me(((n-c)*i.scale-i.x)*ln,(o*i.scale-i.y)*ln)},s.getTileVec3=function(i,n,o=0){return Ou(((n.x-o)*i.scale-i.x)*ln,(n.y*i.scale-i.y)*ln,zd(n.z,n.y))},s.getVideo=function(i,n){const o=S.document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let c=0;c<i.length;c++){const p=S.document.createElement("source");Ao(i[c])||(o.crossOrigin="Anonymous"),p.src=i[c],o.appendChild(p)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const n=[0,0,0],o=Ea(new Float64Array(16));return Fl(o,i.pixelMatrix,i.globeMatrix),Zr(n,n,o),new Me(n[0],n[1])},s.globeDenormalizeECEF=Op,s.globeECEFOrigin=function(i,n){const o=[0,0,0];return Zr(o,o,Xs(Fo(n.canonical))),Zr(o,o,i),o},s.globeMetersToEcef=Dd,s.globeNormalizeECEF=Xs,s.globePixelsToTileUnits=function(i,n){return ln/(512*Math.pow(2,i))*hf(Fo(n))},s.globePoleMatrixForTile=function(i,n,o){const c=Ea(new Float64Array(16)),p=(n/(1<<i)-.5)*Math.PI*2;return rf(c,o.globeMatrix,p),Float32Array.from(c)},s.globeTileBounds=Fo,s.globeTiltAtLngLat=wg,s.globeToMercatorTransition=Od,s.globeUseCustomAntiAliasing=function(i,n,o){const c=Od(o.zoom),p=i.style.map._antialias,_=!!n.extStandardDerivatives,b=n.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return c===0&&!p&&!b&&_},s.identity=Ea,s.identity$1=af,s.invert=Oo,s.isFullscreen=function(){return!!S.document.fullscreenElement||!!S.document.webkitFullscreenElement},s.isLngLatBehindGlobe=zp,s.isMapAuthenticated=function(i){return hs.has(i)},s.isMapboxURL=xe,s.isSafariWithAntialiasingBug=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!cs(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=ur,s.latLngToECEF=Ds,s.len=S_,s.length=Id,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.lngFromMercatorX=es,s.loadVectorTile=mE,s.makeRequest=Fs,s.mapValue=function(i,n,o,c,p){return we((i-n)/(o-n)*(p-c)+c,c,p)},s.mercatorScale=ff,s.mercatorXfromLng=Mr,s.mercatorYfromLat=$r,s.mercatorZfromAltitude=ci,s.mul=fg,s.mul$1=T_,s.multiply=Fl,s.multiply$1=w_,s.multiply$2=pg,s.nextPowerOfTwo=Nt,s.normalize=ms,s.normalize$1=gg,s.normalize$2=Np,s.number=Qn,s.ortho=function(i,n,o,c,p,_,b){var C=1/(n-o),P=1/(c-p),M=1/(_-b);return i[0]=-2*C,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*P,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(n+o)*C,i[13]=(p+c)*P,i[14]=(b+_)*M,i[15]=1,i},s.pbf=hS,s.perspective=function(i,n,o,c,p){var _,b=1/Math.tan(n/2);return i[0]=b/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+c)*(_=1/(c-p)),i[14]=2*p*c*_):(i[10]=-1,i[14]=-2*c),i},s.pick=function(i,n){const o={};for(let c=0;c<n.length;c++){const p=n[c];p in i&&(o[p]=i[p])}return o},s.plugin=D,s.pointGeometry=Ue,s.polesInViewport=function(i){const n=Ea(new Float64Array(16));Fl(n,i.pixelMatrix,i.globeMatrix);const o=[0,ia,0],c=[0,Qt,0];return Zr(o,o,n),Zr(c,c,n),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!zp(i,new fn(i.center.lat,90)),c[0]>0&&c[0]<=i.width&&c[1]>0&&c[1]<=i.height&&!zp(i,new fn(i.center.lat,-90))]},s.polygonContainsPoint=Ul,s.polygonIntersectsBox=P_,s.polygonIntersectsPolygon=Fp,s.polygonizeBounds=function(i,n,o=0,c=!0){const p=new Me(o,o),_=i.sub(p),b=n.add(p),C=[_,new Me(b.x,_.y),b,new Me(_.x,b.y)];return c&&C.push(_.clone()),C},s.posAttributes=cf,s.postMapLoadEvent=oi,s.postPerformanceEvent=Dr,s.postTurnstileEvent=qn,s.potpack=yx,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=gt,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:y,pluginURL:a}),T.on("pluginStateChange",i),i},s.removeAuthState=function(i){hs.delete(i)},s.renderColorRamp=Mg,s.resample=Ys,s.rotateX=kp,s.rotateX$1=E_,s.rotateY=rf,s.rotateY$1=mg,s.rotateZ=function(i,n,o){var c=Math.sin(o),p=Math.cos(o),_=n[0],b=n[1],C=n[2],P=n[3],M=n[4],z=n[5],V=n[6],$=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=_*p+M*c,i[1]=b*p+z*c,i[2]=C*p+V*c,i[3]=P*p+$*c,i[4]=M*p-_*c,i[5]=z*p-b*c,i[6]=V*p-C*c,i[7]=$*p-P*c,i},s.rotateZ$1=function(i,n,o){o*=.5;var c=n[0],p=n[1],_=n[2],b=n[3],C=Math.sin(o),P=Math.cos(o);return i[0]=c*P+p*C,i[1]=p*P-c*C,i[2]=_*P+b*C,i[3]=b*P-_*C,i},s.scale=Oc,s.scale$1=Rp,s.scale$2=Vr,s.scaleAndAdd=Rd,s.set=function(i,n,o,c){return i[0]=n,i[1]=o,i[2]=c,i},s.setCacheLimits=function(i,n){Gr=i,us=n},s.setColumn=function(i,n,o){i[4*n+0]=o[0],i[4*n+1]=o[1],i[4*n+2]=o[2],i[4*n+3]=o[3]},s.setRTLTextPlugin=function(i,n,o=!1){if(y===Do||y===Ta||y===Ad)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=Wo.resolveURL(i),y=Do,Ja=n,x(),o||N()},s.smoothstep=st,s.spec=ht,s.squaredLength=function(i){var n=i[0],o=i[1],c=i[2];return n*n+o*o+c*c},s.storeAuthState=function(i,n){n?hs.add(i):hs.delete(i)},s.sub=Bo,s.subtract=Pp,s.symbolSize=G3,s.tileAABB=function(i,n,o,c,p,_,b,C,P){if(P.name==="globe")return k_(i,n,new D_(o,c,p));const M=Cf({z:o,x:c,y:p},P);return new gs([(_+M.x/M.scale)*n,n*(M.y/M.scale),b],[(_+M.x2/M.scale)*n,n*(M.y2/M.scale),C])},s.tileCornersToBounds=Ld,s.tileTransform=Cf,s.transformMat3=function(i,n,o){var c=n[0],p=n[1],_=n[2];return i[0]=c*o[0]+p*o[3]+_*o[6],i[1]=c*o[1]+p*o[4]+_*o[7],i[2]=c*o[2]+p*o[5]+_*o[8],i},s.transformMat4=Zr,s.transformMat4$1=zc,s.transformQuat=Ip,s.transitionTileAABBinECEF=_g,s.translate=Lc,s.transpose=function(i,n){if(i===n){var o=n[1],c=n[2],p=n[5];i[1]=n[3],i[2]=n[6],i[3]=o,i[5]=n[7],i[6]=c,i[7]=p}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},s.triggerPluginCompletionEvent=h,s.uniqueId=Mt,s.updateGlobeVertexNormal=function(i,n,o,c,p){const _=5*n+2;i.float32[_+0]=o,i.float32[_+1]=c,i.float32[_+2]=p},s.validateCustomStyleLayer=function(i){const n=[],o=i.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},s.validateFilter=i=>Hi(Rs(i)),s.validateFog=i=>Hi(wa(i)),s.validateLayer=i=>Hi(Tp(i)),s.validateLight=i=>Hi(Cd(i)),s.validateSource=i=>Hi(Rl(i)),s.validateStyle=Gi,s.validateTerrain=i=>Hi(Ka(i)),s.values=bt,s.vectorTile=ot,s.version=A,s.warnOnce=Jn,s.window=S,s.wrap=ke})),g(["./shared"],(function(s){function S(be){if(typeof be=="number"||typeof be=="boolean"||typeof be=="string"||be==null)return JSON.stringify(be);if(Array.isArray(be)){let se="[";for(const de of be)se+=`${S(de)},`;return`${se}]`}let re="{";for(const se of Object.keys(be).sort())re+=`${se}:${S(be[se])},`;return`${re}}`}function A(be){let re="";for(const se of s.refProperties)re+=`/${S(be[se])}`;return re}class j{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,se){for(const Te of re)this._layerConfigs[Te.id]=Te,(this._layers[Te.id]=s.createStyleLayer(Te)).compileFilter(),this.keyCache[Te.id]&&delete this.keyCache[Te.id];for(const Te of se)delete this.keyCache[Te],delete this._layerConfigs[Te],delete this._layers[Te];this.familiesBySource={};const de=(function(Te,xe){const ze={};for(let Oe=0;Oe<Te.length;Oe++){const Ze=xe&&xe[Te[Oe].id]||A(Te[Oe]);xe&&(xe[Te[Oe].id]=Ze);let St=ze[Ze];St||(St=ze[Ze]=[]),St.push(Te[Oe])}const Be=[];for(const Oe in ze)Be.push(ze[Oe]);return Be})(s.values(this._layerConfigs),this.keyCache);for(const Te of de){const xe=Te.map((jt=>this._layers[jt.id])),ze=xe[0];if(ze.visibility==="none")continue;const Be=ze.source||"";let Oe=this.familiesBySource[Be];Oe||(Oe=this.familiesBySource[Be]={});const Ze=ze.sourceLayer||"_geojsonTileLayer";let St=Oe[Ze];St||(St=Oe[Ze]=[]),St.push(xe)}}}class O{loadTile(re,se){const{uid:de,encoding:Te,rawImageData:xe,padding:ze,buildQuadTree:Be}=re,Oe=s.window.ImageBitmap&&xe instanceof s.window.ImageBitmap?this.getImageData(xe,ze):xe;se(null,new s.DEMData(de,Oe,Te,ze<1,Be))}getImageData(re,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const de=this.offscreenCanvasContext.getImageData(-se,-se,re.width+2*se,re.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}function L(be,re){if(be.length!==0){W(be[0],re);for(var se=1;se<be.length;se++)W(be[se],!re)}}function W(be,re){for(var se=0,de=0,Te=0,xe=be.length,ze=xe-1;Te<xe;ze=Te++){var Be=(be[Te][0]-be[ze][0])*(be[ze][1]+be[Te][1]),Oe=se+Be;de+=Math.abs(se)>=Math.abs(Be)?se-Oe+Be:Be-Oe+se,se=Oe}se+de>=0!=!!re&&be.reverse()}var U=s.getDefaultExportFromCjs((function be(re,se){var de,Te=re&&re.type;if(Te==="FeatureCollection")for(de=0;de<re.features.length;de++)be(re.features[de],se);else if(Te==="GeometryCollection")for(de=0;de<re.geometries.length;de++)be(re.geometries[de],se);else if(Te==="Feature")be(re.geometry,se);else if(Te==="Polygon")L(re.coordinates,se);else if(Te==="MultiPolygon")for(de=0;de<re.coordinates.length;de++)L(re.coordinates[de],se);return re}));const q=s.VectorTileFeature.prototype.toGeoJSON;var Q={exports:{}},J=s.pointGeometry,Y=s.vectorTile.VectorTileFeature,ie=_e;function _e(be,re){this.options=re||{},this.features=be,this.length=be.length}function Se(be,re){this.id=typeof be.id=="number"?be.id:void 0,this.type=be.type,this.rawGeometry=be.type===1?[be.geometry]:be.geometry,this.properties=be.tags,this.extent=re||4096}_e.prototype.feature=function(be){return new Se(this.features[be],this.options.extent)},Se.prototype.loadGeometry=function(){var be=this.rawGeometry;this.geometry=[];for(var re=0;re<be.length;re++){for(var se=be[re],de=[],Te=0;Te<se.length;Te++)de.push(new J(se[Te][0],se[Te][1]));this.geometry.push(de)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var be=this.geometry,re=1/0,se=-1/0,de=1/0,Te=-1/0,xe=0;xe<be.length;xe++)for(var ze=be[xe],Be=0;Be<ze.length;Be++){var Oe=ze[Be];re=Math.min(re,Oe.x),se=Math.max(se,Oe.x),de=Math.min(de,Oe.y),Te=Math.max(Te,Oe.y)}return[re,de,se,Te]},Se.prototype.toGeoJSON=Y.prototype.toGeoJSON;var Ie=s.pbf,Ue=ie;function Je(be){var re=new Ie;return(function(se,de){for(var Te in se.layers)de.writeMessage(3,Me,se.layers[Te])})(be,re),re.finish()}function Me(be,re){var se;re.writeVarintField(15,be.version||1),re.writeStringField(1,be.name||""),re.writeVarintField(5,be.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<be.length;se++)de.feature=be.feature(se),re.writeMessage(2,lt,de);var Te=de.keys;for(se=0;se<Te.length;se++)re.writeStringField(3,Te[se]);var xe=de.values;for(se=0;se<xe.length;se++)re.writeMessage(4,it,xe[se])}function lt(be,re){var se=be.feature;se.id!==void 0&&re.writeVarintField(1,se.id),re.writeMessage(2,ft,be),re.writeVarintField(3,se.type),re.writeMessage(4,Lt,se)}function ft(be,re){var se=be.feature,de=be.keys,Te=be.values,xe=be.keycache,ze=be.valuecache;for(var Be in se.properties){var Oe=se.properties[Be],Ze=xe[Be];if(Oe!==null){Ze===void 0&&(de.push(Be),xe[Be]=Ze=de.length-1),re.writeVarint(Ze);var St=typeof Oe;St!=="string"&&St!=="boolean"&&St!=="number"&&(Oe=JSON.stringify(Oe));var jt=St+":"+Oe,xt=ze[jt];xt===void 0&&(Te.push(Oe),ze[jt]=xt=Te.length-1),re.writeVarint(xt)}}}function mt(be,re){return(re<<3)+(7&be)}function gt(be){return be<<1^be>>31}function Lt(be,re){for(var se=be.loadGeometry(),de=be.type,Te=0,xe=0,ze=se.length,Be=0;Be<ze;Be++){var Oe=se[Be],Ze=1;de===1&&(Ze=Oe.length),re.writeVarint(mt(1,Ze));for(var St=de===3?Oe.length-1:Oe.length,jt=0;jt<St;jt++){jt===1&&de!==1&&re.writeVarint(mt(2,St-1));var xt=Oe[jt].x-Te,bn=Oe[jt].y-xe;re.writeVarint(gt(xt)),re.writeVarint(gt(bn)),Te+=xt,xe+=bn}de===3&&re.writeVarint(mt(7,1))}}function it(be,re){var se=typeof be;se==="string"?re.writeStringField(1,be):se==="boolean"?re.writeBooleanField(7,be):se==="number"&&(be%1!=0?re.writeDoubleField(3,be):be<0?re.writeSVarintField(6,be):re.writeVarintField(5,be))}Q.exports=Je,Q.exports.fromVectorTileJs=Je,Q.exports.fromGeojsonVt=function(be,re){re=re||{};var se={};for(var de in be)se[de]=new Ue(be[de].features,re),se[de].name=de,se[de].version=re.version,se[de].extent=re.extent;return Je({layers:se})},Q.exports.GeoJSONWrapper=Ue;var We=s.getDefaultExportFromCjs(Q.exports);const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:be=>be},we=Math.fround||(st=new Float32Array(1),be=>(st[0]=+be,st[0]));var st;const ke=3,Ve=5,bt=6;class wt{constructor(re){this.options=Object.assign(Object.create(Le),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:se,minZoom:de,maxZoom:Te}=this.options;se&&console.time("total time");const xe=`prepare ${re.length} points`;se&&console.time(xe),this.points=re;const ze=[];for(let Oe=0;Oe<re.length;Oe++){const Ze=re[Oe];if(!Ze.geometry)continue;const[St,jt]=Ze.geometry.coordinates,xt=we(ct(St)),bn=we(Nt(jt));ze.push(xt,bn,1/0,Oe,-1,1),this.options.reduce&&ze.push(0)}let Be=this.trees[Te+1]=this._createTree(ze);se&&console.timeEnd(xe);for(let Oe=Te;Oe>=de;Oe--){const Ze=+Date.now();Be=this.trees[Oe]=this._createTree(this._cluster(Be,Oe)),se&&console.log("z%d: %d clusters in %dms",Oe,Be.numItems,+Date.now()-Ze)}return se&&console.timeEnd("total time"),this}getClusters(re,se){let de=((re[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,re[1]));let xe=re[2]===180?180:((re[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)de=-180,xe=180;else if(de>xe){const jt=this.getClusters([de,Te,180,ze],se),xt=this.getClusters([-180,Te,xe,ze],se);return jt.concat(xt)}const Be=this.trees[this._limitZoom(se)],Oe=Be.range(ct(de),Nt(ze),ct(xe),Nt(Te)),Ze=Be.data,St=[];for(const jt of Oe){const xt=this.stride*jt;St.push(Ze[xt+Ve]>1?Yt(Ze,xt,this.clusterProps):this.points[Ze[xt+ke]])}return St}getChildren(re){const se=this._getOriginId(re),de=this._getOriginZoom(re),Te="No cluster with the specified id.",xe=this.trees[de];if(!xe)throw new Error(Te);const ze=xe.data;if(se*this.stride>=ze.length)throw new Error(Te);const Be=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Oe=xe.within(ze[se*this.stride],ze[se*this.stride+1],Be),Ze=[];for(const St of Oe){const jt=St*this.stride;ze[jt+4]===re&&Ze.push(ze[jt+Ve]>1?Yt(ze,jt,this.clusterProps):this.points[ze[jt+ke]])}if(Ze.length===0)throw new Error(Te);return Ze}getLeaves(re,se,de){const Te=[];return this._appendLeaves(Te,re,se=se||10,de=de||0,0),Te}getTile(re,se,de){const Te=this.trees[this._limitZoom(re)],xe=Math.pow(2,re),{extent:ze,radius:Be}=this.options,Oe=Be/ze,Ze=(de-Oe)/xe,St=(de+1+Oe)/xe,jt={features:[]};return this._addTileFeatures(Te.range((se-Oe)/xe,Ze,(se+1+Oe)/xe,St),Te.data,se,de,xe,jt),se===0&&this._addTileFeatures(Te.range(1-Oe/xe,Ze,1,St),Te.data,xe,de,xe,jt),se===xe-1&&this._addTileFeatures(Te.range(0,Ze,Oe/xe,St),Te.data,-1,de,xe,jt),jt.features.length?jt:null}getClusterExpansionZoom(re){let se=this._getOriginZoom(re)-1;for(;se<=this.options.maxZoom;){const de=this.getChildren(re);if(se++,de.length!==1)break;re=de[0].properties.cluster_id}return se}_appendLeaves(re,se,de,Te,xe){const ze=this.getChildren(se);for(const Be of ze){const Oe=Be.properties;if(Oe&&Oe.cluster?xe+Oe.point_count<=Te?xe+=Oe.point_count:xe=this._appendLeaves(re,Oe.cluster_id,de,Te,xe):xe<Te?xe++:re.push(Be),re.length===de)break}return xe}_createTree(re){const se=new s.KDBush(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<re.length;de+=this.stride)se.add(re[de],re[de+1]);return se.finish(),se.data=re,se}_addTileFeatures(re,se,de,Te,xe,ze){for(const Be of re){const Oe=Be*this.stride,Ze=se[Oe+Ve]>1;let St,jt,xt;if(Ze)St=Mt(se,Oe,this.clusterProps),jt=se[Oe],xt=se[Oe+1];else{const An=this.points[se[Oe+ke]];St=An.properties;const[Nn,qn]=An.geometry.coordinates;jt=ct(Nn),xt=Nt(qn)}const bn={type:1,geometry:[[Math.round(this.options.extent*(jt*xe-de)),Math.round(this.options.extent*(xt*xe-Te))]],tags:St};let Pn;Pn=Ze||this.options.generateId?se[Oe+ke]:this.points[se[Oe+ke]].id,Pn!==void 0&&(bn.id=Pn),ze.features.push(bn)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,se){const{radius:de,extent:Te,reduce:xe,minPoints:ze}=this.options,Be=de/(Te*Math.pow(2,se)),Oe=re.data,Ze=[],St=this.stride;for(let jt=0;jt<Oe.length;jt+=St){if(Oe[jt+2]<=se)continue;Oe[jt+2]=se;const xt=Oe[jt],bn=Oe[jt+1],Pn=re.within(Oe[jt],Oe[jt+1],Be),An=Oe[jt+Ve];let Nn=An;for(const qn of Pn){const Br=qn*St;Oe[Br+2]>se&&(Nn+=Oe[Br+Ve])}if(Nn>An&&Nn>=ze){let qn,Br=xt*An,oi=bn*An,Yi=-1;const Dr=((jt/St|0)<<5)+(se+1)+this.points.length;for(const Po of Pn){const Ti=Po*St;if(Oe[Ti+2]<=se)continue;Oe[Ti+2]=se;const hs=Oe[Ti+Ve];Br+=Oe[Ti]*hs,oi+=Oe[Ti+1]*hs,Oe[Ti+4]=Dr,xe&&(qn||(qn=this._map(Oe,jt,!0),Yi=this.clusterProps.length,this.clusterProps.push(qn)),xe(qn,this._map(Oe,Ti)))}Oe[jt+4]=Dr,Ze.push(Br/Nn,oi/Nn,1/0,Dr,-1,Nn),xe&&Ze.push(Yi)}else{for(let qn=0;qn<St;qn++)Ze.push(Oe[jt+qn]);if(Nn>1)for(const qn of Pn){const Br=qn*St;if(!(Oe[Br+2]<=se)){Oe[Br+2]=se;for(let oi=0;oi<St;oi++)Ze.push(Oe[Br+oi])}}}}return Ze}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,se,de){if(re[se+Ve]>1){const ze=this.clusterProps[re[se+bt]];return de?Object.assign({},ze):ze}const Te=this.points[re[se+ke]].properties,xe=this.options.map(Te);return de&&xe===Te?Object.assign({},xe):xe}}function Yt(be,re,se){return{type:"Feature",id:be[re+ke],properties:Mt(be,re,se),geometry:{type:"Point",coordinates:[(de=be[re],360*(de-.5)),xn(be[re+1])]}};var de}function Mt(be,re,se){const de=be[re+Ve],Te=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,xe=be[re+bt],ze=xe===-1?{}:Object.assign({},se[xe]);return Object.assign(ze,{cluster:!0,cluster_id:be[re+ke],point_count:de,point_count_abbreviated:Te})}function ct(be){return be/360+.5}function Nt(be){const re=Math.sin(be*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function xn(be){const re=(180-360*be)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function un(be,re,se,de){for(var Te,xe=de,ze=se-re>>1,Be=se-re,Oe=be[re],Ze=be[re+1],St=be[se],jt=be[se+1],xt=re+3;xt<se;xt+=3){var bn=Rn(be[xt],be[xt+1],Oe,Ze,St,jt);if(bn>xe)Te=xt,xe=bn;else if(bn===xe){var Pn=Math.abs(xt-ze);Pn<Be&&(Te=xt,Be=Pn)}}xe>de&&(Te-re>3&&un(be,re,Te,de),be[Te+2]=xe,se-Te>3&&un(be,Te,se,de))}function Rn(be,re,se,de,Te,xe){var ze=Te-se,Be=xe-de;if(ze!==0||Be!==0){var Oe=((be-se)*ze+(re-de)*Be)/(ze*ze+Be*Be);Oe>1?(se=Te,de=xe):Oe>0&&(se+=ze*Oe,de+=Be*Oe)}return(ze=be-se)*ze+(Be=re-de)*Be}function sn(be,re,se,de){var Te={id:be===void 0?null:be,type:re,geometry:se,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(xe){var ze=xe.geometry,Be=xe.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")kr(xe,ze);else if(Be==="Polygon"||Be==="MultiLineString")for(var Oe=0;Oe<ze.length;Oe++)kr(xe,ze[Oe]);else if(Be==="MultiPolygon")for(Oe=0;Oe<ze.length;Oe++)for(var Ze=0;Ze<ze[Oe].length;Ze++)kr(xe,ze[Oe][Ze])})(Te),Te}function kr(be,re){for(var se=0;se<re.length;se+=3)be.minX=Math.min(be.minX,re[se]),be.minY=Math.min(be.minY,re[se+1]),be.maxX=Math.max(be.maxX,re[se]),be.maxY=Math.max(be.maxY,re[se+1])}function vr(be,re,se,de){if(re.geometry){var Te=re.geometry.coordinates,xe=re.geometry.type,ze=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),Be=[],Oe=re.id;if(se.promoteId?Oe=re.properties[se.promoteId]:se.generateId&&(Oe=de||0),xe==="Point")Es(Te,Be);else if(xe==="MultiPoint")for(var Ze=0;Ze<Te.length;Ze++)Es(Te[Ze],Be);else if(xe==="LineString")Jn(Te,Be,ze,!1);else if(xe==="MultiLineString"){if(se.lineMetrics){for(Ze=0;Ze<Te.length;Ze++)Jn(Te[Ze],Be=[],ze,!1),be.push(sn(Oe,"LineString",Be,re.properties));return}Ar(Te,Be,ze,!1)}else if(xe==="Polygon")Ar(Te,Be,ze,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(Ze=0;Ze<re.geometry.geometries.length;Ze++)vr(be,{id:Oe,geometry:re.geometry.geometries[Ze],properties:re.properties},se,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ze=0;Ze<Te.length;Ze++){var St=[];Ar(Te[Ze],St,ze,!0),Be.push(St)}}be.push(sn(Oe,xe,Be,re.properties))}}function Es(be,re){re.push(io(be[0])),re.push(wi(be[1])),re.push(0)}function Jn(be,re,se,de){for(var Te,xe,ze=0,Be=0;Be<be.length;Be++){var Oe=io(be[Be][0]),Ze=wi(be[Be][1]);re.push(Oe),re.push(Ze),re.push(0),Be>0&&(ze+=de?(Te*Ze-Oe*xe)/2:Math.sqrt(Math.pow(Oe-Te,2)+Math.pow(Ze-xe,2))),Te=Oe,xe=Ze}var St=re.length-3;re[2]=1,un(re,0,St,se),re[St+2]=1,re.size=Math.abs(ze),re.start=0,re.end=re.size}function Ar(be,re,se,de){for(var Te=0;Te<be.length;Te++){var xe=[];Jn(be[Te],xe,se,de),re.push(xe)}}function io(be){return be/360+.5}function wi(be){var re=Math.sin(be*Math.PI/180),se=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return se<0?0:se>1?1:se}function Xr(be,re,se,de,Te,xe,ze,Be){if(de/=re,xe>=(se/=re)&&ze<de)return be;if(ze<se||xe>=de)return null;for(var Oe=[],Ze=0;Ze<be.length;Ze++){var St=be[Ze],jt=St.geometry,xt=St.type,bn=Te===0?St.minX:St.minY,Pn=Te===0?St.maxX:St.maxY;if(bn>=se&&Pn<de)Oe.push(St);else if(!(Pn<se||bn>=de)){var An=[];if(xt==="Point"||xt==="MultiPoint")ii(jt,An,se,de,Te);else if(xt==="LineString")cs(jt,An,se,de,Te,!1,Be.lineMetrics);else if(xt==="MultiLineString")zs(jt,An,se,de,Te,!1);else if(xt==="Polygon")zs(jt,An,se,de,Te,!0);else if(xt==="MultiPolygon")for(var Nn=0;Nn<jt.length;Nn++){var qn=[];zs(jt[Nn],qn,se,de,Te,!0),qn.length&&An.push(qn)}if(An.length){if(Be.lineMetrics&&xt==="LineString"){for(Nn=0;Nn<An.length;Nn++)Oe.push(sn(St.id,xt,An[Nn],St.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(An.length===1?(xt="LineString",An=An[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=An.length===3?"Point":"MultiPoint"),Oe.push(sn(St.id,xt,An,St.tags))}}}return Oe.length?Oe:null}function ii(be,re,se,de,Te){for(var xe=0;xe<be.length;xe+=3){var ze=be[xe+Te];ze>=se&&ze<=de&&(re.push(be[xe]),re.push(be[xe+1]),re.push(be[xe+2]))}}function cs(be,re,se,de,Te,xe,ze){for(var Be,Oe,Ze=Ki(be),St=Te===0?Gr:us,jt=be.start,xt=0;xt<be.length-3;xt+=3){var bn=be[xt],Pn=be[xt+1],An=be[xt+2],Nn=be[xt+3],qn=be[xt+4],Br=Te===0?bn:Pn,oi=Te===0?Nn:qn,Yi=!1;ze&&(Be=Math.sqrt(Math.pow(bn-Nn,2)+Math.pow(Pn-qn,2))),Br<se?oi>se&&(Oe=St(Ze,bn,Pn,Nn,qn,se),ze&&(Ze.start=jt+Be*Oe)):Br>de?oi<de&&(Oe=St(Ze,bn,Pn,Nn,qn,de),ze&&(Ze.start=jt+Be*Oe)):Cs(Ze,bn,Pn,An),oi<se&&Br>=se&&(Oe=St(Ze,bn,Pn,Nn,qn,se),Yi=!0),oi>de&&Br<=de&&(Oe=St(Ze,bn,Pn,Nn,qn,de),Yi=!0),!xe&&Yi&&(ze&&(Ze.end=jt+Be*Oe),re.push(Ze),Ze=Ki(be)),ze&&(jt+=Be)}var Dr=be.length-3;bn=be[Dr],Pn=be[Dr+1],An=be[Dr+2],(Br=Te===0?bn:Pn)>=se&&Br<=de&&Cs(Ze,bn,Pn,An),Dr=Ze.length-3,xe&&Dr>=3&&(Ze[Dr]!==Ze[0]||Ze[Dr+1]!==Ze[1])&&Cs(Ze,Ze[0],Ze[1],Ze[2]),Ze.length&&re.push(Ze)}function Ki(be){var re=[];return re.size=be.size,re.start=be.start,re.end=be.end,re}function zs(be,re,se,de,Te,xe){for(var ze=0;ze<be.length;ze++)cs(be[ze],re,se,de,Te,xe,!1)}function Cs(be,re,se,de){be.push(re),be.push(se),be.push(de)}function Gr(be,re,se,de,Te,xe){var ze=(xe-re)/(de-re);return be.push(xe),be.push(se+(Te-se)*ze),be.push(1),ze}function us(be,re,se,de,Te,xe){var ze=(xe-se)/(Te-se);return be.push(re+(de-re)*ze),be.push(xe),be.push(1),ze}function bi(be,re){for(var se=[],de=0;de<be.length;de++){var Te,xe=be[de],ze=xe.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")Te=Bs(xe.geometry,re);else if(ze==="MultiLineString"||ze==="Polygon"){Te=[];for(var Be=0;Be<xe.geometry.length;Be++)Te.push(Bs(xe.geometry[Be],re))}else if(ze==="MultiPolygon")for(Te=[],Be=0;Be<xe.geometry.length;Be++){for(var Oe=[],Ze=0;Ze<xe.geometry[Be].length;Ze++)Oe.push(Bs(xe.geometry[Be][Ze],re));Te.push(Oe)}se.push(sn(xe.id,ze,Te,xe.tags))}return se}function Bs(be,re){var se=[];se.size=be.size,be.start!==void 0&&(se.start=be.start,se.end=be.end);for(var de=0;de<be.length;de+=3)se.push(be[de]+re,be[de+1],be[de+2]);return se}function Xi(be,re){if(be.transformed)return be;var se,de,Te,xe=1<<be.z,ze=be.x,Be=be.y;for(se=0;se<be.features.length;se++){var Oe=be.features[se],Ze=Oe.geometry,St=Oe.type;if(Oe.geometry=[],St===1)for(de=0;de<Ze.length;de+=2)Oe.geometry.push(Mi(Ze[de],Ze[de+1],re,xe,ze,Be));else for(de=0;de<Ze.length;de++){var jt=[];for(Te=0;Te<Ze[de].length;Te+=2)jt.push(Mi(Ze[de][Te],Ze[de][Te+1],re,xe,ze,Be));Oe.geometry.push(jt)}}return be.transformed=!0,be}function Mi(be,re,se,de,Te,xe){return[Math.round(se*(be*de-Te)),Math.round(se*(re*de-xe))]}function ko(be,re,se,de,Te){for(var xe=re===Te.maxZoom?0:Te.tolerance/((1<<re)*Te.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:de,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<be.length;Be++){ze.numFeatures++,so(ze,be[Be],xe,Te);var Oe=be[Be].minX,Ze=be[Be].minY,St=be[Be].maxX,jt=be[Be].maxY;Oe<ze.minX&&(ze.minX=Oe),Ze<ze.minY&&(ze.minY=Ze),St>ze.maxX&&(ze.maxX=St),jt>ze.maxY&&(ze.maxY=jt)}return ze}function so(be,re,se,de){var Te=re.geometry,xe=re.type,ze=[];if(xe==="Point"||xe==="MultiPoint")for(var Be=0;Be<Te.length;Be+=3)ze.push(Te[Be]),ze.push(Te[Be+1]),be.numPoints++,be.numSimplified++;else if(xe==="LineString")Ii(ze,Te,be,se,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(Be=0;Be<Te.length;Be++)Ii(ze,Te[Be],be,se,xe==="Polygon",Be===0);else if(xe==="MultiPolygon")for(var Oe=0;Oe<Te.length;Oe++){var Ze=Te[Oe];for(Be=0;Be<Ze.length;Be++)Ii(ze,Ze[Be],be,se,!0,Be===0)}if(ze.length){var St=re.tags||null;if(xe==="LineString"&&de.lineMetrics){for(var jt in St={},re.tags)St[jt]=re.tags[jt];St.mapbox_clip_start=Te.start/Te.size,St.mapbox_clip_end=Te.end/Te.size}var xt={geometry:ze,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:St};re.id!==null&&(xt.id=re.id),be.features.push(xt)}}function Ii(be,re,se,de,Te,xe){var ze=de*de;if(de>0&&re.size<(Te?ze:de))se.numPoints+=re.length/3;else{for(var Be=[],Oe=0;Oe<re.length;Oe+=3)(de===0||re[Oe+2]>ze)&&(se.numSimplified++,Be.push(re[Oe]),Be.push(re[Oe+1])),se.numPoints++;Te&&(function(Ze,St){for(var jt=0,xt=0,bn=Ze.length,Pn=bn-2;xt<bn;Pn=xt,xt+=2)jt+=(Ze[xt]-Ze[Pn])*(Ze[xt+1]+Ze[Pn+1]);if(jt>0===St)for(xt=0,bn=Ze.length;xt<bn/2;xt+=2){var An=Ze[xt],Nn=Ze[xt+1];Ze[xt]=Ze[bn-2-xt],Ze[xt+1]=Ze[bn-1-xt],Ze[bn-2-xt]=An,Ze[bn-1-xt]=Nn}})(Be,xe),be.push(Be)}}function ds(be,re){var se=(re=this.options=(function(Te,xe){for(var ze in xe)Te[ze]=xe[ze];return Te})(Object.create(this.options),re)).debug;if(se&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var de=(function(Te,xe){var ze=[];if(Te.type==="FeatureCollection")for(var Be=0;Be<Te.features.length;Be++)vr(ze,Te.features[Be],xe,Be);else vr(ze,Te.type==="Feature"?Te:{geometry:Te},xe);return ze})(be,re);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=(function(Te,xe){var ze=xe.buffer/xe.extent,Be=Te,Oe=Xr(Te,1,-1-ze,ze,0,-1,2,xe),Ze=Xr(Te,1,1-ze,2+ze,0,-1,2,xe);return(Oe||Ze)&&(Be=Xr(Te,1,-ze,1+ze,0,-1,2,xe)||[],Oe&&(Be=bi(Oe,1).concat(Be)),Ze&&(Be=Be.concat(bi(Ze,-1)))),Be})(de,re),de.length&&this.splitTile(de,0,0,0),se&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function si(be,re,se){return 32*((1<<be)*se+re)+be}function Fs(be,re){const se=be.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);const de=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!de)return re(null,null);const Te=new class{constructor(ze){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ze.length,this._features=ze}feature(ze){return new class{constructor(Be){this._feature=Be,this.extent=s.EXTENT,this.type=Be.type,this.properties=Be.tags,"id"in Be&&!isNaN(Be.id)&&(this.id=parseInt(Be.id,10))}loadGeometry(){if(this._feature.type===1){const Be=[];for(const Oe of this._feature.geometry)Be.push([new s.Point(Oe[0],Oe[1])]);return Be}{const Be=[];for(const Oe of this._feature.geometry){const Ze=[];for(const St of Oe)Ze.push(new s.Point(St[0],St[1]));Be.push(Ze)}return Be}}toGeoJSON(Be,Oe,Ze){return q.call(this,Be,Oe,Ze)}}(this._features[ze])}}(de.features);let xe=We(Te);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),re(null,{vectorTile:Te,rawData:xe.buffer})}ds.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ds.prototype.splitTile=function(be,re,se,de,Te,xe,ze){for(var Be=[be,re,se,de],Oe=this.options,Ze=Oe.debug;Be.length;){de=Be.pop(),se=Be.pop(),re=Be.pop(),be=Be.pop();var St=1<<re,jt=si(re,se,de),xt=this.tiles[jt];if(!xt&&(Ze>1&&console.time("creation"),xt=this.tiles[jt]=ko(be,re,se,de,Oe),this.tileCoords.push({z:re,x:se,y:de}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,se,de,xt.numFeatures,xt.numPoints,xt.numSimplified),console.timeEnd("creation"));var bn="z"+re;this.stats[bn]=(this.stats[bn]||0)+1,this.total++}if(xt.source=be,Te){if(re===Oe.maxZoom||re===Te)continue;var Pn=1<<Te-re;if(se!==Math.floor(xe/Pn)||de!==Math.floor(ze/Pn))continue}else if(re===Oe.indexMaxZoom||xt.numPoints<=Oe.indexMaxPoints)continue;if(xt.source=null,be.length!==0){Ze>1&&console.time("clipping");var An,Nn,qn,Br,oi,Yi,Dr=.5*Oe.buffer/Oe.extent,Po=.5-Dr,Ti=.5+Dr,hs=1+Dr;An=Nn=qn=Br=null,oi=Xr(be,St,se-Dr,se+Ti,0,xt.minX,xt.maxX,Oe),Yi=Xr(be,St,se+Po,se+hs,0,xt.minX,xt.maxX,Oe),be=null,oi&&(An=Xr(oi,St,de-Dr,de+Ti,1,xt.minY,xt.maxY,Oe),Nn=Xr(oi,St,de+Po,de+hs,1,xt.minY,xt.maxY,Oe),oi=null),Yi&&(qn=Xr(Yi,St,de-Dr,de+Ti,1,xt.minY,xt.maxY,Oe),Br=Xr(Yi,St,de+Po,de+hs,1,xt.minY,xt.maxY,Oe),Yi=null),Ze>1&&console.timeEnd("clipping"),Be.push(An||[],re+1,2*se,2*de),Be.push(Nn||[],re+1,2*se,2*de+1),Be.push(qn||[],re+1,2*se+1,2*de),Be.push(Br||[],re+1,2*se+1,2*de+1)}}},ds.prototype.getTile=function(be,re,se){var de=this.options,Te=de.extent,xe=de.debug;if(be<0||be>24)return null;var ze=1<<be,Be=si(be,re=(re%ze+ze)%ze,se);if(this.tiles[Be])return Xi(this.tiles[Be],Te);xe>1&&console.log("drilling down to z%d-%d-%d",be,re,se);for(var Oe,Ze=be,St=re,jt=se;!Oe&&Ze>0;)Ze--,St=Math.floor(St/2),jt=Math.floor(jt/2),Oe=this.tiles[si(Ze,St,jt)];return Oe&&Oe.source?(xe>1&&console.log("found parent tile z%d-%d-%d",Ze,St,jt),xe>1&&console.time("drilling down"),this.splitTile(Oe.source,Ze,St,jt,be,re,se),xe>1&&console.timeEnd("drilling down"),this.tiles[Be]?Xi(this.tiles[Be],Te):null):null};class oo extends s.VectorTileWorkerSource{constructor(re,se,de,Te,xe){super(re,se,de,Te,Fs),xe&&(this.loadGeoJSON=xe)}loadData(re,se){const de=re&&re.request,Te=de&&de.collectResourceTiming;this.loadGeoJSON(re,((xe,ze)=>{if(xe||!ze)return se(xe);if(typeof ze!="object")return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{U(ze,!0);try{if(re.filter){const Oe=s.createExpression(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map((St=>`${St.key}: ${St.message}`)).join(", "));ze={type:"FeatureCollection",features:ze.features.filter((St=>Oe.value.evaluate({zoom:0},St)))}}this._geoJSONIndex=re.cluster?new wt((function({superclusterOptions:Oe,clusterProperties:Ze}){if(!Ze||!Oe)return Oe;const St={},jt={},xt={accumulated:null,zoom:0},bn={properties:null},Pn=Object.keys(Ze);for(const An of Pn){const[Nn,qn]=Ze[An],Br=s.createExpression(qn),oi=s.createExpression(typeof Nn=="string"?[Nn,["accumulated"],["get",An]]:Nn);St[An]=Br.value,jt[An]=oi.value}return Oe.map=An=>{bn.properties=An;const Nn={};for(const qn of Pn)Nn[qn]=St[qn].evaluate(xt,bn);return Nn},Oe.reduce=(An,Nn)=>{bn.properties=Nn;for(const qn of Pn)xt.accumulated=An[qn],An[qn]=jt[qn].evaluate(xt,bn)},Oe})(re)).load(ze.features):(function(Oe,Ze){return new ds(Oe,Ze)})(ze,re.geojsonVtOptions)}catch(Oe){return se(Oe)}this.loaded={};const Be={};if(Te){const Oe=s.getPerformanceMeasurement(de);Oe&&(Be.resourceTiming={},Be.resourceTiming[re.source]=JSON.parse(JSON.stringify(Oe)))}se(null,Be)}}))}reloadTile(re,se){const de=this.loaded;return de&&de[re.uid]?super.reloadTile(re,se):this.loadTile(re,se)}loadGeoJSON(re,se){if(re.request)s.getJSON(re.request,se);else{if(typeof re.data!="string")return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return se(null,JSON.parse(re.data))}catch{return se(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(de){se(de)}}getClusterChildren(re,se){try{se(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(de){se(de)}}getClusterLeaves(re,se){try{se(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(de){se(de)}}}class Ao{constructor(re){this.self=re,this.actor=new s.Actor(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:oo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(se,de)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=de},this.self.registerRTLTextPlugin=se=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=se.applyArabicShaping,s.plugin.processBidirectionalText=se.processBidirectionalText,s.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}}clearCaches(re,se,de){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],de()}checkIfReady(re,se,de){de()}setReferrer(re,se){this.referrer=se}spriteLoaded(re,se){this.isSpriteLoaded[re]=se;for(const de in this.workerSources[re]){const Te=this.workerSources[re][de];for(const xe in Te)Te[xe]instanceof s.VectorTileWorkerSource&&(Te[xe].isSpriteLoaded=se,Te[xe].fire(new s.Event("isSpriteLoaded")))}}setImages(re,se,de){this.availableImages[re]=se;for(const Te in this.workerSources[re]){const xe=this.workerSources[re][Te];for(const ze in xe)xe[ze].availableImages=se}de()}enableTerrain(re,se,de){this.terrain=se,de()}setProjection(re,se){this.projections[re]=s.getProjection(se)}setLayers(re,se,de){this.getLayerIndex(re).replace(se),de()}updateLayers(re,se,de){this.getLayerIndex(re).update(se.layers,se.removedIds),de()}loadTile(re,se,de){const Te=this.enableTerrain?s.extend({enableTerrain:this.terrain},se):se;Te.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,se.type,se.source).loadTile(Te,de)}loadDEMTile(re,se,de){const Te=this.enableTerrain?s.extend({buildQuadTree:this.terrain},se):se;this.getDEMWorkerSource(re,se.source).loadTile(Te,de)}reloadTile(re,se,de){const Te=this.enableTerrain?s.extend({enableTerrain:this.terrain},se):se;Te.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,se.type,se.source).reloadTile(Te,de)}abortTile(re,se,de){this.getWorkerSource(re,se.type,se.source).abortTile(se,de)}removeTile(re,se,de){this.getWorkerSource(re,se.type,se.source).removeTile(se,de)}removeSource(re,se,de){if(!this.workerSources[re]||!this.workerSources[re][se.type]||!this.workerSources[re][se.type][se.source])return;const Te=this.workerSources[re][se.type][se.source];delete this.workerSources[re][se.type][se.source],Te.removeSource!==void 0?Te.removeSource(se,de):de()}loadWorkerSource(re,se,de){try{this.self.importScripts(se.url),de()}catch(Te){de(Te.toString())}}syncRTLPluginState(re,se,de){try{s.plugin.setState(se);const Te=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&Te!=null){this.self.importScripts(Te);const xe=s.plugin.isParsed();de(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),xe)}}catch(Te){de(Te.toString())}}getAvailableImages(re){let se=this.availableImages[re];return se||(se=[]),se}getLayerIndex(re){let se=this.layerIndexes[re];return se||(se=this.layerIndexes[re]=new j),se}getWorkerSource(re,se,de){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][se]||(this.workerSources[re][se]={}),!this.workerSources[re][se][de]){const Te={send:(xe,ze,Be,Oe,Ze,St)=>{this.actor.send(xe,ze,Be,re,Ze,St)},scheduler:this.actor.scheduler};this.workerSources[re][se][de]=new this.workerSourceTypes[se](Te,this.getLayerIndex(re),this.getAvailableImages(re),this.isSpriteLoaded[re])}return this.workerSources[re][se][de]}getDEMWorkerSource(re,se){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][se]||(this.demWorkerSources[re][se]=new O),this.demWorkerSources[re][se]}enforceCacheSizeLimit(re,se){s.enforceCacheSizeLimit(se)}getWorkerPerformanceMetrics(re,se,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ao(self)),Ao})),g(["./shared"],(function(s){function S(y,a){if(Array.isArray(y)){if(!Array.isArray(a)||y.length!==a.length)return!1;for(let h=0;h<y.length;h++)if(!S(y[h],a[h]))return!1;return!0}if(typeof y=="object"&&y!==null&&a!==null){if(typeof a!="object"||Object.keys(y).length!==Object.keys(a).length)return!1;for(const h in y)if(!S(y[h],a[h]))return!1;return!0}return y===a}var A=j;function j(y){return!(function(a){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,T,k=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(k);try{T=new Worker(N),x=!0}catch{x=!1}return T&&T.terminate(),URL.revokeObjectURL(N),x})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var x=document.createElement("canvas");x.width=x.height=1;var T=x.getContext("2d");if(!T)return!1;var k=T.getImageData(0,0,1,1);return k&&k.width===x.width})()?(O[h=a&&a.failIfMajorPerformanceCaveat]===void 0&&(O[h]=(function(x){var T,k=(function(N){var D=document.createElement("canvas"),B=Object.create(j.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=N,D.getContext("webgl",B)||D.getContext("experimental-webgl",B)})(x);if(!k)return!1;try{T=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!T||k.isContextLost())&&(k.shaderSource(T,"void main() {}"),k.compileShader(T),k.getShaderParameter(T,k.COMPILE_STATUS)===!0)})(h)),O[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h})(y)}var O={};function L(y,a,h){const x=s.window.document.createElement(y);return a!==void 0&&(x.className=a),h&&h.appendChild(x),x}function W(y,a,h){const x=s.window.document.createElementNS("http://www.w3.org/2000/svg",y);for(const T of Object.keys(a))x.setAttributeNS(null,T,a[T]);return h&&h.appendChild(x),x}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const U=s.window.document&&s.window.document.documentElement.style,q=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Q;function J(){U&&q&&(Q=U[q],U[q]="none")}function Y(){U&&q&&(U[q]=Q)}function ie(y){y.preventDefault(),y.stopPropagation(),s.window.removeEventListener("click",ie,!0)}function _e(){s.window.addEventListener("click",ie,!0),s.window.setTimeout((()=>{s.window.removeEventListener("click",ie,!0)}),0)}function Se(y,a){const h=y.getBoundingClientRect();return Je(y,h,a)}function Ie(y,a){const h=y.getBoundingClientRect(),x=[];for(let T=0;T<a.length;T++)x.push(Je(y,h,a[T]));return x}function Ue(y){return s.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button}function Je(y,a,h){const x=y.offsetWidth===a.width?1:y.offsetWidth/a.width;return new s.Point((h.clientX-a.left)*x,(h.clientY-a.top)*x)}function Me(y,a){var h=a[0],x=a[1],T=a[2],k=a[3],N=h*k-T*x;return N?(y[0]=k*(N=1/N),y[1]=-x*N,y[2]=-T*N,y[3]=h*N,y):null}function lt(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class ft extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,callback:x}of this.requestors)this._notify(h,x);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,h){this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),x=!1),this._validateContent(h.content,h)||(this.fire(new s.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),x=!1),x}_validateStretch(a,h){if(!a)return!0;let x=0;for(const T of a){if(T[0]<x||T[1]<T[0]||h<T[1])return!1;x=T[1]}return!0}_validateContent(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,h){let x=!0;if(!this.isLoaded())for(const T of a)this.images[T]||(x=!1);this.isLoaded()||x?this._notify(a,h):this.requestors.push({ids:a,callback:h})}_notify(a,h){const x={};for(const T of a){this.images[T]||this.fire(new s.Event("styleimagemissing",{id:T}));const k=this.images[T];k?x[T]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:!!(k.userImage&&k.userImage.render)}:s.warnOnce(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,x)}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],x=this.getImage(a);if(!x)return null;if(h&&h.position.version===x.version)return h.position;if(h)h.position.version=x.version;else{const T={w:x.data.width+2,h:x.data.height+2,x:0,y:0},k=new s.ImagePosition(T,x);this.patterns[a]={bin:T,position:k}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture&&this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const k in this.patterns)a.push(this.patterns[k].bin);const{w:h,h:x}=s.potpack(a),T=this.atlasImage;T.resize({width:h||1,height:x||1});for(const k in this.patterns){const{bin:N}=this.patterns[k],D=N.x+1,B=N.y+1,H=this.images[k].data,G=H.width,ee=H.height;s.RGBAImage.copy(H,T,{x:0,y:0},{x:D,y:B},{width:G,height:ee}),s.RGBAImage.copy(H,T,{x:0,y:ee-1},{x:D,y:B-1},{width:G,height:1}),s.RGBAImage.copy(H,T,{x:0,y:0},{x:D,y:B+ee},{width:G,height:1}),s.RGBAImage.copy(H,T,{x:G-1,y:0},{x:D-1,y:B},{width:1,height:ee}),s.RGBAImage.copy(H,T,{x:0,y:0},{x:D+G,y:B},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const x=this.images[h];lt(x)&&this.updateImage(h,x)}}}const mt=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(y,a){return(function([h,x,T]){const k=s.degToRad(x+90),N=s.degToRad(T);return{x:h*Math.cos(k)*Math.sin(N),y:h*Math.sin(k)*Math.sin(N),z:h*Math.cos(N),azimuthal:x,polar:T}})(y.expression.evaluate(a))}interpolate(y,a,h){return{x:s.number(y.x,a.x,h),y:s.number(y.y,a.y,h),z:s.number(y.z,a.z,h),azimuthal:s.number(y.azimuthal,a.azimuthal,h),polar:s.number(y.polar,a.polar,h)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class gt extends s.Evented{constructor(a){super(),this._transitionable=new s.Transitionable(mt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(s.validateLight,a,h))for(const x in a){const T=a[x];s.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-11),T):this._transitionable.setValue(x,T)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,x){return(!x||x.validate!==!1)&&s.emitValidationErrors(this,a.call(s.validateStyle,s.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Lt=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let it=class extends s.Evented{constructor(y,a){super(),this._transitionable=new s.Transitionable(Lt),this.set(y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(y){for(const a in y){const h=y[a];s.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),h):this._transitionable.setValue(a,h)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}};function We(y,a,h,x){const T=s.smoothstep(45,65,h),[k,N]=Le(y,x),D=s.length(a);let B=1-Math.min(1,Math.exp((D-k)/(N-k)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*T*y.alpha}function Le(y,a){const h=.5/Math.tan(.5*a);return[y.range[0]+h,y.range[1]+h]}const we=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class st extends s.Evented{constructor(a,h){super(),this._transitionable=new s.Transitionable(we),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const a=this._transform,h=a.projection.name==="globe",x=s.globeToMercatorTransition(a.zoom),T=this.properties.get("range"),k=[.5,3];return{range:h?[s.number(k[0],T[0],x),s.number(k[1],T[1],x)]:T,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,h={}){if(!this._validate(s.validateFog,a,h)){for(const x of Object.keys(s.spec.fog))a&&a[x]===void 0&&(a[x]=s.spec.fog[x].default);for(const x in a){const T=a[x];s.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-11),T):this._transitionable.setValue(x,T)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,a))*h.a}getOpacityAtLatLng(a,h){return this._transform.projection.supportsFog?(function(x,T,k){const N=s.MercatorCoordinate.fromLngLat(T),D=k.elevation?k.elevation.getAtPointOrZero(N):0,B=[N.x,N.y,D];return s.transformMat4(B,B,k.mercatorFogMatrix),We(x,B,k.pitch,k._fov)})(this.state,a,h):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Le(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,x){return(!x||x.validate!==!1)&&s.emitValidationErrors(this,a.call(s.validateStyle,s.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class ke{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const x=this.workerPool.acquire(this.id);for(let T=0;T<x.length;T++){const k=new ke.Actor(x[T],h,this.id);k.name=`Worker ${T}`,this.actors.push(k)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(a,h,x){s.asyncAll(this.actors,((T,k)=>{T.send(a,h,k)}),x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((a=>{a.remove()})),this.actors=[],this.workerPool.release(this.id)}}function Ve(y,a,h){return a*(s.EXTENT/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}ke.Actor=s.Actor;class bt{constructor(a,h,x,T){this.screenBounds=a,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,T)}static createFromScreenPoints(a,h){let x,T;if(a instanceof s.Point||typeof a[0]=="number"){const k=s.Point.convert(a);x=[k],T=h.isPointAboveHorizon(k)}else{const k=s.Point.convert(a[0]),N=s.Point.convert(a[1]);x=[k,N],T=s.polygonizeBounds(k,N).every((D=>h.isPointAboveHorizon(D)))}return new bt(x,h.getCameraPoint(),T,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],T=s.polygonizeBounds(h,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<x.x?T.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?T[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(T[3]=this.cameraPoint)),s.bufferConvexPolygon(T,a)}bufferedCameraGeometryGlobe(a){const h=this.screenBounds[0],x=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],T=s.polygonizeBounds(h,x,a),k=this.cameraPoint.clone();switch(3*((k.y>h.y)+(k.y>x.y))+((k.x>h.x)+(k.x>x.x))){case 0:T[0]=k,T[4]=k.clone();break;case 1:T.splice(1,0,k);break;case 2:T[1]=k;break;case 3:T.splice(4,0,k);break;case 5:T.splice(2,0,k);break;case 6:T[3]=k;break;case 7:T.splice(3,0,k);break;case 8:T[2]=k}return T}containsTile(a,h,x,T=0){const k=a.queryPadding/h._pixelsPerMercatorPixel+1,N=x?this._bufferedCameraMercator(k,h):this._bufferedScreenMercator(k,h);let D=a.tileID.wrap+(N.unwrapped?T:0);const B=N.polygon.map((pe=>s.getTilePoint(a.tileTransform,pe,D)));if(!s.polygonIntersectsBox(B,0,0,s.EXTENT,s.EXTENT))return;D=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?T:0);const H=this.screenGeometryMercator.polygon.map((pe=>s.getTileVec3(a.tileTransform,pe,D))),G=H.map((pe=>new s.Point(pe[0],pe[1]))),ee=h.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),ae=s.getTileVec3(a.tileTransform,ee,D),ue=H.map((pe=>{const te=s.sub(pe,pe,ae);return s.normalize(te,te),new s.Ray(ae,te)})),fe=Ve(a,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:G,tilespaceRays:ue,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(he=s.getBounds(B),he.min.x=s.clamp(he.min.x,0,s.EXTENT),he.min.y=s.clamp(he.min.y,0,s.EXTENT),he.max.x=s.clamp(he.max.x,0,s.EXTENT),he.max.y=s.clamp(he.max.y,0,s.EXTENT),he),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:fe};var he}_bufferedScreenMercator(a,h){const x=Mt(a);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let T;return T=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),h):{polygon:this.bufferedScreenGeometry(a).map((k=>h.pointCoordinate3D(k))),unwrapped:!0},this._screenRaycastCache[x]=T,T}}_bufferedCameraMercator(a,h){const x=Mt(a);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let T;return T=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),h):{polygon:this.bufferedCameraGeometry(a).map((k=>h.pointCoordinate3D(k))),unwrapped:!0},this._cameraRaycastCache[x]=T,T}}_projectAndResample(a,h){const x=(function(k,N){const D=s.multiply([],N.pixelMatrix,N.globeMatrix),B=[0,-s.GLOBE_RADIUS,0,1],H=[0,s.GLOBE_RADIUS,0,1],G=[0,0,0,1];s.transformMat4$1(B,B,D),s.transformMat4$1(H,H,D),s.transformMat4$1(G,G,D);const ee=new s.Point(B[0]/B[3],B[1]/B[3]),ae=new s.Point(H[0]/H[3],H[1]/H[3]),ue=s.polygonContainsPoint(k,ee)&&B[3]<G[3],fe=s.polygonContainsPoint(k,ae)&&H[3]<G[3];if(!ue&&!fe)return null;const he=(function(je,Ge,$e){for(let Ye=1;Ye<je.length;Ye++){const kt=Yt(Ge.pointCoordinate3D(je[Ye-1]).x),qe=Yt(Ge.pointCoordinate3D(je[Ye]).x);if($e<0){if(kt<qe)return{idx:Ye,t:-kt/(qe-1-kt)}}else if(qe<kt)return{idx:Ye,t:(1-kt)/(qe+1-kt)}}return null})(k,N,ue?-1:1);if(!he)return null;const{idx:pe,t:te}=he;let ce=pe>1?wt(k.slice(0,pe),N):[],ye=pe<k.length?wt(k.slice(pe),N):[];ce=ce.map((je=>new s.Point(Yt(je.x),je.y))),ye=ye.map((je=>new s.Point(Yt(je.x),je.y)));const ve=[...ce];ve.length===0&&ve.push(ye[ye.length-1]);const Ne=s.number(ve[ve.length-1].y,(ye.length===0?ce[0]:ye[0]).y,te);let De;return De=ue?[new s.Point(0,Ne),new s.Point(0,0),new s.Point(1,0),new s.Point(1,Ne)]:[new s.Point(1,Ne),new s.Point(1,1),new s.Point(0,1),new s.Point(0,Ne)],ve.push(...De),ye.length===0?ve.push(ce[0]):ve.push(...ye),{polygon:ve.map((je=>new s.MercatorCoordinate(je.x,je.y))),unwrapped:!1}})(a,h);if(x)return x;const T=(function(k,N){let D=!1,B=-1/0,H=0;for(let ee=0;ee<k.length-1;ee++)k[ee].x>B&&(B=k[ee].x,H=ee);for(let ee=0;ee<k.length-1;ee++){const ae=(H+ee)%(k.length-1),ue=k[ae],fe=k[ae+1];Math.abs(ue.x-fe.x)>.5&&(ue.x<fe.x?(ue.x+=1,ae===0&&(k[k.length-1].x+=1)):(fe.x+=1,ae+1===k.length-1&&(k[0].x+=1)),D=!0)}const G=s.mercatorXfromLng(N.center.lng);return D&&G<Math.abs(G-1)&&k.forEach((ee=>{ee.x-=1})),{polygon:k,unwrapped:D}})(wt(a,h).map((k=>new s.Point(Yt(k.x),k.y))),h);return{polygon:T.polygon.map((k=>new s.MercatorCoordinate(k.x,k.y))),unwrapped:T.unwrapped}}}function wt(y,a){return s.resample(y,(h=>{const x=a.pointCoordinate3D(h);h.x=x.x,h.y=x.y}),1/256)}function Yt(y){return y<0?1+y%1:y%1}function Mt(y){return 100*y|0}function ct(y,a,h,x,T){const k=function(N,D){if(N)return T(N);if(D){y.url&&D.tiles&&y.tiles&&delete y.tiles;const B=s.pick(s.extend(D,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(B.vectorLayers=D.vector_layers,B.vectorLayerIds=B.vectorLayers.map((H=>H.id))),B.tiles=a.canonicalizeTileset(B,y.url),T(null,B)}};return y.url?s.getJSON(a.transformRequest(a.normalizeSourceURL(y.url,null,h,x),s.ResourceType.Source),k):s.exported.frame((()=>k(null,y)))}class Nt{constructor(a,h,x){this.bounds=s.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=x||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),x=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*h),T=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*h),k=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*h),N=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*h);return a.x>=x&&a.x<k&&a.y>=T&&a.y<N}}class xn{constructor(a,h,x){this.context=a;const T=a.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const un={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rn{constructor(a,h,x,T){this.length=h.length,this.attributes=x,this.itemSize=h.bytesPerElement,this.dynamicDraw=T,this.context=a;const k=a.gl;this.buffer=k.createBuffer(),a.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let x=0;x<this.attributes.length;x++){const T=h.attributes[this.attributes[x].name];T!==void 0&&a.enableVertexAttribArray(T)}}setVertexAttribPointers(a,h,x){for(let T=0;T<this.attributes.length;T++){const k=this.attributes[T],N=h.attributes[k.name];N!==void 0&&a.vertexAttribPointer(N,k.components,a[un[k.type]],!1,this.itemSize,k.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kr extends sn{getDefault(){return s.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class vr extends sn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Es extends sn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Jn extends sn{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ar extends sn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class io extends sn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class wi extends sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Xr extends sn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class ii extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class cs extends sn{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class Ki extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class zs extends sn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Cs extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class Gr extends sn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class us extends sn{getDefault(){return s.Color.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class bi extends sn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Bs extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class Xi extends sn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Mi extends sn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let ko,so=class extends sn{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class Ii extends sn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class ds extends sn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class si extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Fs extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class oo extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Ao extends sn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class be extends sn{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class re extends sn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class se extends sn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class de extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Te extends sn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class xe extends sn{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class ze extends xe{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Be extends xe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Oe extends Be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ze{constructor(a,h,x,T){this.context=a,this.width=h,this.height=x;const k=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new ze(a,k),T&&(this.depthAttachment=new Be(a,k))}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const x=this.depthAttachment.get();x&&a.deleteRenderbuffer(x)}a.deleteFramebuffer(this.framebuffer)}}class St{constructor(a,h=!1){if(this.gl=a,this.isWebGL2=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),h){const x=a;this.extVertexArrayObject={createVertexArrayOES:x.createVertexArray.bind(a),deleteVertexArrayOES:x.deleteVertexArray.bind(a),bindVertexArrayOES:x.bindVertexArray.bind(a)}}this.clearColor=new kr(this),this.clearDepth=new vr(this),this.clearStencil=new Es(this),this.colorMask=new Jn(this),this.depthMask=new Ar(this),this.stencilMask=new io(this),this.stencilFunc=new wi(this),this.stencilOp=new Xr(this),this.stencilTest=new ii(this),this.depthRange=new cs(this),this.depthTest=new Ki(this),this.depthFunc=new zs(this),this.blend=new Cs(this),this.blendFunc=new Gr(this),this.blendColor=new us(this),this.blendEquation=new bi(this),this.cullFace=new Bs(this),this.cullFaceSide=new Xi(this),this.frontFace=new Mi(this),this.program=new so(this),this.activeTexture=new Ii(this),this.viewport=new ds(this),this.bindFramebuffer=new si(this),this.bindRenderbuffer=new Fs(this),this.bindTexture=new oo(this),this.bindVertexBuffer=new Ao(this),this.bindElementBuffer=new be(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new re(this),this.pixelStoreUnpack=new se(this),this.pixelStoreUnpackPremultiplyAlpha=new de(this),this.pixelStoreUnpackFlipY=new Te(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),h||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(h||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=h||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new xn(this,a,h)}createVertexBuffer(a,h,x){return new Rn(this,a,h,x)}createRenderbuffer(a,h,x){const T=this.gl,k=T.createRenderbuffer();return this.bindRenderbuffer.set(k),T.renderbufferStorage(T.RENDERBUFFER,a,h,x),this.bindRenderbuffer.set(null),k}createFramebuffer(a,h,x){return new Ze(this,a,h,x)}clear({color:a,depth:h,stencil:x}){const T=this.gl;let k=0;a&&(k|=T.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(k|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),x!==void 0&&(k|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),T.clear(k)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){S(a.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class jt extends s.Evented{constructor(a,h,x,T){if(super(),this.id=a,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(h,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(a){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,x=this.map._worldview;this._tileJSONRequest=ct(this._options,this.map._requestManager,h,x,((T,k)=>{this._tileJSONRequest=null,this._loaded=!0,T?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),x&&x.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${x}`),this.fire(new s.ErrorEvent(T))):k&&(s.extend(this,k),k.bounds&&(this.tileBounds=new Nt(k.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(k.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(T)}))}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(a,h){const x=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(x,s.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(T.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",T,k.bind(this));else if(a.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",T,k.bind(this),void 0,!0);else{const N=s.loadVectorTile.call({deduped:this._deduped},T,((D,B)=>{D||!B?k.call(this,D):(T.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},a.actor&&a.actor.send("loadTile",T,k.bind(this),void 0,!0))}),!0);a.request={cancel:N}}function k(N,D){return delete a.request,a.aborted?h(null):N&&N.status!==404?h(N):(D&&D.resourceTiming&&(a.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&a.setExpiryData(D),a.loadVectorData(D,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xt extends s.Evented{constructor(a,h,x,T){super(),this.id=a,this.dispatcher=x,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},h),s.extend(this,s.pick(h,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ct(this._options,this.map._requestManager,null,null,((h,x)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new s.ErrorEvent(h)):x&&(s.extend(this,x),x.bounds&&(this.tileBounds=new Nt(x.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(x.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(h)}))}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load((()=>this.map.style._clearSource(this.id)))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,h){const x=s.exported.devicePixelRatio>=2,T=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);a.request=s.getImage(this.map._requestManager.transformRequest(T,s.ResourceType.Tile),((k,N,D,B)=>(delete a.request,a.aborted?(a.state="unloaded",h(null)):k?(a.state="errored",h(k)):N?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:D,expires:B}),a.setTexture(N,this.map.painter),a.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null))))}static loadTileData(a,h,x){a.setTexture(h,x)}static unloadTileData(a,h){a.texture&&h.saveTileTexture(a.texture)}abortTile(a,h){a.request&&(a.request.cancel(),delete a.request),h()}unloadTile(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function bn(y,a,h,x,T,k,N,D){const B=[y,h,T,a,x,k,1,1,1],H=[N,D,1],G=s.adjoint([],B),[ee,ae,ue]=s.transformMat3(H,H,s.transpose(G,G));return s.multiply$1(B,[ee,0,0,0,ae,0,0,0,ue],B)}class Pn extends s.Evented{constructor(a,h,x,T){super(),this.id=a,this.dispatcher=x,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=h,this._dirty=!1}load(a,h){this._loaded=h||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),((x,T)=>{if(this._imageRequest=null,this._loaded=!0,x)this.fire(new s.ErrorEvent(x));else if(T){const{HTMLImageElement:k}=s.window;this.image=T instanceof k?s.exported.getImageData(T):T,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const h=a.map(s.MercatorCoordinate.fromLngLat);return this.tileID=(function(x){let T=1/0,k=1/0,N=-1/0,D=-1/0;for(const ee of x)T=Math.min(T,ee.x),k=Math.min(k,ee.y),N=Math.max(N,ee.x),D=Math.max(D,ee.y);const B=Math.max(N-T,D-k),H=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),G=Math.pow(2,H);return new s.CanonicalTileID(H,Math.floor((T+N)/2*G),Math.floor((k+D)/2*G))})(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const B in this.tiles){const H=this.tiles[B];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray)return;const h=s.tileTransform(this.tileID,this.map.transform.projection),[x,T,k,N]=this.coordinates.map((B=>{const H=h.projection.project(B[0],B[1]);return s.getTilePoint(h,H)._round()}));this.perspectiveTransform=(function(B,H,G,ee,ae,ue,fe,he,pe,te){const ce=bn(0,0,B,0,0,H,B,H),ye=bn(G,ee,ae,ue,fe,he,pe,te);return s.multiply$1(ye,s.adjoint(ce,ce),ye),[ye[6]/ye[8]*B/s.EXTENT,ye[7]/ye[8]*H/s.EXTENT]})(this.width,this.height,x.x,x.y,T.x,T.y,N.x,N.y,k.x,k.y);const D=this._boundsArray=new s.StructArrayLayout4i8;D.emplaceBack(x.x,x.y,0,0),D.emplaceBack(T.x,T.y,s.EXTENT,0),D.emplaceBack(N.x,N.y,0,s.EXTENT),D.emplaceBack(k.x,k.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(D,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,h=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const An={vector:jt,raster:xt,"raster-dem":class extends xt{constructor(y,a,h,x){super(y,a,h,x),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(y,a){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(T,k){T&&(y.state="errored",a(T)),k&&(y.dem=k,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",a(null))}y.request=s.getImage(this.map._requestManager.transformRequest(h,s.ResourceType.Tile),(function(T,k,N,D){if(delete y.request,y.aborted)y.state="unloaded",a(null);else if(T)y.state="errored",a(T);else if(k){this.map._refreshExpiredTiles&&y.setExpiryData({cacheControl:N,expires:D});const B=s.window.ImageBitmap&&k instanceof s.window.ImageBitmap&&(ko==null&&(ko=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),ko),H=1-(k.width-s.prevPowerOfTwo(k.width))/2;H<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const G=B?k:s.exported.getImageData(k,H),ee={uid:y.uid,coord:y.tileID,source:this.id,rawImageData:G,encoding:this.encoding,padding:H};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadDEMTile",ee,x.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const a=y.canonical,h=Math.pow(2,a.z),x=(a.x-1+h)%h,T=a.x===0?y.wrap-1:y.wrap,k=(a.x+1+h)%h,N=a.x+1===h?y.wrap+1:y.wrap,D={};return D[new s.OverscaledTileID(y.overscaledZ,T,a.z,x,a.y).key]={backfilled:!1},D[new s.OverscaledTileID(y.overscaledZ,N,a.z,k,a.y).key]={backfilled:!1},a.y>0&&(D[new s.OverscaledTileID(y.overscaledZ,T,a.z,x,a.y-1).key]={backfilled:!1},D[new s.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},D[new s.OverscaledTileID(y.overscaledZ,N,a.z,k,a.y-1).key]={backfilled:!1}),a.y+1<h&&(D[new s.OverscaledTileID(y.overscaledZ,T,a.z,x,a.y+1).key]={backfilled:!1},D[new s.OverscaledTileID(y.overscaledZ,y.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},D[new s.OverscaledTileID(y.overscaledZ,N,a.z,k,a.y+1).key]={backfilled:!1}),D}unloadTile(y){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded"}},geojson:class extends s.Evented{constructor(y,a,h,x){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(x),this._data=a.data,this._options=s.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const T=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*T,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*T,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:s.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*T,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}getClusterExpansionZoom(y,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id},a),this}getClusterChildren(y,a){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id},a),this}getClusterLeaves(y,a,h,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:y,limit:a,offset:h},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const y=s.extend({},this.workerOptions),a=this._data;typeof a=="string"?(y.request=this.map._requestManager.transformRequest(s.exported.resolveURL(a),s.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,y,((h,x)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new s.ErrorEvent(h));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(T.resourceTiming=x.resourceTiming[this.id]),this.fire(new s.Event("data",T)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(y,a){const h=y.actor?"reloadTile":"loadTile";y.actor=this.actor,y.request=this.actor.send(h,{type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((x,T)=>(delete y.request,y.unloadVectorData(),y.aborted?a(null):x?a(x):(y.loadVectorData(T,this.map.painter,h==="reloadTile"),a(null)))),void 0,h==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y){y.unloadVectorData(),this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Pn{constructor(y,a,h,x){super(y,a,h,x),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,s.ResourceType.Source).url);s.getVideo(this.urls,((a,h)=>{this._loaded=!0,a?this.fire(new s.ErrorEvent(a)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const a=this.video.seekable;y<a.start(0)||y>a.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Pn,canvas:class extends Pn{constructor(y,a,h,x){super(y,a,h,x),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((T=>!Array.isArray(T)||T.length!==2||T.some((k=>typeof k!="number"))))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${y}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends s.Evented{constructor(y,a,h,x){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=a,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Nt(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this._map=y,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:a,y:h,z:x}=y.canonical;return this._implementation.hasTile({x:a,y:h,z:x})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,a){const{x:h,y:x,z:T}=y.tileID.canonical,k=new s.window.AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:h,y:x,z:T},{signal:k.signal})).then((function(N){return delete y.request,y.aborted?(y.state="unloaded",a(null)):N===void 0?(y.state="errored",a(null)):N===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",a(null)):(function(D){return D instanceof s.window.ImageData||D instanceof s.window.HTMLCanvasElement||D instanceof s.window.ImageBitmap||D instanceof s.window.HTMLImageElement})(N)?(this.loadTileData(y,N),y.state="loaded",void a(null)):(y.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((N=>{N.code!==20&&(y.state="errored",a(N))})),y.request.cancel=()=>k.abort()}loadTileData(y,a){xt.loadTileData(y,a,this._map.painter)}unloadTileData(y){xt.unloadTileData(y,this._map.painter)}unloadTile(y,a){if(this.unloadTileData(y),this._implementation.unloadTile){const{x:h,y:x,z:T}=y.tileID.canonical;this._implementation.unloadTile({x:h,y:x,z:T})}a()}abortTile(y,a){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z})))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Nn=function(y,a,h,x){const T=new An[a.type](y,a,h,x);if(T.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${T.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],T),T};function qn(y,a){const h=s.identity([]);return s.scale(h,h,[.5*y.width,.5*-y.height,1]),s.translate(h,h,[1,-1,0]),s.multiply(h,h,y.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(h)}function Br(y,a,h,x,T,k,N,D=!1){const B=y.tilesIn(x,N,D);B.sort(Yi);const H=[];for(const ee of B)H.push({wrappedTileID:ee.tile.tileID.wrapped().key,queryResults:ee.tile.queryRenderedFeatures(a,h,y._state,ee,T,k,qn(y.transform,ee.tile.tileID),D)});const G=(function(ee){const ae={},ue={};for(const fe of ee){const he=fe.queryResults,pe=fe.wrappedTileID,te=ue[pe]=ue[pe]||{};for(const ce in he){const ye=he[ce],ve=te[ce]=te[ce]||{},Ne=ae[ce]=ae[ce]||[];for(const De of ye)ve[De.featureIndex]||(ve[De.featureIndex]=!0,Ne.push(De))}}return ae})(H);for(const ee in G)G[ee].forEach((ae=>{const ue=ae.feature,fe=ue.layer;fe&&fe.type!=="background"&&fe.type!=="sky"&&(ue.source=fe.source,fe["source-layer"]&&(ue.sourceLayer=fe["source-layer"]),ue.state=ue.id!==void 0?y.getFeatureState(fe["source-layer"],ue.id):{})}));return G}function oi(y,a){const h=y.getRenderableIds().map((k=>y.getTileByID(k))),x=[],T={};for(let k=0;k<h.length;k++){const N=h[k],D=N.tileID.canonical.key;T[D]||(T[D]=!0,N.querySourceFeatures(x,a))}return x}function Yi(y,a){const h=y.tileID,x=a.tileID;return h.overscaledZ-x.overscaledZ||h.canonical.y-x.canonical.y||h.wrap-x.wrap||h.canonical.x-x.canonical.x}function Dr(){return Ja.workerClass!=null?new Ja.workerClass:new s.window.Worker(Ja.workerUrl)}const Po="mapboxgl_preloaded_worker_pool";class Ti{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Ti.workerCount;)this.workers.push(new Dr);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach((h=>{h.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Po]}numActive(){return Object.keys(this.active).length}}let hs;function vl(){return hs||(hs=new Ti),hs}function lp(y,a){const h={};for(const x in y)x!=="ref"&&(h[x]=y[x]);return s.refProperties.forEach((x=>{x in a&&(h[x]=a[x])})),h}function Sh(y){y=y.slice();const a=Object.create(null);for(let h=0;h<y.length;h++)a[y[h].id]=y[h];for(let h=0;h<y.length;h++)"ref"in y[h]&&(y[h]=lp(y[h],a[y[h].ref]));return y}Ti.workerCount=2;const sr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Eh(y,a,h){h.push({command:sr.addSource,args:[y,a[y]]})}function lu(y,a,h){a.push({command:sr.removeSource,args:[y]}),h[y]=!0}function Hr(y,a,h,x){lu(y,h,x),Eh(y,a,h)}function od(y,a,h){let x;for(x in y[h])if(y[h].hasOwnProperty(x)&&x!=="data"&&!S(y[h][x],a[h][x]))return!1;for(x in a[h])if(a[h].hasOwnProperty(x)&&x!=="data"&&!S(y[h][x],a[h][x]))return!1;return!0}function ao(y,a,h,x,T,k){let N;for(N in a=a||{},y=y||{})y.hasOwnProperty(N)&&(S(y[N],a[N])||h.push({command:k,args:[x,N,a[N],T]}));for(N in a)a.hasOwnProperty(N)&&!y.hasOwnProperty(N)&&(S(y[N],a[N])||h.push({command:k,args:[x,N,a[N],T]}))}function Wo(y){return y.id}function sc(y,a){return y[a.id]=a,y}class Ch{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.clamp(a,0,1);let h=1,x=this._distances[h];const T=a*this.paddedLength+this.padding;for(;x<T&&h<this._distances.length;)x=this._distances[++h];const k=h-1,N=this._distances[k],D=x-N,B=D>0?(T-N)/D:0;return this.points[k].mult(1-B).add(this.points[h].mult(B))}}class za{constructor(a,h,x){const T=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(a/x),this.yCellCount=Math.ceil(h/x);for(let N=0;N<this.xCellCount*this.yCellCount;N++)T.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,x,T,k){this._forEachCell(h,x,T,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(x),this.bboxes.push(T),this.bboxes.push(k)}insertCircle(a,h,x,T){this._forEachCell(h-T,x-T,h+T,x+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(x),this.circles.push(T)}_insertBoxCell(a,h,x,T,k,N){this.boxCells[k].push(N)}_insertCircleCell(a,h,x,T,k,N){this.circleCells[k].push(N)}_query(a,h,x,T,k,N){if(x<0||a>this.width||T<0||h>this.height)return!k&&[];const D=[];if(a<=0&&h<=0&&this.width<=x&&this.height<=T){if(k)return!0;for(let B=0;B<this.boxKeys.length;B++)D.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const H=this.circles[3*B],G=this.circles[3*B+1],ee=this.circles[3*B+2];D.push({key:this.circleKeys[B],x1:H-ee,y1:G-ee,x2:H+ee,y2:G+ee})}return N?D.filter(N):D}return this._forEachCell(a,h,x,T,this._queryCell,D,{hitTest:k,seenUids:{box:{},circle:{}}},N),k?D.length>0:D}_queryCircle(a,h,x,T,k){const N=a-x,D=a+x,B=h-x,H=h+x;if(D<0||N>this.width||H<0||B>this.height)return!T&&[];const G=[];return this._forEachCell(N,B,D,H,this._queryCellCircle,G,{hitTest:T,circle:{x:a,y:h,radius:x},seenUids:{box:{},circle:{}}},k),T?G.length>0:G}query(a,h,x,T,k){return this._query(a,h,x,T,!1,k)}hitTest(a,h,x,T,k){return this._query(a,h,x,T,!0,k)}hitTestCircle(a,h,x,T){return this._queryCircle(a,h,x,!0,T)}_queryCell(a,h,x,T,k,N,D,B){const H=D.seenUids,G=this.boxCells[k];if(G!==null){const ae=this.bboxes;for(const ue of G)if(!H.box[ue]){H.box[ue]=!0;const fe=4*ue;if(a<=ae[fe+2]&&h<=ae[fe+3]&&x>=ae[fe+0]&&T>=ae[fe+1]&&(!B||B(this.boxKeys[ue]))){if(D.hitTest)return N.push(!0),!0;N.push({key:this.boxKeys[ue],x1:ae[fe],y1:ae[fe+1],x2:ae[fe+2],y2:ae[fe+3]})}}}const ee=this.circleCells[k];if(ee!==null){const ae=this.circles;for(const ue of ee)if(!H.circle[ue]){H.circle[ue]=!0;const fe=3*ue;if(this._circleAndRectCollide(ae[fe],ae[fe+1],ae[fe+2],a,h,x,T)&&(!B||B(this.circleKeys[ue]))){if(D.hitTest)return N.push(!0),!0;{const he=ae[fe],pe=ae[fe+1],te=ae[fe+2];N.push({key:this.circleKeys[ue],x1:he-te,y1:pe-te,x2:he+te,y2:pe+te})}}}}}_queryCellCircle(a,h,x,T,k,N,D,B){const H=D.circle,G=D.seenUids,ee=this.boxCells[k];if(ee!==null){const ue=this.bboxes;for(const fe of ee)if(!G.box[fe]){G.box[fe]=!0;const he=4*fe;if(this._circleAndRectCollide(H.x,H.y,H.radius,ue[he+0],ue[he+1],ue[he+2],ue[he+3])&&(!B||B(this.boxKeys[fe])))return N.push(!0),!0}}const ae=this.circleCells[k];if(ae!==null){const ue=this.circles;for(const fe of ae)if(!G.circle[fe]){G.circle[fe]=!0;const he=3*fe;if(this._circlesCollide(ue[he],ue[he+1],ue[he+2],H.x,H.y,H.radius)&&(!B||B(this.circleKeys[fe])))return N.push(!0),!0}}}_forEachCell(a,h,x,T,k,N,D,B){const H=this._convertToXCellCoord(a),G=this._convertToYCellCoord(h),ee=this._convertToXCellCoord(x),ae=this._convertToYCellCoord(T);for(let ue=H;ue<=ee;ue++)for(let fe=G;fe<=ae;fe++)if(k.call(this,a,h,x,T,this.xCellCount*fe+ue,N,D,B))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,x,T,k,N){const D=T-a,B=k-h,H=x+N;return H*H>D*D+B*B}_circleAndRectCollide(a,h,x,T,k,N,D){const B=(N-T)/2,H=Math.abs(a-(T+B));if(H>B+x)return!1;const G=(D-k)/2,ee=Math.abs(h-(k+G));if(ee>G+x)return!1;if(H<=B||ee<=G)return!0;const ae=H-B,ue=ee-G;return ae*ae+ue*ue<=x*x}}const lo={unknown:0,flipRequired:1,flipNotRequired:2},ks=Math.tan(85*Math.PI/180);function ht(y,a,h,x,T,k,N){const D=s.create();if(h)if(k.name==="globe"){const B=s.calculateGlobeLabelMatrix(T,a);s.multiply(D,D,B)}else{const B=Me([],N);D[0]=B[0],D[1]=B[1],D[4]=B[2],D[5]=B[3],x||s.rotateZ(D,D,T.angle)}else s.multiply(D,T.labelPlaneMatrix,y);return D}function Si(y,a,h,x,T,k,N){const D=ht(y,a,h,x,T,k,N);return k.name==="globe"&&h||(D[2]=D[6]=D[10]=D[14]=0),D}function ai(y,a,h,x,T,k,N){if(h){if(k.name==="globe"){const D=ht(y,a,h,x,T,k,N);return s.invert(D,D),s.multiply(D,y,D),D}{const D=s.clone(y),B=s.identity([]);return B[0]=N[0],B[1]=N[1],B[4]=N[2],B[5]=N[3],s.multiply(D,D,B),x||s.rotateZ(D,D,-T.angle),D}}return T.glCoordMatrix}function Ri(y,a,h,x){const T=[y,a,h,1];h?s.transformMat4$1(T,T,x):jn(T,T,x);const k=T[3];return T[0]/=k,T[1]/=k,T[2]/=k,T}function cp(y,a){return Math.min(.5+y/a*.5,1.5)}function Vs(y,a){const h=y[0]/y[3],x=y[1]/y[3];return h>=-a[0]&&h<=a[0]&&x>=-a[1]&&x<=a[1]}function oc(y,a,h,x,T,k,N,D,B,H){const G=h.transform,ee=x?y.textSizeData:y.iconSizeData,ae=s.evaluateSizeForZoom(ee,h.transform.zoom),ue=G.projection.name==="globe",fe=[256/h.width*2+1,256/h.height*2+1],he=x?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;he.clear();let pe=null;ue&&(pe=x?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const te=y.lineVertexArray,ce=x?y.text.placedSymbolArray:y.icon.placedSymbolArray,ye=h.transform.width/h.transform.height;let ve,Ne=!1;for(let De=0;De<ce.length;De++){const je=ce.get(De),{numGlyphs:Ge,writingMode:$e}=je;if($e!==s.WritingMode.vertical||Ne||ve===s.WritingMode.horizontal||(Ne=!0),ve=$e,(je.hidden||$e===s.WritingMode.vertical)&&!Ne){Us(Ge,he);continue}Ne=!1;const Ye=new s.Point(je.tileAnchorX,je.tileAnchorY);let{x:kt,y:qe,z:at}=G.projection.projectTilePoint(Ye.x,Ye.y,H.canonical);if(B){const[_n,Zt,hn]=B(Ye);kt+=_n,qe+=Zt,at+=hn}const Qe=[kt,qe,at,1];if(s.transformMat4$1(Qe,Qe,a),!Vs(Qe,fe)){Us(Ge,he);continue}const Et=cp(h.transform.cameraToCenterDistance,Qe[3]),Xe=s.evaluateSizeForFeature(ee,ae,je),ut=N?Xe/Et:Xe*Et,Tt=Ri(kt,qe,at,T);if(Tt[3]<=0){Us(Ge,he);continue}let vt={};const At=N?null:B,tn=Gt(je,ut,!1,D,a,T,k,y.glyphOffsetArray,te,he,pe,Tt,Ye,vt,ye,At,G.projection,H,N);Ne=tn.useVertical,At&&tn.needsFlipping&&(vt={}),(tn.notEnoughRoom||Ne||tn.needsFlipping&&Gt(je,ut,!0,D,a,T,k,y.glyphOffsetArray,te,he,pe,Tt,Ye,vt,ye,At,G.projection,H,N).notEnoughRoom)&&Us(Ge,he)}x?(y.text.dynamicLayoutVertexBuffer.updateData(he),pe&&y.text.globeExtVertexBuffer.updateData(pe)):(y.icon.dynamicLayoutVertexBuffer.updateData(he),pe&&y.icon.globeExtVertexBuffer.updateData(pe))}function ac(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he){const{lineStartIndex:pe,glyphStartIndex:te,segment:ce}=D,ye=te+D.numGlyphs,ve=pe+D.lineLength,Ne=a.getoffsetX(te),De=a.getoffsetX(ye-1),je=As(y*Ne,h,x,T,k,N,ce,pe,ve,B,H,G,ee,ae,!0,ue,fe,he);if(!je)return null;const Ge=As(y*De,h,x,T,k,N,ce,pe,ve,B,H,G,ee,ae,!0,ue,fe,he);return Ge?{first:je,last:Ge}:null}function fa(y,a,h,x){return y===s.WritingMode.horizontal&&Math.abs(x)>Math.abs(h)?{useVertical:!0}:y===s.WritingMode.vertical?x>0?{needsFlipping:!0}:null:a!==lo.unknown&&(function(T,k){return T===0||Math.abs(k/T)>ks})(h,x)?a===lo.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function Gt(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he,pe,te,ce){const ye=a/24,ve=y.lineOffsetX*ye,Ne=y.lineOffsetY*ye,{lineStartIndex:De,glyphStartIndex:je,numGlyphs:Ge,segment:$e,writingMode:Ye,flipState:kt}=y,qe=De+y.lineLength,at=Qe=>{if(G){const[Tt,vt,At]=Qe.up,tn=H.length;s.updateGlobeVertexNormal(G,tn+0,Tt,vt,At),s.updateGlobeVertexNormal(G,tn+1,Tt,vt,At),s.updateGlobeVertexNormal(G,tn+2,Tt,vt,At),s.updateGlobeVertexNormal(G,tn+3,Tt,vt,At)}const[Et,Xe,ut]=Qe.point;s.addDynamicAttributes(H,Et,Xe,ut,Qe.angle)};if(Ge>1){const Qe=ac(ye,D,ve,Ne,h,ee,ae,y,B,k,ue,he,!1,pe,te,ce);if(!Qe)return{notEnoughRoom:!0};if(x&&!h){let[Et,Xe,ut]=Qe.first.point,[Tt,vt,At]=Qe.last.point;[Et,Xe]=Ri(Et,Xe,ut,N),[Tt,vt]=Ri(Tt,vt,At,N);const tn=fa(Ye,kt,(Tt-Et)*fe,vt-Xe);if(y.flipState=tn&&tn.needsFlipping?lo.flipRequired:lo.flipNotRequired,tn)return tn}at(Qe.first);for(let Et=je+1;Et<je+Ge-1;Et++){const Xe=As(ye*D.getoffsetX(Et),ve,Ne,h,ee,ae,$e,De,qe,B,k,ue,he,!1,!1,pe,te,ce);if(!Xe)return H.length-=4*(Et-je),{notEnoughRoom:!0};at(Xe)}at(Qe.last)}else{if(x&&!h){const Et=Ri(ae.x,ae.y,0,T),Xe=De+$e+1,ut=new s.Point(B.getx(Xe),B.gety(Xe)),Tt=Ri(ut.x,ut.y,0,T),vt=Tt[3]>0?Tt:$n(ae,ut,Et,1,T,void 0,pe,te.canonical),At=fa(Ye,kt,(vt[0]-Et[0])*fe,vt[1]-Et[1]);if(y.flipState=At&&At.needsFlipping?lo.flipRequired:lo.flipNotRequired,At)return At}const Qe=As(ye*D.getoffsetX(je),ve,Ne,h,ee,ae,$e,De,qe,B,k,ue,he,!1,!1,pe,te,ce);if(!Qe)return{notEnoughRoom:!0};at(Qe)}return{}}function Zn(y,a,h,x,T){const{x:k,y:N,z:D}=x.projectTilePoint(y.x,y.y,a);if(!T)return Ri(k,N,D,h);const[B,H,G]=T(y);return Ri(k+B,N+H,D+G,h)}function $n(y,a,h,x,T,k,N,D){const B=Zn(y.sub(a)._unit()._add(y),D,T,N,k);return s.sub(B,h,B),s.normalize(B,B),s.scaleAndAdd(B,h,B,x)}function As(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he,pe,te){const ce=x?y-a:y+a;let ye=ce>0?1:-1,ve=0;x&&(ye*=-1,ve=Math.PI),ye<0&&(ve+=Math.PI);let Ne=D+N+(ye>0?0:1)|0,De=T,je=T,Ge=0,$e=0;const Ye=Math.abs(ce),kt=[],qe=[];let at=k,Qe=at;const Et=()=>$n(Qe,at,je,Ye-Ge+1,G,ae,he,pe.canonical);for(;Ge+$e<=Ye;){if(Ne+=ye,Ne<D||Ne>=B)return null;if(je=De,Qe=at,kt.push(je),ue&&qe.push(Qe),at=new s.Point(H.getx(Ne),H.gety(Ne)),De=ee[Ne],!De){const hn=Zn(at,pe.canonical,G,he,ae);De=hn[3]>0?ee[Ne]=hn:Et()}Ge+=$e,$e=s.distance(je,De)}fe&&ae&&(ee[Ne]&&(De=Et(),$e=s.distance(je,De)),ee[Ne]=De);const Xe=(Ye-Ge)/$e,ut=at.sub(Qe)._mult(Xe)._add(Qe),Tt=s.sub([],De,je),vt=s.scaleAndAdd([],je,Tt,Xe);let At=[0,0,1],tn=Tt[0],_n=Tt[1];if(te&&(At=he.upVector(pe.canonical,ut.x,ut.y),At[0]!==0||At[1]!==0||At[2]!==1)){const hn=[At[2],0,-At[0]],zn=s.cross([],At,hn);s.normalize(hn,hn),s.normalize(zn,zn),tn=s.dot(Tt,hn),_n=s.dot(Tt,zn)}if(h){const hn=s.cross([],At,Tt);s.normalize(hn,hn),s.scaleAndAdd(vt,vt,hn,h*ye)}const Zt=ve+Math.atan2(_n,tn);return kt.push(vt),ue&&qe.push(ut),{point:vt,angle:Zt,path:kt,tilePath:qe,up:At}}function Us(y,a){const h=a.length,x=h+4*y;a.resize(x),a.float32.fill(-1/0,4*h,4*x)}function jn(y,a,h){const x=a[0],T=a[1];return y[0]=h[0]*x+h[4]*T+h[12],y[1]=h[1]*x+h[5]*T+h[13],y[3]=h[3]*x+h[7]*T+h[15],y}const $s=100;class xl{constructor(a,h,x=new za(a.width+200,a.height+200,25),T=new za(a.width+200,a.height+200,25)){this.transform=a,this.grid=x,this.ignoredGrid=T,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+$s,this.screenBottomBoundary=a.height+$s,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=h}placeCollisionBox(a,h,x,T,k,N,D,B){let H=x.projectedAnchorX,G=x.projectedAnchorY,ee=x.projectedAnchorZ;const ae=x.elevation,ue=x.tileID,fe=a.getProjection();if(ae&&ue){const[De,je,Ge]=fe.upVector(ue.canonical,x.tileAnchorX,x.tileAnchorY),$e=fe.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=De*ae*$e,G+=je*ae*$e,ee+=Ge*ae*$e}const he=this.projectAndGetPerspectiveRatio(D,H,G,ee,x.tileID,fe.name==="globe"||!!ae||this.transform.pitch>0,fe),pe=N*he.perspectiveRatio,te=(x.x1*h+T.x-x.padding)*pe+he.point.x,ce=(x.y1*h+T.y-x.padding)*pe+he.point.y,ye=(x.x2*h+T.x+x.padding)*pe+he.point.x,ve=(x.y2*h+T.y+x.padding)*pe+he.point.y,Ne=he.perspectiveRatio<=.55||he.occluded;return!this.isInsideGrid(te,ce,ye,ve)||!k&&this.grid.hitTest(te,ce,ye,ve,B)||Ne?{box:[],offscreen:!1,occluded:he.occluded}:{box:[te,ce,ye,ve],offscreen:this.isOffscreen(te,ce,ye,ve),occluded:!1}}placeCollisionCircles(a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he){const pe=[],te=this.transform.elevation,ce=a.getProjection(),ye=te?te.getAtTileOffsetFunc(he,this.transform.center.lat,this.transform.worldSize,ce):null,ve=new s.Point(x.tileAnchorX,x.tileAnchorY);let{x:Ne,y:De,z:je}=ce.projectTilePoint(ve.x,ve.y,he.canonical);if(ye){const[ut,Tt,vt]=ye(ve);Ne+=ut,De+=Tt,je+=vt}const Ge=ce.name==="globe",$e=this.projectAndGetPerspectiveRatio(D,Ne,De,je,he,Ge||!!te||this.transform.pitch>0,ce),{perspectiveRatio:Ye}=$e,kt=(ee?N/Ye:N*Ye)/s.ONE_EM,qe=Ri(Ne,De,je,B),at=$e.signedDistanceFromCamera>0?ac(kt,k,x.lineOffsetX*kt,x.lineOffsetY*kt,!1,qe,ve,x,T,B,{},te&&!ee?ye:null,ee&&!!te,ce,he,ee):null;let Qe=!1,Et=!1,Xe=!0;if(at&&!$e.occluded){const ut=.5*ue*Ye+fe,Tt=new s.Point(-100,-100),vt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),At=new Ch,{first:tn,last:_n}=at,Zt=tn.path.length;let hn=[];for(let nn=Zt-1;nn>=1;nn--)hn.push(tn.path[nn]);for(let nn=1;nn<_n.path.length;nn++)hn.push(_n.path[nn]);const zn=2.5*ut;H&&(hn=hn.map((([nn,Wn,lr],cr)=>(ye&&!Ge&&(lr=ye(cr<Zt-1?tn.tilePath[Zt-1-cr]:_n.tilePath[cr-Zt+2])[2]),Ri(nn,Wn,lr,H)))),hn.some((nn=>nn[3]<=0))&&(hn=[]));let Gn=[];if(hn.length>0){let nn=1/0,Wn=-1/0,lr=1/0,cr=-1/0;for(const ir of hn)nn=Math.min(nn,ir[0]),lr=Math.min(lr,ir[1]),Wn=Math.max(Wn,ir[0]),cr=Math.max(cr,ir[1]);Wn>=Tt.x&&nn<=vt.x&&cr>=Tt.y&&lr<=vt.y&&(Gn=[hn.map((ir=>new s.Point(ir[0],ir[1])))],(nn<Tt.x||Wn>vt.x||lr<Tt.y||cr>vt.y)&&(Gn=s.clipLine(Gn,Tt.x,Tt.y,vt.x,vt.y)))}for(const nn of Gn){At.reset(nn,.25*ut);let Wn=0;Wn=At.length<=.5*ut?1:Math.ceil(At.paddedLength/zn)+1;for(let lr=0;lr<Wn;lr++){const cr=lr/Math.max(Wn-1,1),ir=At.lerp(cr),Li=ir.x+$s,qr=ir.y+$s;pe.push(Li,qr,ut,0);const Ks=Li-ut,_o=qr-ut,Mn=Li+ut,mr=qr+ut;if(Xe=Xe&&this.isOffscreen(Ks,_o,Mn,mr),Et=Et||this.isInsideGrid(Ks,_o,Mn,mr),!h&&this.grid.hitTestCircle(Li,qr,ut,ae)&&(Qe=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Qe,occluded:!1}}}}return{circles:!G&&Qe||!Et?[]:pe,offscreen:Xe,collisionDetected:Qe,occluded:$e.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let x=1/0,T=1/0,k=-1/0,N=-1/0;for(const G of a){const ee=new s.Point(G.x+$s,G.y+$s);x=Math.min(x,ee.x),T=Math.min(T,ee.y),k=Math.max(k,ee.x),N=Math.max(N,ee.y),h.push(ee)}const D=this.grid.query(x,T,k,N).concat(this.ignoredGrid.query(x,T,k,N)),B={},H={};for(const G of D){const ee=G.key;if(B[ee.bucketInstanceId]===void 0&&(B[ee.bucketInstanceId]={}),B[ee.bucketInstanceId][ee.featureIndex])continue;const ae=[new s.Point(G.x1,G.y1),new s.Point(G.x2,G.y1),new s.Point(G.x2,G.y2),new s.Point(G.x1,G.y2)];s.polygonIntersectsPolygon(h,ae)&&(B[ee.bucketInstanceId][ee.featureIndex]=!0,H[ee.bucketInstanceId]===void 0&&(H[ee.bucketInstanceId]=[]),H[ee.bucketInstanceId].push(ee.featureIndex))}return H}insertCollisionBox(a,h,x,T,k){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:T,collisionGroupID:k},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,x,T,k){const N=h?this.ignoredGrid:this.grid,D={bucketInstanceId:x,featureIndex:T,collisionGroupID:k};for(let B=0;B<a.length;B+=4)N.insertCircle(D,a[B],a[B+1],a[B+2])}projectAndGetPerspectiveRatio(a,h,x,T,k,N,D){const B=[h,x,T,1];let H=!1;T||this.transform.pitch>0?(s.transformMat4$1(B,B,a),this.fogState&&k&&D.name!=="globe"&&(H=(function(ae,ue,fe,he,pe,te){const ce=te.calculateFogTileMatrix(pe),ye=[ue,fe,he];return s.transformMat4(ye,ye,ce),We(ae,ye,te.pitch,te._fov)})(this.fogState,h,x,T,k.toUnwrapped(),this.transform)>.9)):jn(B,B,a);const G=B[3];return{point:new s.Point((B[0]/G+1)/2*this.transform.width+$s,(-B[1]/G+1)/2*this.transform.height+$s),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/G*.5,1.5),signedDistanceFromCamera:G,occluded:N&&B[2]>G||H}}isOffscreen(a,h,x,T){return x<$s||a>=this.screenRightBoundary||T<$s||h>this.screenBottomBoundary}isInsideGrid(a,h,x,T){return x>=0&&a<this.gridRightBoundary&&T>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=s.identity([]);return s.translate(a,a,[-100,-100,0]),a}}function or(y,a,h){const x=a.createTileMatrix(y,y.worldSize,h.toUnwrapped());return s.multiply(new Float32Array(16),y.projMatrix,x)}function Gs(y,a,h){if(a.projection.name===h.projection.name)return y.projMatrix;const x=h.clone();return x.setProjection(a.projection),or(x,a.getProjection(),y)}function Pr(y,a,h){return a.name===h.projection.name?y.projMatrix:or(h,a,y)}class ad{constructor(a,h,x,T){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):T&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Zo{constructor(a,h,x,T,k,N=!1){this.text=new ad(a?a.text:null,h,x,k),this.icon=new ad(a?a.icon:null,h,T,k),this.clipped=N}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class lc{constructor(a,h,x,T=!1){this.text=a,this.icon=h,this.skipFade=x,this.clipped=T}}class cc{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class cu{constructor(a,h,x,T,k){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=x,this.bucketIndex=T,this.tileID=k}}class uu{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:x=>x.collisionGroupID===h}}return this.collisionGroups[a]}}function co(y,a,h,x,T){const{horizontalAlign:k,verticalAlign:N}=s.getAnchorAlignment(y),D=-(k-.5)*a,B=-(N-.5)*h,H=s.evaluateVariableOffset(y,x);return new s.Point(D+H[0]*T,B+H[1]*T)}function uo(y,a,h,x,T){const k=new s.Point(y,a);return h&&k._rotate(x?T:-T),k}class Mo{constructor(a,h,x,T,k){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new xl(this.transform,k),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new uu(x),this.collisionCircleArrays={},this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,h,x,T){const k=x.getBucket(h),N=x.latestFeatureIndex;if(!k||!N||h.id!==k.layerIds[0])return;const D=k.layers[0].layout,B=x.collisionBoxArray,H=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),G=x.tileSize/s.EXTENT,ee=x.tileID.toUnwrapped();this.transform.setProjection(k.projection);const ae=(ue=x.tileID,fe=k.getProjection(),he=this.transform,fe.name===this.projection?he.calculateProjMatrix(ue.toUnwrapped()):or(he,fe,ue));var ue,fe,he;const pe=D.get("text-pitch-alignment")==="map",te=D.get("text-rotation-alignment")==="map";h.compileFilter();const ce=h.dynamicFilter(),ye=h.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(x),Ne=Si(ae,x.tileID.canonical,pe,te,this.transform,k.getProjection(),ve);let De=null;if(pe){const $e=ai(ae,x.tileID.canonical,pe,te,this.transform,k.getProjection(),ve);De=s.multiply([],this.transform.labelPlaneMatrix,$e)}let je=null;ce&&x.latestFeatureIndex&&(je={unwrappedTileID:ee,dynamicFilter:ce,dynamicFilterNeedsFeature:ye,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[k.bucketInstanceId]=new cu(k.bucketInstanceId,N,k.sourceLayerIndex,k.index,x.tileID);const Ge={bucket:k,layout:D,posMatrix:ae,textLabelPlaneMatrix:Ne,labelToScreenMatrix:De,clippingData:je,scale:H,textPixelRatio:G,holdingForFade:x.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(k.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(k.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(T)for(const $e of k.sortKeyRanges){const{sortKey:Ye,symbolInstanceStart:kt,symbolInstanceEnd:qe}=$e;a.push({sortKey:Ye,symbolInstanceStart:kt,symbolInstanceEnd:qe,parameters:Ge})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he,pe,te,ce){const{textOffset0:ye,textOffset1:ve,crossTileID:Ne}=ae,De=[ye,ve],je=co(a,x,T,De,k),Ge=this.collisionIndex.placeCollisionBox(fe,k,h,uo(je.x,je.y,N,D,this.transform.angle),ee,B,H,G.predicate);if(pe){const $e=fe.getSymbolInstanceIconSize(ce,this.transform.zoom,ae.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,$e,pe,uo(je.x,je.y,N,D,this.transform.angle),ee,B,H,G.predicate).box.length===0)return}if(Ge.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ne]&&this.prevPlacement.placements[Ne]&&this.prevPlacement.placements[Ne].text&&($e=this.prevPlacement.variableOffsets[Ne].anchor),this.variableOffsets[Ne]={textOffset:De,width:x,height:T,anchor:a,textScale:k,prevAnchor:$e},this.markUsedJustification(fe,a,ae,he),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,he,ae),this.placedOrientations[Ne]=he),{shift:je,placedGlyphBoxes:Ge}}}placeLayerBucketPart(a,h,x,T){const{bucket:k,layout:N,posMatrix:D,textLabelPlaneMatrix:B,labelToScreenMatrix:H,clippingData:G,textPixelRatio:ee,holdingForFade:ae,collisionBoxArray:ue,partiallyEvaluatedTextSize:fe,partiallyEvaluatedIconSize:he,collisionGroup:pe}=a.parameters,te=N.get("text-optional"),ce=N.get("icon-optional"),ye=N.get("text-allow-overlap"),ve=N.get("icon-allow-overlap"),Ne=N.get("text-rotation-alignment")==="map",De=N.get("text-pitch-alignment")==="map",je=N.get("icon-text-fit")!=="none",Ge=N.get("symbol-z-order")==="viewport-y";this.transform.setProjection(k.projection);let $e=ye&&(ve||!k.hasIconData()||ce),Ye=ve&&(ye||!k.hasTextData()||te);!k.collisionArrays&&ue&&k.deserializeCollisionBoxes(ue),x&&T&&k.updateCollisionDebugBuffers(this.transform.zoom,ue);const kt=(qe,at,Qe)=>{const{crossTileID:Et,numVerticalGlyphVertices:Xe}=qe;if(G){const Mn={zoom:this.transform.zoom,pitch:this.transform.pitch};let mr=null;if(G.dynamicFilterNeedsFeature){const nr=this.retainedQueryData[k.bucketInstanceId];mr=G.featureIndex.loadFeature({featureIndex:qe.featureIndex,bucketIndex:nr.bucketIndex,sourceLayerIndex:nr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,G.dynamicFilter)(Mn,mr,this.retainedQueryData[k.bucketInstanceId].tileID.canonical,new s.Point(qe.tileAnchorX,qe.tileAnchorY),this.transform.calculateDistanceTileData(G.unwrappedTileID)))return this.placements[Et]=new lc(!1,!1,!1,!0),void h.add(Et)}if(h.has(Et))return;if(ae)return void(this.placements[Et]=new lc(!1,!1,!1));let ut=!1,Tt=!1,vt=!0,At=!1,tn=!1,_n=null,Zt={box:null,offscreen:null,occluded:null},hn={box:null},zn=null,Gn=null,nn=null,Wn=0,lr=0,cr=0;Qe.textFeatureIndex?Wn=Qe.textFeatureIndex:qe.useRuntimeCollisionCircles&&(Wn=qe.featureIndex),Qe.verticalTextFeatureIndex&&(lr=Qe.verticalTextFeatureIndex);const ir=Mn=>{Mn.tileID=this.retainedQueryData[k.bucketInstanceId].tileID;const mr=this.transform.elevation;(mr||Mn.elevation)&&(Mn.elevation=mr?mr.getAtTileOffset(Mn.tileID,Mn.tileAnchorX,Mn.tileAnchorY):0)},Li=Qe.textBox;if(Li){ir(Li);const Mn=nr=>{let Wr=s.WritingMode.horizontal;if(k.allowVerticalPlacement&&!nr&&this.prevPlacement){const Oi=this.prevPlacement.placedOrientations[Et];Oi&&(this.placedOrientations[Et]=Oi,Wr=Oi,this.markUsedOrientation(k,Wr,qe))}return Wr},mr=(nr,Wr)=>{if(k.allowVerticalPlacement&&Xe>0&&Qe.verticalTextBox){for(const Oi of k.writingModes)if(Oi===s.WritingMode.vertical?(Zt=Wr(),hn=Zt):Zt=nr(),Zt&&Zt.box&&Zt.box.length)break}else Zt=nr()};if(N.get("text-variable-anchor")){let nr=N.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Et]){const wr=this.prevPlacement.variableOffsets[Et];nr.indexOf(wr.anchor)>0&&(nr=nr.filter((pi=>pi!==wr.anchor)),nr.unshift(wr.anchor))}const Wr=(wr,pi,Or)=>{const Fr=k.getSymbolInstanceTextSize(fe,qe,this.transform.zoom,at),Jr=(wr.x2-wr.x1)*Fr+2*wr.padding,vo=(wr.y2-wr.y1)*Fr+2*wr.padding,xo=je&&!ve?pi:null;xo&&ir(xo);let Lo={box:[],offscreen:!1,occluded:!1};const Pd=ye?2*nr.length:nr.length;for(let mi=0;mi<Pd;++mi){const ju=this.attemptAnchorPlacement(nr[mi%nr.length],wr,Jr,vo,Fr,Ne,De,ee,D,pe,mi>=nr.length,qe,at,k,Or,xo,fe,he);if(ju&&(Lo=ju.placedGlyphBoxes,Lo&&Lo.box&&Lo.box.length)){ut=!0,_n=ju.shift;break}}return Lo};mr((()=>Wr(Li,Qe.iconBox,s.WritingMode.horizontal)),(()=>{const wr=Qe.verticalTextBox;return wr&&ir(wr),k.allowVerticalPlacement&&!(Zt&&Zt.box&&Zt.box.length)&&Xe>0&&wr?Wr(wr,Qe.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),Zt&&(ut=Zt.box,vt=Zt.offscreen,At=Zt.occluded);const Oi=Mn(!(!Zt||!Zt.box));if(!ut&&this.prevPlacement){const wr=this.prevPlacement.variableOffsets[Et];wr&&(this.variableOffsets[Et]=wr,this.markUsedJustification(k,wr.anchor,qe,Oi))}}else{const nr=(Wr,Oi)=>{const wr=k.getSymbolInstanceTextSize(fe,qe,this.transform.zoom,at),pi=this.collisionIndex.placeCollisionBox(k,wr,Wr,new s.Point(0,0),ye,ee,D,pe.predicate);return pi&&pi.box&&pi.box.length&&(this.markUsedOrientation(k,Oi,qe),this.placedOrientations[Et]=Oi),pi};mr((()=>nr(Li,s.WritingMode.horizontal)),(()=>{const Wr=Qe.verticalTextBox;return k.allowVerticalPlacement&&Xe>0&&Wr?(ir(Wr),nr(Wr,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),Mn(!!(Zt&&Zt.box&&Zt.box.length))}}if(zn=Zt,ut=zn&&zn.box&&zn.box.length>0,vt=zn&&zn.offscreen,At=zn&&zn.occluded,qe.useRuntimeCollisionCircles){const Mn=k.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),mr=s.evaluateSizeForFeature(k.textSizeData,fe,Mn),nr=N.get("text-padding");Gn=this.collisionIndex.placeCollisionCircles(k,ye,Mn,k.lineVertexArray,k.glyphOffsetArray,mr,D,B,H,x,De,pe.predicate,qe.collisionCircleDiameter*mr/s.ONE_EM,nr,this.retainedQueryData[k.bucketInstanceId].tileID),ut=ye||Gn.circles.length>0&&!Gn.collisionDetected,vt=vt&&Gn.offscreen,At=Gn.occluded}if(Qe.iconFeatureIndex&&(cr=Qe.iconFeatureIndex),Qe.iconBox){const Mn=mr=>{ir(mr);const nr=je&&_n?uo(_n.x,_n.y,Ne,De,this.transform.angle):new s.Point(0,0),Wr=k.getSymbolInstanceIconSize(he,this.transform.zoom,qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(k,Wr,mr,nr,ve,ee,D,pe.predicate)};hn&&hn.box&&hn.box.length&&Qe.verticalIconBox?(nn=Mn(Qe.verticalIconBox),Tt=nn.box.length>0):(nn=Mn(Qe.iconBox),Tt=nn.box.length>0),vt=vt&&nn.offscreen,tn=nn.occluded}const qr=te||qe.numHorizontalGlyphVertices===0&&Xe===0,Ks=ce||qe.numIconVertices===0;if(qr||Ks?Ks?qr||(Tt=Tt&&ut):ut=Tt&&ut:Tt=ut=Tt&&ut,ut&&zn&&zn.box&&this.collisionIndex.insertCollisionBox(zn.box,N.get("text-ignore-placement"),k.bucketInstanceId,hn&&hn.box&&lr?lr:Wn,pe.ID),Tt&&nn&&this.collisionIndex.insertCollisionBox(nn.box,N.get("icon-ignore-placement"),k.bucketInstanceId,cr,pe.ID),Gn&&(ut&&this.collisionIndex.insertCollisionCircles(Gn.circles,N.get("text-ignore-placement"),k.bucketInstanceId,Wn,pe.ID),x)){const Mn=k.bucketInstanceId;let mr=this.collisionCircleArrays[Mn];mr===void 0&&(mr=this.collisionCircleArrays[Mn]=new cc);for(let nr=0;nr<Gn.circles.length;nr+=4)mr.circles.push(Gn.circles[nr+0]),mr.circles.push(Gn.circles[nr+1]),mr.circles.push(Gn.circles[nr+2]),mr.circles.push(Gn.collisionDetected?1:0)}const _o=k.projection.name!=="globe";$e=$e&&(_o||!At),Ye=Ye&&(_o||!tn),this.placements[Et]=new lc(ut||$e,Tt||Ye,vt||k.justReloaded),h.add(Et)};if(Ge){const qe=k.getSortedSymbolIndexes(this.transform.angle);for(let at=qe.length-1;at>=0;--at){const Qe=qe[at];kt(k.symbolInstances.get(Qe),Qe,k.collisionArrays[Qe])}}else for(let qe=a.symbolInstanceStart;qe<a.symbolInstanceEnd;qe++)kt(k.symbolInstances.get(qe),qe,k.collisionArrays[qe]);if(x&&k.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[k.bucketInstanceId];s.invert(qe.invProjMatrix,D),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1}markUsedJustification(a,h,x,T){const{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:B,crossTileID:H}=x,G=s.getAnchorJustification(h),ee=T===s.WritingMode.vertical?B:G==="left"?k:G==="center"?N:G==="right"?D:-1;k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=ee>=0&&k!==ee?0:H),N>=0&&(a.text.placedSymbolArray.get(N).crossTileID=ee>=0&&N!==ee?0:H),D>=0&&(a.text.placedSymbolArray.get(D).crossTileID=ee>=0&&D!==ee?0:H),B>=0&&(a.text.placedSymbolArray.get(B).crossTileID=ee>=0&&B!==ee?0:H)}markUsedOrientation(a,h,x){const T=h===s.WritingMode.horizontal||h===s.WritingMode.horizontalOnly?h:0,k=h===s.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:H}=x,G=a.text.placedSymbolArray;N>=0&&(G.get(N).placedOrientation=T),D>=0&&(G.get(D).placedOrientation=T),B>=0&&(G.get(B).placedOrientation=T),H>=0&&(G.get(H).placedOrientation=k)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let x=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const T=h?h.symbolFadeChange(a):1,k=h?h.opacities:{},N=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const B in this.placements){const H=this.placements[B],G=k[B];G?(this.opacities[B]=new Zo(G,T,H.text,H.icon,null,H.clipped),x=x||H.text!==G.text.placed||H.icon!==G.icon.placed):(this.opacities[B]=new Zo(null,T,H.text,H.icon,H.skipFade,H.clipped),x=x||H.text||H.icon)}for(const B in k){const H=k[B];if(!this.opacities[B]){const G=new Zo(H,T,!1,!1);G.isHidden()||(this.opacities[B]=G,x=x||H.text.placed||H.icon.placed)}}for(const B in N)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=N[B]);for(const B in D)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=D[B]);x?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const x=new Set;for(const T of h){const k=T.getBucket(a);k&&T.latestFeatureIndex&&a.id===k.layerIds[0]&&this.updateBucketOpacities(k,x,T.collisionBoxArray)}}updateBucketOpacities(a,h,x){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const T=a.layers[0].layout,k=!!a.layers[0].dynamicFilter(),N=new Zo(null,0,!1,!1,!0),D=T.get("text-allow-overlap"),B=T.get("icon-allow-overlap"),H=T.get("text-variable-anchor"),G=T.get("text-rotation-alignment")==="map",ee=T.get("text-pitch-alignment")==="map",ae=T.get("icon-text-fit")!=="none",ue=new Zo(null,0,D&&(B||!a.hasIconData()||T.get("icon-optional")),B&&(D||!a.hasTextData()||T.get("text-optional")),!0);!a.collisionArrays&&x&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(x);const fe=(pe,te,ce)=>{for(let ye=0;ye<te/4;ye++)pe.opacityVertexArray.emplaceBack(ce)};let he=0;for(let pe=0;pe<a.symbolInstances.length;pe++){const te=a.symbolInstances.get(pe),{numHorizontalGlyphVertices:ce,numVerticalGlyphVertices:ye,crossTileID:ve,numIconVertices:Ne}=te,De=h.has(ve);let je=this.opacities[ve];De?je=N:je||(je=ue,this.opacities[ve]=je),h.add(ve);const Ge=ce>0||ye>0,$e=Ne>0,Ye=this.placedOrientations[ve],kt=Ye===s.WritingMode.vertical,qe=Ye===s.WritingMode.horizontal||Ye===s.WritingMode.horizontalOnly;if(!Ge&&!$e||je.isHidden()||he++,Ge){const at=Ba(je.text);fe(a.text,ce,kt?Ur:at),fe(a.text,ye,qe?Ur:at);const Qe=je.text.isHidden(),{leftJustifiedTextSymbolIndex:Et,centerJustifiedTextSymbolIndex:Xe,rightJustifiedTextSymbolIndex:ut,verticalPlacedTextSymbolIndex:Tt}=te,vt=a.text.placedSymbolArray,At=Qe||kt?1:0;Et>=0&&(vt.get(Et).hidden=At),Xe>=0&&(vt.get(Xe).hidden=At),ut>=0&&(vt.get(ut).hidden=At),Tt>=0&&(vt.get(Tt).hidden=Qe||qe?1:0);const tn=this.variableOffsets[ve];tn&&this.markUsedJustification(a,tn.anchor,te,Ye);const _n=this.placedOrientations[ve];_n&&(this.markUsedJustification(a,"left",te,_n),this.markUsedOrientation(a,_n,te))}if($e){const at=Ba(je.icon),{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:Et}=te,Xe=a.icon.placedSymbolArray,ut=je.icon.isHidden()?1:0;Qe>=0&&(fe(a.icon,Ne,kt?Ur:at),Xe.get(Qe).hidden=ut),Et>=0&&(fe(a.icon,te.numVerticalIconVertices,qe?Ur:at),Xe.get(Et).hidden=ut)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const at=a.collisionArrays[pe];if(at){let Qe=new s.Point(0,0),Et=!0;if(at.textBox||at.verticalTextBox){if(H){const ut=this.variableOffsets[ve];ut?(Qe=co(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textScale),G&&Qe._rotate(ee?this.transform.angle:-this.transform.angle)):Et=!1}k&&(Et=!je.clipped),at.textBox&&Ko(a.textCollisionBox.collisionVertexArray,je.text.placed,!Et||kt,Qe.x,Qe.y),at.verticalTextBox&&Ko(a.textCollisionBox.collisionVertexArray,je.text.placed,!Et||qe,Qe.x,Qe.y)}const Xe=Et&&!!(!qe&&at.verticalIconBox);at.iconBox&&Ko(a.iconCollisionBox.collisionVertexArray,je.icon.placed,Xe,ae?Qe.x:0,ae?Qe.y:0),at.verticalIconBox&&Ko(a.iconCollisionBox.collisionVertexArray,je.icon.placed,!Xe,ae?Qe.x:0,ae?Qe.y:0)}}}if(a.fullyClipped=he===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=pe.invProjMatrix,a.placementViewportMatrix=pe.viewportMatrix,a.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const x=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*x>a}setStale(){this.stale=!0}}function Ko(y,a,h,x,T){y.emplaceBack(a?1:0,h?1:0,x||0,T||0),y.emplaceBack(a?1:0,h?1:0,x||0,T||0),y.emplaceBack(a?1:0,h?1:0,x||0,T||0),y.emplaceBack(a?1:0,h?1:0,x||0,T||0)}const Ni=Math.pow(2,25),xr=Math.pow(2,24),kh=Math.pow(2,17),ld=Math.pow(2,16),ji=Math.pow(2,9),ho=Math.pow(2,8),Ah=Math.pow(2,1);function Ba(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,h=Math.floor(127*y.opacity);return h*Ni+a*xr+h*kh+a*ld+h*ji+a*ho+h*Ah+a}const Ur=0;class du{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,h,x,T,k){const N=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(N,T,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort(((D,B)=>D.sortKey-B.sortKey)));this._currentPartIndex<N.length;){const D=N[this._currentPartIndex];if(h.placeLayerBucketPart(D,this._seenCrossTileIDs,x,D.symbolInstanceStart===0),this._currentPartIndex++,k())return!0}return!1}}class wl{constructor(a,h,x,T,k,N,D,B){this.placement=new Mo(a,k,N,D,B),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(a,h,x){const T=s.exported.now(),k=()=>{const N=s.exported.now()-T;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=h[a[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=D)&&(!N.maxzoom||N.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new du(N)),this._inProgressLayer.continuePlacement(x[N.source],this.placement,this._showCollisionBoxes,N,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Io=512/s.EXTENT/2;class Yr{constructor(a,h,x){this.tileID=a,this.bucketInstanceId=x,this.index=new s.KDBush(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const T=a.canonical.x*s.EXTENT,k=a.canonical.y*s.EXTENT;for(let N=0;N<h.length;N++){const{key:D,crossTileID:B,tileAnchorX:H,tileAnchorY:G}=h.get(N),ee=Math.floor((T+H)*Io),ae=Math.floor((k+G)*Io);this.index.add(ee,ae),this.keys.push(D),this.crossTileIDs.push(B)}this.index.finish()}findMatches(a,h,x){const T=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),k=Io/Math.pow(2,h.canonical.z-this.tileID.canonical.z),N=h.canonical.x*s.EXTENT,D=h.canonical.y*s.EXTENT;for(let B=0;B<a.length;B++){const H=a.get(B);if(H.crossTileID)continue;const{key:G,tileAnchorX:ee,tileAnchorY:ae}=H,ue=Math.floor((N+ee)*k),fe=Math.floor((D+ae)*k),he=this.index.range(ue-T,fe-T,ue+T,fe+T);for(const pe of he){const te=this.crossTileIDs[pe];if(this.keys[pe]===G&&!x.has(te)){x.add(te),H.crossTileID=te;break}}}}}class uc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const x in this.indexes){const T=this.indexes[x],k={};for(const N in T){const D=T[N];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),k[D.tileID.key]=D}this.indexes[x]=k}this.lng=a}addBucket(a,h,x){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let k=0;k<h.symbolInstances.length;k++)h.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const T=this.usedCrossTileIDs[a.overscaledZ];for(const k in this.indexes){const N=this.indexes[k];if(Number(k)>a.overscaledZ)for(const D in N){const B=N[D];B.tileID.isChildOf(a)&&B.findMatches(h.symbolInstances,a,T)}else{const D=N[a.scaledTo(Number(k)).key];D&&D.findMatches(h.symbolInstances,a,T)}}for(let k=0;k<h.symbolInstances.length;k++){const N=h.symbolInstances.get(k);N.crossTileID||(N.crossTileID=x.generate(),T.add(N.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Yr(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const x of h.crossTileIDs)this.usedCrossTileIDs[a].delete(x)}removeStaleBuckets(a){let h=!1;for(const x in this.indexes){const T=this.indexes[x];for(const k in T)a[T[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,T[k]),delete T[k],h=!0)}return h}}class pa{constructor(){this.layerIndexes={},this.crossTileIDs=new uc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,x,T){let k=this.layerIndexes[a.id];k===void 0&&(k=this.layerIndexes[a.id]=new Ph);let N=!1;const D={};T.name!=="globe"&&k.handleWrapJump(x);for(const B of h){const H=B.getBucket(a);H&&a.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(B.tileID,H,this.crossTileIDs)&&(N=!0),D[H.bucketInstanceId]=!0)}return k.removeStaleBuckets(D)&&(N=!0),N}pruneUnusedLayers(a){const h={};a.forEach((x=>{h[x]=!0}));for(const x in this.layerIndexes)h[x]||delete this.layerIndexes[x]}}const Xo=(y,a)=>s.emitValidationErrors(y,a&&a.filter((h=>h.identifier!=="source.canvas"))),bl=s.pick(sr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Mh=s.pick(sr,["setCenter","setZoom","setBearing","setPitch"]),cd={version:8,layers:[],sources:{}},Hs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class fo extends s.Evented{constructor(a,h={}){super(),this.map=a,this.dispatcher=new ke(vl(),this),this.imageManager=new ft,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(a._requestManager,h.localFontFamily?s.LocalGlyphMode.all:h.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new pa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const x=this;this._rtlTextPluginCallback=fo.registerForPluginStateChange((T=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},((k,N)=>{if(s.triggerPluginCompletionEvent(k),N&&N.every((D=>D)))for(const D in x._sourceCaches){const B=x._sourceCaches[D],H=B.getSource().type;H!=="vector"&&H!=="geojson"||B.reload()}}))})),this.on("data",(T=>{if(T.dataType!=="source"||T.sourceDataType!=="metadata")return;const k=this.getSource(T.sourceId);if(k&&k.vectorLayerIds)for(const N in this._layers){const D=this._layers[N];D.source===k.id&&this._validateLayer(D)}}))}loadURL(a,h={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const x=typeof h.validate=="boolean"?h.validate:!s.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);const T=this.map._requestManager.transformRequest(a,s.ResourceType.Style);this._request=s.getJSON(T,((k,N)=>{this._request=null,k?this.fire(new s.ErrorEvent(k)):N&&this._load(N,x)}))}loadJSON(a,h={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame((()=>{this._request=null,this._load(a,h.validate!==!1)}))}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(cd,!1)}_updateLayerCount(a,h){const x=h?1:-1;a.is3D()&&(this._num3DLayers+=x),a.type==="circle"&&(this._numCircleLayers+=x),a.type==="symbol"&&(this._numSymbolLayers+=x)}_load(a,h){if(h&&Xo(this,s.validateStyle(a)))return;this._loaded=!0,this.stylesheet=s.clone$1(a),this._updateMapProjection();for(const T in a.sources)this.addSource(T,a.sources[T],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const x=Sh(this.stylesheet.layers);this._order=x.map((T=>T.id)),this._layers={},this._serializedLayers={};for(const T of x){const k=s.createStyleLayer(T);k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize(),this._updateLayerCount(k,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=(function(h,x,T){let k,N,D;const B=s.exported.devicePixelRatio>1?"@2x":"";let H=s.getJSON(x.transformRequest(x.normalizeSpriteURL(h,B,".json"),s.ResourceType.SpriteJSON),((ae,ue)=>{H=null,D||(D=ae,k=ue,ee())})),G=s.getImage(x.transformRequest(x.normalizeSpriteURL(h,B,".png"),s.ResourceType.SpriteImage),((ae,ue)=>{G=null,D||(D=ae,N=ue,ee())}));function ee(){if(D)T(D);else if(k&&N){const ae=s.exported.getImageData(N),ue={};for(const fe in k){const{width:he,height:pe,x:te,y:ce,sdf:ye,pixelRatio:ve,stretchX:Ne,stretchY:De,content:je}=k[fe],Ge=new s.RGBAImage({width:he,height:pe});s.RGBAImage.copy(ae,Ge,{x:te,y:ce},{x:0,y:0},{width:he,height:pe}),ue[fe]={data:Ge,pixelRatio:ve,sdf:ye,stretchX:Ne,stretchY:De,content:je}}T(null,ue)}}return{cancel(){H&&(H.cancel(),H=null),G&&(G.cancel(),G=null)}}})(a,this.map._requestManager,((h,x)=>{if(this._spriteRequest=null,h)this.fire(new s.ErrorEvent(h));else if(x)for(const T in x)this.imageManager.addImage(T,x[T]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))}))}_validateLayer(a){const h=this.getSource(a.source);if(!h)return;const x=a.sourceLayer;x&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(x)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${h.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const h=[];for(const x of a){const T=this._layers[x];T.type!=="custom"&&h.push(T.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped():Hs[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const h=this._changed;if(this._changed){const T=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(T.length||k.length)&&this._updateWorkerLayers(T,k);for(const N in this._updatedSources){const D=this._updatedSources[N];D==="reload"?this._reloadSource(N):D==="clear"&&this._clearSource(N)}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const x={};for(const T in this._sourceCaches){const k=this._sourceCaches[T];x[T]=k.used,k.used=!1}for(const T of this._order){const k=this._layers[T];if(k.recalculate(a,this._availableImages),!k.isHidden(a.zoom)){const D=this._getLayerSourceCache(k);D&&(D.used=!0)}const N=this.map.painter;if(N){const D=k.getProgramIds();if(!D)continue;const B=k.getProgramConfiguration(a.zoom);for(const H of D)N.useProgram(H,B)}}for(const T in x){const k=this._sourceCaches[T];x[T]!==k.used&&k.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Xo(this,s.validateStyle(a)))return!1;(a=s.clone$1(a)).layers=Sh(a.layers);const h=(function(T,k){if(!T)return[{command:sr.setStyle,args:[k]}];let N=[];try{if(!S(T.version,k.version))return[{command:sr.setStyle,args:[k]}];S(T.center,k.center)||N.push({command:sr.setCenter,args:[k.center]}),S(T.zoom,k.zoom)||N.push({command:sr.setZoom,args:[k.zoom]}),S(T.bearing,k.bearing)||N.push({command:sr.setBearing,args:[k.bearing]}),S(T.pitch,k.pitch)||N.push({command:sr.setPitch,args:[k.pitch]}),S(T.sprite,k.sprite)||N.push({command:sr.setSprite,args:[k.sprite]}),S(T.glyphs,k.glyphs)||N.push({command:sr.setGlyphs,args:[k.glyphs]}),S(T.transition,k.transition)||N.push({command:sr.setTransition,args:[k.transition]}),S(T.light,k.light)||N.push({command:sr.setLight,args:[k.light]}),S(T.fog,k.fog)||N.push({command:sr.setFog,args:[k.fog]}),S(T.projection,k.projection)||N.push({command:sr.setProjection,args:[k.projection]});const D={},B=[];(function(ee,ae,ue,fe){let he;for(he in ae=ae||{},ee=ee||{})ee.hasOwnProperty(he)&&(ae.hasOwnProperty(he)||lu(he,ue,fe));for(he in ae){if(!ae.hasOwnProperty(he))continue;const pe=ae[he];ee.hasOwnProperty(he)?S(ee[he],pe)||(ee[he].type==="geojson"&&pe.type==="geojson"&&od(ee,ae,he)?ue.push({command:sr.setGeoJSONSourceData,args:[he,pe.data]}):Hr(he,ae,ue,fe)):Eh(he,ae,ue)}})(T.sources,k.sources,B,D);const H=[];T.layers&&T.layers.forEach((ee=>{ee.source&&D[ee.source]?N.push({command:sr.removeLayer,args:[ee.id]}):H.push(ee)}));let G=T.terrain;G&&D[G.source]&&(N.push({command:sr.setTerrain,args:[void 0]}),G=void 0),N=N.concat(B),S(G,k.terrain)||N.push({command:sr.setTerrain,args:[k.terrain]}),(function(ee,ae,ue){ae=ae||[];const fe=(ee=ee||[]).map(Wo),he=ae.map(Wo),pe=ee.reduce(sc,{}),te=ae.reduce(sc,{}),ce=fe.slice(),ye=Object.create(null);let ve,Ne,De,je,Ge,$e,Ye;for(ve=0,Ne=0;ve<fe.length;ve++)De=fe[ve],te.hasOwnProperty(De)?Ne++:(ue.push({command:sr.removeLayer,args:[De]}),ce.splice(ce.indexOf(De,Ne),1));for(ve=0,Ne=0;ve<he.length;ve++)De=he[he.length-1-ve],ce[ce.length-1-ve]!==De&&(pe.hasOwnProperty(De)?(ue.push({command:sr.removeLayer,args:[De]}),ce.splice(ce.lastIndexOf(De,ce.length-Ne),1)):Ne++,$e=ce[ce.length-ve],ue.push({command:sr.addLayer,args:[te[De],$e]}),ce.splice(ce.length-ve,0,De),ye[De]=!0);for(ve=0;ve<he.length;ve++)if(De=he[ve],je=pe[De],Ge=te[De],!ye[De]&&!S(je,Ge))if(S(je.source,Ge.source)&&S(je["source-layer"],Ge["source-layer"])&&S(je.type,Ge.type)){for(Ye in ao(je.layout,Ge.layout,ue,De,null,sr.setLayoutProperty),ao(je.paint,Ge.paint,ue,De,null,sr.setPaintProperty),S(je.filter,Ge.filter)||ue.push({command:sr.setFilter,args:[De,Ge.filter]}),S(je.minzoom,Ge.minzoom)&&S(je.maxzoom,Ge.maxzoom)||ue.push({command:sr.setLayerZoomRange,args:[De,Ge.minzoom,Ge.maxzoom]}),je)je.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ao(je[Ye],Ge[Ye],ue,De,Ye.slice(6),sr.setPaintProperty):S(je[Ye],Ge[Ye])||ue.push({command:sr.setLayerProperty,args:[De,Ye,Ge[Ye]]}));for(Ye in Ge)Ge.hasOwnProperty(Ye)&&!je.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ao(je[Ye],Ge[Ye],ue,De,Ye.slice(6),sr.setPaintProperty):S(je[Ye],Ge[Ye])||ue.push({command:sr.setLayerProperty,args:[De,Ye,Ge[Ye]]}))}else ue.push({command:sr.removeLayer,args:[De]}),$e=ce[ce.lastIndexOf(De)+1],ue.push({command:sr.addLayer,args:[Ge,$e]})})(H,k.layers,N)}catch(D){console.warn("Unable to compute style diff:",D),N=[{command:sr.setStyle,args:[k]}]}return N})(this.serialize(),a).filter((T=>!(T.command in Mh)));if(h.length===0)return!1;const x=h.filter((T=>!(T.command in bl)));if(x.length>0)throw new Error(`Unimplemented: ${x.map((T=>T.command)).join(", ")}.`);return h.forEach((T=>{T.command!=="setTransition"&&T.command!=="setProjection"&&this[T.command].apply(this,T.args)})),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,h){return this.getImage(a)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,h),this._afterImageUpdated(a),this)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,h,x={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.validateSource,`sources.${a}`,h,null,x))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const T=Nn(a,h,this.dispatcher,this);T.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:T.serialize(),sourceId:a})));const k=N=>{const D=(N?"symbol:":"other:")+a,B=this._sourceCaches[D]=new s.SourceCache(D,T,N);(N?this._symbolSourceCaches:this._otherSourceCaches)[a]=B,B.style=this,B.onAdd(this.map)};k(!1),h.type!=="vector"&&h.type!=="geojson"||k(!0),T.onAdd&&T.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const h=this.getSource(a);if(!h)throw new Error("There is no source with this ID");for(const T in this._layers)if(this._layers[T].source===a)return this.fire(new s.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${T}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new s.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(a);for(const T of x)delete this._sourceCaches[T.id],delete this._updatedSources[T.id],T.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:T.getSource().id})),T.setEventedParent(null),T.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,h){this._checkLoaded(),this.getSource(a).setData(h),this._changed=!0}getSource(a){const h=this._getSourceCache(a);return h&&h.getSource()}_getSources(){const a=[];for(const h in this._otherSourceCaches){const x=this._getSourceCache(h);x&&a.push(x.getSource())}return a}addLayer(a,h,x={}){this._checkLoaded();const T=a.id;if(this.getLayer(T))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${T}" already exists on this map`)));let k;if(a.type==="custom"){if(Xo(this,s.validateCustomStyleLayer(a)))return;k=s.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(T,a.source),a=s.clone$1(a),a=s.extend(a,{source:T})),this._validate(s.validateLayer,`layers.${T}`,a,{arrayIndex:-1},x))return;k=s.createStyleLayer(a),this._validateLayer(k),k.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[k.id]=k.serialize(),this._updateLayerCount(k,!0)}const N=h?this._order.indexOf(h):this._order.length;if(h&&N===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(N,0,T),this._layerOrderChanged=!0,this._layers[T]=k;const D=this._getLayerSourceCache(k);if(this._removedLayers[T]&&k.source&&D&&k.type!=="custom"){const B=this._removedLayers[T];delete this._removedLayers[T],B.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",D.pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const x=this._order.indexOf(a);this._order.splice(x,1);const T=h?this._order.indexOf(h):this._order.length;h&&T===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(T,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const x=this._order.indexOf(a);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const h in this._layers)if(this._layers[h].type===a)return!0;return!1}setLayerZoomRange(a,h,x){this._checkLoaded();const T=this.getLayer(a);T?T.minzoom===h&&T.maxzoom===x||(h!=null&&(T.minzoom=h),x!=null&&(T.maxzoom=x),this._updateLayer(T)):this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,h,x={}){this._checkLoaded();const T=this.getLayer(a);if(T){if(!S(T.filter,h))return h==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(s.validateFilter,`layers.${T.id}.filter`,h,{layerType:T.type},x)||(T.filter=s.clone$1(h),this._updateLayer(T)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const h=this.getLayer(a);return h&&s.clone$1(h.filter)}setLayoutProperty(a,h,x,T={}){this._checkLoaded();const k=this.getLayer(a);k?S(k.getLayoutProperty(h),x)||(k.setLayoutProperty(h,x,T),this._updateLayer(k)):this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,h){const x=this.getLayer(a);if(x)return x.getLayoutProperty(h);this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,h,x,T={}){this._checkLoaded();const k=this.getLayer(a);k?S(k.getPaintProperty(h),x)||(k.setPaintProperty(h,x,T)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,h){const x=this.getLayer(a);return x&&x.getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const x=a.source,T=a.sourceLayer,k=this.getSource(x);if(!k)return void this.fire(new s.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const N=k.type;if(N==="geojson"&&T)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(N==="vector"&&!T)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const D=this._getSourceCaches(x);for(const B of D)B.setFeatureState(T,a.id,h)}removeFeatureState(a,h){this._checkLoaded();const x=a.source,T=this.getSource(x);if(!T)return void this.fire(new s.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const k=T.type,N=k==="vector"?a.sourceLayer:void 0;if(k==="vector"&&!N)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const D=this._getSourceCaches(x);for(const B of D)B.removeFeatureState(N,a.id,h)}getFeatureState(a){this._checkLoaded();const h=a.source,x=a.sourceLayer,T=this.getSource(h);if(T){if(T.type!=="vector"||x)return a.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(x,a.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const h in this._sourceCaches){const x=this._sourceCaches[h].getSource();a[x.id]||(a[x.id]=x.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},(h=>h!==void 0))}_updateLayer(a){this._updatedLayers[a.id]=!0;const h=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",h.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const h=N=>this._layers[N].type==="fill-extrusion",x={},T=[];for(let N=this._order.length-1;N>=0;N--){const D=this._order[N];if(h(D)){x[D]=N;for(const B of a){const H=B[D];if(H)for(const G of H)T.push(G)}}}T.sort(((N,D)=>D.intersectionZ-N.intersectionZ));const k=[];for(let N=this._order.length-1;N>=0;N--){const D=this._order[N];if(h(D))for(let B=T.length-1;B>=0;B--){const H=T[B].feature;if(x[H.layer.id]<N)break;k.push(H),T.pop()}else for(const B of a){const H=B[D];if(H)for(const G of H)k.push(G.feature)}}return k}queryRenderedFeatures(a,h,x){h&&h.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const T={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of h.layers){const H=this._layers[B];if(!H)return this.fire(new s.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];T[H.source]=!0}}const k=[];h.availableImages=this._availableImages;const N=h&&h.layers?h.layers.some((B=>{const H=this.getLayer(B);return H&&H.is3D()})):this.has3DLayers(),D=bt.createFromScreenPoints(a,x);for(const B in this._sourceCaches){const H=this._sourceCaches[B].getSource().id;h.layers&&!T[H]||k.push(Br(this._sourceCaches[B],this._layers,this._serializedLayers,D,h,x,N,!!this.map._showQueryGeometry))}return this.placement&&k.push((function(B,H,G,ee,ae,ue,fe){const he={},pe=ue.queryRenderedSymbols(ee),te=[];for(const ce of Object.keys(pe).map(Number))te.push(fe[ce]);te.sort(Yi);for(const ce of te){const ye=ce.featureIndex.lookupSymbolFeatures(pe[ce.bucketInstanceId],H,ce.bucketIndex,ce.sourceLayerIndex,ae.filter,ae.layers,ae.availableImages,B);for(const ve in ye){const Ne=he[ve]=he[ve]||[],De=ye[ve];De.sort(((je,Ge)=>{const $e=ce.featureSortOrder;if($e){const Ye=$e.indexOf(je.featureIndex);return $e.indexOf(Ge.featureIndex)-Ye}return Ge.featureIndex-je.featureIndex}));for(const je of De)Ne.push(je)}}for(const ce in he)he[ce].forEach((ye=>{const ve=ye.feature,Ne=G(B[ce]);if(!Ne)return;const De=Ne.getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=De}));return he})(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),D.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(a,h){h&&h.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const x=this._getSourceCaches(a);let T=[];for(const k of x)T=T.concat(oi(k,h));return T}addSourceType(a,h,x){return fo.getSourceType(a)?x(new Error(`A source type called "${a}" already exists.`)):(fo.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const x=this.light.getLight();let T=!1;for(const N in a)if(!S(a[N],x[N])){T=!0;break}if(!T)return;const k=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,h),this.light.updateTransitions(k)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,h=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let x=a;if(h===1){if(typeof x.source=="object"){const T="terrain-dem-src";this.addSource(T,x.source),x=s.clone$1(x),x=s.extend(x,{source:T})}if(this._validate(s.validateTerrain,"terrain",x))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode){if(!x)return;this._createTerrain(x,h)}else{const T=this.terrain,k=T.get();for(const N of Object.keys(s.spec.terrain))!x.hasOwnProperty(N)&&s.spec.terrain[N].default&&(x[N]=s.spec.terrain[N].default);for(const N in x)if(!S(x[N],k[N])){T.set(x),this.stylesheet.terrain=x;const D=this._setTransitionParameters({duration:0});T.updateTransitions(D);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const h=this.fog=new st(a,this.map.transform);this.stylesheet.fog=a;const x=this._setTransitionParameters({duration:0});h.updateTransitions(x)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const a of this.map._markers)a._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,x=h.get();Object.keys(a).length===0&&h.set(a);for(const T in a)if(!S(a[T],x[T])){h.set(a),this.stylesheet.fog=a;const k=this._setTransitionParameters({duration:0});h.updateTransitions(k);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:s.exported.now(),transition:s.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter((x=>this.isLayerDraped(this._layers[x]))),h=this._order.filter((x=>!this.isLayerDraped(this._layers[x])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...h)}_createTerrain(a,h){const x=this.terrain=new it(a,h);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const T=this._setTransitionParameters({duration:0});x.updateTransitions(T)}_force3DLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const h=this._layers[a];h.type==="symbol"&&this._updateLayer(h)}}_validate(a,h,x,T,k={}){return(!k||k.validate!==!1)&&Xo(this,a.call(s.validateStyle,s.extend({key:h,style:this.serialize(),value:x,styleSpec:s.spec},T)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const h=this._getSourceCaches(a);for(const x of h)x.clearTiles()}_reloadSource(a){const h=this._getSourceCaches(a);for(const x of h)x.resume(),x.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const h in this._sourceCaches)this._sourceCaches[h].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const h=this._sourceCaches[a];h.resume(),h.reload()}}_updatePlacement(a,h,x,T,k=!1){let N=!1,D=!1;const B={};for(const H of this._order){const G=this._layers[H];if(G.type!=="symbol")continue;if(!B[G.source]){const ae=this._getLayerSourceCache(G);if(!ae)continue;B[G.source]=ae.getRenderableIds(!0).map((ue=>ae.getTileByID(ue))).sort(((ue,fe)=>fe.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(fe.tileID)?-1:1)))}const ee=this.crossTileSymbolIndex.addLayer(G,B[G.source],a.center.lng,a.projection);N=N||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),k=k||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),a.zoom))&&(this.pauseablePlacement=new wl(a,this._order,k,h,x,T,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),D=!0),N&&this.pauseablePlacement.placement.setStale()),D||N)for(const H of this._order){const G=this._layers[H];G.type==="symbol"&&this.placement.updateLayerOpacities(G,B[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h,x){this.imageManager.getImages(h.icons,x),this._updateTilesForChangedImages();const T=k=>{k&&k.setDependencies(h.tileID.key,h.type,h.icons)};T(this._otherSourceCaches[h.source]),T(this._symbolSourceCaches[h.source])}getGlyphs(a,h,x){this.glyphManager.getGlyphs(h.stacks,x)}getResource(a,h,x){return s.makeRequest(h,x)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const h=[];return this._otherSourceCaches[a]&&h.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&h.push(this._symbolSourceCaches[a]),h}_isSourceCacheLoaded(a){const h=this._getSourceCaches(a);return h.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):h.every((x=>x.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}fo.getSourceType=function(y){return An[y]},fo.setSourceType=function(y,a){An[y]=a},fo.registerForPluginStateChange=s.registerForPluginStateChange;var dc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Fa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",po=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Va=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Yo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ji={},Ro={};const Tl=[];Jo(dc,Tl),Jo(po,Tl),Jo(Va,Tl),Jo(Yo,Tl),Ji=er("",po),Ro=er(Yo,Va);const hc=er(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ud=dc,hu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var fu={background:er(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:er(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:er(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:er("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:er(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:er(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:er(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:er(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:er(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:er(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:er(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:er(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:er(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fa),skyboxGradient:er(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Fa),skyboxCapture:er(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:er(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:er(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Jo(y,a){const h=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let x of h)if(x=x.trim(),x[0]==="#"&&x.includes("if")&&!x.includes("endif")){x=x.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const T=x.split(" ");for(const k of T)a.includes(k)||a.push(k)}}function er(y,a){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T={},k=[...Tl];return Jo(y,k),Jo(a,k),{fragmentSource:y=y.replace(h,((N,D,B,H,G)=>(T[G]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${B} ${H} ${G};
#else
uniform ${B} ${H} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${H} ${G} = u_${G};
#endif
`))),vertexSource:a=a.replace(h,((N,D,B,H,G)=>{const ee=H==="float"?"vec2":"vec4",ae=G.match(/color/)?"color":ee;return T[G]?D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${ee} a_${G};
varying ${B} ${H} ${G};
#else
uniform ${B} ${H} u_${G};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${H} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);
#else
    ${B} ${H} ${G} = u_${G};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${ee} a_${G};
#else
uniform ${B} ${H} u_${G};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${H} ${G} = a_${G};
#else
    ${B} ${H} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${H} ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);
#else
    ${B} ${H} ${G} = u_${G};
#endif
`})),staticAttributes:x,usedDefines:k}}class up{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,h,x,T,k,N,D){this.context=a;let B=this.boundPaintVertexBuffers.length!==T.length;for(let G=0;!B&&G<T.length;G++)this.boundPaintVertexBuffers[G]!==T[G]&&(B=!0);let H=this.boundDynamicVertexBuffers.length!==D.length;for(let G=0;!H&&G<D.length;G++)this.boundDynamicVertexBuffers[G]!==D[G]&&(H=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==x||B||H||this.boundIndexBuffer!==k||this.boundVertexOffset!==N)this.freshBind(h,x,T,k,N,D);else{a.bindVertexArrayOES.set(this.vao);for(const G of D)G&&G.bind();k&&k.dynamicDraw&&k.bind()}}freshBind(a,h,x,T,k,N){let D;const B=a.numAttributes,H=this.context,G=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=T,this.boundVertexOffset=k,this.boundDynamicVertexBuffers=N;else{D=H.currentNumAttributes||0;for(let ee=B;ee<D;ee++)G.disableVertexAttribArray(ee)}h.enableAttributes(G,a),h.bind(),h.setVertexAttribPointers(G,a,k);for(const ee of x)ee.enableAttributes(G,a),ee.bind(),ee.setVertexAttribPointers(G,a,k);for(const ee of N)ee&&(ee.enableAttributes(G,a),ee.bind(),ee.setVertexAttribPointers(G,a,k));T&&T.bind(),H.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ih(y,a){const h=Math.pow(2,a.canonical.z),x=a.canonical.y;return[new s.MercatorCoordinate(0,x/h).toLngLat().lat,new s.MercatorCoordinate(0,(x+1)/h).toLngLat().lat]}function dp(y,a,h,x,T,k,N){const D=y.context,B=D.gl,H=h.fbo;if(!H)return;y.prepareDrawTile();const G=y.useProgram("hillshade");D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,H.colorAttachment.get());const ee=((he,pe,te,ce)=>{const ye=te.paint.get("hillshade-shadow-color"),ve=te.paint.get("hillshade-highlight-color"),Ne=te.paint.get("hillshade-accent-color");let De=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(De-=he.transform.angle);const je=!he.options.moving;return{u_matrix:ce||he.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),je),u_image:0,u_latrange:Ih(0,pe.tileID),u_light:[te.paint.get("hillshade-exaggeration"),De],u_shadow:ye,u_highlight:ve,u_accent:Ne}})(y,h,x,y.terrain?a.projMatrix:null);y.prepareDrawProgram(D,G,a.toUnwrapped());const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:ue,tileBoundsSegments:fe}=y.getTileBoundsBuffers(h);G.draw(D,B.TRIANGLES,T,k,N,s.CullFaceMode.disabled,ee,x.id,ae,ue,fe)}function Rh(y,a,h){if(!a.needsDEMTextureUpload)return;const x=y.context,T=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(h.stride);const k=h.getPixels();a.demTexture?a.demTexture.update(k,{premultiply:!1}):a.demTexture=new s.Texture(x,k,T.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function dd(y,a,h,x,T,k){const N=y.context,D=N.gl;if(!a.dem)return;const B=a.dem;if(N.activeTexture.set(D.TEXTURE1),Rh(y,a,B),!a.demTexture)return;a.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);const H=B.dim;N.activeTexture.set(D.TEXTURE0);let G=a.fbo;if(!G){const fe=new s.Texture(N,{width:H,height:H,data:null},D.RGBA);fe.bind(D.LINEAR,D.CLAMP_TO_EDGE),G=a.fbo=N.createFramebuffer(H,H,!0),G.colorAttachment.set(fe.texture)}N.bindFramebuffer.set(G.framebuffer),N.viewport.set([0,0,H,H]);const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ae,tileBoundsSegments:ue}=y.getMercatorTileBoundsBuffers();y.useProgram("hillshadePrepare").draw(N,D.TRIANGLES,x,T,k,s.CullFaceMode.disabled,((fe,he)=>{const pe=he.stride,te=s.create();return s.ortho(te,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(te,te,[0,-s.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[pe,pe],u_zoom:fe.overscaledZ,u_unpack:he.unpackVector}})(a.tileID,B),h.id,ee,ae,ue),a.needsHillshadePrepare=!1}const Nh=y=>({u_matrix:new s.UniformMatrix4f(y),u_image0:new s.Uniform1i(y),u_skirt_height:new s.Uniform1f(y)}),fc=(y,a)=>({u_matrix:y,u_image0:0,u_skirt_height:a}),hd=(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:h,u_zoom_transition:T,u_merc_center:k,u_image0:0,u_frustum_tl:N,u_frustum_tr:D,u_frustum_br:B,u_frustum_bl:H,u_globe_pos:G,u_globe_radius:ee,u_viewport:ae,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9),u_skirt_height:ue});function pc(y,a){return y!=null&&a!=null&&!(!y.hasData()||!a.hasData())&&y.demTexture!=null&&a.demTexture!=null&&y.tileID.key!==a.tileID.key}const ma=new class{constructor(){this.operations={}}newMorphing(y,a,h,x,T){if(y in this.operations){const k=this.operations[y];k.to.tileID.key!==h.tileID.key&&(k.queued=h)}else this.operations[y]={startTime:x,phase:0,duration:T,from:a,to:h,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const a=this.operations[y];return{from:a.from,to:a.to,phase:a.phase}}update(y){for(const a in this.operations){const h=this.operations[a];for(h.phase=(y-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,y)){delete this.operations[a];break}}}_nextOp(y,a){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=a,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},Ua={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function fd(y){return 6*Math.pow(1.5,22-y)}function hp(y,a){const h=1<<y.z;return!a&&(y.x===0||y.x===h-1)||y.y===0||y.y===h-1}const pu=y=>({u_matrix:y});function jh(y,a,h,x,T){if(T>0){const k=s.exported.now(),N=(k-y.timeAdded)/T,D=a?(k-a.timeAdded)/T:-1,B=h.getSource(),H=x.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),G=!a||Math.abs(a.tileID.overscaledZ-H)>Math.abs(y.tileID.overscaledZ-H),ee=G&&y.refreshedUponExpiration?1:s.clamp(G?N:1-D,0,1);return y.refreshedUponExpiration&&N>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class mu extends s.SourceCache{constructor(a){const h={type:"raster-dem",maxzoom:a.transform.maxZoom},x=new ke(vl(),null),T=Nn("mock-dem",h,x,a.style);super("mock-dem",T,!1),T.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,h){a.state="loaded",h(null)}}class pd extends s.SourceCache{constructor(a){const h=Nn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new ke(vl(),null),a.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,h,x){if(a.freezeTileCoverage)return;this.transform=a;const T=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((k,N)=>{if(k[N.key]="",!this._tiles[N.key]){const D=new s.Tile(N,this._source.tileSize*N.overscaleFactor(),a.tileZoom);D.state="loaded",this._tiles[N.key]=D}return k}),{});for(const k in this._tiles)k in T||(this.freeFBO(k),this._tiles[k].unloadVectorData(),delete this._tiles[k])}freeFBO(a){const h=this.proxyCachedFBO[a];if(h!==void 0){const x=Object.values(h);this.renderCachePool.push(...x),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach((a=>a.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class md extends s.OverscaledTileID{constructor(a,h,x){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=h,this.projMatrix=x}}class Dh extends s.Elevation{constructor(a,h){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,T,k]=(function(B){const H=new s.StructArrayLayout2i4,G=new s.StructArrayLayout3ui6,ee=131;H.reserve(17161),G.reserve(33800);const ae=s.EXTENT/128,ue=s.EXTENT+ae/2,fe=ue+ae;for(let pe=-ae;pe<fe;pe+=ae)for(let te=-ae;te<fe;te+=ae){const ce=te<0||te>ue||pe<0||pe>ue?24575:0,ye=s.clamp(Math.round(te),0,s.EXTENT),ve=s.clamp(Math.round(pe),0,s.EXTENT);H.emplaceBack(ye+ce,ve)}const he=(pe,te)=>{const ce=te*ee+pe;G.emplaceBack(ce+1,ce,ce+ee),G.emplaceBack(ce+ee,ce+ee+1,ce+1)};for(let pe=1;pe<129;pe++)for(let te=1;te<129;te++)he(te,pe);return[0,129].forEach((pe=>{for(let te=0;te<130;te++)he(te,pe),he(pe,te)})),[H,G,32768]})(),N=a.context;this.gridBuffer=N.createVertexBuffer(x,s.posAttributes.members),this.gridIndexBuffer=N.createIndexBuffer(T),this.gridSegments=s.SegmentVector.simpleSegment(0,0,x.length,T.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,x.length,k),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pd(h.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const D=N.gl;this._overlapStencilMode=new s.StencilMode({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new mu(h.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(a,h,x){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const T=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(T.get("source")),this._exaggeration=T.get("exaggeration");const k=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(h,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),h.updateElevation(!0,x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((a=>a.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=x._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(x.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const T=this.proxyCoords=h.getIds().map((B=>{const H=h.getTileByID(B).tileID;return H.projMatrix=x.calculateProjMatrix(H.toUnwrapped()),H}));(function(B,H){const G=H.transform.pointCoordinate(H.transform.getCameraPoint()),ee=new s.Point(G.x,G.y);B.sort(((ae,ue)=>{if(ue.overscaledZ-ae.overscaledZ)return ue.overscaledZ-ae.overscaledZ;const fe=new s.Point(ae.canonical.x+(1<<ae.canonical.z)*ae.wrap,ae.canonical.y),he=new s.Point(ue.canonical.x+(1<<ue.canonical.z)*ue.wrap,ue.canonical.y),pe=ee.mult(1<<ae.canonical.z);return pe.x-=.5,pe.y-=.5,pe.distSqr(fe)-pe.distSqr(he)}))})(T,this.painter),this._previousZoom=x.zoom;const k=this.proxyToSource||{};this.proxyToSource={},T.forEach((B=>{this.proxyToSource[B.key]={}})),this.terrainTileForTile={};const N=this._style._sourceCaches;for(const B in N){const H=N[B];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,a[B],k),H.usedForTerrain))continue;const G=a[B];H.getSource().reparseOverscaled&&this._assignTerrainTiles(G)}this.proxiedCoords[h.id]=T.map((B=>new md(B,B.key,this.orthoMatrix))),this._assignTerrainTiles(T),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(k),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const D={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const H=this.terrainTileForTile[B.key];if(!H)continue;const G=H.tileID.key;G in D||(this._visibleDemTiles.push(H),D[G]=G)}}_assignTerrainTiles(a){this._initializing||a.forEach((h=>{if(this.terrainTileForTile[h.key])return;const x=this._findTileCoveringTileID(h,this.sourceCache);x&&(this.terrainTileForTile[h.key]=x)}))}_prepareDEMTextures(){const a=this.painter.context,h=a.gl;for(const x in this.terrainTileForTile){const T=this.terrainTileForTile[x],k=T.dem;!k||T.demTexture&&!T.needsDEMTextureUpload||(a.activeTexture.set(h.TEXTURE1),Rh(this.painter,T,k))}}_prepareDemTileUniforms(a,h,x,T){if(!h||h.demTexture==null)return!1;const k=a.tileID.canonical,N=Math.pow(2,h.tileID.canonical.z-k.z),D=T||"";return x[`u_dem_tl${D}`]=[k.x*N%1,k.y*N%1],x[`u_dem_scale${D}`]=N,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,h=a.gl;if(!this._emptyDepthBufferTexture){const x=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(a,x,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const h=this._visibleDemTiles.reduce(((x,T)=>{if(!T.dem)return x;const k=T.dem.tree.minimums[0];return k>0&&a++,x+k}),0);return a?h/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,h=a.gl;a.activeTexture.set(h.TEXTURE2);const x=this._getLoadedAreaMinimum(),T=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(x,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let k=this._emptyDEMTexture;return k?k.update(T,{premultiply:!1}):k=this._emptyDEMTexture=new s.Texture(a,T,h.RGBA,{premultiply:!1}),k}setupElevationDraw(a,h,x){const T=this.painter.context,k=T.gl,N=(D=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(D),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var D;N.u_dem_size=this.sourceCache.getSource().tileSize,N.u_exaggeration=this.exaggeration();let B=null,H=null,G=1;if(x&&x.morphing&&this._useVertexMorphing){const ee=x.morphing.srcDemTile,ae=x.morphing.dstDemTile;G=x.morphing.phase,ee&&ae&&(this._prepareDemTileUniforms(a,ee,N,"_prev")&&(H=ee),this._prepareDemTileUniforms(a,ae,N)&&(B=ae))}if(H&&B?(T.activeTexture.set(k.TEXTURE2),B.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE,k.NEAREST),T.activeTexture.set(k.TEXTURE4),H.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE,k.NEAREST),N.u_dem_lerp=G):(B=this.terrainTileForTile[a.tileID.key],T.activeTexture.set(k.TEXTURE2),(this._prepareDemTileUniforms(a,B,N)?B.demTexture:this.emptyDEMTexture).bind(k.NEAREST,k.CLAMP_TO_EDGE)),T.activeTexture.set(k.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE),this._depthFBO&&(N.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE),N.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&B){const ee=(1<<B.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;N.u_meter_to_dem=ee}if(x&&x.labelPlaneMatrixInv&&(N.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),h.setTerrainUniformValues(T,N),this.painter.transform.projection.name==="globe"){const ee=this.globeUniformValues(this.painter.transform,a.tileID.canonical,x&&x.useDenormalizedUpVectorScale);h.setGlobeUniformValues(T,ee)}}globeUniformValues(a,h,x){const T=a.projection;return{u_tile_tl_up:T.upVector(h,0,0),u_tile_tr_up:T.upVector(h,s.EXTENT,0),u_tile_br_up:T.upVector(h,s.EXTENT,s.EXTENT),u_tile_bl_up:T.upVector(h,0,s.EXTENT),u_tile_up_scale:x?s.globeMetersToEcef(1):T.upVectorScale(h,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const h=this.painter,x=this.painter.context;a.length!==0&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(T,k,N,D,B){if(T.transform.projection.name==="globe")(function(H,G,ee,ae,ue){const fe=H.context,he=fe.gl;let pe,te;const ce=H.options.showTerrainWireframe?2:0,ye=H.transform,ve=s.globeUseCustomAntiAliasing(H,fe,ye),Ne=(Et,Xe)=>{if(te===Et)return;const ut=[Ua[Et],"PROJECTION_GLOBE_VIEW"];ve&&ut.push("CUSTOM_ANTIALIASING"),Xe&&ut.push(Ua[ce]),pe=H.useProgram("globeRaster",null,ut),te=Et},De=H.colorModeForRenderPass(),je=new s.DepthMode(he.LEQUAL,s.DepthMode.ReadWrite,H.depthRangeFor3D);ma.update(ue);const Ge=s.calculateGlobeMercatorMatrix(ye),$e=[s.mercatorXfromLng(ye.center.lng),s.mercatorYfromLat(ye.center.lat)],Ye=ce?[!1,!0]:[!1],kt=H.globeSharedBuffers,qe=[ye.width*s.exported.devicePixelRatio,ye.height*s.exported.devicePixelRatio],at=Float32Array.from(ye.globeMatrix),Qe={useDenormalizedUpVectorScale:!0};if(Ye.forEach((Et=>{const Xe=H.transform,ut=fd(Xe.zoom)*G.exaggeration();te=-1;const Tt=Et?he.LINES:he.TRIANGLES;for(const vt of ae){const At=ee.getTile(vt),tn=s.StencilMode.disabled,_n=G.prevTerrainTileForTile[vt.key],Zt=G.terrainTileForTile[vt.key];pc(_n,Zt)&&ma.newMorphing(vt.key,_n,Zt,ue,250),fe.activeTexture.set(he.TEXTURE0),At.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);const hn=ma.getMorphValuesForProxy(vt.key),zn=hn?1:0;hn&&s.extend$1(Qe,{morphing:{srcDemTile:hn.from,dstDemTile:hn.to,phase:s.easeCubicInOut(hn.phase)}});const Gn=s.tileCornersToBounds(vt.canonical),nn=s.getLatitudinalLod(Gn.getCenter().lat),Wn=s.getGridMatrix(vt.canonical,Gn,nn,Xe.worldSize/Xe._pixelsPerMercatorPixel),lr=s.globeNormalizeECEF(s.globeTileBounds(vt.canonical)),cr=hd(Xe.projMatrix,at,Ge,lr,s.globeToMercatorTransition(Xe.zoom),$e,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,qe,ut,Wn);if(Ne(zn,Et),G.setupElevationDraw(At,pe,Qe),H.prepareDrawProgram(fe,pe,vt.toUnwrapped()),kt){const[ir,Li,qr]=Et?kt.getWirefameBuffers(H.context,nn):kt.getGridBuffers(nn,ut!==0);pe.draw(fe,Tt,je,tn,De,s.CullFaceMode.backCCW,cr,"globe_raster",ir,Li,qr)}}})),kt){const Et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&Et.push("CUSTOM_ANTIALIASING"),pe=H.useProgram("globeRaster",null,Et);for(const Xe of ae){const{x:ut,y:Tt,z:vt}=Xe.canonical,At=Tt===0,tn=Tt===(1<<vt)-1,[_n,Zt,hn,zn]=kt.getPoleBuffers(vt);if(zn&&(At||tn)){const Gn=ee.getTile(Xe);fe.activeTexture.set(he.TEXTURE0),Gn.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);let nn=s.globePoleMatrixForTile(vt,ut,ye);const Wn=s.globeNormalizeECEF(s.globeTileBounds(Xe.canonical)),lr=(cr,ir)=>cr.draw(fe,he.TRIANGLES,je,s.StencilMode.disabled,De,s.CullFaceMode.disabled,hd(ye.projMatrix,nn,nn,Wn,0,$e,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,qe,0),"globe_pole_raster",ir,hn,zn);G.setupElevationDraw(Gn,pe,Qe),H.prepareDrawProgram(fe,pe,Xe.toUnwrapped()),At&&lr(pe,_n),tn&&(nn=s.scale(s.create(),nn,[1,-1,1]),lr(pe,Zt))}}}})(T,k,N,D,B);else{const H=T.context,G=H.gl;let ee,ae;const ue=T.options.showTerrainWireframe?2:0,fe=(ye,ve)=>{if(ae===ye)return;const Ne=[Ua[ye]];ve&&Ne.push(Ua[ue]),ee=T.useProgram("terrainRaster",null,Ne),ae=ye},he=T.colorModeForRenderPass(),pe=new s.DepthMode(G.LEQUAL,s.DepthMode.ReadWrite,T.depthRangeFor3D);ma.update(B);const te=T.transform,ce=fd(te.zoom)*k.exaggeration();(ue?[!1,!0]:[!1]).forEach((ye=>{ae=-1;const ve=ye?G.LINES:G.TRIANGLES,[Ne,De]=ye?k.getWirefameBuffer():[k.gridIndexBuffer,k.gridSegments];for(const je of D){const Ge=N.getTile(je),$e=s.StencilMode.disabled,Ye=k.prevTerrainTileForTile[je.key],kt=k.terrainTileForTile[je.key];pc(Ye,kt)&&ma.newMorphing(je.key,Ye,kt,B,250),H.activeTexture.set(G.TEXTURE0),Ge.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST);const qe=ma.getMorphValuesForProxy(je.key),at=qe?1:0;let Qe;qe&&(Qe={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:s.easeCubicInOut(qe.phase)}});const Et=fc(je.projMatrix,hp(je.canonical,te.renderWorldCopies)?ce/10:ce);fe(at,ye),k.setupElevationDraw(Ge,ee,Qe),T.prepareDrawProgram(H,ee,je.toUnwrapped()),ee.draw(H,ve,pe,$e,he,s.CullFaceMode.backCCW,Et,"terrain_raster",k.gridBuffer,Ne,De)}}))}})(h,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const h=this.painter,x=this.painter.context,T=this.proxySourceCache,k=this.proxiedCoords[T.id],N=this._drapedRenderBatches.shift(),D=[],B=h.style.order;let H=0;for(const G of k){const ee=T.getTileByID(G.proxyTileKey),ae=T.proxyCachedFBO[G.key]?T.proxyCachedFBO[G.key][a]:void 0,ue=ae!==void 0?T.renderCache[ae]:this.pool[H++],fe=ae!==void 0;if(ee.texture=ue.tex,fe&&!ue.dirty){D.push(ee.tileID);continue}let he;x.bindFramebuffer.set(ue.fb.framebuffer),this.renderedToTile=!1,ue.dirty&&(x.clear({color:s.Color.transparent,stencil:0}),ue.dirty=!1);for(let pe=N.start;pe<=N.end;++pe){const te=h.style._layers[B[pe]];if(te.isHidden(h.transform.zoom))continue;const ce=h.style._getLayerSourceCache(te),ye=ce?this.proxyToSource[G.key][ce.id]:[G];if(!ye)continue;const ve=ye;x.viewport.set([0,0,ue.fb.width,ue.fb.height]),he!==(ce?ce.id:null)&&(this._setupStencil(ue,ye,te,ce),he=ce?ce.id:null),h.renderLayer(h,ce,te,ve)}this.renderedToTile?(ue.dirty=!0,D.push(ee.tileID)):fe||--H,H===5&&(H=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height]),N.end+1}postRender(){}renderCacheEfficiency(a){const h=a.order.length;if(h===0)return{efficiency:100};let x,T=0,k=0,N=!1;for(let D=0;D<h;++D){const B=a._layers[a.order[D]];this._style.isLayerDraped(B)?(N&&++T,++k):N||(N=!0,x=B.id)}return k===0?{efficiency:100}:{efficiency:100*(1-T/k),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter((h=>h.dem)).forEach((h=>{a=Math.min(a,h.dem.tree.minimums[0])})),a===0?a:(a-30)*this._exaggeration}raycast(a,h,x){if(!this._visibleDemTiles)return null;const T=this._visibleDemTiles.filter((k=>k.dem)).map((k=>{const N=k.tileID,D=1<<N.overscaledZ,{x:B,y:H}=N.canonical,G=B/D,ee=(B+1)/D,ae=H/D,ue=(H+1)/D;return{minx:G,miny:ae,maxx:ee,maxy:ue,t:k.dem.tree.raycastRoot(G,ae,ee,ue,a,h,x),tile:k}}));T.sort(((k,N)=>(k.t!==null?k.t:Number.MAX_VALUE)-(N.t!==null?N.t:Number.MAX_VALUE)));for(const k of T){if(k.t==null)return null;const N=k.tile.dem.tree.raycast(k.minx,k.miny,k.maxx,k.maxy,a,h,x);if(N!=null)return N}return null}_createFBO(){const a=this.painter.context,h=a.gl,x=this.drapeBufferSize;a.activeTexture.set(h.TEXTURE0);const T=new s.Texture(a,{width:x[0],height:x[1],data:null},h.RGBA);T.bind(h.LINEAR,h.CLAMP_TO_EDGE);const k=a.createFramebuffer(x[0],x[1],!1);return k.colorAttachment.set(T.texture),k.depthAttachment=new Oe(a,k.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,k.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):k.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:k,tex:T,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some((a=>{const h=this._style._layers[a],x=h.isHidden(this.painter.transform.zoom);return h.type==="custom"?!x&&h.shouldRedrape():!x&&h.hasTransition()}))}_clearLineLayersFromRenderCache(){let a=!1;for(const x of this._style._getSources())if(x instanceof jt){a=!0;break}if(!a)return;const h={};for(let x=0;x<this._style.order.length;++x){const T=this._style._layers[this._style.order[x]],k=this._style._getLayerSourceCache(T);if(k&&!h[k.id]&&!T.isHidden(this.painter.transform.zoom)&&T.type==="line"&&T.widthExpression()instanceof s.ZoomDependentExpression){h[k.id]=!0;for(const N of this.proxyCoords){const D=this.proxyToSource[N.key][k.id];if(D)for(const B of D)this._clearRenderCacheForTile(k.id,B)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const x in this._style._sourceCaches)if(this._style._sourceCaches[x]._source instanceof xt){a=!0;break}if(!a)return;const h={};for(let x=0;x<this._style.order.length;++x){const T=this._style._layers[this._style.order[x]],k=this._style._getLayerSourceCache(T);if(!k||h[k.id]||T.isHidden(this.painter.transform.zoom)||T.type!=="raster")continue;const N=T.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const B=this.proxyToSource[D.key][k.id];if(B)for(const H of B){const G=jh(k.getTile(H),k.findLoadedParent(H,0),k,this.painter.transform,N);(G.opacity!==1||G.mix!==0)&&this._clearRenderCacheForTile(k.id,H)}}}}_setupDrapedRenderBatches(){const a=this._style.order,h=a.length;if(h===0)return;const x=[];let T,k=0,N=this._style._layers[a[k]];for(;!this._style.isLayerDraped(N)&&N.isHidden(this.painter.transform.zoom)&&++k<h;)N=this._style._layers[a[k]];for(;k<h;++k){const D=this._style._layers[a[k]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?T===void 0&&(T=k):T!==void 0&&(x.push({start:T,end:k-1}),T=void 0))}T!==void 0&&x.push({start:T,end:k-1}),this._drapedRenderBatches=x}_setupRenderCache(a){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const N=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let D=0;D<N.length;++D){const B=Object.values(N[D]);h.renderCachePool.push(...B)}}return}this._clearRasterLayersFromRenderCache();const x=this.proxyCoords,T=this._tilesDirty;for(let N=x.length-1;N>=0;N--){const D=x[N];if(h.getTileByID(D.key),h.proxyCachedFBO[D.key]!==void 0){const B=a[D.key],H=this.proxyToSource[D.key];let G=0;for(const ee in H){const ae=H[ee],ue=B[ee];if(!ue||ue.length!==ae.length||ae.some(((fe,he)=>fe!==ue[he]||T[ee]&&T[ee].hasOwnProperty(fe.key)))){G=-1;break}++G}for(const ee in h.proxyCachedFBO[D.key])h.renderCache[h.proxyCachedFBO[D.key][ee]].dirty=G<0||G!==Object.values(B).length}}const k=[...this._drapedRenderBatches];k.sort(((N,D)=>D.end-D.start-(N.end-N.start)));for(const N of k)for(const D of x){if(h.proxyCachedFBO[D.key])continue;let B=h.renderCachePool.pop();B===void 0&&h.renderCache.length<50&&(B=h.renderCache.length,h.renderCache.push(this._createFBO())),B!==void 0&&(h.proxyCachedFBO[D.key]={},h.proxyCachedFBO[D.key][N.start]=B,h.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(a,h,x,T){if(!T||!this._sourceTilesOverlap[T.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const k=this.painter.context,N=k.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let D;if(x.isTileClipped())D=h.length,this._overlapStencilMode.test={func:N.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:N.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(k.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(a,h){const x=this.painter,T=this.painter.context,k=T.gl;x._tileClippingMaskIDs={},T.setColorMode(s.ColorMode.disabled),T.setDepthMode(s.DepthMode.disabled);const N=x.useProgram("clippingMask");for(const D of a){const B=x._tileClippingMaskIDs[D.key]=--h;N.draw(T,k.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:k.ALWAYS,mask:0},B,255,k.KEEP,k.KEEP,k.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,pu(D.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(a){const h=this.painter.transform;if(a.x<0||a.x>h.width||a.y<0||a.y>h.height)return null;const x=[a.x,a.y,1,1];s.transformMat4$1(x,x,h.pixelMatrixInverse),s.scale$1(x,x,1/x[3]),x[0]/=h.worldSize,x[1]/=h.worldSize;const T=h._camera.position,k=s.mercatorZfromAltitude(1,h.center.lat),N=[T[0],T[1],T[2]/k,0],D=s.subtract([],x.slice(0,3),N);s.normalize(D,D);const B=this.raycast(N,D,this._exaggeration);return B!==null&&B?(s.scaleAndAdd(N,N,D,B),N[3]=N[2],N[2]*=k,N):null}drawDepth(){const a=this.painter,h=a.context,x=this.proxySourceCache,T=Math.ceil(a.width),k=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===T&&this._depthFBO.height===k||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const N=h.gl,D=h.createFramebuffer(T,k,!0);h.activeTexture.set(N.TEXTURE0);const B=new s.Texture(h,{width:T,height:k,data:null},N.RGBA);B.bind(N.NEAREST,N.CLAMP_TO_EDGE),D.colorAttachment.set(B.texture);const H=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,T,k);D.depthAttachment.set(H),this._depthFBO=D,this._depthTexture=B}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,T,k]),(function(N,D,B,H){if(N.transform.projection.name==="globe")return;const G=N.context,ee=G.gl;G.clear({depth:1});const ae=N.useProgram("terrainDepth"),ue=new s.DepthMode(ee.LESS,s.DepthMode.ReadWrite,N.depthRangeFor3D);for(const fe of H){const he=B.getTile(fe),pe=fc(fe.projMatrix,0);D.setupElevationDraw(he,ae),ae.draw(G,ee.TRIANGLES,ue,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,pe,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}})(a,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,h,x){if(a.getSource()instanceof Pn)return this._setupProxiedCoordsForImageSource(a,h,x);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const T=this.proxiedCoords[a.id]=[],k=this.proxyCoords;for(let D=0;D<k.length;D++){const B=k[D],H=this._findTileCoveringTileID(B,a);if(H){const G=this._createProxiedId(B,H,x[B.key]&&x[B.key][a.id]);T.push(G),this.proxyToSource[B.key][a.id]=[G]}}let N=!1;for(let D=0;D<h.length;D++){const B=a.getTile(h[D]);if(!B||!B.hasData())continue;const H=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==B.tileID.canonical.z){const G=this.proxyToSource[H.tileID.key][a.id],ee=this._createProxiedId(H.tileID,B,x[H.tileID.key]&&x[H.tileID.key][a.id]);G?G.splice(G.length-1,0,ee):this.proxyToSource[H.tileID.key][a.id]=[ee],T.push(ee),N=!0}}this._sourceTilesOverlap[a.id]=N}_setupProxiedCoordsForImageSource(a,h,x){if(!a.getSource().loaded())return;const T=this.proxiedCoords[a.id]=[],k=this.proxyCoords,N=a.getSource(),D=new s.Point(N.tileID.x,N.tileID.y)._div(1<<N.tileID.z),B=N.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce(((G,ee)=>(G.min.x=Math.min(G.min.x,ee.x-D.x),G.min.y=Math.min(G.min.y,ee.y-D.y),G.max.x=Math.max(G.max.x,ee.x-D.x),G.max.y=Math.max(G.max.y,ee.y-D.y),G)),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(G,ee)=>{const ae=G.wrap+G.canonical.x/(1<<G.canonical.z),ue=G.canonical.y/(1<<G.canonical.z),fe=s.EXTENT/(1<<G.canonical.z),he=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),pe=ee.canonical.y/(1<<ee.canonical.z);return ae+fe<he+B.min.x||ae>he+B.max.x||ue+fe<pe+B.min.y||ue>pe+B.max.y};for(let G=0;G<k.length;G++){const ee=k[G];for(let ae=0;ae<h.length;ae++){const ue=a.getTile(h[ae]);if(!ue||!ue.hasData()||H(ee,ue.tileID))continue;const fe=this._createProxiedId(ee,ue,x[ee.key]&&x[ee.key][a.id]),he=this.proxyToSource[ee.key][a.id];he?he.push(fe):this.proxyToSource[ee.key][a.id]=[fe],T.push(fe)}}}_createProxiedId(a,h,x){let T=this.orthoMatrix;if(x){const k=x.find((N=>N.key===h.tileID.key));if(k)return k}if(h.tileID.key!==a.key){const k=a.canonical.z-h.tileID.canonical.z;let N,D,B;T=s.create();const H=h.tileID.wrap-a.wrap<<a.overscaledZ;k>0?(N=s.EXTENT>>k,D=N*((h.tileID.canonical.x<<k)-a.canonical.x+H),B=N*((h.tileID.canonical.y<<k)-a.canonical.y)):(N=s.EXTENT<<-k,D=s.EXTENT*(h.tileID.canonical.x-(a.canonical.x+H<<-k)),B=s.EXTENT*(h.tileID.canonical.y-(a.canonical.y<<-k))),s.ortho(T,0,N,0,N,0,1),s.translate(T,T,[D,B,0])}return new md(h.tileID,a.key,T)}_findTileCoveringTileID(a,h){let x=h.getTile(a);if(x&&x.hasData())return x;const T=this._findCoveringTileCache[h.id],k=T[a.key];if(x=k?h.getTileByID(k):null,x&&x.hasData()||k===null)return x;let N=x?x.tileID:a,D=N.overscaledZ;const B=h.getSource().minzoom,H=[];if(!k){const ee=h.getSource().maxzoom;if(a.canonical.z>=ee){const ae=a.canonical.z-ee;h.getSource().reparseOverscaled?(D=Math.max(a.canonical.z+2,h.transform.tileZoom),N=new s.OverscaledTileID(D,a.wrap,ee,a.canonical.x>>ae,a.canonical.y>>ae)):ae!==0&&(D=ee,N=new s.OverscaledTileID(D,a.wrap,ee,a.canonical.x>>ae,a.canonical.y>>ae))}N.key!==a.key&&(H.push(N.key),x=h.getTile(N))}const G=ee=>{H.forEach((ae=>{T[ae]=ee})),H.length=0};for(D-=1;D>=B&&(!x||!x.hasData());D--){x&&G(x.tileID.key);const ee=N.calculateScaledKey(D);if(x=h.getTileByID(ee),x&&x.hasData())break;const ae=T[ee];if(ae===null)break;ae===void 0?H.push(ee):x=h.getTileByID(ae)}return G(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,h){let x=this._tilesDirty[a];x||(x=this._tilesDirty[a]={}),x[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=(function(h){let x=0;const T=new s.StructArrayLayout2ui4,k=131;for(let N=1;N<129;N++){for(let D=1;D<129;D++)x=N*k+D,T.emplaceBack(x,x+1),T.emplaceBack(x,x+k),T.emplaceBack(x+1,x+k),N===128&&T.emplaceBack(x+k,x+k+1);T.emplaceBack(x+1,x+1+k)}return T})();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Qn{static cacheKey(a,h,x,T){let k=`${h}${T?T.cacheKey:""}`;for(const N of x)a.usedDefines.includes(N)&&(k+=`/${N}`);return k}constructor(a,h,x,T,k,N){const D=a.gl;this.program=D.createProgram();const B=(function(te){const ce=[];for(let ye=0;ye<te.length;ye++){if(te[ye]===null)continue;const ve=te[ye].split(" ");ce.push(ve.pop())}return ce})(x.staticAttributes),H=T?T.getBinderAttributes():[],G=B.concat(H);let ee=T?T.defines():[];ee=ee.concat(N.map((te=>`#define ${te}`)));const ae=a.isWebGL2?`#version 300 es
`:"",ue=ae+ee.concat(a.extStandardDerivatives&&ae.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(hu):hu,hu,ud,hc.fragmentSource,Ro.fragmentSource,x.fragmentSource).join(`
`),fe=ae+ee.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ud,hc.vertexSource,Ro.vertexSource,Ji.vertexSource,x.vertexSource).join(`
`),he=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(he,ue),D.compileShader(he),D.attachShader(this.program,he);const pe=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())this.failedToCreate=!0;else{D.shaderSource(pe,fe),D.compileShader(pe),D.attachShader(this.program,pe),this.attributes={},this.numAttributes=G.length;for(let te=0;te<this.numAttributes;te++)G[te]&&(D.bindAttribLocation(this.program,te,G[te]),this.attributes[G[te]]=te);D.linkProgram(this.program),D.deleteShader(pe),D.deleteShader(he),this.fixedUniforms=k(a),this.binderUniforms=T?T.getUniforms(a):[],N.includes("TERRAIN")&&(this.terrainUniforms=(te=>({u_dem:new s.Uniform1i(te),u_dem_prev:new s.Uniform1i(te),u_dem_unpack:new s.Uniform4f(te),u_dem_tl:new s.Uniform2f(te),u_dem_scale:new s.Uniform1f(te),u_dem_tl_prev:new s.Uniform2f(te),u_dem_scale_prev:new s.Uniform1f(te),u_dem_size:new s.Uniform1f(te),u_dem_lerp:new s.Uniform1f(te),u_exaggeration:new s.Uniform1f(te),u_depth:new s.Uniform1i(te),u_depth_size_inv:new s.Uniform2f(te),u_meter_to_dem:new s.Uniform1f(te),u_label_plane_matrix_inv:new s.UniformMatrix4f(te)}))(a)),N.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new s.Uniform3f(te),u_tile_tr_up:new s.Uniform3f(te),u_tile_br_up:new s.Uniform3f(te),u_tile_bl_up:new s.Uniform3f(te),u_tile_up_scale:new s.Uniform1f(te)}))(a)),N.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new s.UniformMatrix4f(te),u_fog_range:new s.Uniform2f(te),u_fog_color:new s.Uniform4f(te),u_fog_horizon_blend:new s.Uniform1f(te),u_fog_temporal_offset:new s.Uniform1f(te),u_frustum_tl:new s.Uniform3f(te),u_frustum_tr:new s.Uniform3f(te),u_frustum_br:new s.Uniform3f(te),u_frustum_bl:new s.Uniform3f(te),u_globe_pos:new s.Uniform3f(te),u_globe_radius:new s.Uniform1f(te),u_globe_transition:new s.Uniform1f(te),u_is_globe:new s.Uniform1i(te),u_viewport:new s.Uniform2f(te)}))(a))}}setTerrainUniformValues(a,h){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const T in h)x[T]&&x[T].set(this.program,T,h[T])}}setGlobeUniformValues(a,h){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const T in h)x[T]&&x[T].set(this.program,T,h[T])}}setFogUniformValues(a,h){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const T in h)x[T].set(this.program,T,h[T])}}draw(a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he){const pe=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(x),a.setStencilMode(T),a.setColorMode(k),a.setCullFace(N);for(const ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,D[ce]);fe&&fe.setUniforms(this.program,a,this.binderUniforms,ae,{zoom:ue});const te={[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[h];for(const ce of ee.get()){const ye=ce.vaos||(ce.vaos={});(ye[B]||(ye[B]=new up)).bind(a,this,H,fe?fe.getPaintVertexBuffers():[],G,ce.vertexOffset,he||[]),pe.drawElements(h,ce.primitiveLength*te,pe.UNSIGNED_SHORT,ce.primitiveOffset*te*2)}}}function gu(y,a){const h=Math.pow(2,a.tileID.overscaledZ),x=a.tileSize*Math.pow(2,y.transform.tileZoom)/h,T=x*(a.tileID.canonical.x+a.tileID.wrap*h),k=x*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ve(a,1,y.transform.tileZoom),u_pixel_coord_upper:[T>>16,k>>16],u_pixel_coord_lower:[65535&T,65535&k]}}const fp=s.create(),Lh=(y,a,h,x,T,k,N,D,B,H,G)=>{const ee=a.style.light,ae=ee.properties.get("position"),ue=[ae.x,ae.y,ae.z],fe=s.create$1();ee.properties.get("anchor")==="viewport"&&(s.fromRotation(fe,-a.transform.angle),s.transformMat3(ue,ue,fe));const he=ee.properties.get("color"),pe=a.transform,te={u_matrix:y,u_lightpos:ue,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+h,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:T,u_edge_radius:k};return pe.projection.name==="globe"&&(te.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],te.u_zoom_transition=B,te.u_inv_rot_matrix=G,te.u_merc_center=H,te.u_up_dir=pe.projection.upVector(new s.CanonicalTileID(0,0,0),H[0]*s.EXTENT,H[1]*s.EXTENT),te.u_height_lift=D),te},pp=(y,a,h,x,T,k,N,D,B,H,G,ee)=>{const ae=Lh(y,a,h,x,T,k,N,B,H,G,ee),ue={u_height_factor:-Math.pow(2,N.overscaledZ)/D.tileSize/8};return s.extend(ae,gu(a,D),ue)},Sl=y=>({u_matrix:y}),Oh=(y,a,h)=>s.extend(Sl(y),gu(a,h)),ig=(y,a)=>({u_matrix:y,u_world:a}),zh=(y,a,h,x)=>s.extend(Oh(y,a,h),{u_world:x}),yu=s.create(),Bh=(y,a,h,x,T,k)=>{const N=y.transform,D=N.projection.name==="globe";let B;if(k.paint.get("circle-pitch-alignment")==="map")if(D){const G=s.globePixelsToTileUnits(N.zoom,a.canonical)*N._pixelsPerMercatorPixel;B=Float32Array.from([G,0,0,G])}else B=N.calculatePixelsToTileUnitsMatrix(h);else B=new Float32Array([N.pixelsToGLUnits[0],0,0,N.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:N.cameraToCenterDistance,u_matrix:y.translatePosMatrix(a.projMatrix,h,k.paint.get("circle-translate"),k.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:B,u_inv_rot_matrix:yu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){H.u_inv_rot_matrix=x,H.u_merc_center=T,H.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],H.u_zoom_transition=s.globeToMercatorTransition(N.zoom);const G=T[0]*s.EXTENT,ee=T[1]*s.EXTENT;H.u_up_dir=N.projection.upVector(new s.CanonicalTileID(0,0,0),G,ee)}return H},gd=y=>{const a=[];return y.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),y.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},yd=(y,a,h,x)=>{const T=s.EXTENT/h.tileSize;return{u_matrix:y,u_camera_to_center_distance:a.getCameraToCenterDistance(x),u_extrude_scale:[a.pixelsToGLUnits[0]/T,a.pixelsToGLUnits[1]/T]}},_u=(y,a,h=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:h}),Fh=s.create(),Vh=(y,a,h,x,T,k,N)=>{const D=y.transform,B=D.projection.name==="globe",H=B?s.globePixelsToTileUnits(D.zoom,a.canonical)*D._pixelsPerMercatorPixel:Ve(h,1,k),G={u_matrix:a.projMatrix,u_extrude_scale:H,u_intensity:N,u_inv_rot_matrix:Fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){G.u_inv_rot_matrix=x,G.u_merc_center=T,G.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],G.u_zoom_transition=s.globeToMercatorTransition(D.zoom);const ee=T[0]*s.EXTENT,ae=T[1]*s.EXTENT;G.u_up_dir=D.projection.upVector(new s.CanonicalTileID(0,0,0),ee,ae)}return G},mc=(y,a,h,x,T,k,N)=>{const D=y.transform,B=D.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:Uh(y,a,h,x),u_pixels_to_tile_units:B,u_device_pixel_ratio:k,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:yc(h)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gc(a,y.transform),u_alpha_discard_threshold:0,u_trim_offset:N}},vu=(y,a,h,x,T)=>{const k=y.transform;return{u_matrix:Uh(y,a,h,x),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:T,u_image:0,u_tile_units_to_pixels:gc(a,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function gc(y,a){return 1/Ve(y,1,a.tileZoom)}function Uh(y,a,h,x){return y.translatePosMatrix(x||a.tileID.projMatrix,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function yc(y){const a=y.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const _d=(y,a,h,x,T,k)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:h,u_fade_t:x.mix,u_opacity:x.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(D=T.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(N=T.paint.get("raster-contrast"),N>0?1/(1-N):1+N),u_spin_weights:Ps(T.paint.get("raster-hue-rotate")),u_perspective_transform:k};var N,D};function Ps(y){y*=Math.PI/180;const a=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const $a=s.create(),$h=(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he)=>{const pe=T.transform,te={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:pe.width/pe.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:N,u_coord_matrix:D,u_is_text:+B,u_pitch_with_map:+x,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$a,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$a,u_up_vector:[0,-1,0]};return he.name==="globe"&&(te.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],te.u_zoom_transition=ee,te.u_inv_rot_matrix=ue,te.u_merc_center=ae,te.u_camera_forward=pe._camera.forward(),te.u_ecef_origin=s.globeECEFOrigin(pe.globeMatrix,G.toUnwrapped()),te.u_tile_matrix=Float32Array.from(pe.globeMatrix),te.u_up_vector=fe),te},El=(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he,pe)=>s.extend($h(y,a,h,x,T,k,N,D,B,H,ee,ae,ue,fe,he,pe),{u_gamma_scale:x?T.transform.cameraToCenterDistance*Math.cos(T.terrain?0:T.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:1}),mp=(y,a,h,x,T,k,N,D,B,H,G,ee,ae,ue,fe,he)=>s.extend(El(y,a,h,x,T,k,N,D,!0,B,!0,G,ee,ae,ue,fe,he),{u_texsize_icon:H,u_texture_icon:1}),vd=(y,a,h)=>({u_matrix:y,u_opacity:a,u_color:h}),Gh=(y,a,h,x,T)=>s.extend((function(k,N,D){const B=N.imageManager.getPattern(k.toString()),{width:H,height:G}=N.imageManager.getPixelSize(),ee=Math.pow(2,D.tileID.overscaledZ),ae=D.tileSize*Math.pow(2,N.transform.tileZoom)/ee,ue=ae*(D.tileID.canonical.x+D.tileID.wrap*ee),fe=ae*D.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[H,G],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/Ve(D,1,N.transform.tileZoom),u_pixel_coord_upper:[ue>>16,fe>>16],u_pixel_coord_lower:[65535&ue,65535&fe]}})(x,h,T),{u_matrix:y,u_opacity:a}),xu={fillExtrusion:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y)}),fillExtrusionPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_lightpos:new s.Uniform3f(y),u_lightintensity:new s.Uniform1f(y),u_lightcolor:new s.Uniform3f(y),u_vertical_gradient:new s.Uniform1f(y),u_height_factor:new s.Uniform1f(y),u_edge_radius:new s.Uniform1f(y),u_ao:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_up_dir:new s.Uniform3f(y),u_height_lift:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y)}),fill:y=>({u_matrix:new s.UniformMatrix4f(y)}),fillPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),fillOutline:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y)}),fillOutlinePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_world:new s.Uniform2f(y),u_image:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),circle:y=>({u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),collisionBox:y=>({u_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_extrude_scale:new s.Uniform2f(y)}),collisionCircle:y=>({u_matrix:new s.UniformMatrix4f(y),u_inv_matrix:new s.UniformMatrix4f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_viewport_size:new s.Uniform2f(y)}),debug:y=>({u_color:new s.UniformColor(y),u_matrix:new s.UniformMatrix4f(y),u_overlay:new s.Uniform1i(y),u_overlay_scale:new s.Uniform1f(y)}),clippingMask:y=>({u_matrix:new s.UniformMatrix4f(y)}),heatmap:y=>({u_extrude_scale:new s.Uniform1f(y),u_intensity:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_up_dir:new s.Uniform3f(y)}),heatmapTexture:y=>({u_image:new s.Uniform1i(y),u_color_ramp:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y)}),hillshade:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_latrange:new s.Uniform2f(y),u_light:new s.Uniform2f(y),u_shadow:new s.UniformColor(y),u_highlight:new s.UniformColor(y),u_accent:new s.UniformColor(y)}),hillshadePrepare:y=>({u_matrix:new s.UniformMatrix4f(y),u_image:new s.Uniform1i(y),u_dimension:new s.Uniform2f(y),u_zoom:new s.Uniform1f(y),u_unpack:new s.Uniform4f(y)}),line:y=>({u_matrix:new s.UniformMatrix4f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_units_to_pixels:new s.Uniform2f(y),u_dash_image:new s.Uniform1i(y),u_gradient_image:new s.Uniform1i(y),u_image_height:new s.Uniform1f(y),u_texsize:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y),u_trim_offset:new s.Uniform2f(y)}),linePattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_texsize:new s.Uniform2f(y),u_pixels_to_tile_units:new s.UniformMatrix2f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_units_to_pixels:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y),u_alpha_discard_threshold:new s.Uniform1f(y)}),raster:y=>({u_matrix:new s.UniformMatrix4f(y),u_tl_parent:new s.Uniform2f(y),u_scale_parent:new s.Uniform1f(y),u_fade_t:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_image0:new s.Uniform1i(y),u_image1:new s.Uniform1i(y),u_brightness_low:new s.Uniform1f(y),u_brightness_high:new s.Uniform1f(y),u_saturation_factor:new s.Uniform1f(y),u_contrast_factor:new s.Uniform1f(y),u_spin_weights:new s.Uniform3f(y),u_perspective_transform:new s.Uniform2f(y)}),symbolIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_texture:new s.Uniform1i(y)}),symbolSDF:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_tile_id:new s.Uniform3f(y),u_zoom_transition:new s.Uniform1f(y),u_inv_rot_matrix:new s.UniformMatrix4f(y),u_merc_center:new s.Uniform2f(y),u_camera_forward:new s.Uniform3f(y),u_tile_matrix:new s.UniformMatrix4f(y),u_up_vector:new s.Uniform3f(y),u_ecef_origin:new s.Uniform3f(y),u_is_halo:new s.Uniform1i(y)}),symbolTextAndIcon:y=>({u_is_size_zoom_constant:new s.Uniform1i(y),u_is_size_feature_constant:new s.Uniform1i(y),u_size_t:new s.Uniform1f(y),u_size:new s.Uniform1f(y),u_camera_to_center_distance:new s.Uniform1f(y),u_rotate_symbol:new s.Uniform1i(y),u_aspect_ratio:new s.Uniform1f(y),u_fade_change:new s.Uniform1f(y),u_matrix:new s.UniformMatrix4f(y),u_label_plane_matrix:new s.UniformMatrix4f(y),u_coord_matrix:new s.UniformMatrix4f(y),u_is_text:new s.Uniform1i(y),u_pitch_with_map:new s.Uniform1i(y),u_texsize:new s.Uniform2f(y),u_texsize_icon:new s.Uniform2f(y),u_texture:new s.Uniform1i(y),u_texture_icon:new s.Uniform1i(y),u_gamma_scale:new s.Uniform1f(y),u_device_pixel_ratio:new s.Uniform1f(y),u_is_halo:new s.Uniform1i(y)}),background:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_color:new s.UniformColor(y)}),backgroundPattern:y=>({u_matrix:new s.UniformMatrix4f(y),u_opacity:new s.Uniform1f(y),u_image:new s.Uniform1i(y),u_pattern_tl:new s.Uniform2f(y),u_pattern_br:new s.Uniform2f(y),u_texsize:new s.Uniform2f(y),u_pattern_size:new s.Uniform2f(y),u_pixel_coord_upper:new s.Uniform2f(y),u_pixel_coord_lower:new s.Uniform2f(y),u_tile_units_to_pixels:new s.Uniform1f(y)}),terrainRaster:Nh,terrainDepth:Nh,skybox:y=>({u_matrix:new s.UniformMatrix4f(y),u_sun_direction:new s.Uniform3f(y),u_cubemap:new s.Uniform1i(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxGradient:y=>({u_matrix:new s.UniformMatrix4f(y),u_color_ramp:new s.Uniform1i(y),u_center_direction:new s.Uniform3f(y),u_radius:new s.Uniform1f(y),u_opacity:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y)}),skyboxCapture:y=>({u_matrix_3f:new s.UniformMatrix3f(y),u_sun_direction:new s.Uniform3f(y),u_sun_intensity:new s.Uniform1f(y),u_color_tint_r:new s.Uniform4f(y),u_color_tint_m:new s.Uniform4f(y),u_luminance:new s.Uniform1f(y)}),globeRaster:y=>({u_proj_matrix:new s.UniformMatrix4f(y),u_globe_matrix:new s.UniformMatrix4f(y),u_normalize_matrix:new s.UniformMatrix4f(y),u_merc_matrix:new s.UniformMatrix4f(y),u_zoom_transition:new s.Uniform1f(y),u_merc_center:new s.Uniform2f(y),u_image0:new s.Uniform1i(y),u_grid_matrix:new s.UniformMatrix3f(y),u_skirt_height:new s.Uniform1f(y),u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_globe_pos:new s.Uniform3f(y),u_globe_radius:new s.Uniform1f(y),u_viewport:new s.Uniform2f(y)}),globeAtmosphere:y=>({u_frustum_tl:new s.Uniform3f(y),u_frustum_tr:new s.Uniform3f(y),u_frustum_br:new s.Uniform3f(y),u_frustum_bl:new s.Uniform3f(y),u_horizon:new s.Uniform1f(y),u_transition:new s.Uniform1f(y),u_fadeout_range:new s.Uniform1f(y),u_color:new s.Uniform4f(y),u_high_color:new s.Uniform4f(y),u_space_color:new s.Uniform4f(y),u_star_intensity:new s.Uniform1f(y),u_star_density:new s.Uniform1f(y),u_star_size:new s.Uniform1f(y),u_temporal_offset:new s.Uniform1f(y),u_horizon_angle:new s.Uniform1f(y),u_rotation_matrix:new s.UniformMatrix4f(y)})};let wu;function _c(y,a,h,x,T,k,N){const D=y.context,B=D.gl,H=y.transform,G=y.useProgram("collisionBox"),ee=[];let ae=0,ue=0;for(let ve=0;ve<x.length;ve++){const Ne=x[ve],De=a.getTile(Ne),je=De.getBucket(h);if(!je)continue;const Ge=Gs(Ne,je,H);let $e=Ge;T[0]===0&&T[1]===0||($e=y.translatePosMatrix(Ge,De,T,k));const Ye=N?je.textCollisionBox:je.iconCollisionBox,kt=je.collisionCircleArray;if(kt.length>0){const qe=s.create(),at=$e;s.mul(qe,je.placementInvProjMatrix,H.glCoordMatrix),s.mul(qe,qe,je.placementViewportMatrix),ee.push({circleArray:kt,circleOffset:ue,transform:at,invTransform:qe,projection:je.getProjection()}),ae+=kt.length/4,ue=ae}Ye&&(y.terrain&&y.terrain.setupElevationDraw(De,G),G.draw(D,B.LINES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,yd($e,H,De,je.getProjection()),h.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,null,H.zoom,null,[Ye.collisionVertexBuffer,Ye.collisionVertexBufferExt]))}if(!N||!ee.length)return;const fe=y.useProgram("collisionCircle"),he=new s.StructArrayLayout2f1f2i16;he.resize(4*ae),he._trim();let pe=0;for(const ve of ee)for(let Ne=0;Ne<ve.circleArray.length/4;Ne++){const De=4*Ne,je=ve.circleArray[De+0],Ge=ve.circleArray[De+1],$e=ve.circleArray[De+2],Ye=ve.circleArray[De+3];he.emplace(pe++,je,Ge,$e,Ye,0),he.emplace(pe++,je,Ge,$e,Ye,1),he.emplace(pe++,je,Ge,$e,Ye,2),he.emplace(pe++,je,Ge,$e,Ye,3)}(!wu||wu.length<2*ae)&&(wu=(function(ve){const Ne=2*ve,De=new s.StructArrayLayout3ui6;De.resize(Ne),De._trim();for(let je=0;je<Ne;je++){const Ge=6*je;De.uint16[Ge+0]=4*je+0,De.uint16[Ge+1]=4*je+1,De.uint16[Ge+2]=4*je+2,De.uint16[Ge+3]=4*je+2,De.uint16[Ge+4]=4*je+3,De.uint16[Ge+5]=4*je+0}return De})(ae));const te=D.createIndexBuffer(wu,!0),ce=D.createVertexBuffer(he,s.collisionCircleLayout.members,!0);for(const ve of ee){const Ne={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(ye=H).getCameraToCenterDistance(ve.projection),u_viewport_size:[ye.width,ye.height]};fe.draw(D,B.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,y.colorModeForRenderPass(),s.CullFaceMode.disabled,Ne,h.id,ce,te,s.SegmentVector.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,H.zoom)}var ye;ce.destroy(),te.destroy()}const Hh=s.create();function qh({width:y,height:a,anchor:h,textOffset:x,textScale:T},k){const{horizontalAlign:N,verticalAlign:D}=s.getAnchorAlignment(h),B=-(N-.5)*y,H=-(D-.5)*a,G=s.evaluateVariableOffset(h,x);return new s.Point((B/T+G[0])*k,(H/T+G[1])*k)}function sg(y,a,h,x,T,k,N,D,B,H,G){const ee=y.text.placedSymbolArray,ae=y.text.dynamicLayoutVertexArray,ue=y.icon.dynamicLayoutVertexArray,fe={},he=y.getProjection(),pe=Pr(D,he,k),te=k.elevation,ce=he.upVectorScale(D.canonical,k.center.lat,k.worldSize).metersToTile;ae.clear();for(let ye=0;ye<ee.length;ye++){const ve=ee.get(ye),{tileAnchorX:Ne,tileAnchorY:De,numGlyphs:je}=ve,Ge=ve.hidden||!ve.crossTileID||y.allowVerticalPlacement&&!ve.placedOrientation?null:x[ve.crossTileID];if(Ge){let $e=0,Ye=0,kt=0;if(te){const At=te?te.getAtTileOffset(D,Ne,De):0,[tn,_n,Zt]=he.upVector(D.canonical,Ne,De);$e=At*tn*ce,Ye=At*_n*ce,kt=At*Zt*ce}let[qe,at,Qe,Et]=Ri(ve.projectedAnchorX+$e,ve.projectedAnchorY+Ye,ve.projectedAnchorZ+kt,h?pe:N);const Xe=cp(k.getCameraToCenterDistance(he),Et);let ut=T.evaluateSizeForFeature(y.textSizeData,H,ve)*Xe/s.ONE_EM;h&&(ut*=y.tilePixelRatio/B);const Tt=qh(Ge,ut);h?({x:qe,y:at,z:Qe}=he.projectTilePoint(Ne+Tt.x,De+Tt.y,D.canonical),[qe,at,Qe]=Ri(qe+$e,at+Ye,Qe+kt,N)):(a&&Tt._rotate(-k.angle),qe+=Tt.x,at+=Tt.y,Qe=0);const vt=y.allowVerticalPlacement&&ve.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let At=0;At<je;At++)s.addDynamicAttributes(ae,qe,at,Qe,vt);G&&ve.associatedIconIndex>=0&&(fe[ve.associatedIconIndex]={x:qe,y:at,z:Qe,angle:vt})}else Us(je,ae)}if(G){ue.clear();const ye=y.icon.placedSymbolArray;for(let ve=0;ve<ye.length;ve++){const Ne=ye.get(ve),{numGlyphs:De}=Ne,je=fe[ve];if(Ne.hidden||!je)Us(De,ue);else{const{x:Ge,y:$e,z:Ye,angle:kt}=je;for(let qe=0;qe<De;qe++)s.addDynamicAttributes(ue,Ge,$e,Ye,kt)}}y.icon.dynamicLayoutVertexBuffer.updateData(ue)}y.text.dynamicLayoutVertexBuffer.updateData(ae)}function Wh(y,a,h){return h.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function gp(y,a,h,x,T,k,N,D,B,H,G,ee){const ae=y.context,ue=ae.gl,fe=y.transform,he=D==="map",pe=B==="map",te=he&&h.layout.get("symbol-placement")!=="point",ce=he&&!pe&&!te,ye=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ve=!1;const Ne=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),De=[s.mercatorXfromLng(fe.center.lng),s.mercatorYfromLat(fe.center.lat)],je=h.layout.get("text-variable-anchor"),Ge=fe.projection.name==="globe",$e=[],Ye=[0,-1,0];let kt=Ye;!Ge&&!fe.mercatorFromTransition||he||(kt=(function(qe){const at=qe._camera.getWorldToCamera(qe.worldSize,1),Qe=s.multiply([],at,qe.globeMatrix);s.invert(Qe,Qe);const Et=[0,0,0],Xe=[0,1,0,0];return s.transformMat4$1(Xe,Xe,Qe),Et[0]=Xe[0],Et[1]=Xe[1],Et[2]=Xe[2],s.normalize(Et,Et),Et})(fe));for(const qe of x){const at=a.getTile(qe),Qe=at.getBucket(h);if(!Qe||Qe.projection.name==="mercator"&&Ge)continue;const Et=T?Qe.text:Qe.icon;if(!Et||Qe.fullyClipped||!Et.segments.get().length)continue;const Xe=Et.programConfigurations.get(h.id),ut=T||Qe.sdfIcons,Tt=T?Qe.textSizeData:Qe.iconSizeData,vt=pe||fe.pitch!==0,At=s.evaluateSizeForZoom(Tt,fe.zoom);let tn,_n,Zt,hn,zn=[0,0],Gn=null;if(T)_n=at.glyphAtlasTexture,Zt=ue.LINEAR,tn=at.glyphAtlasTexture.size,Qe.iconsInText&&(zn=at.imageAtlasTexture.size,Gn=at.imageAtlasTexture,hn=vt||y.options.rotating||y.options.zooming||Tt.kind==="composite"||Tt.kind==="camera"?ue.LINEAR:ue.NEAREST);else{const vo=h.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;_n=at.imageAtlasTexture,Zt=ut||y.options.rotating||y.options.zooming||vo||vt?ue.LINEAR:ue.NEAREST,tn=at.imageAtlasTexture.size}const nn=Qe.projection.name==="globe",Wn=nn?kt:Ye,lr=nn?s.globeToMercatorTransition(fe.zoom):0,cr=Pr(qe,Qe.getProjection(),fe),ir=fe.calculatePixelsToTileUnitsMatrix(at),Li=ht(cr,at.tileID.canonical,pe,he,fe,Qe.getProjection(),ir),qr=y.terrain&&pe&&te?s.invert(s.create(),Li):Hh,Ks=ai(cr,at.tileID.canonical,pe,he,fe,Qe.getProjection(),ir),_o=je&&Qe.hasTextData(),Mn=h.layout.get("icon-text-fit")!=="none"&&_o&&Qe.hasIconData();if(te){const vo=fe.elevation,xo=vo?vo.getAtTileOffsetFunc(qe,fe.center.lat,fe.worldSize,Qe.getProjection()):null,Lo=Si(cr,at.tileID.canonical,pe,he,fe,Qe.getProjection(),ir);oc(Qe,cr,y,T,Lo,Ks,pe,H,xo,qe)}const mr=te||T&&je||Mn,nr=y.translatePosMatrix(cr,at,k,N),Wr=mr?Hh:Li,Oi=y.translatePosMatrix(Ks,at,k,N,!0),wr=Qe.getProjection().createInversionMatrix(fe,qe.canonical),pi=[];y.terrainRenderModeElevated()&&pe&&pi.push("PITCH_WITH_MAP_TERRAIN"),nn&&pi.push("PROJECTION_GLOBE_VIEW"),mr&&pi.push("PROJECTED_POS_ON_VIEWPORT");const Or=ut&&h.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Fr;Fr=ut?Qe.iconsInText?mp(Tt.kind,At,ce,pe,y,nr,Wr,Oi,tn,zn,qe,lr,De,wr,Wn,Qe.getProjection()):El(Tt.kind,At,ce,pe,y,nr,Wr,Oi,T,tn,!0,qe,lr,De,wr,Wn,Qe.getProjection()):$h(Tt.kind,At,ce,pe,y,nr,Wr,Oi,T,tn,qe,lr,De,wr,Wn,Qe.getProjection());const Jr={program:y.useProgram(Wh(ut,T,Qe),Xe,pi),buffers:Et,uniformValues:Fr,atlasTexture:_n,atlasTextureIcon:Gn,atlasInterpolation:Zt,atlasInterpolationIcon:hn,isSDF:ut,hasHalo:Or,tile:at,labelPlaneMatrixInv:qr};if(ye&&Qe.canOverlap){ve=!0;const vo=Et.segments.get();for(const xo of vo)$e.push({segments:new s.SegmentVector([xo]),sortKey:xo.sortKey,state:Jr})}else $e.push({segments:Et.segments,sortKey:0,state:Jr})}ve&&$e.sort(((qe,at)=>qe.sortKey-at.sortKey));for(const qe of $e){const at=qe.state;if(y.terrain&&y.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:!Ge,labelPlaneMatrixInv:at.labelPlaneMatrixInv}),ae.activeTexture.set(ue.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,ue.CLAMP_TO_EDGE),at.atlasTextureIcon&&(ae.activeTexture.set(ue.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,ue.CLAMP_TO_EDGE)),at.isSDF){const Qe=at.uniformValues;at.hasHalo&&(Qe.u_is_halo=1,bu(at.buffers,qe.segments,h,y,at.program,Ne,G,ee,Qe)),Qe.u_is_halo=0}bu(at.buffers,qe.segments,h,y,at.program,Ne,G,ee,at.uniformValues)}}function bu(y,a,h,x,T,k,N,D,B){const H=x.context,G=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.globeExtVertexBuffer];T.draw(H,H.gl.TRIANGLES,k,N,D,s.CullFaceMode.disabled,B,h.id,y.layoutVertexBuffer,y.indexBuffer,a,h.paint,x.transform.zoom,y.programConfigurations.get(h.id),G)}function mo(y,a,h,x,T,k,N){const D=y.context.gl,B=h.paint.get("fill-pattern"),H=B&&B.constantOr(1);let G,ee,ae,ue,fe;N?(ee=H&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=D.LINES):(ee=H?"fillPattern":"fill",G=D.TRIANGLES);for(const he of x){const pe=a.getTile(he);if(H&&!pe.patternsLoaded())continue;const te=pe.getBucket(h);if(!te)continue;y.prepareDrawTile();const ce=te.programConfigurations.get(h.id),ye=y.useProgram(ee,ce);H&&(y.context.activeTexture.set(D.TEXTURE0),pe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ce.updatePaintBuffers());const ve=B.constantOr(null);if(ve&&pe.imageAtlas){const De=pe.imageAtlas.patternPositions[ve.toString()];De&&ce.setConstantPatternPositions(De)}const Ne=y.translatePosMatrix(he.projMatrix,pe,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(N){ue=te.indexBuffer2,fe=te.segments2;const De=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];ae=ee==="fillOutlinePattern"&&H?zh(Ne,y,pe,De):ig(Ne,De)}else ue=te.indexBuffer,fe=te.segments,ae=H?Oh(Ne,y,pe):Sl(Ne);y.prepareDrawProgram(y.context,ye,he.toUnwrapped()),ye.draw(y.context,G,T,y.stencilModeForClipping(he),k,s.CullFaceMode.disabled,ae,h.id,te.layoutVertexBuffer,ue,fe,h.paint,y.transform.zoom,ce)}}function Ga(y,a,h,x,T,k,N){const D=y.context,B=D.gl,H=y.transform,G=h.paint.get("fill-extrusion-pattern"),ee=G.constantOr(1),ae=h.paint.get("fill-extrusion-opacity"),ue=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],fe=h.layout.get("fill-extrusion-edge-radius"),he=fe>0&&!h.paint.get("fill-extrusion-rounded-roof"),pe=he?0:fe,te=H.projection.name==="globe"?s.fillExtrusionHeightLift():0,ce=H.projection.name==="globe",ye=ce?s.globeToMercatorTransition(H.zoom):0,ve=[s.mercatorXfromLng(H.center.lng),s.mercatorYfromLat(H.center.lat)],Ne=[];ce&&Ne.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Ne.push("FAUX_AO"),he&&Ne.push("ZERO_ROOF_RADIUS");for(const De of x){const je=a.getTile(De),Ge=je.getBucket(h);if(!Ge||Ge.projection.name!==H.projection.name)continue;const $e=Ge.programConfigurations.get(h.id),Ye=y.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",$e,Ne);if(y.terrain){const ut=y.terrain;if(y.style.terrainSetForDrapingOnly())ut.setupElevationDraw(je,Ye,{useMeterToDem:!0});else{if(!Ge.enableTerrain)continue;if(ut.setupElevationDraw(je,Ye,{useMeterToDem:!0}),Zh(D,a,De,Ge,h,ut),!Ge.centroidVertexBuffer){const Tt=Ye.attributes.a_centroid_pos;Tt!==void 0&&B.vertexAttrib2f(Tt,0,0)}}}ee&&(y.context.activeTexture.set(B.TEXTURE0),je.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),$e.updatePaintBuffers());const kt=G.constantOr(null);if(kt&&je.imageAtlas){const ut=je.imageAtlas.patternPositions[kt.toString()];ut&&$e.setConstantPatternPositions(ut)}const qe=y.translatePosMatrix(De.projMatrix,je,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),at=H.projection.createInversionMatrix(H,De.canonical),Qe=h.paint.get("fill-extrusion-vertical-gradient"),Et=ee?pp(qe,y,Qe,ae,ue,pe,De,je,te,ye,ve,at):Lh(qe,y,Qe,ae,ue,pe,De,te,ye,ve,at);y.prepareDrawProgram(D,Ye,De.toUnwrapped());const Xe=[];y.terrain&&Xe.push(Ge.centroidVertexBuffer),ce&&Xe.push(Ge.layoutVertexExtBuffer),Ye.draw(D,D.gl.TRIANGLES,T,k,N,s.CullFaceMode.backCCW,Et,h.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,h.paint,y.transform.zoom,$e,Xe)}}function Zh(y,a,h,x,T,k){const N=[te=>{let ce=te.canonical.x-1,ye=te.wrap;return ce<0&&(ce=(1<<te.canonical.z)-1,ye--),new s.OverscaledTileID(te.overscaledZ,ye,te.canonical.z,ce,te.canonical.y)},te=>{let ce=te.canonical.x+1,ye=te.wrap;return ce===1<<te.canonical.z&&(ce=0,ye++),new s.OverscaledTileID(te.overscaledZ,ye,te.canonical.z,ce,te.canonical.y)},te=>new s.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,(te.canonical.y===0?1<<te.canonical.z:te.canonical.y)-1),te=>new s.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,te.canonical.y===(1<<te.canonical.z)-1?0:te.canonical.y+1)],D=te=>{const ce=a.getSource().minzoom,ye=Ne=>{const De=a.getTileByID(Ne);if(De&&De.hasData())return De.getBucket(T)},ve=[0,-1,1];for(const Ne of ve){if(te.overscaledZ+Ne<ce)continue;const De=ye(te.calculateScaledKey(te.overscaledZ+Ne));if(De)return De}},B=[0,0,0],H=(te,ce)=>(B[0]=Math.min(te.min.y,ce.min.y),B[1]=Math.max(te.max.y,ce.max.y),B[2]=s.EXTENT-ce.min.x>te.max.x?ce.min.x-s.EXTENT:te.max.x,B),G=(te,ce)=>(B[0]=Math.min(te.min.x,ce.min.x),B[1]=Math.max(te.max.x,ce.max.x),B[2]=s.EXTENT-ce.min.y>te.max.y?ce.min.y-s.EXTENT:te.max.y,B),ee=[(te,ce)=>H(te,ce),(te,ce)=>H(ce,te),(te,ce)=>G(te,ce),(te,ce)=>G(ce,te)],ae=new s.Point(0,0);let ue,fe,he;const pe=(te,ce,ye,ve,Ne)=>{const De=[[ve?ye:te,ve?te:ye,0],[ve?ye:ce,ve?ce:ye,0]],je=Ne<0?s.EXTENT+Ne:Ne,Ge=[ve?je:(te+ce)/2,ve?(te+ce)/2:je,0];return ye===0&&Ne<0||ye!==0&&Ne>0?k.getForTilePoints(he,[Ge],!0,fe):De.push(Ge),k.getForTilePoints(h,De,!0,ue),Math.max(De[0][2],De[1][2],Ge[2])/k.exaggeration()};for(let te=0;te<4;te++){const ce=(te<2?1:5)-te,ye=x.borders[te];if(ye.length===0)continue;const ve=he=N[te](h),Ne=D(ve);if(!(Ne&&Ne instanceof s.FillExtrusionBucket&&Ne.enableTerrain)||x.borderDoneWithNeighborZ[te]===Ne.canonical.z&&Ne.borderDoneWithNeighborZ[ce]===x.canonical.z||(fe=k.findDEMTileFor(ve),!fe||!fe.dem))continue;if(!ue){const $e=k.findDEMTileFor(h);if(!$e||!$e.dem)return;ue=$e}const De=Ne.borders[ce];let je=0;const Ge=Ne.borderDoneWithNeighborZ[ce]!==x.canonical.z;if(x.canonical.z===Ne.canonical.z){for(let $e=0;$e<ye.length;$e++){const Ye=x.featuresOnBorder[ye[$e]],kt=Ye.borders[te];let qe;for(;je<De.length&&(qe=Ne.featuresOnBorder[De[je]],!(qe.borders[ce][1]>kt[0]+3));)Ge&&Ne.encodeCentroid(void 0,qe,!1),je++;if(qe&&je<De.length){const at=je;let Qe=0;for(;!(qe.borders[ce][0]>kt[1]-3)&&(Qe++,++je!==De.length);)qe=Ne.featuresOnBorder[De[je]];if(qe=Ne.featuresOnBorder[De[at]],Ye.intersectsCount()>1||qe.intersectsCount()>1||Qe!==1){Qe!==1&&(je=at),x.encodeCentroid(void 0,Ye,!1),Ge&&Ne.encodeCentroid(void 0,qe,!1);continue}const Et=ee[te](Ye,qe),Xe=te%2?s.EXTENT-1:0;ae.x=pe(Et[0],Math.min(s.EXTENT-1,Et[1]),Xe,te<2,Et[2]),ae.y=0,x.encodeCentroid(ae,Ye,!1),Ge&&Ne.encodeCentroid(ae,qe,!1)}else x.encodeCentroid(void 0,Ye,!1)}x.borderDoneWithNeighborZ[te]=Ne.canonical.z,x.needsCentroidUpdate=!0,Ge&&(Ne.borderDoneWithNeighborZ[ce]=x.canonical.z,Ne.needsCentroidUpdate=!0)}else{for(const $e of ye)x.encodeCentroid(void 0,x.featuresOnBorder[$e],!1);if(Ge){for(const $e of De)Ne.encodeCentroid(void 0,Ne.featuresOnBorder[$e],!1);Ne.borderDoneWithNeighborZ[ce]=x.canonical.z,Ne.needsCentroidUpdate=!0}x.borderDoneWithNeighborZ[te]=Ne.canonical.z,x.needsCentroidUpdate=!0}}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&x.centroidVertexArray.length!==0)&&x.uploadCentroid(y)}const Cl=new s.Color(1,0,0,1),yp=new s.Color(0,1,0,1),_p=new s.Color(0,0,1,1),Kh=new s.Color(1,0,1,1),og=new s.Color(0,1,1,1);function ag(y,a,h){const x=y.context,T=y.transform,k=x.gl,N=T.projection.name==="globe",D=N?["PROJECTION_GLOBE_VIEW"]:null;let B=h.projMatrix;if(N&&s.globeToMercatorTransition(T.zoom)>0){const Ye=s.transitionTileAABBinECEF(h.canonical,T),kt=s.globeDenormalizeECEF(Ye);B=s.multiply(new Float32Array(16),T.globeMatrix,kt),s.multiply(B,T.projMatrix,B)}const H=y.useProgram("debug",null,D),G=a.getTileByID(h.key);y.terrain&&y.terrain.setupElevationDraw(G,H);const ee=s.DepthMode.disabled,ae=s.StencilMode.disabled,ue=y.colorModeForRenderPass(),fe="$debug";x.activeTexture.set(k.TEXTURE0),y.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),N?G._makeGlobeTileDebugBuffers(y.context,T):G._makeDebugTileBoundsBuffers(y.context,T.projection);const he=G._tileDebugBuffer||y.debugBuffer,pe=G._tileDebugIndexBuffer||y.debugIndexBuffer,te=G._tileDebugSegments||y.debugSegments;H.draw(x,k.LINE_STRIP,ee,ae,ue,s.CullFaceMode.disabled,_u(B,s.Color.red),fe,he,pe,te,null,null,null,[G._globeTileDebugBorderBuffer]);const ce=G.latestRawTileData,ye=Math.floor((ce&&ce.byteLength||0)/1024),ve=a.getTile(h).tileSize,Ne=512/Math.min(ve,512)*(h.overscaledZ/T.zoom)*.5;let De=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(De+=` => ${h.overscaledZ}`),De+=` ${ye}kb`,(function(Ye,kt){Ye.initDebugOverlayCanvas();const qe=Ye.debugOverlayCanvas,at=Ye.context.gl,Qe=Ye.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,qe.width,qe.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(kt,5,5),Qe.strokeText(kt,5,5),Ye.debugOverlayTexture.update(qe),Ye.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)})(y,De);const je=G._tileDebugTextBuffer||y.debugBuffer,Ge=G._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,$e=G._tileDebugTextSegments||y.debugSegments;H.draw(x,k.TRIANGLES,ee,ae,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,_u(B,s.Color.transparent,Ne),fe,je,Ge,$e,null,null,null,[G._globeTileDebugTextBuffer])}function kl(y,a,h,x){Qo(y,0,a+h/2,y.transform.width,h,x)}function vc(y,a,h,x){Qo(y,a-h/2,0,h,y.transform.height,x)}function Qo(y,a,h,x,T,k){const N=y.context,D=N.gl;D.enable(D.SCISSOR_TEST),D.scissor(a*s.exported.devicePixelRatio,h*s.exported.devicePixelRatio,x*s.exported.devicePixelRatio,T*s.exported.devicePixelRatio),N.clear({color:k}),D.disable(D.SCISSOR_TEST)}const xd=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Xh}=xd;function go(y,a,h,x){y.emplaceBack(a,h,x)}class ga{constructor(a){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,go(this.vertexArray,-1,-1,1),go(this.vertexArray,1,-1,1),go(this.vertexArray,-1,1,1),go(this.vertexArray,1,1,1),go(this.vertexArray,-1,-1,-1),go(this.vertexArray,1,-1,-1),go(this.vertexArray,-1,1,-1),go(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Xh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Ms(y,a,h,x,T,k){const N=y.gl,D=a.paint.get("sky-atmosphere-color"),B=a.paint.get("sky-atmosphere-halo-color"),H=a.paint.get("sky-atmosphere-sun-intensity"),G=((ee,ae,ue,fe,he)=>({u_matrix_3f:ee,u_sun_direction:ae,u_sun_intensity:ue,u_color_tint_r:[fe.r,fe.g,fe.b,fe.a],u_color_tint_m:[he.r,he.g,he.b,he.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),x),T,H,D,B);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+k,a.skyboxTexture,0),h.draw(y,N.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,G,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const xc=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Tu{constructor(a){const h=new s.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const x=new s.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(h,xc.members),this.indexBuffer=a.createIndexBuffer(x),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ha={symbol:function(y,a,h,x,T){if(y.renderPass!=="translucent")return;const k=s.StencilMode.disabled,N=y.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&(function(D,B,H,G,ee,ae,ue){const fe=B.transform,he=ee==="map",pe=ae==="map";for(const te of D){const ce=G.getTile(te),ye=ce.getBucket(H);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const ve=s.evaluateSizeForZoom(ye.textSizeData,fe.zoom),Ne=Pr(te,ye.getProjection(),fe),De=fe.calculatePixelsToTileUnitsMatrix(ce),je=ht(Ne,ce.tileID.canonical,pe,he,fe,ye.getProjection(),De),Ge=H.layout.get("icon-text-fit")!=="none"&&ye.hasIconData();if(ve){const $e=Math.pow(2,fe.zoom-ce.tileID.overscaledZ);sg(ye,he,pe,ue,s.symbolSize,fe,je,te,$e,ve,Ge)}}})(x,y,h,a,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),T),h.paint.get("icon-opacity").constantOr(1)!==0&&gp(y,a,h,x,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),k,N),h.paint.get("text-opacity").constantOr(1)!==0&&gp(y,a,h,x,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),k,N),a.map.showCollisionBoxes&&(_c(y,a,h,x,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),_c(y,a,h,x,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(y,a,h,x){if(y.renderPass!=="translucent")return;const T=h.paint.get("circle-opacity"),k=h.paint.get("circle-stroke-width"),N=h.paint.get("circle-stroke-opacity"),D=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(T.constantOr(1)===0&&(k.constantOr(1)===0||N.constantOr(1)===0))return;const B=y.context,H=B.gl,G=y.transform,ee=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),ae=s.StencilMode.disabled,ue=y.colorModeForRenderPass(),fe=G.projection.name==="globe",he=[s.mercatorXfromLng(G.center.lng),s.mercatorYfromLat(G.center.lat)],pe=[];for(let ce=0;ce<x.length;ce++){const ye=x[ce],ve=a.getTile(ye),Ne=ve.getBucket(h);if(!Ne||Ne.projection.name!==G.projection.name)continue;const De=Ne.programConfigurations.get(h.id),je=gd(h);fe&&je.push("PROJECTION_GLOBE_VIEW");const Ge=y.useProgram("circle",De,je),$e=Ne.layoutVertexBuffer,Ye=Ne.globeExtVertexBuffer,kt=Ne.indexBuffer,qe=G.projection.createInversionMatrix(G,ye.canonical),at={programConfiguration:De,program:Ge,layoutVertexBuffer:$e,globeExtVertexBuffer:Ye,indexBuffer:kt,uniformValues:Bh(y,ye,ve,qe,he,h),tile:ve};if(D){const Qe=Ne.segments.get();for(const Et of Qe)pe.push({segments:new s.SegmentVector([Et]),sortKey:Et.sortKey,state:at})}else pe.push({segments:Ne.segments,sortKey:0,state:at})}D&&pe.sort(((ce,ye)=>ce.sortKey-ye.sortKey));const te={useDepthForOcclusion:!fe};for(const ce of pe){const{programConfiguration:ye,program:ve,layoutVertexBuffer:Ne,globeExtVertexBuffer:De,indexBuffer:je,uniformValues:Ge,tile:$e}=ce.state,Ye=ce.segments;y.terrain&&y.terrain.setupElevationDraw($e,ve,te),y.prepareDrawProgram(B,ve,$e.tileID.toUnwrapped()),ve.draw(B,H.TRIANGLES,ee,ae,ue,s.CullFaceMode.disabled,Ge,h.id,Ne,je,Ye,h.paint,G.zoom,ye,[De])}},heatmap:function(y,a,h,x){if(h.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const T=y.context,k=T.gl,N=s.StencilMode.disabled,D=new s.ColorMode([k.ONE,k.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(ue,fe,he,pe){const te=ue.gl,ce=fe.width*pe,ye=fe.height*pe;ue.activeTexture.set(te.TEXTURE1),ue.viewport.set([0,0,ce,ye]);let ve=he.heatmapFbo;if(!ve||ve&&(ve.width!==ce||ve.height!==ye)){ve&&ve.destroy();const Ne=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ne),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ve=he.heatmapFbo=ue.createFramebuffer(ce,ye,!1),(function(De,je,Ge,$e,Ye,kt){const qe=De.gl;qe.texImage2D(qe.TEXTURE_2D,0,De.isWebGL2&&De.extRenderToTextureHalfFloat?qe.RGBA16F:qe.RGBA,Ye,kt,0,qe.RGBA,De.extRenderToTextureHalfFloat?De.isWebGL2?qe.HALF_FLOAT:De.extTextureHalfFloat.HALF_FLOAT_OES:qe.UNSIGNED_BYTE,null),$e.colorAttachment.set(Ge)})(ue,0,Ne,ve,ce,ye)}else te.bindTexture(te.TEXTURE_2D,ve.colorAttachment.get()),ue.bindFramebuffer.set(ve.framebuffer)})(T,y,h,y.transform.projection.name==="globe"?.5:.25),T.clear({color:s.Color.transparent});const B=y.transform,H=B.projection.name==="globe",G=H?["PROJECTION_GLOBE_VIEW"]:null,ee=H?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,ae=[s.mercatorXfromLng(B.center.lng),s.mercatorYfromLat(B.center.lat)];for(let ue=0;ue<x.length;ue++){const fe=x[ue];if(a.hasRenderableParent(fe))continue;const he=a.getTile(fe),pe=he.getBucket(h);if(!pe||pe.projection.name!==B.projection.name)continue;const te=pe.programConfigurations.get(h.id),ce=y.useProgram("heatmap",te,G),{zoom:ye}=y.transform;y.terrain&&y.terrain.setupElevationDraw(he,ce),y.prepareDrawProgram(T,ce,fe.toUnwrapped());const ve=B.projection.createInversionMatrix(B,fe.canonical);ce.draw(T,k.TRIANGLES,s.DepthMode.disabled,N,D,ee,Vh(y,fe,he,ve,ae,ye,h.paint.get("heatmap-intensity")),h.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,h.paint,y.transform.zoom,te,H?[pe.globeExtVertexBuffer]:null)}T.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),(function(T,k){const N=T.context,D=N.gl,B=k.heatmapFbo;if(!B)return;N.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,B.colorAttachment.get()),N.activeTexture.set(D.TEXTURE1);let H=k.colorRampTexture;H||(H=k.colorRampTexture=new s.Texture(N,k.colorRamp,D.RGBA)),H.bind(D.LINEAR,D.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(N,D.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,T.colorModeForRenderPass(),s.CullFaceMode.disabled,((G,ee,ae,ue)=>({u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}))(0,k),k.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,k.paint,T.transform.zoom)})(y,h))},line:function(y,a,h,x){if(y.renderPass!=="translucent")return;const T=h.paint.get("line-opacity"),k=h.paint.get("line-width");if(T.constantOr(1)===0||k.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),D=y.colorModeForRenderPass(),B=y.terrain&&y.terrain.renderingToTexture?1:s.exported.devicePixelRatio,H=h.paint.get("line-dasharray"),G=H.constantOr(1),ee=h.layout.get("line-cap"),ae=h.paint.get("line-pattern"),ue=ae.constantOr(1),fe=h.paint.get("line-gradient"),he=ue?"linePattern":"line",pe=y.context,te=pe.gl,ce=(ve=>{const Ne=[];yc(ve)&&Ne.push("RENDER_LINE_DASH"),ve.paint.get("line-gradient")&&Ne.push("RENDER_LINE_GRADIENT");const De=ve.paint.get("line-trim-offset");De[0]===0&&De[1]===0||Ne.push("RENDER_LINE_TRIM_OFFSET");const je=ve.paint.get("line-pattern").constantOr(1),Ge=ve.paint.get("line-opacity").constantOr(1)!==1;return!je&&Ge&&Ne.push("RENDER_LINE_ALPHA_DISCARD"),Ne})(h);let ye=ce.includes("RENDER_LINE_ALPHA_DISCARD");y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(ye=!1);for(const ve of x){const Ne=a.getTile(ve);if(ue&&!Ne.patternsLoaded())continue;const De=Ne.getBucket(h);if(!De)continue;y.prepareDrawTile();const je=De.programConfigurations.get(h.id),Ge=y.useProgram(he,je,ce),$e=ae.constantOr(null);if($e&&Ne.imageAtlas){const ut=Ne.imageAtlas.patternPositions[$e.toString()];ut&&je.setConstantPatternPositions(ut)}const Ye=H.constantOr(null),kt=ee.constantOr(null);if(!ue&&Ye&&kt&&Ne.lineAtlas){const ut=Ne.lineAtlas.getDash(Ye,kt);ut&&je.setConstantPatternPositions(ut)}let[qe,at]=h.paint.get("line-trim-offset");(kt==="round"||kt==="square")&&qe!==at&&(qe===0&&(qe-=1),at===1&&(at+=1));const Qe=y.terrain?ve.projMatrix:null,Et=ue?vu(y,Ne,h,Qe,B):mc(y,Ne,h,Qe,De.lineClipsArray.length,B,[qe,at]);if(fe){const ut=De.gradients[h.id];let Tt=ut.texture;if(h.gradientVersion!==ut.version){let vt=256;if(h.stepInterpolant){const At=a.getSource().maxzoom,tn=ve.canonical.z===At?Math.ceil(1<<y.transform.maxZoom-ve.canonical.z):1;vt=s.clamp(s.nextPowerOfTwo(De.maxLineLength/s.EXTENT*1024*tn),256,pe.maxTextureSize)}ut.gradient=s.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:ut.gradient||void 0,clips:De.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new s.Texture(pe,ut.gradient,te.RGBA),ut.version=h.gradientVersion,Tt=ut.texture}pe.activeTexture.set(te.TEXTURE1),Tt.bind(h.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}G&&(pe.activeTexture.set(te.TEXTURE0),Ne.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),je.updatePaintBuffers()),ue&&(pe.activeTexture.set(te.TEXTURE0),Ne.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),je.updatePaintBuffers()),y.prepareDrawProgram(pe,Ge,ve.toUnwrapped());const Xe=ut=>{Ge.draw(pe,te.TRIANGLES,N,ut,D,s.CullFaceMode.disabled,Et,h.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,h.paint,y.transform.zoom,je,[De.layoutVertexBuffer2])};if(ye){const ut=y.stencilModeForClipping(ve).ref;ut===0&&y.terrain&&pe.clear({stencil:0});const Tt={func:te.EQUAL,mask:255};Et.u_alpha_discard_threshold=.8,Xe(new s.StencilMode(Tt,ut,255,te.KEEP,te.KEEP,te.INVERT)),Et.u_alpha_discard_threshold=0,Xe(new s.StencilMode(Tt,ut,255,te.KEEP,te.KEEP,te.KEEP))}else Xe(y.stencilModeForClipping(ve))}ye&&(y.resetStencilClippingMasks(),y.terrain&&pe.clear({stencil:0}))},fill:function(y,a,h,x){const T=h.paint.get("fill-color"),k=h.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),D=h.paint.get("fill-pattern"),B=y.opaquePassEnabledForLayer()&&!D.constantOr(1)&&T.constantOr(s.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===B){const H=y.depthModeForSublayer(1,y.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);mo(y,a,h,x,H,N,!1)}if(y.renderPass==="translucent"&&h.paint.get("fill-antialias")){const H=y.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);mo(y,a,h,x,H,N,!0)}},"fill-extrusion":function(y,a,h,x){const T=h.paint.get("fill-extrusion-opacity");if(T!==0&&y.renderPass==="translucent"){const k=new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D);if(T!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Ga(y,a,h,x,k,s.StencilMode.disabled,s.ColorMode.disabled),Ga(y,a,h,x,k,y.stencilModeFor3D(),y.colorModeForRenderPass()),y.resetStencilClippingMasks();else{const N=y.colorModeForRenderPass();Ga(y,a,h,x,k,s.StencilMode.disabled,N)}}},hillshade:function(y,a,h,x){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const T=y.context,k=y.depthModeForSublayer(0,s.DepthMode.ReadOnly),N=y.colorModeForRenderPass(),D=y.terrain&&y.terrain.renderingToTexture,[B,H]=y.renderPass!=="translucent"||D?[{},x]:y.stencilConfigForOverlap(x);for(const G of H){const ee=a.getTile(G);if(ee.needsHillshadePrepare&&y.renderPass==="offscreen")dd(y,ee,h,k,s.StencilMode.disabled,N);else if(y.renderPass==="translucent"){const ae=D&&y.terrain?y.terrain.stencilModeForRTTOverlap(G):B[G.overscaledZ];dp(y,G,ee,h,k,ae,N)}}T.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,a,h,x,T,k){if(y.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!x.length)return;const N=y.context,D=N.gl,B=a.getSource(),H=y.useProgram("raster"),G=y.colorModeForRenderPass(),ee=y.terrain&&y.terrain.renderingToTexture,[ae,ue]=B instanceof Pn||ee?[{},x]:y.stencilConfigForOverlap(x),fe=ue[ue.length-1].overscaledZ,he=!y.options.moving;for(const pe of ue){const te=ee?s.DepthMode.disabled:y.depthModeForSublayer(pe.overscaledZ-fe,h.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,D.LESS),ce=pe.toUnwrapped(),ye=a.getTile(pe);if(ee&&(!ye||!ye.hasData()))continue;const ve=ee?pe.projMatrix:y.transform.calculateProjMatrix(ce,he),Ne=y.terrain&&ee?y.terrain.stencilModeForRTTOverlap(pe):ae[pe.overscaledZ],De=k?0:h.paint.get("raster-fade-duration");ye.registerFadeDuration(De);const je=a.findLoadedParent(pe,0),Ge=jh(ye,je,a,y.transform,De);let $e,Ye;y.terrain&&y.terrain.prepareDrawTile();const kt=h.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;N.activeTexture.set(D.TEXTURE0),ye.texture.bind(kt,D.CLAMP_TO_EDGE),N.activeTexture.set(D.TEXTURE1),je?(je.texture.bind(kt,D.CLAMP_TO_EDGE),$e=Math.pow(2,je.tileID.overscaledZ-ye.tileID.overscaledZ),Ye=[ye.tileID.canonical.x*$e%1,ye.tileID.canonical.y*$e%1]):ye.texture.bind(kt,D.CLAMP_TO_EDGE),ye.texture.useMipmap&&N.extTextureFilterAnisotropic&&y.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const qe=_d(ve,Ye||[0,0],$e||1,Ge,h,B instanceof Pn?B.perspectiveTransform:[0,0]);if(y.prepareDrawProgram(N,H,ce),B instanceof Pn)B.boundsBuffer&&B.boundsSegments&&H.draw(N,D.TRIANGLES,te,s.StencilMode.disabled,G,s.CullFaceMode.disabled,qe,h.id,B.boundsBuffer,y.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:at,tileBoundsIndexBuffer:Qe,tileBoundsSegments:Et}=y.getTileBoundsBuffers(ye);H.draw(N,D.TRIANGLES,te,Ne,G,s.CullFaceMode.disabled,qe,h.id,at,Qe,Et)}}y.resetStencilClippingMasks()},background:function(y,a,h,x){const T=h.paint.get("background-color"),k=h.paint.get("background-opacity");if(k===0)return;const N=y.context,D=N.gl,B=y.transform,H=B.tileSize,G=h.paint.get("background-pattern");if(y.isPatternMissing(G))return;const ee=!G&&T.a===1&&k===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ee)return;const ae=s.StencilMode.disabled,ue=y.depthModeForSublayer(0,ee==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),fe=y.colorModeForRenderPass(),he=y.useProgram(G?"backgroundPattern":"background");let pe,te=x;te||(pe=y.getBackgroundTiles(),te=Object.values(pe).map((ce=>ce.tileID))),G&&(N.activeTexture.set(D.TEXTURE0),y.imageManager.bind(y.context));for(const ce of te){const ye=ce.toUnwrapped(),ve=x?ce.projMatrix:y.transform.calculateProjMatrix(ye);y.prepareDrawTile();const Ne=a?a.getTile(ce):pe?pe[ce.key]:new s.Tile(ce,H,B.zoom,y),De=G?Gh(ve,k,y,G,{tileID:ce,tileSize:H}):vd(ve,k,T);y.prepareDrawProgram(N,he,ye);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ge,tileBoundsSegments:$e}=y.getTileBoundsBuffers(Ne);he.draw(N,D.TRIANGLES,ue,ae,fe,s.CullFaceMode.disabled,De,h.id,je,Ge,$e)}},sky:function(y,a,h){const x=y.transform,T=x.projection.name==="mercator"||x.projection.name==="globe"?1:s.smoothstep(7,8,x.zoom),k=h.paint.get("sky-opacity")*T;if(k===0)return;const N=y.context,D=h.paint.get("sky-type"),B=new s.DepthMode(N.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),H=y.frameCounter/1e3%1;D==="atmosphere"?y.renderPass==="offscreen"?h.needsSkyboxCapture(y)&&((function(G,ee,ae,ue){const fe=G.context,he=fe.gl;let pe=ee.skyboxFbo;if(!pe){pe=ee.skyboxFbo=fe.createFramebuffer(32,32,!1),ee.skyboxGeometry=new ga(fe),ee.skyboxTexture=fe.gl.createTexture(),he.bindTexture(he.TEXTURE_CUBE_MAP,ee.skyboxTexture),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MAG_FILTER,he.LINEAR);for(let ve=0;ve<6;++ve)he.texImage2D(he.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,he.RGBA,32,32,0,he.RGBA,he.UNSIGNED_BYTE,null)}fe.bindFramebuffer.set(pe.framebuffer),fe.viewport.set([0,0,32,32]);const te=ee.getCenter(G,!0),ce=G.useProgram("skyboxCapture"),ye=new Float64Array(16);s.identity(ye),s.rotateY(ye,ye,.5*-Math.PI),Ms(fe,ee,ce,ye,te,0),s.identity(ye),s.rotateY(ye,ye,.5*Math.PI),Ms(fe,ee,ce,ye,te,1),s.identity(ye),s.rotateX(ye,ye,.5*-Math.PI),Ms(fe,ee,ce,ye,te,2),s.identity(ye),s.rotateX(ye,ye,.5*Math.PI),Ms(fe,ee,ce,ye,te,3),s.identity(ye),Ms(fe,ee,ce,ye,te,4),s.identity(ye),s.rotateY(ye,ye,Math.PI),Ms(fe,ee,ce,ye,te,5),fe.viewport.set([0,0,G.width,G.height])})(y,h),h.markSkyboxValid(y)):y.renderPass==="sky"&&(function(G,ee,ae,ue,fe){const he=G.context,pe=he.gl,te=G.transform,ce=G.useProgram("skybox");he.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_CUBE_MAP,ee.skyboxTexture);const ye=((ve,Ne,De,je,Ge)=>({u_matrix:ve,u_sun_direction:Ne,u_cubemap:0,u_opacity:je,u_temporal_offset:Ge}))(te.skyboxMatrix,ee.getCenter(G,!1),0,ue,fe);G.prepareDrawProgram(he,ce),ce.draw(he,pe.TRIANGLES,ae,s.StencilMode.disabled,G.colorModeForRenderPass(),s.CullFaceMode.backCW,ye,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)})(y,h,B,k,H):D==="gradient"&&y.renderPass==="sky"&&(function(G,ee,ae,ue,fe){const he=G.context,pe=he.gl,te=G.transform,ce=G.useProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new ga(he)),he.activeTexture.set(pe.TEXTURE0);let ye=ee.colorRampTexture;ye||(ye=ee.colorRampTexture=new s.Texture(he,ee.colorRamp,pe.RGBA)),ye.bind(pe.LINEAR,pe.CLAMP_TO_EDGE);const ve=((Ne,De,je,Ge,$e)=>({u_matrix:Ne,u_color_ramp:0,u_center_direction:De,u_radius:s.degToRad(je),u_opacity:Ge,u_temporal_offset:$e}))(te.skyboxMatrix,ee.getCenter(G,!1),ee.paint.get("sky-gradient-radius"),ue,fe);G.prepareDrawProgram(he,ce),ce.draw(he,pe.TRIANGLES,ae,s.StencilMode.disabled,G.colorModeForRenderPass(),s.CullFaceMode.backCW,ve,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)})(y,h,B,k,H)},debug:function(y,a,h){for(let x=0;x<h.length;x++)ag(y,a,h[x])},custom:function(y,a,h,x){const T=y.context,k=h.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&h.isLayerDraped()){if(y.renderPass==="offscreen"){const N=k.prerender;if(N){if(y.setCustomLayerDefaults(),T.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const D=y.transform.pointMerc;N.call(k,T.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(y.transform.zoom),[D.x,D.y],y.transform.pixelsPerMeterRatio)}else N.call(k,T.gl,y.transform.customLayerMatrix());T.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const D=k.renderToTile;if(D){const B=x[0].canonical,H=new s.MercatorCoordinate(B.x+x[0].wrap*(1<<B.z),B.y,B.z);T.setDepthMode(s.DepthMode.disabled),T.setStencilMode(s.StencilMode.disabled),T.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),D.call(k,T.gl,H),T.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),T.setColorMode(y.colorModeForRenderPass()),T.setStencilMode(s.StencilMode.disabled);const N=k.renderingMode==="3d"?new s.DepthMode(y.context.gl.LEQUAL,s.DepthMode.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(T.setDepthMode(N),y.transform.projection.name==="globe"){const D=y.transform.pointMerc;k.render(T.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(y.transform.zoom),[D.x,D.y],y.transform.pixelsPerMeterRatio)}else k.render(T.gl,y.transform.customLayerMatrix());T.setDirty(),y.setBaseState(),T.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Al{constructor(a,h,x=!1){this.context=new St(a,x),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,h){const x=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Dh(this,a));const T=this._terrain;this.transform.elevation=x?T:null,T.update(a,this.transform,h)}_updateFog(a){const h=a.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,T]=h.getFovAdjustedRange(this.transform._fov);if(x>T)return void(this.transform.fogCullDistSq=null);const k=x+.78*(T-x);this.transform.fogCullDistSq=k*k}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,h){if(this.width=a*s.exported.devicePixelRatio,this.height=h*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const a=this.context,h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(h,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const x=new s.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(s.EXTENT,0),x.emplaceBack(0,s.EXTENT),x.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=a.createVertexBuffer(x,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const T=new s.StructArrayLayout2i4;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(-1,1),T.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(T,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const k=new s.StructArrayLayout4i8;k.emplaceBack(0,0,0,0),k.emplaceBack(s.EXTENT,0,s.EXTENT,0),k.emplaceBack(0,s.EXTENT,0,s.EXTENT),k.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(k,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const N=new s.StructArrayLayout3ui6;N.emplaceBack(0,1,2),N.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(N);const D=new s.StructArrayLayout1ui2;for(const H of[0,1,3,2,0])D.emplaceBack(H);this.debugIndexBuffer=a.createIndexBuffer(D),this.emptyTexture=new s.Texture(a,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=s.create();const B=this.context.gl;this.stencilClearMode=new s.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Tu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,h.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,pu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,h,x){if(!h||this.currentStencilSource===h.id||!a.isTileClipped()||!x||x.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const B of x)if(this._tileClippingMaskIDs[B.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=h.id;const T=this.context,k=T.gl;this.nextStencilID+x.length>256&&this.clearStencil(),T.setColorMode(s.ColorMode.disabled),T.setDepthMode(s.DepthMode.disabled);const N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of x){const B=h.getTile(D),H=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:G,tileBoundsIndexBuffer:ee,tileBoundsSegments:ae}=this.getTileBoundsBuffers(B);N.draw(T,k.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:k.ALWAYS,mask:0},H,255,k.KEEP,k.KEEP,k.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,pu(D.projMatrix),"$clipping",G,ee,ae)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new s.StencilMode({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const h=this.context.gl;return new s.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(a){const h=this.context.gl,x=a.sort(((N,D)=>D.overscaledZ-N.overscaledZ)),T=x[x.length-1].overscaledZ,k=x[0].overscaledZ-T+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const N={};for(let D=0;D<k;D++)N[D+T]=new s.StencilMode({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=k,[N,x]}return[{[T]:s.StencilMode.disabled},x]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([a.CONSTANT_COLOR,a.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(a,h,x){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new s.DepthMode(x||this.context.gl.LEQUAL,h,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){this.style=a,this.options=h,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const x=this.style.order,T=this.style._sourceCaches;for(const H in T){const G=T[H];G.used&&G.prepare(this.context)}const k={},N={},D={};for(const H in T){const G=T[H];k[H]=G.getVisibleCoordinates(),N[H]=k[H].slice().reverse(),D[H]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<x.length;H++)if(this.style._layers[x[H]].is3D()){this.opaquePassCutoff=H;break}if(this.terrain&&(this.terrain.updateTileBinding(D),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const H of x){const G=this.style._layers[H],ee=a._getLayerSourceCache(G);if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const ae=ee?N[ee.id]:void 0;(G.type==="custom"||G.isSky()||ae&&ae.length)&&this.renderLayer(this,ee,G,ae)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const B=this.terrain;if(B&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&B.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[x[this.currentLayer]],G=a._getLayerSourceCache(H);if(H.isSky())continue;const ee=G?N[G.id]:void 0;this._renderTileClippingMasks(H,G,ee),this.renderLayer(this,G,H,ee)}if(this.style.fog&&this.transform.projection.supportsFog&&(function(H,G){const ee=H.context,ae=ee.gl,ue=H.transform,fe=new s.DepthMode(ae.LEQUAL,s.DepthMode.ReadOnly,[0,1]),he=H.useProgram("globeAtmosphere",null,ue.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),pe=s.globeToMercatorTransition(ue.zoom),te=G.properties.get("color").toArray01(),ce=G.properties.get("high-color").toArray01(),ye=G.properties.get("space-color").toArray01PremultipliedAlpha(),ve=s.identity$1([]);s.rotateY$1(ve,ve,-s.degToRad(ue._center.lng)),s.rotateX$1(ve,ve,s.degToRad(ue._center.lat)),s.rotateZ$1(ve,ve,ue.angle),s.rotateX$1(ve,ve,-ue._pitch);const Ne=s.fromQuat(new Float32Array(16),ve),De=s.mapValue(G.properties.get("star-intensity"),0,1,0,.25),je=5e-4,Ge=s.mapValue(G.properties.get("horizon-blend"),0,1,je,.25),$e=s.globeUseCustomAntiAliasing(H,ee,ue)&&Ge===je?ue.worldSize/(2*Math.PI*1.025)-1:ue.globeRadius,Ye=H.frameCounter/1e3%1,kt=s.length(ue.globeCenterInViewSpace),qe=Math.sqrt(Math.pow(kt,2)-Math.pow($e,2)),at=Math.acos(qe/kt),Qe=((Xe,ut,Tt,vt,At,tn,_n,Zt,hn,zn,Gn,nn,Wn,lr)=>({u_frustum_tl:Xe,u_frustum_tr:ut,u_frustum_br:Tt,u_frustum_bl:vt,u_horizon:At,u_transition:tn,u_fadeout_range:_n,u_color:Zt,u_high_color:hn,u_space_color:zn,u_star_intensity:Gn,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:nn,u_horizon_angle:Wn,u_rotation_matrix:lr}))(ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.frustumCorners.horizon,pe,Ge,te,ce,ye,De,Ye,at,Ne);H.prepareDrawProgram(ee,he);const Et=H.atmosphereBuffer;Et&&he.draw(ee,ae.TRIANGLES,fe,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Qe,"skybox",Et.vertexBuffer,Et.indexBuffer,Et.segments)})(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const H=this.style._layers[x[this.currentLayer]],G=a._getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,G,H,G?N[G.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const H=this.style._layers[x[this.currentLayer]],G=a._getLayerSourceCache(H);if(H.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ee=G?(H.type==="symbol"?D:N)[G.id]:void 0;this._renderTileClippingMasks(H,G,G?k[G.id]:void 0),this.renderLayer(this,G,H,ee),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;s.values(this.style._layers).forEach((G=>{const ee=a._getLayerSourceCache(G);ee&&!G.isHidden(this.transform.zoom)&&(!H||H.getSource().maxzoom<ee.getSource().maxzoom)&&(H=ee)})),H&&this.options.showTileBoundaries&&Ha.debug(this,H,H.getVisibleCoordinates())}this.options.showPadding&&(function(H){const G=H.transform.padding;kl(H,H.transform.height-(G.top||0),3,Cl),kl(H,G.bottom||0,3,yp),vc(H,G.left||0,3,_p),vc(H,H.transform.width-(G.right||0),3,Kh);const ee=H.transform.centerPoint;(function(ae,ue,fe,he){Qo(ae,ue-1,fe-10,2,20,he),Qo(ae,ue-10,fe-1,20,2,he)})(H,ee.x,H.transform.height-ee.y,og)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,h,x,T){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="sky"||x.type==="custom"||T&&T.length)&&(this.id=x.id,this.gpuTimingStart(x),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(x.type)||a.terrain&&x.type==="custom")&&Ha[x.type](a,h,x,T,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let x=this.gpuTimers[a.id];x||(x=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),x.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,h=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),a.beginQueryEXT(a.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const h={};for(const x in a){const T=a[x],k=this.context.extTimerQuery,N=k.getQueryObjectEXT(T.query,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(T.query),h[x]=N}return h}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let x=0;for(const T of a)x+=h.getQueryObjectEXT(T,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(T);return x}translatePosMatrix(a,h,x,T,k){if(!x[0]&&!x[1])return a;const N=k?T==="map"?this.transform.angle:0:T==="viewport"?-this.transform.angle:0;if(N){const H=Math.sin(N),G=Math.cos(N);x=[x[0]*G-x[1]*H,x[0]*H+x[1]*G]}const D=[k?x[0]:Ve(h,x[0],this.transform.zoom),k?x[1]:Ve(h,x[1],this.transform.zoom),0],B=new Float32Array(16);return s.translate(B,a,D),B}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&this.terrain.exaggeration()===0,x=this.style&&this.style.fog,T=[];return this.terrainRenderModeElevated()&&T.push("TERRAIN"),this.transform.projection.name==="globe"&&T.push("GLOBE"),h&&T.push("ZERO_EXAGGERATION"),x&&!a&&x.getOpacity(this.transform.pitch)!==0&&T.push("FOG"),a&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}useProgram(a,h,x){this.cache=this.cache||{};const T=x||[],k=this.currentGlobalDefines().concat(T),N=Qn.cacheKey(fu[a],a,k,h);return this.cache[N]||(this.cache[N]=new Qn(this.context,a,fu[a],h,xu[a],k)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,h,x){if(this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const k=T.getOpacity(this.transform.pitch),N=((D,B,H,G,ee,ae,ue,fe,he,pe,te)=>{const ce=D.transform,ye=B.properties.get("color").toArray01();ye[3]=G;const ve=D.frameCounter/1e3%1;return{u_fog_matrix:H?ce.calculateFogTileMatrix(H):D.identityMat,u_fog_range:B.getFovAdjustedRange(ce._fov),u_fog_color:ye,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:ve,u_frustum_tl:ee,u_frustum_tr:ae,u_frustum_br:ue,u_frustum_bl:fe,u_globe_pos:he,u_globe_radius:pe,u_viewport:te,u_globe_transition:s.globeToMercatorTransition(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,T,x,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);h.setFogUniformValues(a,N)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,h=a.createTexture();return a.bindTexture(a.TEXTURE_2D,h),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,h=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const T of x)h[T.key]=a[T.key]||new s.Tile(T,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Su{constructor(a=0,h=0,x=0,T=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(x)||x<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=x,this.right=T}interpolate(a,h,x){return h.top!=null&&a.top!=null&&(this.top=s.number(a.top,h.top,x)),h.bottom!=null&&a.bottom!=null&&(this.bottom=s.number(a.bottom,h.bottom,x)),h.left!=null&&a.left!=null&&(this.left=s.number(a.left,h.left,x)),h.right!=null&&a.right!=null&&(this.right=s.number(a.right,h.right,x)),this}getCenter(a,h){const x=s.clamp((this.left+a-this.right)/2,0,a),T=s.clamp((this.top+h-this.bottom)/2,0,h);return new s.Point(x,T)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Su(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Eu(y,a){const h=s.getColumn(y,3);s.fromQuat(y,a),s.setColumn(y,3,h)}function tr(y,a){const h=s.identity$1([]);return s.rotateZ$1(h,h,-a),s.rotateX$1(h,h,-y),h}function wc(y,a){const h=[y[0],y[1],0],x=[a[0],a[1],0];if(s.length(h)>=1e-15){const N=s.normalize([],h);s.scale$2(x,N,s.dot(x,N)),a[0]=x[0],a[1]=x[1]}const T=s.cross([],a,y);if(s.len(T)<1e-15)return null;const k=Math.atan2(-T[1],T[0]);return tr(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),k)}class ya{constructor(a,h){this.position=a,this.orientation=h}get position(){return this._position}set position(a){if(a){const h=a instanceof s.MercatorCoordinate?a:new s.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(h.x=s.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(a,h){if(this.orientation=null,!this.position)return;const x=this.position,T=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(a)):0,k=s.MercatorCoordinate.fromLngLat(a,T),N=[k.x-x.x,k.y-x.y,k.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=wc(N,h)}setPitchBearing(a,h){this.orientation=tr(s.degToRad(a),s.degToRad(-h))}}class bc{constructor(a,h){this._transform=s.identity([]),this.orientation=h,this.position=a}get mercatorPosition(){const a=this.position;return new s.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=s.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var h;a&&s.setColumn(this._transform,3,[(h=a)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||s.identity$1([]),a&&Eu(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,h){this._orientation=tr(a,h),Eu(this._transform,this._orientation)}forward(){const a=s.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=s.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=s.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,h){const x=new Float64Array(16);return s.invert(x,this.getWorldToCamera(a,h)),x}getWorldToCameraPosition(a,h,x){const T=this.position;s.scale$2(T,T,-a);const k=new Float64Array(16);return s.fromScaling(k,[x,x,x]),s.translate(k,k,T),k[10]*=h,k}getWorldToCamera(a,h){const x=new Float64Array(16),T=new Float64Array(4),k=this.position;return s.conjugate(T,this._orientation),s.scale$2(k,k,-a),s.fromQuat(x,T),s.translate(x,x,k),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=h,x[9]*=h,x[10]*=h,x[11]*=h,x}getCameraToClipPerspective(a,h,x,T){const k=new Float64Array(16);return s.perspective(k,a,h,x,T),k}getDistanceToElevation(a,h=!1){const x=a===0?0:s.mercatorZfromAltitude(a,h?s.latFromMercatorY(this.position[1]):this.position[1]),T=this.forward();return(x-this.position[2])/T[2]}clone(){return new bc([...this.position],[...this.orientation])}}function qa(y,a){const h=wd(y.projection,y.zoom,y.width,y.height),x=(function(k,N,D,B,H){const G=new s.LngLat(D.lng-180*qs,D.lat),ee=new s.LngLat(D.lng+180*qs,D.lat),ae=k.project(G.lng,G.lat),ue=k.project(ee.lng,ee.lat),fe=-Math.atan2(ue.y-ae.y,ue.x-ae.x),he=s.MercatorCoordinate.fromLngLat(D);he.y=s.clamp(he.y,-1+qs,1-qs);const pe=he.toLngLat(),te=k.project(pe.lng,pe.lat),ce=s.MercatorCoordinate.fromLngLat(pe);ce.x+=qs;const ye=ce.toLngLat(),ve=k.project(ye.lng,ye.lat),Ne=Cu(ve.x-te.x,ve.y-te.y,fe),De=s.MercatorCoordinate.fromLngLat(pe);De.y+=qs;const je=De.toLngLat(),Ge=k.project(je.lng,je.lat),$e=Cu(Ge.x-te.x,Ge.y-te.y,fe),Ye=Math.abs(Ne.x)/Math.abs($e.y),kt=s.identity([]);s.rotateZ(kt,kt,-fe*(1-(H?0:B)));const qe=s.identity([]);return s.scale(qe,qe,[1,1-(1-Ye)*B,1]),qe[4]=-$e.x/$e.y*B,s.rotateZ(qe,qe,fe),s.multiply(qe,kt,qe),qe})(y.projection,0,y.center,h,a),T=vp(y);return s.scale(x,x,[T,T,1]),x}function vp(y){const a=y.projection,h=wd(y.projection,y.zoom,y.width,y.height),x=xp(a,y.center),T=xp(a,s.LngLat.convert(a.center));return Math.pow(2,x*h+(1-h)*T)}function wd(y,a,h,x,T=1/0){const k=y.range;if(!k)return 0;const N=Math.min(T,Math.max(h,x)),D=Math.log(N/1024)/Math.LN2;return s.smoothstep(k[0]+D,k[1]+D,a)}const qs=1/4e4;function xp(y,a){const h=s.clamp(a.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),x=new s.LngLat(a.lng-180*qs,h),T=new s.LngLat(a.lng+180*qs,h),k=y.project(x.lng,h),N=y.project(T.lng,h),D=s.MercatorCoordinate.fromLngLat(x),B=s.MercatorCoordinate.fromLngLat(T),H=N.x-k.x,G=N.y-k.y,ee=B.x-D.x,ae=B.y-D.y,ue=Math.sqrt((ee*ee+ae*ae)/(H*H+G*G));return Math.log(ue)/Math.LN2}function Cu(y,a,h){const x=Math.cos(h),T=Math.sin(h);return{x:y*x-a*T,y:y*T+a*x}}class Pl{constructor(a,h,x,T,k,N,D){this.tileSize=512,this._renderWorldCopies=k===void 0||k,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=x??0,this._maxPitch=T??60,this.setProjection(N),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Su,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new bc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new Pl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,h=!1){const x=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||x)&&this._updateCameraOnTerrain(),(a||x)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const x=!S(h,this.getProjection());return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const h=a!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const h=-a*Math.PI/180;var x;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(x=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),(function(T,k,N){var D=k[0],B=k[1],H=k[2],G=k[3],ee=Math.sin(N),ae=Math.cos(N);T[0]=D*ae+H*ee,T[1]=B*ae+G*ee,T[2]=D*-ee+H*ae,T[3]=B*-ee+G*ae})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const h=s.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=s.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const h=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let T=0,k=0;for(let N=0;N<h.length;N++){const D=new s.Point(h[N][0]*this.width,x+h[N][1]*(this.height-x)),B=a.pointCoordinate(D);if(!B)continue;const H=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);T+=B[3]*H,k+=H}return k===0?NaN:T/k}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*h,T=this._mercatorZfromZoom(a),k=this._mercatorZfromZoom(this._maxZoom),N=Math.max(T-x,k);this._setZoom(this._zoomFromMercatorZ(N))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let x;x=a.z<this._camera.position[2]?[h.x,h.y,h.z]:[a.x,a.y,a.z];const T=s.length(s.sub([],this._camera.position,x));return s.clamp(this._zoomFromMercatorZ(T),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let h=!1;if(a.orientation&&!s.exactEquals(a.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(a.orientation)),a.position){const x=[a.position.x,a.position.y,a.position.z];s.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,h=new ya;return h.position=new s.MercatorCoordinate(a[0],a[1],a[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(a){if(!s.length$1(a))return!1;s.normalize$1(a,a);const h=s.transformQuat([],[0,0,-1],a),x=s.transformQuat([],[0,-1,0],a);if(x[2]<0)return!1;const T=wc(h,x);return!!T&&(this._camera.orientation=T,!0)}_setCameraPosition(a){const h=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,T=this.cameraToCenterDistance;a[2]=s.clamp(a[2],T/x,T/h),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,x){this._unmodified=!1,this._edgeInsets.interpolate(a,h,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const h=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(a){const h=[new s.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const x=this.pointCoordinate(new s.Point(0,0)),T=this.pointCoordinate(new s.Point(this.width,0)),k=this.pointCoordinate(new s.Point(this.width,this.height)),N=this.pointCoordinate(new s.Point(0,this.height)),D=Math.floor(Math.min(x.x,T.x,k.x,N.x)),B=Math.floor(Math.max(x.x,T.x,k.x,N.x)),H=1;for(let G=D-H;G<=B+H;G++)G!==0&&h.push(new s.UnwrappedTileID(G,a))}return h}coveringTiles(a){let h=this.coveringZoomLevel(a);const x=h,T=this.elevation&&!a.isTerrainDEM,k=this.projection.name==="mercator";if(a.minzoom!==void 0&&h<a.minzoom)return[];a.maxzoom!==void 0&&h>a.maxzoom&&(h=a.maxzoom);const N=this.locationCoordinate(this.center),D=this.center.lat,B=1<<h,H=[B*N.x,B*N.y,0],G=this.projection.name==="globe",ee=!G,ae=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,ee),ue=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),fe=B*s.mercatorZfromAltitude(1,this.center.lat),he=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),pe=[B*ue.x,B*ue.y,he*(ee?1:fe)],te=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ce=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ye=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ve=a.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ne=this.projection.isReprojectedInTileSpace?vp(this):1,De=Xe=>{const Tt=new s.MercatorCoordinate(Xe.x+25e-6,Xe.y,Xe.z),vt=new s.MercatorCoordinate(Xe.x,Xe.y+25e-6,Xe.z),At=Xe.toLngLat(),tn=Tt.toLngLat(),_n=vt.toLngLat(),Zt=this.locationCoordinate(At),hn=this.locationCoordinate(tn),zn=this.locationCoordinate(_n),Gn=Math.hypot(hn.x-Zt.x,hn.y-Zt.y),nn=Math.hypot(zn.x-Zt.x,zn.y-Zt.y);return Math.sqrt(Gn*nn)*Ne/25e-6},je=Xe=>{const ut=ye,Tt=ve;return{aabb:s.tileAABB(this,B,0,0,0,Xe,Tt,ut,this.projection),zoom:0,x:0,y:0,minZ:Tt,maxZ:ut,wrap:Xe,fullyVisible:!1}},Ge=[];let $e=[];const Ye=h,kt=a.reparseOverscaled?x:h,qe=Xe=>Xe*Xe,at=qe((he-this._centerAltitude)*fe),Qe=Xe=>{if(!this._elevation||!Xe.tileID||!k)return;const ut=this._elevation.getMinMaxForTile(Xe.tileID),Tt=Xe.aabb;ut?(Tt.min[2]=ut.min,Tt.max[2]=ut.max,Tt.center[2]=(Tt.min[2]+Tt.max[2])/2):(Xe.shouldSplit=Et(Xe),Xe.shouldSplit||(Tt.min[2]=Tt.max[2]=Tt.center[2]=this._centerAltitude))},Et=Xe=>{if(Xe.zoom<ce)return!0;if(Xe.zoom===Ye)return!1;if(Xe.shouldSplit!=null)return Xe.shouldSplit;const ut=Xe.aabb.distanceX(pe),Tt=Xe.aabb.distanceY(pe);let vt=at,At=1;if(G){vt=qe(Xe.aabb.distanceZ(pe));const Zt=Math.pow(2,Xe.zoom),hn=s.latFromMercatorY((Xe.y+1)/Zt),zn=s.latFromMercatorY(Xe.y/Zt),Gn=Math.min(Math.max(D,hn),zn),nn=s.circumferenceAtLatitude(Gn)/s.circumferenceAtLatitude(D);if(At=Gn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,nn/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Xe.zoom===Ye-1&&nn>=.9)return!0}else if(T&&(vt=qe(Xe.aabb.distanceZ(pe)*fe)),this.projection.isReprojectedInTileSpace&&x<=5){const Zt=Math.pow(2,Xe.zoom),hn=De(new s.MercatorCoordinate((Xe.x+.5)/Zt,(Xe.y+.5)/Zt));At=hn>.85?1:hn}const tn=ut*ut+Tt*Tt+vt,_n=qe((1<<Ye-Xe.zoom)*te*At*((Zt,hn)=>{if(hn*qe(.707)<Zt)return 1;const zn=Math.sqrt(hn/Zt);return zn/(1.4144271570014144+(Math.pow(1.1,zn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vt,at),tn));return tn<_n};if(this.renderWorldCopies)for(let Xe=1;Xe<=3;Xe++)Ge.push(je(-Xe)),Ge.push(je(Xe));for(Ge.push(je(0));Ge.length>0;){const Xe=Ge.pop(),ut=Xe.x,Tt=Xe.y;let vt=Xe.fullyVisible;if(!vt){const At=Xe.aabb.intersects(ae);if(At===0)continue;vt=At===2}if(Xe.zoom!==Ye&&Et(Xe))for(let At=0;At<4;At++){const tn=(ut<<1)+At%2,_n=(Tt<<1)+(At>>1),Zt={aabb:k?Xe.aabb.quadrant(At):s.tileAABB(this,B,Xe.zoom+1,tn,_n,Xe.wrap,Xe.minZ,Xe.maxZ,this.projection),zoom:Xe.zoom+1,x:tn,y:_n,wrap:Xe.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:Xe.minZ,maxZ:Xe.maxZ};T&&!G&&(Zt.tileID=new s.OverscaledTileID(Xe.zoom+1===Ye?kt:Xe.zoom+1,Xe.wrap,Xe.zoom+1,tn,_n),Qe(Zt)),Ge.push(Zt)}else{const At=Xe.zoom===Ye?kt:Xe.zoom;if(a.minzoom&&a.minzoom>At)continue;const tn=H[0]-(.5+ut+(Xe.wrap<<Xe.zoom))*(1<<h-Xe.zoom),_n=H[1]-.5-Tt,Zt=Xe.tileID?Xe.tileID:new s.OverscaledTileID(At,Xe.wrap,Xe.zoom,ut,Tt);$e.push({tileID:Zt,distanceSq:tn*tn+_n*_n})}}if(this.fogCullDistSq){const Xe=this.fogCullDistSq,ut=this.horizonLineFromTop();$e=$e.filter((Tt=>{const vt=[0,0,0,1],At=[s.EXTENT,s.EXTENT,0,1],tn=this.calculateFogTileMatrix(Tt.tileID.toUnwrapped());s.transformMat4$1(vt,vt,tn),s.transformMat4$1(At,At,tn);const _n=s.getAABBPointSquareDist(vt,At);if(_n===0)return!0;let Zt=!1;const hn=this._elevation;if(hn&&_n>Xe&&ut!==0){const zn=this.calculateProjMatrix(Tt.tileID.toUnwrapped());let Gn;a.isTerrainDEM||(Gn=hn.getMinMaxForTile(Tt.tileID)),Gn||(Gn={min:ve,max:ye});const nn=s.furthestTileCorner(this.rotation),Wn=[nn[0]*s.EXTENT,nn[1]*s.EXTENT,Gn.max];s.transformMat4(Wn,Wn,zn),Zt=(1-Wn[1])*this.height*.5<ut}return _n<Xe||Zt}))}return $e.sort(((Xe,ut)=>Xe.distanceSq-ut.distanceSq)).map((Xe=>Xe.tileID))}resize(a,h){this.width=a,this.height=h,this.pixelsToGLUnits=[2/a,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const h=s.clamp(a.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),x=this.projection.project(a.lng,h);return new s.Point(x.x*this.worldSize,x.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,h){let x,T;const k=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;x=(h.x-k.x)/D,T=(h.y-k.y)/D}else{const D=this.pointCoordinate(h),B=this.pointCoordinate(k);x=D.x-B.x,T=D.y-B.y}const N=this.locationCoordinate(a);this.setLocation(new s.MercatorCoordinate(N.x-x,N.y-T))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,h){const x=h?s.mercatorZfromAltitude(h,a.lat):void 0,T=this.projection.project(a.lng,a.lat);return new s.MercatorCoordinate(T.x,T.y,x)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,h){const x=h??this._centerAltitude,T=[a.x,a.y,0,1],k=[a.x,a.y,1,1];s.transformMat4$1(T,T,this.pixelMatrixInverse),s.transformMat4$1(k,k,this.pixelMatrixInverse);const N=k[3];s.scale$1(T,T,1/T[3]),s.scale$1(k,k,1/N);const D=T[2],B=k[2];return{p0:T,p1:k,t:D===B?0:(x-D)/(B-D)}}screenPointToMercatorRay(a){const h=[a.x,a.y,0,1],x=[a.x,a.y,1,1];return s.transformMat4$1(h,h,this.pixelMatrixInverse),s.transformMat4$1(x,x,this.pixelMatrixInverse),s.scale$1(h,h,1/h[3]),s.scale$1(x,x,1/x[3]),h[2]=s.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,x[2]=s.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,s.scale$1(h,h,1/this.worldSize),s.scale$1(x,x,1/this.worldSize),new s.Ray([h[0],h[1],h[2]],s.normalize([],s.sub([],x,h)))}rayIntersectionCoordinate(a){const{p0:h,p1:x,t:T}=a,k=s.mercatorZfromAltitude(h[2],this._center.lat),N=s.mercatorZfromAltitude(x[2],this._center.lat);return new s.MercatorCoordinate(s.number(h[0],x[0],T)/this.worldSize,s.number(h[1],x[1],T)/this.worldSize,s.number(k,N,T))}pointCoordinate(a,h=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,h)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let h=this.projection.pointCoordinate3D(this,a.x,a.y);if(h)return new s.MercatorCoordinate(h[0],h[1],h[2]);let x=0,T=this.horizonLineFromTop();if(a.y>T)return this.pointCoordinate(a);const k=.02*T,N=a.clone();for(let D=0;D<10&&T-x>k;D++){N.y=s.number(x,T,.66);const B=this.projection.pointCoordinate3D(this,N.x,N.y);B?(T=N.y,h=B):x=N.y}return h?new s.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const h=this.pointCoordinate(a);return h.y>=0&&h.y<=1}_coordinatePoint(a,h){const x=h&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,T=[a.x*this.worldSize,a.y*this.worldSize,x+a.toAltitude(),1];return s.transformMat4$1(T,T,this.pixelMatrix),T[3]>0?new s.Point(T[0]/T[3],T[1]/T[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:h}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,k=this.pointLocation3D(new s.Point(h,a)),N=this.pointLocation3D(new s.Point(T,a)),D=this.pointLocation3D(new s.Point(T,x)),B=this.pointLocation3D(new s.Point(h,x));let H=Math.min(k.lng,N.lng,D.lng,B.lng),G=Math.max(k.lng,N.lng,D.lng,B.lng),ee=Math.min(k.lat,N.lat,D.lat,B.lat),ae=Math.max(k.lat,N.lat,D.lat,B.lat);const ue=Math.pow(2,-this.zoom)/16*270,fe=this.projection.name==="globe"?1:4,he=(pe,te,ce,ye,ve)=>{const Ne=(pe+ce)/2,De=(te+ye)/2,je=new s.Point(Ne,De),{lng:Ge,lat:$e}=this.pointLocation3D(je),Ye=Math.max(0,H-Ge,ee-$e,Ge-G,$e-ae);H=Math.min(H,Ge),G=Math.max(G,Ge),ee=Math.min(ee,$e),ae=Math.max(ae,$e),(ve<fe||Ye>ue)&&(he(pe,te,Ne,De,ve+1),he(Ne,De,ce,ye,ve+1))};if(he(h,a,T,a,1),he(T,a,T,x,1),he(T,x,h,x,1),he(h,x,h,a,1),this.projection.name==="globe"){const[pe,te]=s.polesInViewport(this);pe?(ae=90,G=180,H=-180):te&&(ee=-90,G=180,H=-180)}return new s.LngLatBounds(new s.LngLat(H,ee),new s.LngLat(G,ae))}_getBoundsRectangular(a,h){const{top:x,left:T}=this._edgeInsets,k=this.height-this._edgeInsets.bottom,N=this.width-this._edgeInsets.right,D=new s.Point(T,x),B=new s.Point(N,x),H=new s.Point(N,k),G=new s.Point(T,k);let ee=this.pointCoordinate(D,a),ae=this.pointCoordinate(B,a);const ue=this.pointCoordinate(H,h),fe=this.pointCoordinate(G,h),he=(pe,te)=>(te.y-pe.y)/(te.x-pe.x);return ee.y>1&&ae.y>=0?ee=new s.MercatorCoordinate((1-fe.y)/he(fe,ee)+fe.x,1):ee.y<0&&ae.y<=1&&(ee=new s.MercatorCoordinate(-fe.y/he(fe,ee)+fe.x,0)),ae.y>1&&ee.y>=0?ae=new s.MercatorCoordinate((1-ue.y)/he(ue,ae)+ue.x,1):ae.y<0&&ee.y<=1&&(ae=new s.MercatorCoordinate(-ue.y/he(ue,ae)+ue.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(fe)).extend(this.coordinateLocation(ue))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=a.visibleDemTiles.reduce(((x,T)=>{if(T.dem){const k=T.dem.tree;x.min=Math.min(x.min,k.minimums[0]),x.max=Math.max(x.max,k.maximums[0])}return x}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*a.exaggeration(),h.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-h*(1-this._horizonShift);return a?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,h){return this.projection.createTileMatrix(this,h,a)}calculateDistanceTileData(a){const h=a.key,x=this._distanceTileDataCache;if(x[h])return x[h];const T=a.canonical,k=1/this.height,N=this.cameraWorldSize,D=N/this.zoomScale(T.z),B=(T.x+Math.pow(2,T.z)*a.wrap)*D,H=T.y*D,G=this.point;G.x*=N/this.worldSize,G.y*=N/this.worldSize;const ee=this.angle,ae=Math.sin(-ee),ue=-Math.cos(-ee);return x[h]={bearing:[ae,ue],center:[(G.x-B)*k,(G.y-H)*k],scale:D/s.EXTENT*k},x[h]}calculateFogTileMatrix(a){const h=a.key,x=this._fogTileMatrixCache;if(x[h])return x[h];const T=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return s.multiply(T,this.worldToFogMatrix,T),x[h]=new Float32Array(T),x[h]}calculateProjMatrix(a,h=!1){const x=a.key,T=h?this._alignedProjMatrixCache:this._projMatrixCache;if(T[x])return T[x];const k=this.calculatePosMatrix(a,this.worldSize);return s.multiply(k,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,k),T[x]=new Float32Array(k),T[x]}calculatePixelsToTileUnitsMatrix(a){const h=a.tileID.key,x=this._pixelsToTileUnitsCache;if(x[h])return x[h];const T=(function(k,N){const{scale:D}=k.tileTransform,B=D*s.EXTENT/(k.tileSize*Math.pow(2,N.zoom-k.tileID.overscaledZ+k.tileID.canonical.z));return H=new Float32Array(4),ae=(G=N.inverseAdjustmentMatrix)[1],ue=G[2],fe=G[3],pe=(ee=[B,B])[1],H[0]=G[0]*(he=ee[0]),H[1]=ae*he,H[2]=ue*pe,H[3]=fe*pe,H;var H,G,ee,ae,ue,fe,he,pe})(a,this);return x[h]=T,x[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const a=1/this.worldSize,h=s.fromScaling([],[a,a,a]);return s.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const a=this._elevation;this._updateCameraState();const h=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(h),T=this._camera.forward(),k=s.mercatorZfromAltitude(1,this._center.lat);x[2]/=k,T[2]/=k,s.normalize(T,T);const N=a.raycast(x,T,a.exaggeration());if(N){const D=s.scaleAndAdd([],x,T,N),B=new s.MercatorCoordinate(D[0],D[1],s.mercatorZfromAltitude(D[2],s.latFromMercatorY(D[1]))),H=(B.z+s.length([B.x-x[0],B.y-x[1],B.z-x[2]*k]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const h=this._elevation,x=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,T=this._computeCameraPosition(x),k=h.getAtPointOrZero(new s.MercatorCoordinate(...T)),N=this.pixelsPerMeter/this.worldSize*k,D=this._minimumHeightOverTerrain(),B=T[2]-N;if(B<=D)if(B<0||a){const H=this.locationCoordinate(this._center,this._centerAltitude),G=[T[0],T[1],H.z-T[2]],ee=s.length(G);G[2]-=(D-B)/this._pixelsPerMercatorPixel;const ae=s.length(G);if(ae===0)return;s.scale$2(G,G,ee/ae*this._pixelsPerMercatorPixel),this._camera.position=[T[0],T[1],H.z*this._pixelsPerMercatorPixel-G[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const ae=this.center;return ae.lat=s.clamp(ae.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(ae.lng=s.clamp(ae.lng,this.minLng,this.maxLng)),this.center=ae,void(this._constraining=!1)}const h=this._unmodified,{x,y:T}=this.point;let k=0,N=x,D=T;const B=this.width/2,H=this.height/2,G=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(T-H<G&&(D=G+H),T+H>ee&&(D=ee-H),ee-G<this.height&&(k=Math.max(k,this.height/(ee-G)),D=(ee+G)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ae=this.worldMinX*this.scale,ue=this.worldMaxX*this.scale,fe=this.worldSize/2-(ae+ue)/2;N=(x+fe+this.worldSize)%this.worldSize-fe,N-B<ae&&(N=ae+B),N+B>ue&&(N=ue-B),ue-ae<this.width&&(k=Math.max(k,this.width/(ue-ae)),N=(ue+ae)/2)}N===x&&D===T||(this.center=this.unproject(new s.Point(N,D))),k&&(this.zoom+=this.scaleZoom(k)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const x=wd(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?h:1,k=this._camera.getWorldToCamera(this.worldSize,T),N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);N[8]=2*-a.x/this.width,N[9]=2*a.y/this.height;let D=s.mul([],N,k);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),je=s.identity([]);s.translate(je,je,[De.x*this.worldSize,De.y*this.worldSize,0]),s.multiply(je,je,qa(this)),s.translate(je,je,[-De.x*this.worldSize,-De.y*this.worldSize,0]),s.multiply(D,D,je),this.inverseAdjustmentMatrix=(function(Ge){const $e=qa(Ge,!0);return Me([],[$e[0],$e[1],$e[4],$e[5]])})(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],D,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=D,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const B=s.invert([],N);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height);const H=new Float32Array(16);s.identity(H),s.scale(H,H,[1,-1,1]),s.rotateX(H,H,this._pitch),s.rotateZ(H,H,this.angle);const G=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-a.x/this.width,G[9]=2*(a.y+ee)/this.height,this.skyboxMatrix=s.multiply(H,G,H);const ae=this.point,ue=ae.x,fe=ae.y,he=this.width%2/2,pe=this.height%2/2,te=Math.cos(this.angle),ce=Math.sin(this.angle),ye=ue-Math.round(ue)+te*he+ce*pe,ve=fe-Math.round(fe)+te*pe+ce*he,Ne=new Float64Array(D);if(s.translate(Ne,Ne,[ye>.5?ye-1:ye,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Ne,D=s.create(),s.scale(D,D,[this.width/2,-this.height/2,1]),s.translate(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=s.create(),s.scale(D,D,[1,-1,1]),s.translate(D,D,[-1,-1,0]),s.scale(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},D=s.invert(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(De,De,k),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,x=this._camera.position,T=1/this.height/this._pixelsPerMercatorPixel,k=[a,a,h];s.scale$2(k,k,T),s.scale$2(x,x,-1),s.multiply$2(x,x,k);const N=s.create();s.translate(N,N,x),s.scale(N,N,k),this.mercatorFogMatrix=N,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,h,T)}_computeCameraPosition(a){const h=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),T=this.point,k=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-a/this.worldSize*this._centerAltitude;return[T.x/this.worldSize-x[0]*k,T.y/this.worldSize-x[1]*k,a/this.worldSize*this._centerAltitude-x[2]*k]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],T=a[2];let k=1;this.projection.wrap&&(this.center=this.center.wrap()),T>0&&(k=Math.min((h-x)/T,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,a,k),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,h=this._camera.forward(),{pitch:x,bearing:T}=this._camera.getPitchBearing(),k=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,N=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),D=Math.max((a[2]-k)/Math.cos(x),N),B=this._zoomFromMercatorZ(D);s.scaleAndAdd(a,a,h,D),this._pitch=s.clamp(x,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(T,-Math.PI,Math.PI),this._setZoom(s.clamp(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let h=0,x=s.GLOBE_ZOOM_THRESHOLD_MAX,T=0,k=1/0;for(;x-h>1e-6&&x>h;){const N=h+.5*(x-h),D=this.tileSize*Math.pow(2,N),B=this.getCameraToCenterDistance(this.projection,N,D),H=this.scaleZoom(B/(a*this.tileSize)),G=Math.abs(N-H);G<k&&(k=G,T=N),N<H?h=N:x=N}return T}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,h){const x=Math.min(a.x,h.x),T=Math.max(a.x,h.x),k=Math.min(a.y,h.y),N=Math.max(a.y,h.y);if(k<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new s.Point(x,k),new s.Point(T,N),new s.Point(x,N),new s.Point(T,k)],B=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const G of D){const ee=this.pointRayIntersection(G);if(ee.t<0)return!0;const ae=this.rayIntersectionCoordinate(ee);if(ae.x<B||ae.y<0||ae.x>H||ae.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(a,h){const x=s.length(s.sub([],this._camera.position,a)),T=this._zoomFromMercatorZ(x)+h;return x-this._mercatorZfromZoom(T)}getCameraPoint(){if(this.projection.name==="globe"){const a=(function([h,x,T],k){const N=[h,x,T,1];s.transformMat4$1(N,N,k);const D=N[3]=Math.max(N[3],1e-6);return N[0]/=D,N[1]/=D,N[2]/=D,N})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,a))}}getCameraToCenterDistance(a,h=this.zoom,x=this.worldSize){const T=wd(a,h,this.width,this.height,1024),k=a.pixelSpaceConversion(this.center.lat,x,T);return .5/Math.tan(.5*this._fov)*this.height*k}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(a,a,this.globeMatrix),a}}function yr(y,a){let h=!1,x=null;const T=()=>{x=null,h&&(y(),x=setTimeout(T,a),h=!1)};return()=>(h=!0,x||T(),x)}class ku{constructor(a){this._hashName=a&&encodeURIComponent(a),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=yr(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,s.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const h=Wa(a);if(this._hashName){const x=this._hashName;let T=!1;const k=s.window.location.hash.slice(1).split("&").map((N=>{const D=N.split("=")[0];return D===x?(T=!0,`${D}=${h}`):N})).filter((N=>N));return T||k.push(`${x}=${h}`),`#${k.join("&")}`}return`#${h}`}_getCurrentHash(){const a=s.window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(h=x)})),(h&&h[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some((x=>isNaN(x)))){const x=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(h[3]||0):a.getBearing();return a.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:x,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,a)}}function Wa(y,a){const h=y.getCenter(),x=Math.round(100*y.getZoom())/100,T=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,T),N=Math.round(h.lng*k)/k,D=Math.round(h.lat*k)/k,B=y.getBearing(),H=y.getPitch();let G=a?`/${N}/${D}/${x}`:`${x}/${D}/${N}`;return(B||H)&&(G+="/"+Math.round(10*B)/10),H&&(G+=`/${Math.round(H)}`),G}const _a={linearity:.3,easing:s.bezier(0,0,.3,1)},Au=s.extend({deceleration:2500,maxSpeed:1400},_a),Tc=s.extend({deceleration:20,maxSpeed:1400},_a),Ft=s.extend({deceleration:1e3,maxSpeed:360},_a),Is=s.extend({deceleration:1e3,maxSpeed:90},_a);class Ml{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=s.exported.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)h.zoom+=k.zoomDelta||0,h.bearing+=k.bearingDelta||0,h.pitch+=k.pitchDelta||0,k.panDelta&&h.pan._add(k.panDelta),k.around&&(h.around=k.around),k.pinchAround&&(h.pinchAround=k.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(h.pan.mag()){const k=Pu(h.pan.mag(),x,s.extend({},Au,a||{}));T.offset=h.pan.mult(k.amount/h.pan.mag()),T.center=this._map.transform.center,Sc(T,k)}if(h.zoom){const k=Pu(h.zoom,x,Tc);T.zoom=this._map.transform.zoom+k.amount,Sc(T,k)}if(h.bearing){const k=Pu(h.bearing,x,Ft);T.bearing=this._map.transform.bearing+s.clamp(k.amount,-179,179),Sc(T,k)}if(h.pitch){const k=Pu(h.pitch,x,Is);T.pitch=this._map.transform.pitch+k.amount,Sc(T,k)}if(T.zoom||T.bearing){const k=h.pinchAround===void 0?h.around:h.pinchAround;T.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),T.noMoveStart=!0,T}}function Sc(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Pu(y,a,h){const{maxSpeed:x,linearity:T,deceleration:k}=h,N=s.clamp(y*T/(a/1e3),-x,x),D=Math.abs(N)/(k*T);return{easing:h.easing,duration:1e3*D,amount:N*(D/2)}}class Di extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,x,T={}){const k=Se(h.getCanvasContainer(),x),N=h.unproject(k);super(a,s.extend({point:k,lngLat:N,originalEvent:x},T)),this._defaultPrevented=!1,this.target=h}}class Ec extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,x){const T=a==="touchend"?x.changedTouches:x.touches,k=Ie(h.getCanvasContainer(),T),N=k.map((B=>h.unproject(B))),D=k.reduce(((B,H,G,ee)=>B.add(H.div(ee.length))),new s.Point(0,0));super(a,{points:k,point:D,lngLats:N,lngLat:h.unproject(D),originalEvent:x}),this._defaultPrevented=!1}}class Il extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,x){super(a,{originalEvent:x}),this._defaultPrevented=!1}}class Cc{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Il(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Di(a.type,this._map,a))}mouseup(a){this._map.fire(new Di(a.type,this._map,a))}preclick(a){const h=s.extend({},a);h.type="preclick",this._map.fire(new Di(h.type,this._map,h))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Di(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Di(a.type,this._map,a))}mouseover(a){this._map.fire(new Di(a.type,this._map,a))}mouseout(a){this._map.fire(new Di(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Ec(a.type,this._map,a))}touchmove(a){this._map.fire(new Ec(a.type,this._map,a))}touchend(a){this._map.fire(new Ec(a.type,this._map,a))}touchcancel(a){this._map.fire(new Ec(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kc{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Di(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Di(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bd{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(J(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const x=h,T=this._startPos,k=this._lastPos;if(!T||!k||k.equals(x)||!this._box&&x.dist(T)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const N=Math.min(T.x,x.x),D=Math.max(T.x,x.x),B=Math.min(T.y,x.y),H=Math.max(T.y,x.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${N}px,${B}px)`,this._box.style.width=D-N+"px",this._box.style.height=H-B+"px")}))}mouseupWindow(a,h){if(!this._active)return;const x=this._startPos,T=h;if(x&&a.button===0){if(this.reset(),_e(),x.x!==T.x||x.y!==T.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:k=>k.fitScreenCoordinates(x,T,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Y(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new s.Event(a,{originalEvent:h}))}}function Ac(y,a){const h={};for(let x=0;x<y.length;x++)h[y[x].identifier]=a[x];return h}class Za{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,h,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),x.length===this.numTouches&&(this.centroid=(function(T){const k=new s.Point(0,0);for(const N of T)k._add(N);return k.div(T.length)})(h),this.touches=Ac(x,h)))}touchmove(a,h,x){if(this.aborted||!this.centroid)return;const T=Ac(x,h);for(const k in this.touches){const N=T[k];(!N||N.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(a,h,x){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const T=!this.aborted&&this.centroid;if(this.reset(),T)return T}}}class Yh{constructor(a){this.singleTap=new Za(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,h,x){this.singleTap.touchstart(a,h,x)}touchmove(a,h,x){this.singleTap.touchmove(a,h,x)}touchend(a,h,x){const T=this.singleTap.touchend(a,h,x);if(T){const k=a.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(T)<30;if(k&&N||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}}}class wp{constructor(){this._zoomIn=new Yh({numTouches:1,numTaps:2}),this._zoomOut=new Yh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,x){this._zoomIn.touchstart(a,h,x),this._zoomOut.touchstart(a,h,x)}touchmove(a,h,x){this._zoomIn.touchmove(a,h,x),this._zoomOut.touchmove(a,h,x)}touchend(a,h,x){const T=this._zoomIn.touchend(a,h,x),k=this._zoomOut.touchend(a,h,x);return T?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(T)},{originalEvent:a})}):k?(this._active=!0,a.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(k)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const bp={0:1,2:2};class Pc{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,h){return!1}_move(a,h){return{}}mousedown(a,h){if(this._lastPoint)return;const x=Ue(a);this._correctButton(a,x)&&(this._lastPoint=h,this._eventButton=x)}mousemoveWindow(a,h){const x=this._lastPoint;if(x){if(a.preventDefault(),this._eventButton!=null&&(function(T,k){const N=bp[k];return T.buttons===void 0||(T.buttons&N)!==N})(a,this._eventButton))this.reset();else if(this._moved||!(h.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(x,h)}}mouseupWindow(a){this._lastPoint&&Ue(a)===this._eventButton&&(this._moved&&_e(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu extends Pc{mousedown(a,h){super.mousedown(a,h),this._lastPoint&&(this._active=!0)}_correctButton(a,h){return h===0&&!a.ctrlKey}_move(a,h){return{around:h,panDelta:h.sub(a)}}}class ea extends Pc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const x=.8*(h.x-a.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(a){a.preventDefault()}}class Td extends Pc{_correctButton(a,h){return h===0&&a.ctrlKey||h===2}_move(a,h){const x=-.5*(h.y-a.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(a){a.preventDefault()}}class va{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(a,h,x){return this._calculateTransform(a,h,x)}touchmove(a,h,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(x.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,h,x)}}touchend(a,h,x){this._calculateTransform(a,h,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,x){x.length>0&&(this._active=!0);const T=Ac(x,h),k=new s.Point(0,0),N=new s.Point(0,0);let D=0;for(const H in T){const G=T[H],ee=this._touches[H];ee&&(k._add(G),N._add(G.sub(ee)),D++,T[H]=G)}if(this._touches=T,D<this._minTouches||!N.mag())return;const B=N.div(D);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(D),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class Rs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,h,x){return{}}touchstart(a,h,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,x){const T=this._firstTwoTouches;if(!T)return;a.preventDefault();const[k,N]=T,D=xa(x,h,k),B=xa(x,h,N);if(!D||!B)return;const H=this._aroundCenter?null:D.add(B).div(2);return this._move([D,B],H,a)}touchend(a,h,x){if(!this._firstTwoTouches)return;const[T,k]=this._firstTwoTouches,N=xa(x,h,T),D=xa(x,h,k);N&&D||(this._active&&_e(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xa(y,a,h){for(let x=0;x<y.length;x++)if(y[x].identifier===h)return a[x]}function No(y,a){return Math.log(y/a)/Math.LN2}class Sd extends Rs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const x=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(No(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:No(this._distance,x),pinchAround:h}}}function Jh(y,a){return 180*y.angleWith(a)/Math.PI}class Tp extends Rs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h){const x=this._vector;if(this._vector=a[0].sub(a[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Jh(this._vector,x),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const T=Jh(a,x);return Math.abs(T)<h}}function Ns(y){return Math.abs(y.y)>Math.abs(y.x)}class Mc extends Rs{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Ns(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,x){const T=this._lastPoints;if(!T)return;const k=a[0].sub(T[0]),N=a[1].sub(T[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(k,N,x.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(k.y+N.y)/2*-.5})}gestureBeginsVertically(a,h,x){if(this._valid!==void 0)return this._valid;const T=a.mag()>=2,k=h.mag()>=2;if(!T&&!k)return;if(!T||!k)return this._firstMove==null&&(this._firstMove=x),x-this._firstMove<100&&void 0;const N=a.y>0==h.y>0;return Ns(a)&&Ns(h)&&N}}const Rl={panStep:100,bearingStep:15,pitchStep:10};class Ed{constructor(){const a=Rl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,x=0,T=0,k=0,N=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?x=-1:(a.preventDefault(),k=-1);break;case 39:a.shiftKey?x=1:(a.preventDefault(),k=1);break;case 38:a.shiftKey?T=1:(a.preventDefault(),N=-1);break;case 40:a.shiftKey?T=-1:(a.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(x=0,T=0),{cameraAnimation:D=>{const B=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Cd,zoom:h?Math.round(B)+h*(a.shiftKey?2:1):B,bearing:D.getBearing()+x*this._bearingStep,pitch:D.getPitch()+T*this._pitchStep,offset:[-k*this._panStep,-N*this._panStep],center:D.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cd(y){return y*(2-y)}const Ka=4.000244140625;class wa{constructor(a,h){this._map=a,this._el=a.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=a.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const x=s.exported.now(),T=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,h!==0&&h%Ka==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(T*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Se(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>Ka?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&H!==0&&(H=1/H);const G=h(),ee=Math.pow(2,G),ae=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):ee;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(ae*H))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:h(),T=this._startZoom,k=this._easing;let N,D=!1;if(this._type==="wheel"&&T&&k){const B=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),H=k(B);N=s.number(T,x,H),B<1?this._frameId||(this._frameId=!0):D=!0}else N=x,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:N-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=s.ease;if(this._prevEase){const x=this._prevEase,T=(s.exported.now()-x.start)/x.duration,k=x.easing(T+.01)-x.easing(T),N=.27/Math.sqrt(k*k+1e-4)*.01,D=Math.sqrt(.0729-N*N);h=s.bezier(N,D,.25,1)}return this._prevEase={start:s.exported.now(),duration:a,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class Lr{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,h){return a.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(a.shiftKey?-1:1),around:x.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xa{constructor(){this._tap=new Yh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,h,x){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=h[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(a,h,x))}touchmove(a,h,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const T=h[0],k=T.y-this._swipePoint.y;return this._swipePoint=T,a.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(a,h,x)}touchend(a,h,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(a,h,x)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gi{constructor(a,h,x){this._el=a,this._mousePan=h,this._touchPan=x}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class js{constructor(a,h,x){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=h,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nl{constructor(a,h,x,T){this._el=a,this._touchZoom=h,this._touchRotate=x,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Hi=y=>y.zoom||y.drag||y.pitch||y.rotate;class fs extends s.Event{}class kd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,h){const x=s.sub([],h,a);this.radius=s.length(x[2]<0?s.div([],x,this.constants):[x[0],x[1],0])}projectRay(a){s.div(a,a,this.constants),s.normalize(a,a),s.mul$1(a,a,this.constants);const h=s.scale$2([],a,this.radius);if(h[2]>0){const x=s.scale$2([],[0,0,1],s.dot(h,[0,0,1])),T=s.scale$2([],s.normalize([],[h[0],h[1],0]),this.radius),k=s.add([],h,s.scale$2([],s.sub([],s.add([],T,x),h),2));h[0]=k[0],h[1]=k[1]}return h}}function yo(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class jo{constructor(a,h){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ml(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),s.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[T,k,N]of this._listeners)T.addEventListener(k,T===s.window.document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[a,h,x]of this._listeners)a.removeEventListener(h,a===s.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(a){const h=this._map,x=h.getCanvasContainer();this._add("mapEvent",new Cc(h,a));const T=h.boxZoom=new bd(h,a);this._add("boxZoom",T);const k=new wp,N=new Kn;h.doubleClickZoom=new Lr(N,k),this._add("tapZoom",k),this._add("clickZoom",N);const D=new Xa;this._add("tapDragZoom",D);const B=h.touchPitch=new Mc(h);this._add("touchPitch",B);const H=new ea(a),G=new Td(a);h.dragRotate=new js(a,H,G),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",G,["mouseRotate"]);const ee=new Mu(a),ae=new va(h,a);h.dragPan=new Gi(x,ee,ae),this._add("mousePan",ee),this._add("touchPan",ae,["touchZoom","touchRotate"]);const ue=new Tp,fe=new Sd;h.touchZoomRotate=new Nl(x,fe,ue,D),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new kc(h));const he=h.scrollZoom=new wa(h,this);this._add("scrollZoom",he,["mousePan"]);const pe=h.keyboard=new Ed;this._add("keyboard",pe);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[te]&&h[te].enable(a[te])}_add(a,h,x){this._handlers.push({handlerName:a,handler:h,allowed:x}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,h,x){for(const T in a)if(T!==x&&(!h||h.indexOf(T)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const h=[];for(const x of a)this._el.contains(x.target)&&h.push(x);return h}handleEvent(a,h){this._updatingCamera=!0;const x=a.type==="renderFrame",T=x?void 0:a,k={needsRenderFrame:!1},N={},D={},B=a.touches?this._getMapTouches(a.touches):void 0,H=B?Ie(this._el,B):x?void 0:Se(this._el,a);for(const{handlerName:ae,handler:ue,allowed:fe}of this._handlers){if(!ue.isEnabled())continue;let he;this._blockedByActive(D,fe,ae)?ue.reset():ue[h||a.type]&&(he=ue[h||a.type](a,H,B),this.mergeHandlerResult(k,N,he,ae,T),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||ue.isActive())&&(D[ae]=ue)}const G={};for(const ae in this._previousActiveHandlers)D[ae]||(G[ae]=T);this._previousActiveHandlers=D,(Object.keys(G).length||yo(k))&&(this._changes.push([k,N,G]),this._triggerRenderFrame()),(Object.keys(D).length||yo(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=k;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(a,h,x,T,k){if(!x)return;s.extend(a,x);const N={handlerName:T,originalEvent:x.originalEvent||k};x.zoomDelta!==void 0&&(h.zoom=N),x.panDelta!==void 0&&(h.drag=N),x.pitchDelta!==void 0&&(h.pitch=N),x.bearingDelta!==void 0&&(h.rotate=N)}_applyChanges(){const a={},h={},x={};for(const[T,k,N]of this._changes)T.panDelta&&(a.panDelta=(a.panDelta||new s.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(a.around=T.around),T.aroundCoord!==void 0&&(a.aroundCoord=T.aroundCoord),T.pinchAround!==void 0&&(a.pinchAround=T.pinchAround),T.noInertia&&(a.noInertia=T.noInertia),s.extend(h,k),s.extend(x,N);this._updateMapTransform(a,h,x),this._changes=[]}_updateMapTransform(a,h,x){const T=this._map,k=T.transform,N=ce=>[ce.x,ce.y,ce.z];if((ce=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!yo(a)){const ce=k.zoom;k.cameraElevationReference="sea",k.recenterOnTerrain(),k.cameraElevationReference="ground",ce!==k.zoom&&this._map._update(!0)}if(k._isCameraConstrained&&T._stop(!0),!yo(a))return void this._fireEvents(h,x,!0);let{panDelta:D,zoomDelta:B,bearingDelta:H,pitchDelta:G,around:ee,aroundCoord:ae,pinchAround:ue}=a;k._isCameraConstrained&&(B>0&&(B=0),k._isCameraConstrained=!1),ue!==void 0&&(ee=ue),(B||(ce=>h[ce]&&!this._eventsInProgress[ce])("drag"))&&ee&&(this._dragOrigin=N(k.pointCoordinate3D(ee)),this._trackingEllipsoid.setup(k._camera.position,this._dragOrigin)),k.cameraElevationReference="sea",T._stop(!0),ee=ee||T.transform.centerPoint,H&&(k.bearing+=H),G&&(k.pitch+=G),k._updateCameraState();const fe=[0,0,0];if(D)if(k.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(k.screenPointToMercatorRay(ee).dir),ye=this._trackingEllipsoid.projectRay(k.screenPointToMercatorRay(ee.sub(D)).dir);fe[0]=ye[0]-ce[0],fe[1]=ye[1]-ce[1]}else{const ce=k.pointCoordinate(ee);if(k.projection.name==="globe"){D=D.rotate(-k.angle);const ye=k._pixelsPerMercatorPixel/k.worldSize;fe[0]=-D.x*s.mercatorScale(s.latFromMercatorY(ce.y))*ye,fe[1]=-D.y*s.mercatorScale(k.center.lat)*ye}else{const ye=k.pointCoordinate(ee.sub(D));ce&&ye&&(fe[0]=ye.x-ce.x,fe[1]=ye.y-ce.y)}}const he=k.zoom,pe=[0,0,0];if(B){const ce=N(ae||k.pointCoordinate3D(ee)),ye={dir:s.normalize([],s.sub([],ce,k._camera.position))};if(ye.dir[2]<0){const ve=k.zoomDeltaToMovement(ce,B);s.scale$2(pe,ye.dir,ve)}}const te=s.add(fe,fe,pe);k._translateCameraConstrained(te),B&&Math.abs(k.zoom-he)>1e-4&&k.recenterOnTerrain(),k.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,x,!0)}_fireEvents(a,h,x){const T=Hi(this._eventsInProgress),k=Hi(a),N={};for(const G in a){const{originalEvent:ee}=a[G];this._eventsInProgress[G]||(N[`${G}start`]=ee),this._eventsInProgress[G]=a[G]}!T&&k&&this._fireEvent("movestart",k.originalEvent);for(const G in N)this._fireEvent(G,N[G]);k&&this._fireEvent("move",k.originalEvent);for(const G in a){const{originalEvent:ee}=a[G];this._fireEvent(G,ee)}const D={};let B;for(const G in this._eventsInProgress){const{handlerName:ee,originalEvent:ae}=this._eventsInProgress[G];this._handlersById[ee].isActive()||(delete this._eventsInProgress[G],B=h[ee]||ae,D[`${G}end`]=B)}for(const G in D)this._fireEvent(G,D[G]);const H=Hi(this._eventsInProgress);if(x&&(T||k)&&!H){this._updatingCamera=!0;const G=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=ae=>ae!==0&&-this._bearingSnap<ae&&ae<this._bearingSnap;G?(ee(G.bearing||this._map.getBearing())&&(G.bearing=0),this._map.easeTo(G,{originalEvent:B})):(this._map.fire(new s.Event("moveend",{originalEvent:B})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new s.Event(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((a=>{this._frameId=void 0,this.handleEvent(new fs("renderFrame",{timeStamp:a})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ta="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Iu extends s.Evented{constructor(a,h){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}panBy(a,h,x){return a=s.Point.convert(a).mult(-1),this.panTo(this.transform.center,s.extend({offset:a},h),x)}panTo(a,h,x){return this.easeTo(s.extend({center:a},h),x)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,x){return this.easeTo(s.extend({zoom:a},h),x)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,x){return this.easeTo(s.extend({bearing:a},h),x)}resetNorth(a,h){return this.rotateTo(0,s.extend({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}cameraForBounds(a,h){a=s.LngLatBounds.convert(a);const x=h&&h.bearing||0,T=h&&h.pitch||0,k=a.getNorthWest(),N=a.getSouthEast();return this._cameraForBounds(this.transform,k,N,x,T,h)}_extendCameraOptions(a){const h={top:0,bottom:0,right:0,left:0};if(typeof(a=s.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const x=a.padding;a.padding={top:x,bottom:x,right:x,left:x}}return a.padding=s.extend(h,a.padding),a}_minimumAABBFrustumDistance(a,h){const x=h.max[0]-h.min[0],T=h.max[1]-h.min[1];return x/T>a.aspect?x/(2*Math.tan(.5*a.fovX)*a.aspect):T/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,h,x,T,k,N){const D=a.clone(),B=this._extendCameraOptions(N);D.bearing=T,D.pitch=k;const H=s.LngLat.convert(h),G=s.LngLat.convert(x),ee=.5*(H.lat+G.lat),ae=.5*(H.lng+G.lng),ue=s.latLngToECEF(ee,ae),fe=s.normalize([],ue),he=s.normalize([],s.cross([],fe,[0,1,0])),pe=s.cross([],he,fe),te=[he[0],he[1],he[2],0,pe[0],pe[1],pe[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ce=[ue,s.latLngToECEF(H.lat,H.lng),s.latLngToECEF(G.lat,H.lng),s.latLngToECEF(G.lat,G.lng),s.latLngToECEF(H.lat,G.lng),s.latLngToECEF(ee,H.lng),s.latLngToECEF(ee,G.lng),s.latLngToECEF(H.lat,ae),s.latLngToECEF(G.lat,ae)];let ye=s.Aabb.fromPoints(ce.map((vt=>[s.dot(he,vt),s.dot(pe,vt),s.dot(fe,vt)])));const ve=s.transformMat4([],ye.center,te);s.squaredLength(ve)===0&&s.set(ve,0,0,1),s.normalize(ve,ve),s.scale$2(ve,ve,s.GLOBE_RADIUS),D.center=s.ecefToLatLng(ve);const Ne=D.getWorldToCameraMatrix(),De=s.invert(new Float64Array(16),Ne);ye=s.Aabb.applyTransform(ye,s.multiply([],Ne,te)),s.transformMat4(ve,ve,Ne);const je=.5*(ye.max[2]-ye.min[2]),Ge=this._minimumAABBFrustumDistance(D,ye),$e=s.scale$2([],[0,0,1],je),Ye=s.add($e,ve,$e),kt=Ge+(D.pitch===0?0:s.distance(ve,Ye)),qe=D.globeCenterInViewSpace,at=s.sub([],ve,[qe[0],qe[1],qe[2]]);s.normalize(at,at),s.scale$2(at,at,kt);const Qe=s.add([],ve,at);s.transformMat4(Qe,Qe,De);const Et=s.earthRadius/s.GLOBE_RADIUS,Xe=s.length(Qe),ut=s.mercatorZfromAltitude(Math.max(Xe*Et-s.earthRadius,Number.EPSILON),0),Tt=Math.min(D.zoomFromMercatorZAdjusted(ut),B.maxZoom);return Tt>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(D.setProjection({name:"mercator"}),D.zoom=Tt,this._cameraForBounds(D,h,x,T,k,N)):{center:D.center,zoom:Tt,bearing:T,pitch:k}}queryTerrainElevation(a,h){const x=this.transform.elevation;return x?(h=s.extend({},{exaggerated:!0},h),x.getAtPoint(s.MercatorCoordinate.fromLngLat(a),null,h.exaggerated)):null}_cameraForBounds(a,h,x,T,k,N){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,h,x,T,k,N);const D=a.clone(),B=this._extendCameraOptions(N),H=D.padding;D.bearing=T,D.pitch=k;const G=s.LngLat.convert(h),ee=s.LngLat.convert(x),ae=new s.LngLat(G.lng,ee.lat),ue=new s.LngLat(ee.lng,G.lat),fe=D.project(G),he=D.project(ee),pe=this.queryTerrainElevation(G),te=this.queryTerrainElevation(ee),ce=this.queryTerrainElevation(ae),ye=this.queryTerrainElevation(ue),ve=[[fe.x,fe.y,Math.min(pe||0,te||0,ce||0,ye||0)],[he.x,he.y,Math.max(pe||0,te||0,ce||0,ye||0)]];let Ne=s.Aabb.fromPoints(ve);const De=D.getWorldToCameraMatrix(),je=s.invert(new Float64Array(16),De);Ne=s.Aabb.applyTransform(Ne,De);const Ge=s.sub([],Ne.max,Ne.min),$e=H.left||0,Ye=H.right||0,kt=H.bottom||0,qe=H.top||0,{left:at,right:Qe,top:Et,bottom:Xe}=B.padding,ut=.5*($e+Ye),Tt=.5*(qe+kt),vt=Math.min(D.scaleZoom(D.scale*Math.min((D.width-($e+Ye+at+Qe))/Ge[0],(D.height-(kt+qe+Xe+Et))/Ge[1])),B.maxZoom),At=D.scale/D.zoomScale(vt);Ne=new s.Aabb([Ne.min[0]-(at+ut)*At,Ne.min[1]-(Xe+Tt)*At,Ne.min[2]],[Ne.max[0]+(Qe+ut)*At,Ne.max[1]+(Et+Tt)*At,Ne.max[2]]);const tn=.5*Ge[2],_n=this._minimumAABBFrustumDistance(D,Ne),Zt=[0,0,1,0];s.transformMat4$1(Zt,Zt,De),s.normalize$2(Zt,Zt);const hn=s.scale$2([],Zt,_n+tn),zn=s.add([],Ne.center,hn),Gn=(typeof B.offset.x=="number"&&typeof B.offset.y=="number"?new s.Point(B.offset.x,B.offset.y):s.Point.convert(B.offset)).rotate(-s.degToRad(T));Ne.center[0]-=Gn.x*At,Ne.center[1]+=Gn.y*At,s.transformMat4(Ne.center,Ne.center,je),s.transformMat4(zn,zn,je);const nn=[Ne.center[0],Ne.center[1],zn[2]*D.pixelsPerMeter];s.scale$2(nn,nn,1/D.worldSize);const Wn=s.lngFromMercatorX(nn[0]),lr=s.latFromMercatorY(nn[1]),cr=Math.min(D._zoomFromMercatorZ(nn[2]),B.maxZoom),ir=new s.LngLat(Wn,lr);return D.mercatorFromTransition&&cr<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(D.setProjection({name:"globe"}),D.zoom=cr,this._cameraForBounds(D,h,x,T,k,N)):{center:ir,zoom:cr,bearing:T,pitch:k}}fitBounds(a,h,x){const T=this.cameraForBounds(a,h);return this._fitInternal(T,h,x)}fitScreenCoordinates(a,h,x,T,k){const N=s.Point.convert(a),D=s.Point.convert(h),B=new s.Point(Math.min(N.x,D.x),Math.min(N.y,D.y)),H=new s.Point(Math.max(N.x,D.x),Math.max(N.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(N,D))return this;const G=this.transform.pointLocation3D(B),ee=this.transform.pointLocation3D(H),ae=this.transform.pointLocation3D(new s.Point(B.x,H.y)),ue=this.transform.pointLocation3D(new s.Point(H.x,B.y)),fe=[Math.min(G.lng,ee.lng,ae.lng,ue.lng),Math.min(G.lat,ee.lat,ae.lat,ue.lat)],he=[Math.max(G.lng,ee.lng,ae.lng,ue.lng),Math.max(G.lat,ee.lat,ae.lat,ue.lat)],pe=T&&T.pitch?T.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,fe,he,x,pe,T);return this._fitInternal(te,T,k)}_fitInternal(a,h,x){return a?(delete(h=s.extend(a,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this}jumpTo(a,h){this.stop();const x=a.preloadOnly?this.transform.clone():this.transform;let T=!1,k=!1,N=!1;return"zoom"in a&&x.zoom!==+a.zoom&&(T=!0,x.zoom=+a.zoom),a.center!==void 0&&(x.center=s.LngLat.convert(a.center)),"bearing"in a&&x.bearing!==+a.bearing&&(k=!0,x.bearing=+a.bearing),"pitch"in a&&x.pitch!==+a.pitch&&(N=!0,x.pitch=+a.pitch),a.padding==null||x.isPaddingEqual(a.padding)||(x.padding=a.padding),a.preloadOnly?(this._preloadTiles(x),this):(this.fire(new s.Event("movestart",h)).fire(new s.Event("move",h)),T&&this.fire(new s.Event("zoomstart",h)).fire(new s.Event("zoom",h)).fire(new s.Event("zoomend",h)),k&&this.fire(new s.Event("rotatestart",h)).fire(new s.Event("rotate",h)).fire(new s.Event("rotateend",h)),N&&this.fire(new s.Event("pitchstart",h)).fire(new s.Event("pitch",h)).fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(ta),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,h){const x=this.transform;if(!x.projection.supportsFreeCamera)return s.warnOnce(ta),this;this.stop();const T=x.zoom,k=x.pitch,N=x.bearing;x.setFreeCameraOptions(a);const D=T!==x.zoom,B=k!==x.pitch,H=N!==x.bearing;return this.fire(new s.Event("movestart",h)).fire(new s.Event("move",h)),D&&this.fire(new s.Event("zoomstart",h)).fire(new s.Event("zoom",h)).fire(new s.Event("zoomend",h)),H&&this.fire(new s.Event("rotatestart",h)).fire(new s.Event("rotate",h)).fire(new s.Event("rotateend",h)),B&&this.fire(new s.Event("pitchstart",h)).fire(new s.Event("pitch",h)).fire(new s.Event("pitchend",h)),this.fire(new s.Event("moveend",h)),this}easeTo(a,h){this._stop(!1,a.easeId),((a=s.extend({offset:[0,0],duration:500,easing:s.ease},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);const x=this.transform,T=this.getZoom(),k=this.getBearing(),N=this.getPitch(),D=this.getPadding(),B="zoom"in a?+a.zoom:T,H="bearing"in a?this._normalizeBearing(a.bearing,k):k,G="pitch"in a?+a.pitch:N,ee="padding"in a?a.padding:x.padding,ae=s.Point.convert(a.offset);let ue,fe,he;if(x.projection.name==="globe"){const $e=s.MercatorCoordinate.fromLngLat(x.center),Ye=ae.rotate(-x.angle);$e.x+=Ye.x/x.worldSize,$e.y+=Ye.y/x.worldSize;const kt=$e.toLngLat(),qe=s.LngLat.convert(a.center||kt);this._normalizeCenter(qe),ue=x.centerPoint.add(Ye),fe=new s.Point($e.x,$e.y).mult(x.worldSize),he=new s.Point(s.mercatorXfromLng(qe.lng),s.mercatorYfromLat(qe.lat)).mult(x.worldSize).sub(fe)}else{ue=x.centerPoint.add(ae);const $e=x.pointLocation(ue),Ye=s.LngLat.convert(a.center||$e);this._normalizeCenter(Ye),fe=x.project($e),he=x.project(Ye).sub(fe)}const pe=x.zoomScale(B-T);let te,ce;a.around&&(te=s.LngLat.convert(a.around),ce=x.locationPoint(te));const ye=this._zooming||B!==T,ve=this._rotating||k!==H,Ne=this._pitching||G!==N,De=!x.isPaddingEqual(ee),je=$e=>Ye=>{if(ye&&($e.zoom=s.number(T,B,Ye)),ve&&($e.bearing=s.number(k,H,Ye)),Ne&&($e.pitch=s.number(N,G,Ye)),De&&($e.interpolatePadding(D,ee,Ye),ue=$e.centerPoint.add(ae)),te)$e.setLocationAtPoint(te,ce);else{const kt=$e.zoomScale($e.zoom-T),qe=B>T?Math.min(2,pe):Math.max(.5,pe),at=Math.pow(qe,1-Ye),Qe=$e.unproject(fe.add(he.mult(Ye*at)).mult(kt));$e.setLocationAtPoint($e.renderWorldCopies?Qe.wrap():Qe,ue)}return a.preloadOnly||this._fireMoveEvents(h),$e};if(a.preloadOnly){const $e=this._emulate(je,a.duration,x);return this._preloadTiles($e),this}const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=ve,this._pitching=Ne,this._padding=De,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Ge),this._ease(je(x),($e=>{x.recenterOnTerrain(),this._afterEase(h,$e)}),a),this}_prepareEase(a,h,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||x.moving||this.fire(new s.Event("movestart",a)),this._zooming&&!x.zooming&&this.fire(new s.Event("zoomstart",a)),this._rotating&&!x.rotating&&this.fire(new s.Event("rotatestart",a)),this._pitching&&!x.pitching&&this.fire(new s.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new s.Event("move",a)),this._zooming&&this.fire(new s.Event("zoom",a)),this._rotating&&this.fire(new s.Event("rotate",a)),this._pitching&&this.fire(new s.Event("pitch",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,T=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new s.Event("zoomend",a)),T&&this.fire(new s.Event("rotateend",a)),k&&this.fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a))}flyTo(a,h){if(this._prefersReducedMotion(a)){const vt=s.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(vt,h)}this.stop(),a=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},a);const x=this.transform,T=this.getZoom(),k=this.getBearing(),N=this.getPitch(),D=this.getPadding(),B="zoom"in a?s.clamp(+a.zoom,x.minZoom,x.maxZoom):T,H="bearing"in a?this._normalizeBearing(a.bearing,k):k,G="pitch"in a?+a.pitch:N,ee="padding"in a?a.padding:x.padding,ae=x.zoomScale(B-T),ue=s.Point.convert(a.offset);let fe=x.centerPoint.add(ue);const he=x.pointLocation(fe),pe=s.LngLat.convert(a.center||he);this._normalizeCenter(pe);const te=x.project(he),ce=x.project(pe).sub(te);let ye=a.curve;const ve=Math.max(x.width,x.height),Ne=ve/ae,De=ce.mag();if("minZoom"in a){const vt=s.clamp(Math.min(a.minZoom,T,B),x.minZoom,x.maxZoom),At=ve/x.zoomScale(vt-T);ye=Math.sqrt(At/De*2)}const je=ye*ye;function Ge(vt){const At=(Ne*Ne-ve*ve+(vt?-1:1)*je*je*De*De)/(2*(vt?Ne:ve)*je*De);return Math.log(Math.sqrt(At*At+1)-At)}function $e(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function Ye(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const kt=Ge(0);let qe=function(vt){return Ye(kt)/Ye(kt+ye*vt)},at=function(vt){return ve*((Ye(kt)*($e(At=kt+ye*vt)/Ye(At))-$e(kt))/je)/De;var At},Qe=(Ge(1)-kt)/ye;if(Math.abs(De)<1e-6||!isFinite(Qe)){if(Math.abs(ve-Ne)<1e-6)return this.easeTo(a,h);const vt=Ne<ve?-1:1;Qe=Math.abs(Math.log(Ne/ve))/ye,at=function(){return 0},qe=function(At){return Math.exp(vt*ye*At)}}a.duration="duration"in a?+a.duration:1e3*Qe/("screenSpeed"in a?+a.screenSpeed/ye:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Et=k!==H,Xe=G!==N,ut=!x.isPaddingEqual(ee),Tt=vt=>At=>{const tn=At*Qe,_n=1/qe(tn);vt.zoom=At===1?B:T+vt.scaleZoom(_n),Et&&(vt.bearing=s.number(k,H,At)),Xe&&(vt.pitch=s.number(N,G,At)),ut&&(vt.interpolatePadding(D,ee,At),fe=vt.centerPoint.add(ue));const Zt=At===1?pe:vt.unproject(te.add(ce.mult(at(tn))).mult(_n));return vt.setLocationAtPoint(vt.renderWorldCopies?Zt.wrap():Zt,fe),vt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(h),vt};if(a.preloadOnly){const vt=this._emulate(Tt,a.duration,x);return this._preloadTiles(vt),this}return this._zooming=!0,this._rotating=Et,this._pitching=Xe,this._padding=ut,this._prepareEase(h,!1),this._ease(Tt(x),(()=>this._afterEase(h)),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,h)}if(!a){const x=this.handlers;x&&x.stop(!1)}return this}_ease(a,h,x){x.animate===!1||x.duration===0?(a(1),h()):(this._easeStart=s.exported.now(),this._easeOptions=x,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,h){a=s.wrap(a,-180,180);const x=Math.abs(a-h);return Math.abs(a-360-h)<x&&(a-=360),Math.abs(a+360-h)<x&&(a+=360),a}_normalizeCenter(a){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const x=a.lng-h.center.lng;a.lng+=x>180?-360:x<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,h,x){const T=Math.ceil(15*h/1e3),k=[],N=a(x.clone());for(let D=0;D<=T;D++){const B=N(D/T);k.push(B.clone())}return k}}class Ut{constructor(a={}){this.options=a,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const h=this.options&&this.options.compact;return this._map=a,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),L("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const x=this._map._getUIString(`AttributionControl.${h}`);a.setAttribute("aria-label",x),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(a){const x=h.reduce(((T,k,N)=>(k.value&&(T+=`${k.key}=${k.value}${N<h.length-1?"&":""}`),T)),"?");a.href=`${s.config.FEEDBACK_URL}/${x}#${Wa(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const T=this._map.style.stylesheet;this.styleOwner=T.owner,this.styleId=T.id}const h=this._map.style._sourceCaches;for(const T in h){const k=h[T];if(k.used){const N=k.getSource();N.attribution&&a.indexOf(N.attribution)<0&&a.push(N.attribution)}}a.sort(((T,k)=>T.length-k.length)),a=a.filter(((T,k)=>{for(let N=k+1;N<a.length;N++)if(a[N].indexOf(T)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const x=a.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,a.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ic{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=L("div","mapboxgl-ctrl");const h=L("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const h in a){const x=a[h].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Ru{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,x=h?this._queue.concat(h):this._queue;for(const T of x)if(T.id===a)return void(T.cancelled=!0)}run(a=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const x of h)if(!x.cancelled&&(x.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function jl(y,a,h){if(y=new s.LngLat(y.lng,y.lat),a){const x=new s.LngLat(y.lng-360,y.lat),T=new s.LngLat(y.lng+360,y.lat),k=360*Math.ceil(Math.abs(y.lng-h.center.lng)/360),N=h.locationPoint(y).distSqr(a),D=a.x<0||a.y<0||a.x>h.width||a.y>h.height;h.locationPoint(x).distSqr(a)<N&&(D||Math.abs(x.lng-h.center.lng)<k)?y=x:h.locationPoint(T).distSqr(a)<N&&(D||Math.abs(T.lng-h.center.lng)<k)&&(y=T)}for(;Math.abs(y.lng-h.center.lng)>180;){const x=h.locationPoint(y);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const Dl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bt extends s.Evented{constructor(a,h){if(super(),(a instanceof s.window.HTMLElement||h)&&(a=s.extend({element:a},h)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=s.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");const T=41,k=27,N=W("svg",{display:"block",height:T*this._scale+"px",width:k*this._scale+"px",viewBox:`0 0 ${k} ${T}`},this._element),D=W("radialGradient",{id:"shadowGradient"},W("defs",{},N));W("stop",{offset:"10%","stop-opacity":.4},D),W("stop",{offset:"100%","stop-opacity":.05},D),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},N),W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},N),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},N),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},N),this._offset=s.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(T=>{T.preventDefault()})),this._element.addEventListener("mousedown",(T=>{T.preventDefault()}));const x=this._element.classList;for(const T in Dl)x.remove(`mapboxgl-marker-anchor-${T}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const T=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(38.1-13.5+T)],"bottom-right":[-T,-1*(38.1-13.5+T)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const h=a.code,x=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(a){const h=a.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,h=this._pos;if(!a||!h)return!1;const x=a.unproject(h),T=a.getFreeCameraOptions();if(!T.position)return!1;const k=T.position.toLngLat();return k.distanceTo(x)<.9*k.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const h=this._pos;if(!h||h.x<0||h.x>a.transform.width||h.y<0||h.y>a.transform.height)return void this._clearFadeTimer();const x=a.unproject(h);let T;a._showingGlobe()&&s.isLngLatBehindGlobe(a.transform,this._lngLat)?T=0:(T=1-a._queryFogOpacity(x),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(T*=this._occludedOpacity)),this._element.style.opacity=`${T}`,this._element.style.pointerEvents=T>0?"auto":"none",this._popup&&this._popup._setOpacity(T),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${a.x}px,${a.y}px)
            ${Dl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const a=this._pos,h=this._map,x=this.getPitchAlignment();if(!h||!a||x!=="map")return"";if(!h._showingGlobe()){const B=h.getPitch();return B?`rotateX(${B}deg)`:""}const T=s.radToDeg(s.globeTiltAtLngLat(h.transform,this._lngLat)),k=a.sub(s.globeCenterToScreenPoint(h.transform)),N=Math.abs(k.x)+Math.abs(k.y);if(N===0)return"";const D=T/N;return`rotateX(${-k.y*D}deg) rotateY(${k.x*D}deg)`}_calculateZTransform(){const a=this._pos,h=this._map;if(!h||!a)return"";let x=0;const T=this.getRotationAlignment();if(T==="map")if(h._showingGlobe()){const k=h.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),N=h.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(k);x=s.radToDeg(Math.atan2(N.y,N.x))-90}else x=-h.getBearing();else if(T==="horizon"){const k=s.smoothstep(4,6,h.getZoom()),N=s.globeCenterToScreenPoint(h.transform);N.y+=k*h.transform.height;const D=a.sub(N),B=s.radToDeg(Math.atan2(D.y,D.x));x=(B>90?B-270:B+90)*(1-k)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(a){s.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=jl(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),a===!0?this._updateFrameId=s.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),h._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(a){return this._offset=s.Point.convert(a),this._update(),this}_onMove(a){const h=this._map;if(!h)return;const x=this._pointerdownPos,T=this._positionDelta;if(x&&T){if(!this._isDragging){const k=this._clickTolerance||h._clickTolerance;if(a.point.dist(x)<k)return;this._isDragging=!0}this._pos=a.point.sub(T),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(a){const h=this._map,x=this._pos;h&&x&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(x),this._pointerdownPos=a.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const h=this._map;return h&&(a?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ya={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(y=new s.Point(0,0),a="bottom"){if(typeof y=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(a){case"top":return new s.Point(0,y);case"top-left":return new s.Point(h,h);case"top-right":return new s.Point(-h,h);case"bottom":return new s.Point(0,-y);case"bottom-left":return new s.Point(h,-h);case"bottom-right":return new s.Point(-h,-h);case"left":return new s.Point(y,0);case"right":return new s.Point(-y,0)}return new s.Point(0,0)}return y instanceof s.Point||Array.isArray(y)?s.Point.convert(y):s.Point.convert(y[a]||[0,0])}class Nc{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const h=s.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,h,x){this._start=this.getValue(h),this._end=a,this._startTime=h,this._endTime=h+x}}const Ws={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Zs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Ll={showCompass:!0,showZoom:!0,visualizePitch:!1};class ba{constructor(a,h,x=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ea({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,x&&(this.mousePitch=new Td({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(a,h){this.mouseRotate.mousedown(a,h),this.mousePitch&&this.mousePitch.mousedown(a,h),J()}move(a,h){const x=this.map,T=this.mouseRotate.mousemoveWindow(a,h),k=T&&T.bearingDelta;if(k&&x.setBearing(x.getBearing()+k),this.mousePitch){const N=this.mousePitch.mousemoveWindow(a,h),D=N&&N.pitchDelta;D&&x.setPitch(x.getPitch()+D)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Y(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(s.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Se(this.element,a)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Se(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ie(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Ie(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Do={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ta={maxWidth:100,unit:"metric"},Ad={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ja={version:s.version,supported:A,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Iu{constructor(y){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(y=s.extend({},Zs,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(y.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),y),this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._useWebGL2=y.useWebGL2,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._optimizeForTerrain=y.optimizeForTerrain,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new Ru,this._domRenderTaskQueue=new Ru,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Ws,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,typeof y.container=="string"){if(this._container=s.window.document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new jo(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),this._hash=y.hash&&new ku(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),y.attributionControl&&this.addControl(new Ut({customAttribution:y.customAttribution})),this._logoControl=new Ic,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new s.Event(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new s.Event(`${a.dataType}dataloading`,a))}))}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const x=this._controlPositions[a];return a.indexOf("bottom")!==-1?x.insertBefore(h,x.firstChild):x.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new s.Event("movestart",y)).fire(new s.Event("move",y)),this.fire(new s.Event("resize",y)),a&&this.fire(new s.Event("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(s.LngLatBounds.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?s.window.navigator.language:Array.isArray(y)?y.length===0?void 0:y.map((a=>a==="auto"?s.window.navigator.language:a)):y}setLanguage(y){const a=this._parseLanguage(y);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,a=y.projection.name;let h;a==="globe"&&y.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(y.setMercatorFromTransition(),h=!0):a==="mercator"&&y.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(y.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(y,a){return this._updateProjection(y||a||{name:"mercator"})}_updateProjection(y){let a;if(a=y.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(y){return this.transform.locationPoint3D(s.LngLat.convert(y))}unproject(y){return this.transform.pointLocation3D(s.Point.convert(y))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,a,h){if(y==="mouseenter"||y==="mouseover"){let x=!1;const T=N=>{const D=a.filter((H=>this.getLayer(H))),B=D.length?this.queryRenderedFeatures(N.point,{layers:D}):[];B.length?x||(x=!0,h.call(this,new Di(y,this,N.originalEvent,{features:B}))):x=!1},k=()=>{x=!1};return{layers:new Set(a),listener:h,delegates:{mousemove:T,mouseout:k}}}if(y==="mouseleave"||y==="mouseout"){let x=!1;const T=N=>{const D=a.filter((B=>this.getLayer(B)));(D.length?this.queryRenderedFeatures(N.point,{layers:D}):[]).length?x=!0:x&&(x=!1,h.call(this,new Di(y,this,N.originalEvent)))},k=N=>{x&&(x=!1,h.call(this,new Di(y,this,N.originalEvent)))};return{layers:new Set(a),listener:h,delegates:{mousemove:T,mouseout:k}}}{const x=T=>{const k=a.filter((D=>this.getLayer(D))),N=k.length?this.queryRenderedFeatures(T.point,{layers:k}):[];N.length&&(T.features=N,h.call(this,T),delete T.features)};return{layers:new Set(a),listener:h,delegates:{[y]:x}}}}on(y,a,h){if(h===void 0)return super.on(y,a);Array.isArray(a)||(a=[a]);const x=this._createDelegatedListener(y,a,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(x);for(const T in x.delegates)this.on(T,x.delegates[T]);return this}once(y,a,h){if(h===void 0)return super.once(y,a);Array.isArray(a)||(a=[a]);const x=this._createDelegatedListener(y,a,h);for(const T in x.delegates)this.once(T,x.delegates[T]);return this}off(y,a,h){if(h===void 0)return super.off(y,a);a=new Set(Array.isArray(a)?a:[a]);const x=(k,N)=>{if(k.size!==N.size)return!1;for(const D of k)if(!N.has(D))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[y]:void 0;return T&&(k=>{for(let N=0;N<k.length;N++){const D=k[N];if(D.listener===h&&x(D.layers,a)){for(const B in D.delegates)this.off(B,D.delegates[B]);return k.splice(N,1),this}}})(T),this}queryRenderedFeatures(y,a){return this.style?(a!==void 0||y===void 0||y instanceof s.Point||Array.isArray(y)||(a=y,y=void 0),this.style.queryRenderedFeatures(y=y||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}isPointOnSurface(y){const{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&s.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(y))}setStyle(y,a){return(a=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(y,a))}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y&&(this.style=new fo(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new fo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const h=this._requestManager.normalizeStyleURL(y),x=this._requestManager.transformRequest(h,s.ResourceType.Style);s.getJSON(x,((T,k)=>{T?this.fire(new s.ErrorEvent(T)):k&&this._updateDiff(k,a)}))}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y)&&this._update(!0)}catch(h){s.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){return!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){const y=this.style&&this.style._sourceCaches;for(const a in y){const h=y[a]._tiles;for(const x in h){const T=h[x];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}addSourceType(y,a,h){this._lazyInitEmptyStyle(),this.style.addSourceType(y,a,h)}removeSource(y){return this.style.removeSource(y),this._updateTerrain(),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,{pixelRatio:h=1,sdf:x=!1,stretchX:T,stretchY:k,content:N}={}){if(this._lazyInitEmptyStyle(),a instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&a instanceof s.window.ImageBitmap){const{width:D,height:B,data:H}=s.exported.getImageData(a);this.style.addImage(y,{data:new s.RGBAImage({width:D,height:B},H),pixelRatio:h,stretchX:T,stretchY:k,content:N,sdf:x,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:B}=a,H=a;this.style.addImage(y,{data:new s.RGBAImage({width:D,height:B},new Uint8Array(H.data)),pixelRatio:h,stretchX:T,stretchY:k,content:N,sdf:x,version:0,userImage:H}),H.onAdd&&H.onAdd(this,y)}}updateImage(y,a){const h=this.style.getImage(y);if(!h)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=a instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&a instanceof s.window.ImageBitmap?s.exported.getImageData(a):a,{width:T,height:k}=x;T!==void 0&&k!==void 0?T===h.data.width&&k===h.data.height?(h.data.replace(x.data,!(a instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&a instanceof s.window.ImageBitmap)),this.style.updateImage(y,h)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${T}, ${k})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,a){s.getImage(this._requestManager.transformRequest(y,s.ResourceType.Image),((h,x)=>{a(h,x instanceof s.window.HTMLImageElement?s.exported.getImageData(x):x)}))}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,a,h){return this.style.setLayerZoomRange(y,a,h),this._update(!0)}setFilter(y,a,h={}){return this.style.setFilter(y,a,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,h,x={}){return this.style.setPaintProperty(y,a,h,x),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,h,x={}){return this.style.setLayoutProperty(y,a,h,x),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(y),this.transform):0}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let h,x,T,k=this._container;for(;k&&(!x||!T);){const N=s.window.getComputedStyle(k).transform;N&&N!=="none"&&(h=N.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(x=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(T=h[3])),k=k.parentElement}this._containerWidth=x?Math.abs(y/x):y,this._containerHeight=T?Math.abs(a/T):a}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=L("div","mapboxgl-canvas-container",y);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=L("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=L("div","mapboxgl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((T=>{x[T]=L("div",`mapboxgl-ctrl-${T}`,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a){const h=s.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(y),this._canvas.height=h*Math.ceil(a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const a=this._markers.indexOf(y);a!==-1&&this._markers.splice(a,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const a=this._popups.indexOf(y);a!==-1&&this._popups.splice(a,1)}_setupPainter(){const y=s.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",y),h=a||this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);h?(this._useWebGL2&&!a&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(h,!0),this.painter=new Al(h,this.transform,!!a),this.on("data",(x=>{x.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.exported$1.testSupport(h)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let a;const h=this.painter.context.extTimerQuery,x=s.exported.now();if(this.listens("gpu-timing-frame")&&(a=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,B=this.transform.pitch,H=s.exported.now(),G=new s.EvaluationParameters(D,{now:H,fadeDuration:T,pitch:B,transition:this.style.getTransition()});this.style.update(G)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let k=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),k=this._updateAverageElevation(x),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):k=this._updateAverageElevation(x),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const D=s.exported.now()-x;h.endQueryEXT(h.TIME_ELAPSED_EXT,a),setTimeout((()=>{const B=h.getQueryObjectEXT(a,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(a),this.fire(new s.Event("gpu-timing-frame",{cpuTime:D,gpuTime:B})),s.window.performance.mark("frame-gpu",{startTime:x,detail:{gpuTime:B}})}),50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout((()=>{const B=this.painter.queryGpuTimers(D);this.fire(new s.Event("gpu-timing-layer",{layerTimes:B}))}),50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const B=this.painter.queryGpuTimeDeferredRender(D);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:B}))}),50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||k;if(N||this._repaint)this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(k=this._updateAverageElevation(x,!0)),k)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const a of this._markers)y&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!y||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(y,a=!1){const h=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((a||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const x=this.transform.averageElevation;let T=this.transform.sampleAverageElevation(),k=!1;this.transform.elevation&&(k=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=y;const N=Math.abs(x-T);if(N>1){if(this._isInitialLoad||k)return this._averageElevation.jumpTo(T),h(T);this._averageElevation.easeTo(T,y,300)}else if(N>1e-4)return this._averageElevation.jumpTo(T),h(T)}return!!this._averageElevation.isEasing(y)&&h(this._averageElevation.getValue(y))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(y=>{if(y&&(y.message===s.AUTH_ERR_MSG||y.status===401)){const a=this.painter.context.gl;s.storeAuthState(a,!1),this._logoControl instanceof Ic&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const h=this.painter.context.gl,x=h.createFramebuffer();function T(k){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,k,0);const N=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,N),N}return h.bindFramebuffer(h.FRAMEBUFFER,x),this._canvasPixelComparison(T(y),a.canvasCopies.map(T),a.timeStamps)}_canvasPixelComparison(y,a,h){let x=h[1]-h[0];const T=y.length/4;for(let k=0;k<a.length;k++){const N=a[k];let D=0;for(let B=0;B<N.length;B+=4)N[B]===y[B]&&N[B+1]===y[B+1]&&N[B+2]===y[B+2]&&N[B+3]===y[B+3]&&(D+=1);x+=(h[k+2]-h[k+1])*(1-D/T)}return x}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=s.exported.frame((a=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(a)})))}_preloadTiles(y){const a=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(a,((h,x)=>h._preloadTiles(y,x)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,y&&this._update())}_setCacheLimits(y,a){s.setCacheLimits(y,a)}get version(){return s.version}},NavigationControl:class{constructor(y){this.options=s.extend({},Ll,y),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(a=>{this._map&&this._map.zoomIn({},{originalEvent:a})})),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(a=>{this._map&&this._map.zoomOut({},{originalEvent:a})})),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(a=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:a}):h.resetNorth({},{originalEvent:a}))})),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const a=y.getZoom(),h=a===y.getMaxZoom(),x=a===y.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=a)}))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ba(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,a){const h=L("button",y,this._container);return h.type="button",h.addEventListener("click",a),h}_setButtonTitle(y,a){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${a}`);y.setAttribute("aria-label",h),y.firstElementChild&&y.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends s.Evented{constructor(y){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Do,y),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=yr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const a=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,y(h)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then((h=>a(h.state!=="denied"))).catch((()=>a())):a()}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),h=y.coords;return!!a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",y)),this._finish()}}_updateCamera(y){const a=new s.LngLat(y.coords.longitude,y.coords.latitude),h=y.coords.accuracy,x=this._map.getBearing(),T=s.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(h),T,{geolocateSource:!0})}_updateMarker(y){if(y){const a=new s.LngLat(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,a=s.mercatorZfromAltitude(1,y._center.lat)*y.worldSize,h=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(a=>a.preventDefault())),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))}))}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((a=>{a==="granted"&&y()})).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ut,ScaleControl:class{constructor(y){this.options=s.extend({},Ta,y),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,a=this._map,h=a._containerHeight/2,x=a._containerWidth/2-y/2,T=a.unproject([x,h]),k=a.unproject([x+y,h]),N=T.distanceTo(k);if(this.options.unit==="imperial"){const D=3.2808*N;D>5280?this._setScale(y,D/5280,"mile"):this._setScale(y,D,"foot")}else this.options.unit==="nautical"?this._setScale(y,N/1852,"nautical-mile"):N>=1e3?this._setScale(y,N/1e3,"kilometer"):this._setScale(y,N,"meter")}_setScale(y,a,h){this._map._requestDomTask((()=>{const x=(function(k){const N=Math.pow(10,`${Math.floor(k)}`.length-1);let D=k/N;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:(function(B){const H=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*H)/H})(D),N*D})(a),T=x/a;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(x):`${x}&nbsp;${Ad[h]}`,this._container.style.width=y*T+"px"}))}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof s.window.HTMLElement?this._container=y.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(y){super(),this.options=s.extend(Object.create(Ya),y),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=s.LngLat.convert(y),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(s.window.document.createTextNode(y))}setHTML(y){const a=s.window.document.createDocumentFragment(),h=s.window.document.createElement("body");let x;for(h.innerHTML=y;x=h.firstChild,x;)a.appendChild(x);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(y),this.options.closeButton){const h=this._closeButton=L("button","mapboxgl-popup-close-button",a);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let a;return this._classList.delete(y)?a=!1:(this._classList.add(y),a=!0),this._updateClassList(),a}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const a=this._map,h=this._container,x=this._pos;if(!a||!h||!x)return"bottom";const T=h.offsetWidth,k=h.offsetHeight,N=x.x<T/2,D=x.x>a.transform.width-T/2;if(x.y+y<k)return N?"top-left":D?"top-right":"top";if(x.y>a.transform.height-k){if(N)return"bottom-left";if(D)return"bottom-right"}return N?"left":D?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),y.className=a.join(" ")}_update(y){const a=this._map,h=this._content;if(!a||!this._lngLat&&!this._trackPointer||!h)return;let x=this._container;if(x||(x=this._container=L("div","mapboxgl-popup",a.getContainer()),this._tip=L("div","mapboxgl-popup-tip",x),x.appendChild(h)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jl(this._lngLat,this._pos,a.transform)),!this._trackPointer||y){const T=this._pos=this._trackPointer&&y?y:a.project(this._lngLat),k=Nu(this.options.offset),N=this._anchor=this._getAnchor(k.y),D=Nu(this.options.offset,N),B=T.add(D).round();a._requestDomTask((()=>{this._container&&N&&(this._container.style.transform=`${Dl[N]} translate(${B.x}px,${B.y}px)`)}))}if(!this._marker&&a._showingGlobe()){const T=s.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(T)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Rc);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Bt,Style:fo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:ya,Evented:s.Evented,config:s.config,prewarm:function(){vl().acquire(Po)},clearPrewarmedResources:function(){const y=hs;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Po),hs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(y){s.config.ACCESS_TOKEN=y},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(y){s.config.API_URL=y},get workerCount(){return Ti.workerCount},set workerCount(y){Ti.workerCount=y},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){s.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){s.clearTileCache(y)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ja}));var w=f;return w}))})(kv)),kv.exports}var TN=vG();const Xl=s1(TN),xG=dP({__proto__:null,default:Xl},[TN]),wA={lat:21.038,lng:105.782},CT=[{id:"A1",name:"Building A1",nameVi:"A1",type:"building",lat:21.039716029400708,lng:105.7832080286106,description:"Ta nh A1 - Khu ging ng chnh",descriptionEn:"Building A1 - Main lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A2",name:"Building A2",nameVi:"A2",type:"building",lat:21.039241956752605,lng:105.78308893318581,description:"Ta nh A2 - Khu ging ng",descriptionEn:"Building A2 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A3",name:"Building A3",nameVi:"A3",type:"building",lat:21.039111478563356,lng:105.78279039415679,description:"Ta nh A3 - Khu ging ng",descriptionEn:"Building A3 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A4",name:"Building A4",nameVi:"A4",type:"building",lat:21.039805,lng:105.782784,description:"Ta nh A4 - Khu ging ng",descriptionEn:"Building A4 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A5",name:"Building A5",nameVi:"A5",type:"building",lat:21.039853372191985,lng:105.78296008714364,description:"Ta nh A5 - Khu ging ng",descriptionEn:"Building A5 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A6",name:"Building A6",nameVi:"A6",type:"building",lat:21.040221833014513,lng:105.78293897060121,description:"Ta nh A6 - Khu ging ng",descriptionEn:"Building A6 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A7",name:"Building A7",nameVi:"A7",type:"building",lat:21.039954182925683,lng:105.78157815521064,description:"Ta nh A7 - Khu ging ng",descriptionEn:"Building A7 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"A8",name:"Building A8",nameVi:"A8",type:"building",lat:21.040014,lng:105.781236,description:"Ta nh A8 - Khu ging ng",descriptionEn:"Building A8 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"B1",name:"Building B1",nameVi:"B1",type:"building",lat:21.03806856546437,lng:105.78122336937986,description:"Ta nh B1 - Khu ging ng",descriptionEn:"Building B1 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"B2",name:"Building B2",nameVi:"B2",type:"building",lat:21.037537005578642,lng:105.78243174427888,description:"Ta nh B2 - Khu ging ng",descriptionEn:"Building B2 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"B3",name:"Building B3",nameVi:"B3",type:"building",lat:21.03842964478416,lng:105.78202247538536,description:"Ta nh B3 - Khu ging ng",descriptionEn:"Building B3 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"B4",name:"Building B4",nameVi:"B4",type:"building",lat:21.036848509166973,lng:105.78278135131,description:"Ta nh B4 - Khu ging ng",descriptionEn:"Building B4 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C1",name:"Building C1",nameVi:"C1",type:"building",lat:21.039312040918517,lng:105.7816554858685,description:"Ta nh C1 - Khu ging ng",descriptionEn:"Building C1 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C1T",name:"Building C1T",nameVi:"C1T",type:"building",lat:21.03837975944799,lng:105.78335962961887,description:"Ta nh C1T - Khu ging ng",descriptionEn:"Building C1T - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C2",name:"Building C2",nameVi:"C2",type:"building",lat:21.038700468933712,lng:105.7816178053169,description:"Ta nh C2 - Khu ging ng",descriptionEn:"Building C2 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C3",name:"Building C3",nameVi:"C3",type:"building",lat:21.03897939011371,lng:105.78201374266945,description:"Ta nh C3 - Khu ging ng",descriptionEn:"Building C3 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C4",name:"Building C4",nameVi:"C4",type:"building",lat:21.038673854494604,lng:105.78220222457082,description:"Ta nh C4 - Khu ging ng",descriptionEn:"Building C4 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C5",name:"Building C5",nameVi:"C5",type:"building",lat:21.039211779923747,lng:105.78223646566244,description:"Ta nh C5 - Khu ging ng",descriptionEn:"Building C5 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"C6",name:"Building C6",nameVi:"C6",type:"building",lat:21.038969210374205,lng:105.7813646272462,description:"Ta nh C6 - Khu ging ng",descriptionEn:"Building C6 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"D1",name:"Nguyen Van Dao Auditorium",nameVi:"Hi trng Nguyn Vn o",type:"building",lat:21.03745096834652,lng:105.78142828118075,description:"Hi trng Nguyn Vn o - Hi trng ln dnh cho s kin quan trng",descriptionEn:"Nguyen Van Dao Auditorium - Main auditorium for important events",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Hi trng","S kin"],tagsEn:["Auditorium","Events"]},{id:"D2",name:"VNU Administration Building D2",nameVi:"Nh iu hnh HQG D2",type:"building",lat:21.03766686313898,lng:105.78162505532134,description:"Nh iu hnh HQG - Ta nh hnh chnh",descriptionEn:"VNU Administration Building - Administrative office building",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["iu hnh","Hnh chnh"],tagsEn:["Administration","Office"]},{id:"E1",name:"Building E1",nameVi:"E1",type:"building",lat:21.037898547008368,lng:105.78265983816675,description:"Ta nh E1 - Khu ging ng",descriptionEn:"Building E1 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"E2",name:"Building E2",nameVi:"E2",type:"building",lat:21.038138125326725,lng:105.78250452675343,description:"Ta nh E2 - Khu ging ng",descriptionEn:"Building E2 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"E3",name:"Building E3",nameVi:"E3",type:"building",lat:21.038251539453896,lng:105.78267346560932,description:"Ta nh E3 - Khu ging ng",descriptionEn:"Building E3 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"E4",name:"Building E4",nameVi:"E4",type:"building",lat:21.038066515983516,lng:105.7828634652073,description:"Ta nh E4 - Khu ging ng",descriptionEn:"Building E4 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"E5",name:"Building E5",nameVi:"E5",type:"building",lat:21.03840666563933,lng:105.7827621403332,description:"Ta nh E5 - Khu ging ng v vn phng cc khoa",descriptionEn:"Building E5 - Lecture halls and faculty offices",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng","Vn phng"],tagsEn:["Lecture Hall","Office"]},{id:"G2",name:"Building G2",nameVi:"G2",type:"building",lat:21.038066718818,lng:105.7833562104258,description:"Ta nh G2 - Khu ging ng",descriptionEn:"Building G2 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G3",name:"Building G3",nameVi:"G3",type:"building",lat:21.038096961578148,lng:105.78199566240357,description:"Ta nh G3 - Khu ging ng",descriptionEn:"Building G3 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G4",name:"Building G4",nameVi:"G4",type:"building",lat:21.037036202500104,lng:105.7823262311631,description:"Ta nh G4 - Khu ging ng",descriptionEn:"Building G4 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G5",name:"Building G5",nameVi:"G5",type:"building",lat:21.037865450192925,lng:105.7814600713798,description:"Ta nh G5 - Khu ging ng",descriptionEn:"Building G5 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G6",name:"Building G6",nameVi:"G6",type:"building",lat:21.037614060236706,lng:105.78116710074528,description:"Ta nh G6 - Khu ging ng",descriptionEn:"Building G6 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G7",name:"Building G7",nameVi:"G7",type:"building",lat:21.038435221135757,lng:105.78144892714266,description:"Ta nh G7 - Khu ging ng",descriptionEn:"Building G7 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"G8",name:"Building G8",nameVi:"G8",type:"building",lat:21.038258438326096,lng:105.78144555504053,description:"Ta nh G8 - Khu ging ng",descriptionEn:"Building G8 - Lecture hall area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Ging ng"],tagsEn:["Lecture Hall"]},{id:"14A",name:"Dormitory 14A",nameVi:"14A",type:"building",lat:21.04066869104366,lng:105.78216346177845,description:"K tc x 14A - Khu nh  sinh vin",descriptionEn:"Dormitory 14A - Student housing area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800",tags:["K tc x","Sinh vin"],tagsEn:["Dormitory","Student"]},{id:"14B",name:"Dormitory 14B",nameVi:"14B",type:"building",lat:21.040332429257745,lng:105.78213949275664,description:"K tc x 14B - Khu nh  sinh vin",descriptionEn:"Dormitory 14B - Student housing area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800",tags:["K tc x","Sinh vin"],tagsEn:["Dormitory","Student"]},{id:"14C",name:"Dormitory 14C",nameVi:"14C",type:"building",lat:21.04074140951343,lng:105.78145868466765,description:"K tc x 14C - Khu nh  sinh vin",descriptionEn:"Dormitory 14C - Student housing area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800",tags:["K tc x","Sinh vin"],tagsEn:["Dormitory","Student"]},{id:"14D",name:"Dormitory 14D",nameVi:"14D",type:"building",lat:21.040696062046877,lng:105.7830743587856,description:"K tc x 14D - Khu nh  sinh vin",descriptionEn:"Dormitory 14D - Student housing area",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800",tags:["K tc x","Sinh vin"],tagsEn:["Dormitory","Student"]},{id:"Y1",name:"Health Center Y1",nameVi:"Y1",type:"building",lat:21.040337761272482,lng:105.78160682814034,description:"Ta nh Y1 - Trm Y t phc v sinh vin v cn b",descriptionEn:"Building Y1 - Health center serving students and staff",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?w=800",tags:["Y t","Sc khe"],tagsEn:["Medical","Health"]},{id:"SANTHECHAT",name:"Sports Field",nameVi:"Sn gio dc th cht",type:"building",lat:21.039932683929663,lng:105.78187391466429,description:"Sn gio dc th cht - Khu vc th thao ngoi tri",descriptionEn:"Sports Field - Outdoor sports area for physical education",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=800",tags:["Th thao","Sn bng"],tagsEn:["Sports","Field"]},{id:"SUNWAH",name:"Sunwah Innovation Center",nameVi:"Sunwah",type:"building",lat:21.0373549,lng:105.782269,description:"Ta nh Sunwah - Trung tm i mi Sng to v Khi nghip",descriptionEn:"Sunwah Building - Innovation and Startup Center",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=800",tags:["i mi","Sng to","Startup"],tagsEn:["Innovation","Creative","Startup"]},{id:"MB",name:"MB Bank ATM",nameVi:"MB Bank",type:"building",lat:21.038383769994525,lng:105.78252247352702,description:"Cy ATM MB Bank trong khun vin trng",descriptionEn:"MB Bank ATM located within campus",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=800",tags:["ATM","Ngn hng"],tagsEn:["ATM","Bank"]},{id:"HO",name:"Campus Lake",nameVi:"H",type:"building",lat:21.039027854415934,lng:105.78167624551548,description:"H nc trong khun vin trng - Khu vc th gin",descriptionEn:"Campus lake - Relaxation area with scenic views",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800",tags:["H","Th gin","Cnh quan"],tagsEn:["Lake","Relaxation","Landscape"]},{id:"CONG1",name:"Xuan Thuy Main Gate",nameVi:"Cng Xun Thy",type:"building",lat:21.036791579174974,lng:105.7820570664141,description:"Cng chnh vo trng t ng Xun Thy",descriptionEn:"Main entrance gate from Xuan Thuy Street",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["Cng","Li vo"],tagsEn:["Gate","Entrance"]},{id:"CONG2",name:"Pham Van Dong Gate",nameVi:"Cng PV",type:"building",lat:21.03964484205782,lng:105.78116818655224,description:"Cng ph vo trng t ng Phm Vn ng",descriptionEn:"Secondary entrance from Pham Van Dong Street",address:"Phm Vn ng, Cu Giy, H Ni",addressEn:"Pham Van Dong, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Cng","Li vo"],tagsEn:["Gate","Entrance"]},{id:"CONGP",name:"Side Gate",nameVi:"Cng Ph",type:"building",lat:21.040888033109084,lng:105.78267112400499,description:"Cng ph - Li vo ph",descriptionEn:"Side Gate - Secondary entrance",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Cng","Li vo"],tagsEn:["Gate","Entrance"]},{id:"BAOVEPV",name:"Security Post 2",nameVi:"Bo v 2",type:"building",lat:21.03938956724801,lng:105.78121276017191,description:"Trm bo v cng Phm Vn ng",descriptionEn:"Security post at Pham Van Dong Gate",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Bo v","An ninh"],tagsEn:["Security","Safety"]},{id:"BAOVEXT",name:"Security Post 1",nameVi:"Bo v 1",type:"building",lat:21.03686313635906,lng:105.78225545781584,description:"Trm bo v cng Xun Thy",descriptionEn:"Security post at Xuan Thuy Gate",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["Bo v","An ninh"],tagsEn:["Security","Safety"]},{id:"P_14a",name:"Parking 14A",nameVi:"Nh xe 14a",type:"building",lat:21.040230778034413,lng:105.7825580783724,description:"Nh xe khu 14A - Dnh cho sinh vin k tc x",descriptionEn:"Parking 14A - For dormitory students",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["Nh xe"," xe"],tagsEn:["Parking","Bike Parking"]},{id:"P_14b",name:"Parking 14B",nameVi:"Nh xe 14b",type:"building",lat:21.039751005110787,lng:105.78129100352783,description:"Nh xe khu 14B - Dnh cho sinh vin k tc x",descriptionEn:"Parking 14B - For dormitory students",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["Nh xe"," xe"],tagsEn:["Parking","Bike Parking"]},{id:"P_14c",name:"Parking 14C",nameVi:"Nh xe 14c",type:"building",lat:21.040858639860403,lng:105.78277779365209,description:"Nh xe khu 14C - Dnh cho sinh vin k tc x",descriptionEn:"Parking 14C - For dormitory students",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["Nh xe"," xe"],tagsEn:["Parking","Bike Parking"]},{id:"P_C",name:"Parking Zone C",nameVi:"Nh xe khu C",type:"building",lat:21.039486239165825,lng:105.7817145800708,description:"Nh xe khu C - Dnh cho sinh vin v ging vin",descriptionEn:"Parking Zone C - For students and faculty",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["Nh xe"," xe"],tagsEn:["Parking","Bike Parking"]},{id:"P_E",name:"Parking Zone E",nameVi:"Nh xe khu E",type:"building",lat:21.037745684639646,lng:105.78264380795207,description:"Nh xe khu E - Dnh cho sinh vin v ging vin",descriptionEn:"Parking Zone E - For students and faculty",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800",tags:["Nh xe"," xe"],tagsEn:["Parking","Bike Parking"]},{id:"P_Car",name:"Car Parking Lot",nameVi:"Bi  xe  t",type:"building",lat:21.03726473275222,lng:105.78174321293005,description:"Bi  xe  t - Dnh cho ging vin v khch",descriptionEn:"Car Parking Lot - For faculty and visitors",address:"144 Xun Thy, Cu Giy, H Ni",addressEn:"144 Xuan Thuy, Cau Giay, Hanoi",image:"https://images.unsplash.com/photo-1506521781263-d8422e82f27a?w=800",tags:[" xe"," t"],tagsEn:["Parking","Car"]},{id:"C1",name:"Building C1",nameVi:"Nh C1",type:"lecture_hall",lat:21.006998,lng:105.843146,description:"Nh C1 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"C2",name:"Building C2",nameVi:"Nh C2",type:"lecture_hall",lat:21.00648,lng:105.842316,description:"Nh C2 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"C3",name:"Building C3",nameVi:"Nh C3",type:"lecture_hall",lat:21.006554,lng:105.84401,description:"Nh C3 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"C4",name:"Building C4",nameVi:"Nh C4",type:"lecture_hall",lat:21.006179,lng:105.844041,description:"Nh C4 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"C5",name:"Building C5",nameVi:"Nh C5",type:"lecture_hall",lat:21.005763,lng:105.844036,description:"Nh C5 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"C6",name:"Building C6",nameVi:"Nh C6",type:"lecture_hall",lat:21.006173,lng:105.845011,description:"Nh C6 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"C7",name:"Building C7",nameVi:"Nh C7",type:"lecture_hall",lat:21.005766,lng:105.844968,description:"Nh C7 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"C8",name:"Building C8",nameVi:"Nh C8",type:"lecture_hall",lat:21.00529,lng:105.844926,description:"Nh C8 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"C9",name:"Building C9",nameVi:"Nh C9",type:"lecture_hall",lat:21.005835,lng:105.842323,description:"Nh C9 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"C10",name:"Building C10",nameVi:"Nh C10",type:"lecture_hall",lat:21.005441,lng:105.844081,description:"Nh C10 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"D1",name:"Building D1",nameVi:"Nh D1",type:"lecture_hall",lat:21.004879,lng:105.843412,description:"Nh D1 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"D2",name:"Building D2",nameVi:"Nh D2",type:"lecture_hall",lat:21.004719,lng:105.842118,description:"Nh D2 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"D3",name:"Building D3",nameVi:"Nh D3",type:"lecture_hall",lat:21.00475,lng:105.844982,description:"Nh D3 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"D4",name:"Building D4",nameVi:"Nh D4",type:"lecture_hall",lat:21.004182,lng:105.842085,description:"Nh D4 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"D5",name:"Building D5",nameVi:"Nh D5",type:"lecture_hall",lat:21.004334,lng:105.844972,description:"Nh D5 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"D6",name:"Building D6",nameVi:"Nh D6",type:"lecture_hall",lat:21.004323,lng:105.842682,description:"Nh D6 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"D7",name:"Building D7",nameVi:"Nh D7",type:"lecture_hall",lat:21.004072,lng:105.844899,description:"Nh D7 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"D8",name:"Building D8",nameVi:"Nh D8",type:"lecture_hall",lat:21.003964,lng:105.842679,description:"Nh D8 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"D9",name:"Building D9",nameVi:"Nh D9",type:"lecture_hall",lat:21.003806,lng:105.844114,description:"Nh D9 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"D3_5",name:"Building D3-5",nameVi:"Nh D3-5",type:"lecture_hall",lat:21.004583,lng:105.845289,description:"Nh D3-5 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"B1",name:"Building B1",nameVi:"Nh B1",type:"lecture_hall",lat:21.004447,lng:105.846614,description:"Nh B1 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"B3",name:"Building B3",nameVi:"Nh B3",type:"lecture_hall",lat:21.005613,lng:105.847615,description:"Nh B3 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"B5",name:"Building B5",nameVi:"Nh B5",type:"lecture_hall",lat:21.006424,lng:105.846885,description:"Nh B5 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"B5b",name:"Building B5b",nameVi:"Nh B5b",type:"lecture_hall",lat:21.006584,lng:105.846902,description:"Nh B5b - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"B6",name:"Building B6",nameVi:"Nh B6",type:"lecture_hall",lat:21.006475,lng:105.846137,description:"Nh B6 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"B7",name:"Building B7",nameVi:"Nh B7",type:"lecture_hall",lat:21.006044,lng:105.846114,description:"Nh B7 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"B7bis",name:"Building B7bis",nameVi:"Nh B7bis",type:"lecture_hall",lat:21.005663,lng:105.846131,description:"Nh B7bis - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800",tags:["HUST","Ging ng"]},{id:"B8",name:"Building B8",nameVi:"Nh B8",type:"lecture_hall",lat:21.005223,lng:105.846116,description:"Nh B8 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=800",tags:["HUST","Ging ng"]},{id:"B9",name:"Building B9",nameVi:"Nh B9",type:"lecture_hall",lat:21.006216,lng:105.847031,description:"Nh B9 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Ging ng"]},{id:"B13",name:"Building B13",nameVi:"Nh B13",type:"lecture_hall",lat:21.006686,lng:105.84762,description:"Nh B13 - i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1541339907198-e08756dedf3f?w=800",tags:["HUST","Ging ng"]},{id:"HO_TIEN",name:"Tien Lake",nameVi:"H Tin",type:"checkin",lat:21.004088,lng:105.843347,description:"H Tin - Khu vc cnh quan v th gin",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800",tags:["HUST","H","Checkin"]},{id:"THU_VIEN",name:"Ta Quang Buu Library",nameVi:"Th vin T Quang Bu",type:"building",lat:21.004454,lng:105.844135,description:"Th vin T Quang Bu - Th vin ln nht Bch Khoa",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1507842217121-9e9f1929c5f7?w=800",tags:["HUST","Th vin","Hc tp"]},{id:"KTX_B10",name:"Dormitory B10",nameVi:"KTX B10",type:"housing",lat:21.005268,lng:105.847516,description:"K tc x B10 dnh cho sinh vin",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1555854877-bab0e564b8d5?w=800",tags:["HUST","KTX","Sinh vin"]},{id:"TRAM_XA",name:"Medical Station",nameVi:"Trm x",type:"building",lat:21.006605,lng:105.847562,description:"Trm y t trng i hc Bch Khoa H Ni",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?w=800",tags:["HUST","Y t"]},{id:"A15",name:"Canteen A15",nameVi:"Nh n A15",type:"food",lat:21.004362,lng:105.847608,description:"Nh n sinh vin A15",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1552566626-52f8b828add9?w=800",tags:["HUST","n ung"]},{id:"NHA_KHACH",name:"HUST Guesthouse",nameVi:"Nh khch BK",type:"housing",lat:21.004091,lng:105.8479,description:"Nh khch i hc Bch Khoa",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800",tags:["HUST","Lu tr"]},{id:"A17",name:"Building A17",nameVi:"Nh A17",type:"building",lat:21.003959,lng:105.847633,description:"Ta nh A17 - Vin S phm k thut",address:"1 i C Vit, Hai B Trng, H Ni",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Vn phng"]},{id:"G_PARABOL",name:"Parabol Gate",nameVi:"Cng Parabol",type:"checkin",lat:21.005082,lng:105.841626,description:"Cng Parabol - Biu tng ca Bch Khoa",address:"ng Gii Phng",image:"https://images.unsplash.com/photo-1621644813589-9a22f365922c?w=800",tags:["HUST","Cng","Checkin"]},{id:"G_B8",name:"B8 Gate",nameVi:"Cng B8",type:"checkin",lat:21.004978,lng:105.845616,description:"Cng B8 ng Trn i Ngha",address:"ng Trn i Ngha",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Cng"]},{id:"G_BAC",name:"North Gate",nameVi:"Cng Bc",type:"checkin",lat:21.007411,lng:105.843047,description:"Cng Trn i Ngha (Cng Bc)",address:"ng Trn i Ngha",image:"https://images.unsplash.com/photo-1562774053-701939374585?w=800",tags:["HUST","Cng"]}],wG=t=>{if(["food","cafe","entertainment","lecture_hall","office","housing","job","building","checkin"].includes(t))return t;switch(t){case"service":case"shop":return"job";case"school":case"university":return"lecture_hall";default:return"building"}},bG=()=>{const{data:t=[],isLoading:e,refetch:r}=L1({queryKey:["approved_stores"],queryFn:async()=>{const{data:l,error:u}=await Wt.from("user_stores").select("*").eq("status","approved");if(u)throw console.error("Error fetching stores:",u),u;if(!l||l.length===0)return[];const f=l.map(s=>s.id),{data:g}=await Wt.from("store_vouchers").select("store_id, title_vi").in("store_id",f).eq("is_active",!0),w=new Map;return g&&g.forEach(s=>{w.has(s.store_id)||w.set(s.store_id,s)}),l.map(s=>{const S=w.get(s.id),A=s.is_premium===!0;return{id:`user-store-${s.id}`,name:s.name_en||s.name_vi,nameVi:s.name_vi,type:wG(s.category),category:s.category,lat:s.lat,lng:s.lng,description:s.description_vi||"",address:s.address_vi,image:s.image_url||"https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=800",isSponsored:A,is_premium:A,hasVoucher:!!S,voucherText:S?.title_vi,reviews:[]}})},staleTime:6e4});return{storesAsLocations:t,isLoading:e,refetch:r}},O0=()=>localStorage.getItem("mapbox_token")||"pk.eyJ1IjoiYW5odGh1eTA0IiwiYSI6ImNta25kbnoweDBsYTkzZnNiMncxbnZscncifQ.3RK47LOR8WkYagYydkps1w",TG=t=>{localStorage.setItem("mapbox_token",t)},fi=I.forwardRef(({className:t,type:e,...r},l)=>v.jsx("input",{type:e,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:l,...r}));fi.displayName="Input";const SG=({onSaved:t})=>{const[e,r]=I.useState(""),[l,u]=I.useState(null),{t:f}=da(),g=()=>{const w=e.trim();if(!w){u(f("tokenEmptyError"));return}if(w.length<20){u(f("tokenTooShortError"));return}u(null),TG(w),t(w)};return v.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-border bg-card p-5 shadow-lg",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-4xl mb-2",children:""}),v.jsx("p",{className:"font-semibold text-foreground",children:f("mapboxTokenRequired")}),v.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f("mapboxTokenInstructions")})]}),v.jsxs("div",{className:"mt-4 space-y-3",children:[v.jsx(fi,{value:e,onChange:w=>r(w.target.value),placeholder:f("tokenPlaceholder"),"aria-label":"Mapbox Access Token"}),l&&v.jsx("p",{className:"text-sm text-destructive",children:l}),v.jsx(vn,{onClick:g,className:"w-full",children:f("saveTokenAndLoad")}),v.jsx("p",{className:"text-xs text-muted-foreground text-center",children:f("tokenSavedInBrowser")})]})]})},EG=(t,e,r,l)=>{const f=(r-t)*(Math.PI/180),g=(l-e)*(Math.PI/180),w=Math.sin(f/2)*Math.sin(f/2)+Math.cos(t*(Math.PI/180))*Math.cos(r*(Math.PI/180))*Math.sin(g/2)*Math.sin(g/2);return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},CG=({userLocation:t,onViewStore:e})=>{const{session:r}=ha(),[l,u]=I.useState([]),[f,g]=I.useState(0),[w,s]=I.useState(!0),[S,A]=I.useState(new Set);I.useEffect(()=>{if(!t)return;(async()=>{const{data:U,error:q}=await Wt.from("store_vouchers").select(`
          *,
          store:user_stores!inner (
            id, name_vi, lat, lng, address_vi
          )
        `).eq("is_active",!0);if(q||!U){console.error("Li ly voucher:",q);return}const Q=U.map(J=>({...J,distance:EG(t.lat,t.lng,J.store.lat,J.store.lng)})).filter(J=>J.distance<=10).sort((J,Y)=>J.distance-Y.distance);if(u(Q),r?.user){const{data:J}=await Wt.from("user_saved_vouchers").select("voucher_id").eq("user_id",r.user.id);if(J){const Y=J.map(ie=>ie.voucher_id);A(new Set(Y))}}})()},[t,r]),I.useEffect(()=>{if(l.length<=1)return;const W=setInterval(()=>{g(U=>(U+1)%l.length)},6e3);return()=>clearInterval(W)},[l]);const j=async(W,U)=>{if(W.stopPropagation(),!r?.user){Jt.error("Bn cn ng nhp  lu m!");return}try{const{error:q}=await Wt.from("user_saved_vouchers").insert({user_id:r.user.id,voucher_id:U.id});if(q)if(q.code==="23505")Jt.info("Bn  lu m ny ri!"),A(Q=>new Set(Q).add(U.id));else throw q;else Jt.success(" lu m vo v!"),A(Q=>new Set(Q).add(U.id))}catch(q){console.error(q),Jt.error("Li khi lu m")}};if(!w||l.length===0)return null;const O=l[f],L=S.has(O.id);return v.jsx("div",{className:"fixed bottom-2 left-2 z-[40] w-[90%] md:w-80",children:v.jsx(Da,{mode:"wait",children:v.jsxs(_r.div,{initial:{x:-50,opacity:0},animate:{x:0,opacity:1},exit:{x:-50,opacity:0},transition:{duration:.4},onClick:()=>e(O.store.lat,O.store.lng),className:"bg-white/95 backdrop-blur shadow-xl rounded-xl border border-gray-200 overflow-hidden relative cursor-pointer hover:shadow-2xl transition-all",children:[v.jsx("button",{onClick:W=>{W.stopPropagation(),s(!1)},className:"absolute top-1 right-1 p-1 text-gray-400 hover:text-gray-600 rounded-full z-10",children:v.jsx(xi,{className:"w-4 h-4"})}),v.jsxs("div",{className:"flex",children:[v.jsxs("div",{className:"w-16 bg-gradient-to-b from-primary to-blue-600 flex items-center justify-center text-white flex-col gap-1",children:[v.jsx(fh,{className:"w-6 h-6"}),v.jsx("span",{className:"text-[10px] font-bold",children:"Voucher"})]}),v.jsxs("div",{className:"flex-1 p-3",children:[v.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase truncate mb-0.5",children:O.store.name_vi}),v.jsxs("div",{className:"flex items-baseline gap-1 mb-2",children:[v.jsxs("span",{className:"text-xl font-black text-primary",children:["-",O.discount_value,O.discount_type==="percent"?"%":"k"]}),v.jsxs("span",{className:"text-xs text-gray-400 font-mono",children:["#",O.code]})]}),v.jsxs("div",{className:"flex justify-between items-center mt-1",children:[v.jsxs("div",{className:"flex items-center text-[10px] text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[v.jsx(Wi,{className:"w-3 h-3 mr-1"}),O.distance.toFixed(1),"km"]}),v.jsxs(vn,{size:"sm",variant:L?"outline":"default",className:`h-7 text-xs px-2 ${L?"text-green-600 border-green-200 bg-green-50":""}`,onClick:W=>j(W,O),children:[L?v.jsx(tp,{className:"w-3 h-3 mr-1"}):v.jsx(C5,{className:"w-3 h-3 mr-1"}),L?" lu":"Lu"]})]})]})]}),v.jsx(_r.div,{initial:{width:"0%"},animate:{width:"100%"},transition:{duration:6,ease:"linear"},className:"h-1 bg-primary/50 absolute bottom-0 left-0"})]},f)})})},kG=({type:t,isSelected:e,isSponsored:r,hasVoucher:l})=>{let u=Wi,f="#64748B";switch(t){case"lecture_hall":u=p1,f="#0EA5E9";break;case"office":u=d1,f="#475569";break;case"cafe":u=h1,f="#D97706";break;case"entertainment":u=f1,f="#DB2777";break;case"food":u=m0,f="#F97316";break;case"housing":u=m1,f="#3B82F6";break;case"job":u=lh,f="#8B5CF6";break;case"building":u=Dm,f="#10B981";break;case"checkin":u=WP,f="#EC4899";break;default:u=Wi,f="#64748B"}const g=e?46:r?32:26,w=e?24:r?16:14,s=e?3:1.5;return v.jsxs("div",{className:"relative flex flex-col items-center justify-center transition-all duration-300 group cursor-pointer",style:{transform:e?"scale(1.15) translateY(-10px)":"scale(1)",zIndex:e?50:10},children:[v.jsx("div",{style:{width:g,height:g,backgroundColor:e?f:"white",border:`${s}px solid ${e?"white":f}`,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:e?`0 10px 25px -5px ${f}90`:"0 2px 4px 0 rgba(0,0,0,0.15)"},children:v.jsx(u,{size:w,color:e?"white":f,strokeWidth:2.5})}),(e||r)&&v.jsx("div",{style:{width:0,height:0,borderLeft:`${e?6:4}px solid transparent`,borderRight:`${e?6:4}px solid transparent`,borderTop:`${e?8:6}px solid ${f}`,marginTop:-1,filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.1))"}}),l&&v.jsx("div",{className:"absolute -top-1.5 -right-1.5 bg-yellow-400 border border-white rounded-full p-0.5 shadow-sm animate-bounce z-[60]",children:v.jsx(Uf,{size:e?10:8,fill:"white",className:"text-white"})})]})},AG=({selectedLocation:t,onSelectLocation:e,activeCategories:r,flyToLocation:l,routeInfo:u,routeOrigin:f,routeDestination:g,multiStopRoute:w,isMultiStopMode:s,onUserLocationUpdate:S})=>{const{language:A}=da(),{storesAsLocations:j}=bG(),O=I.useRef(null),L=I.useRef(null),W=I.useRef([]),U=I.useRef(null),q=I.useRef(null),Q=I.useRef(null),[J,Y]=I.useState(!1),[ie,_e]=I.useState(null),[Se,Ie]=I.useState(!1),[Ue,Je]=I.useState(null),Me="route-line",lt="route-arrows",ft="route-source";I.useEffect(()=>{const Lt=O0();_e(Lt),Ie(!0)},[]);const mt=Lt=>{_e(Lt)};I.useEffect(()=>{if(!O.current||L.current||!ie)return;Xl.accessToken=ie,L.current=new Xl.Map({container:O.current,style:"mapbox://styles/mapbox/streets-v12",center:[wA.lng,wA.lat],zoom:16,pitch:45,bearing:-17.6}),L.current.addControl(new Xl.NavigationControl,"bottom-right");const Lt=new Xl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});return L.current.addControl(Lt,"bottom-right"),Lt.on("geolocate",it=>{const We={lat:it.coords.latitude,lng:it.coords.longitude};Je(We),S&&S(We)}),L.current.on("load",()=>{Y(!0),Lt.trigger()}),L.current.on("click",it=>{Q.current&&(Q.current.remove(),Q.current=null);const We=L.current?.queryRenderedFeatures(it.point,{layers:["poi-label"]});if(We&&We.length>0){const Le=We[0],we=Le.properties?.name||"a im cha c tn",st=Le.geometry.coordinates.slice(),ke=document.createElement("div");ke.className="poi-highlight-marker",ym.createRoot(ke).render(v.jsxs("div",{className:"relative -top-4 animate-bounce",children:[v.jsx(Wi,{size:46,className:"text-red-600 fill-white drop-shadow-2xl",strokeWidth:2.5}),v.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-4 h-2 bg-black/20 blur-[3px] rounded-full"})]}));const bt=new Xl.Marker({element:ke,anchor:"bottom"}).setLngLat(st).addTo(L.current);Q.current=bt,L.current?.flyTo({center:st,zoom:17,pitch:50,duration:1e3,offset:[0,150]});const wt={id:String(Le.id),name:we,nameVi:we,address:"a im trn bn ",description:"a im tm thy t Mapbox",lat:st[1],lng:st[0],type:"checkin",category:"checkin",image:null,is_premium:!1};e(wt)}}),L.current.on("mouseenter","poi-label",()=>{L.current&&(L.current.getCanvas().style.cursor="pointer")}),L.current.on("mouseleave","poi-label",()=>{L.current&&(L.current.getCanvas().style.cursor="")}),()=>{L.current?.remove(),L.current=null}},[ie]),I.useEffect(()=>{if(!L.current||!J||(W.current.forEach(({marker:Le,root:we})=>{we.unmount(),Le.remove()}),W.current=[],!!u||!!w))return;[...CT,...j].filter(Le=>r.includes(Le.type)).forEach(Le=>{const we=document.createElement("div");we.className="custom-marker-container";const st=ym.createRoot(we),ke=t?.id===Le.id;if(st.render(v.jsx(kG,{type:Le.type,isSelected:ke,isSponsored:Le.isSponsored||!1,hasVoucher:Le.hasVoucher})),Le.type==="building"||ke){const bt=document.createElement("div"),wt=A==="en"&&Le.name?Le.name:Le.nameVi;bt.innerHTML=`<div class="px-2 py-1 bg-slate-900/90 text-white text-[10px] font-bold rounded shadow-lg backdrop-blur-sm mt-2 whitespace-nowrap transform -translate-x-1/2 left-1/2 relative">${wt}</div>`,we.appendChild(bt)}we.addEventListener("click",bt=>{bt.stopPropagation(),e(Le)});const Ve=new Xl.Marker({element:we,anchor:"bottom"}).setLngLat([Le.lng,Le.lat]).addTo(L.current);W.current.push({marker:Ve,root:st})})},[r,J,t,e,A,j,u,w]),I.useEffect(()=>{!L.current||!l||L.current.flyTo({center:[l.lng,l.lat],zoom:18,pitch:60,duration:1500})},[l]),I.useEffect(()=>{if(!L.current||!J)return;L.current.getLayer(lt)&&L.current.removeLayer(lt),L.current.getLayer(Me)&&L.current.removeLayer(Me),L.current.getSource(ft)&&L.current.removeSource(ft),U.current&&(U.current.remove(),U.current=null),q.current&&(q.current.remove(),q.current=null);const Lt=s?w:u;if(!Lt?.geometry)return;if(L.current.addSource(ft,{type:"geojson",data:{type:"Feature",properties:{},geometry:Lt.geometry}}),L.current.addLayer({id:Me,type:"line",source:ft,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":s?"#8b5cf6":"#3b82f6","line-width":6,"line-opacity":.8}}),L.current.addLayer({id:lt,type:"symbol",source:ft,layout:{"symbol-placement":"line","symbol-spacing":80,"icon-image":"arrow-right","icon-size":.6,"icon-allow-overlap":!0,"icon-ignore-placement":!0}}),!L.current.hasImage("arrow-right")){const We='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>',Le=new Image(24,24);Le.onload=()=>{L.current&&!L.current.hasImage("arrow-right")&&L.current.addImage("arrow-right",Le)},Le.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(We)}if(f){const We=document.createElement("div");ym.createRoot(We).render(v.jsx("div",{className:"w-5 h-5 bg-blue-600 border-2 border-white rounded-full shadow-md animate-pulse"})),U.current=new Xl.Marker({element:We}).setLngLat(f).addTo(L.current)}if(!s&&g){const We=document.createElement("div");ym.createRoot(We).render(v.jsx("div",{className:"flex flex-col items-center pb-2",children:v.jsx(Wi,{size:32,className:"text-red-600 drop-shadow-md fill-red-600"})})),q.current=new Xl.Marker({element:We,anchor:"bottom"}).setLngLat(g).addTo(L.current)}const it=Lt.geometry.coordinates;if(it&&it.length>0){const We=it.reduce((Le,we)=>Le.extend(we),new Xl.LngLatBounds(it[0],it[0]));L.current.fitBounds(We,{padding:{top:150,bottom:300,left:50,right:50},duration:1e3})}},[u,w,s,f,g,J]);const gt=(Lt,it)=>{if(L.current){tempMarkerRef.current&&tempMarkerRef.current.remove(),L.current.flyTo({center:[it,Lt],zoom:17,pitch:50,duration:1500});const We=document.createElement("div");ym.createRoot(We).render(v.jsx(Wi,{size:40,className:"text-red-500 fill-red-500 animate-bounce"})),tempMarkerRef.current=new Xl.Marker({element:We,anchor:"bottom"}).setLngLat([it,Lt]).addTo(L.current)}};return Se?ie?v.jsxs("div",{className:"relative w-full h-full",children:[v.jsx("div",{ref:O,className:"w-full h-full"}),Ue&&v.jsx(CG,{userLocation:Ue,onViewStore:gt})]}):v.jsx("div",{className:"w-full h-full flex items-center justify-center p-4",children:v.jsx(SG,{onSaved:mt})}):v.jsx("div",{className:"w-full h-full flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})},iy=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"d").replace(//g,"D"),Iw=(t,e,r,l)=>{const f=(r-t)*(Math.PI/180),g=(l-e)*(Math.PI/180),w=Math.sin(f/2)*Math.sin(f/2)+Math.cos(t*(Math.PI/180))*Math.cos(r*(Math.PI/180))*Math.sin(g/2)*Math.sin(g/2);return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},PG=({onLocationSelect:t,onFocus:e,onBlur:r,placeholder:l="Tm a im...",userLocation:u,resultContainerStyle:f})=>{const[g,w]=I.useState(""),[s,S]=I.useState([]),[A,j]=I.useState(!1),[O,L]=I.useState(!1),[W,U]=I.useState(!1),q=I.useRef(null),Q=I.useRef(null),J=I.useRef(null);I.useEffect(()=>{const Se=Ie=>{q.current&&!q.current.contains(Ie.target)&&(L(!1),r&&r())};return document.addEventListener("mousedown",Se),()=>document.removeEventListener("mousedown",Se)},[r]),I.useEffect(()=>{if(!g){S([]),U(!1);return}L(!0),j(!0),U(!1);const Se=setTimeout(async()=>{const Ie=iy(g).toLowerCase().trim(),Ue=CT.filter(lt=>{const ft=iy(lt.name).toLowerCase(),mt=iy(lt.nameVi||"").toLowerCase();return ft.includes(Ie)||mt.includes(Ie)}).map(lt=>({id:`local-${lt.id}`,name:lt.nameVi||lt.name,address:lt.address||"i hc Bch Khoa HN",lat:lt.lat,lng:lt.lng,source:"local",type:lt.type,originalData:lt,distance:u?Iw(u.lat,u.lng,lt.lat,lt.lng):0})),Je=O0();J.current&&J.current.abort(),J.current=new AbortController;const Me=J.current.signal;try{let lt=[],ft=[];const{data:mt}=await Wt.from("user_stores").select("*").ilike("name_vi",`%${g}%`).limit(5);if(mt&&(lt=mt.map(Lt=>({id:`db-${Lt.id}`,name:Lt.name_vi,address:Lt.address_vi,lat:Lt.lat,lng:Lt.lng,source:"database",type:Lt.category,originalData:Lt,distance:u?Iw(u.lat,u.lng,Lt.lat,Lt.lng):0}))),Je){const Lt=u?`&proximity=${u.lng},${u.lat}`:"",it=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(g)}.json?access_token=${Je}&country=vn&autocomplete=true&limit=10&language=vi&types=poi,address${Lt}`,We=await fetch(it,{signal:Me});if(We.ok){const Le=await We.json();Le.features&&(ft=Le.features.map(we=>({id:we.id,name:we.text,address:we.place_name?.replace(we.text+", ","").replace(", Vietnam",""),lat:we.center[1],lng:we.center[0],source:"mapbox",type:"checkin",originalData:{id:we.id,name:we.text,nameVi:we.text,address:we.place_name,lat:we.center[1],lng:we.center[0],type:"checkin",isMapboxResult:!0},distance:u?Iw(u.lat,u.lng,we.center[1],we.center[0]):0})))}}const gt=[...Ue,...lt,...ft];gt.sort((Lt,it)=>{const We=iy(Lt.name).toLowerCase()===Ie,Le=iy(it.name).toLowerCase()===Ie;return We&&!Le?-1:!We&&Le?1:(Lt.distance||0)-(it.distance||0)}),S(gt)}catch(lt){lt.name!=="AbortError"&&console.error("Li tm kim:",lt)}finally{Me.aborted||j(!1)}},400);return()=>clearTimeout(Se)},[g,u]);const Y=Se=>{w(Se.name),S([]),L(!1),Q.current&&Q.current.blur(),t(Se.originalData)},ie=()=>{w(""),S([]),Q.current&&Q.current.focus()},_e=Se=>Se===void 0?"":Se<1?`${(Se*1e3).toFixed(0)}m`:`${Se.toFixed(1)}km`;return v.jsxs("div",{ref:q,className:"relative w-full pointer-events-auto z-[50]",children:[O&&v.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-[1px] z-[-1] md:hidden",onClick:()=>L(!1)}),v.jsxs("div",{className:"relative flex items-center bg-white rounded-full shadow-md border border-gray-200 h-12 overflow-hidden transition-all duration-200 focus-within:shadow-lg focus-within:border-blue-300",children:[v.jsx("div",{className:"pl-4 pr-2 text-gray-400",children:A?v.jsx(ls,{className:"w-5 h-5 animate-spin text-blue-500"}):v.jsx(p0,{className:"w-5 h-5"})}),v.jsx(fi,{ref:Q,className:"border-none shadow-none focus-visible:ring-0 focus-visible:ring-offset-0 h-full bg-transparent text-base px-2 placeholder:text-gray-400 w-full",placeholder:l,value:g,onChange:Se=>w(Se.target.value),onFocus:()=>L(!0),style:{fontSize:"16px"}}),g&&v.jsx(vn,{variant:"ghost",size:"icon",className:"h-9 w-9 mr-1 hover:bg-gray-100 rounded-full active:scale-95 transition-transform",onMouseDown:Se=>{Se.preventDefault(),ie()},children:v.jsx(xi,{className:"h-5 w-5 text-gray-500"})})]}),O&&(s.length>0||A&&g||W)&&v.jsx("div",{className:`
            bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden 
            flex flex-col
            /* MOBILE: Fixed trn mn hnh, nm di thanh search mt cht */
            fixed top-[70px] left-2 right-2 max-h-[50vh]
            /* DESKTOP: Absolute nm ngay di thanh search */
            md:absolute md:top-full md:left-0 md:right-0 md:mt-2 md:max-h-[60vh]
            z-[100]
          `,children:v.jsxs("div",{className:"overflow-y-auto overscroll-contain",children:[W&&v.jsxs("div",{className:"p-3 bg-red-50 text-red-600 text-sm flex items-center gap-2 border-b border-red-100",children:[v.jsx(l5,{className:"w-4 h-4"}),v.jsx("span",{children:"Cha nhp Mapbox Token!"})]}),A&&s.length===0&&!W&&v.jsxs("div",{className:"p-4 text-center text-gray-400 text-sm flex items-center justify-center gap-2 py-8",children:[v.jsx(ls,{className:"w-5 h-5 animate-spin"})," ang tm kim..."]}),v.jsx("div",{className:"py-1",children:s.map(Se=>v.jsxs("button",{onMouseDown:Ie=>{Ie.preventDefault(),Y(Se)},className:"w-full text-left px-4 py-3 hover:bg-blue-50 active:bg-blue-100 transition-colors flex items-start gap-3 border-b border-gray-50 last:border-0 group",children:[v.jsx("div",{className:`mt-0.5 w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm ${Se.source==="local"?"bg-blue-100 text-blue-600":Se.source==="database"?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-600"}`,children:Se.source==="local"||Se.source==="database"?v.jsx(Dm,{className:"w-4 h-4"}):v.jsx(Wi,{className:"w-4 h-4"})}),v.jsxs("div",{className:"min-w-0 flex-1",children:[v.jsxs("div",{className:"flex justify-between items-start gap-2",children:[v.jsx("h4",{className:"font-semibold text-gray-800 text-sm line-clamp-1 group-hover:text-blue-700",children:Se.name}),u&&v.jsxs("div",{className:"flex items-center text-[10px] text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded-md flex-shrink-0 whitespace-nowrap",children:[v.jsx(Rv,{className:"w-3 h-3 mr-0.5"}),_e(Se.distance)]})]}),v.jsxs("p",{className:"text-xs text-gray-500 line-clamp-1 mt-0.5 flex items-center gap-1.5",children:[Se.source==="local"&&v.jsx("span",{className:"bg-blue-100 text-blue-700 px-1 rounded-[3px] text-[9px] font-bold uppercase tracking-wider",children:"Trng"}),v.jsx("span",{className:"truncate",children:Se.address})]})]})]},`${Se.source}-${Se.id}`))})]})}),O&&!A&&g&&s.length===0&&!W&&v.jsx("div",{className:`
              bg-white rounded-xl shadow-lg p-4 text-center text-gray-500 text-sm 
              fixed top-[70px] left-2 right-2 
              md:absolute md:top-full md:left-0 md:right-0 md:mt-2
              z-[100]
            `,children:"Khng tm thy a im no ph hp."})]})},MG=({activeCategories:t,onToggleCategory:e})=>{const{t:r}=da(),l=[{type:"lecture_hall",labelKey:"lecture_hall",icon:p1},{type:"office",labelKey:"office",icon:d1},{type:"food",labelKey:"food",icon:m0},{type:"cafe",labelKey:"cafe",icon:h1},{type:"entertainment",labelKey:"entertainment",icon:f1},{type:"housing",labelKey:"housing",icon:m1},{type:"job",labelKey:"job",icon:lh},{type:"building",labelKey:"building",icon:Dm}];return v.jsx("div",{className:"flex gap-1.5 overflow-x-auto pb-1 scrollbar-hide",children:l.map(({type:u,labelKey:f,icon:g})=>{const w=t.includes(u);return v.jsxs(_r.button,{onClick:()=>e(u),className:cn("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all",w?"bg-primary text-primary-foreground shadow-md":"bg-card/90 backdrop-blur-sm text-muted-foreground border border-border hover:bg-muted"),whileTap:{scale:.95},children:[v.jsx(g,{className:"w-3.5 h-3.5"}),v.jsx("span",{children:r(f)})]},u)})})},SN=()=>{const{session:t}=ha(),e=b0(),r=t?.user?.id,{data:l=[],isLoading:u}=L1({queryKey:["favorites",r],queryFn:async()=>{if(!r)return[];const{data:S,error:A}=await Wt.from("favorites").select("*").eq("user_id",r);if(A)throw A;return S.map(j=>({id:j.location_id,name:j.location_name_en||j.location_name,nameVi:j.location_name,type:j.location_type,lat:j.location_lat,lng:j.location_lng,address:"",description:"",image:"https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=800",isSponsored:!1,hasVoucher:!1}))},enabled:!!r}),f=Yl({mutationFn:async S=>{if(!r)throw new Error("Vui lng ng nhp");const A=S.id.toString(),{data:j}=await Wt.from("favorites").select("id").eq("user_id",r).eq("location_id",A).maybeSingle();if(j)return;const{error:O}=await Wt.from("favorites").insert({user_id:r,location_id:A,location_name:S.nameVi||S.name,location_name_en:S.name||null,location_lat:S.lat,location_lng:S.lng,location_type:S.type});if(O)throw O},onSuccess:()=>{e.invalidateQueries({queryKey:["favorites"]}),Jt.success(" thm vo yu thch ")},onError:S=>Jt.error(S.message)}),g=Yl({mutationFn:async S=>{if(!r)throw new Error("Vui lng ng nhp");const{error:A}=await Wt.from("favorites").delete().eq("user_id",r).eq("location_id",S.toString());if(A)throw A},onSuccess:()=>{e.invalidateQueries({queryKey:["favorites"]}),Jt.info(" xa khi yu thch")},onError:S=>Jt.error(S.message)}),w=S=>l.some(A=>A.id.toString()===S.toString()),s=S=>{w(S.id)?g.mutate(S.id):f.mutate(S)};return{favorites:l,isLoading:u,addFavorite:f.mutate,removeFavorite:g.mutate,isFavorite:w,toggleFavorite:s,isAdding:f.isPending}};var Rw="focusScope.autoFocusOnMount",Nw="focusScope.autoFocusOnUnmount",bA={bubbles:!1,cancelable:!0},IG="FocusScope",z0=I.forwardRef((t,e)=>{const{loop:r=!1,trapped:l=!1,onMountAutoFocus:u,onUnmountAutoFocus:f,...g}=t,[w,s]=I.useState(null),S=$i(u),A=$i(f),j=I.useRef(null),O=ar(e,U=>s(U)),L=I.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;I.useEffect(()=>{if(l){let U=function(Y){if(L.paused||!w)return;const ie=Y.target;w.contains(ie)?j.current=ie:eh(j.current,{select:!0})},q=function(Y){if(L.paused||!w)return;const ie=Y.relatedTarget;ie!==null&&(w.contains(ie)||eh(j.current,{select:!0}))},Q=function(Y){if(document.activeElement===document.body)for(const _e of Y)_e.removedNodes.length>0&&eh(w)};document.addEventListener("focusin",U),document.addEventListener("focusout",q);const J=new MutationObserver(Q);return w&&J.observe(w,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",U),document.removeEventListener("focusout",q),J.disconnect()}}},[l,w,L.paused]),I.useEffect(()=>{if(w){SA.add(L);const U=document.activeElement;if(!w.contains(U)){const Q=new CustomEvent(Rw,bA);w.addEventListener(Rw,S),w.dispatchEvent(Q),Q.defaultPrevented||(RG(OG(EN(w)),{select:!0}),document.activeElement===U&&eh(w))}return()=>{w.removeEventListener(Rw,S),setTimeout(()=>{const Q=new CustomEvent(Nw,bA);w.addEventListener(Nw,A),w.dispatchEvent(Q),Q.defaultPrevented||eh(U??document.body,{select:!0}),w.removeEventListener(Nw,A),SA.remove(L)},0)}}},[w,S,A,L]);const W=I.useCallback(U=>{if(!r&&!l||L.paused)return;const q=U.key==="Tab"&&!U.altKey&&!U.ctrlKey&&!U.metaKey,Q=document.activeElement;if(q&&Q){const J=U.currentTarget,[Y,ie]=NG(J);Y&&ie?!U.shiftKey&&Q===ie?(U.preventDefault(),r&&eh(Y,{select:!0})):U.shiftKey&&Q===Y&&(U.preventDefault(),r&&eh(ie,{select:!0})):Q===J&&U.preventDefault()}},[r,l,L.paused]);return v.jsx(In.div,{tabIndex:-1,...g,ref:O,onKeyDown:W})});z0.displayName=IG;function RG(t,{select:e=!1}={}){const r=document.activeElement;for(const l of t)if(eh(l,{select:e}),document.activeElement!==r)return}function NG(t){const e=EN(t),r=TA(e,t),l=TA(e.reverse(),t);return[r,l]}function EN(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const u=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||u?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)e.push(r.currentNode);return e}function TA(t,e){for(const r of t)if(!jG(r,{upTo:e}))return r}function jG(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function DG(t){return t instanceof HTMLInputElement&&"select"in t}function eh(t,{select:e=!1}={}){if(t&&t.focus){const r=document.activeElement;t.focus({preventScroll:!0}),t!==r&&DG(t)&&e&&t.select()}}var SA=LG();function LG(){let t=[];return{add(e){const r=t[0];e!==r&&r?.pause(),t=EA(t,e),t.unshift(e)},remove(e){t=EA(t,e),t[0]?.resume()}}}function EA(t,e){const r=[...t],l=r.indexOf(e);return l!==-1&&r.splice(l,1),r}function OG(t){return t.filter(e=>e.tagName!=="A")}var jw=0;function kT(){I.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??CA()),document.body.insertAdjacentElement("beforeend",t[1]??CA()),jw++,()=>{jw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),jw--}},[])}function CA(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var Av="right-scroll-bar-position",Pv="width-before-scroll-bar",zG="with-scroll-bars-hidden",BG="--removed-body-scroll-bar-size";function Dw(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function FG(t,e){var r=I.useState(function(){return{value:t,callback:e,facade:{get current(){return r.value},set current(l){var u=r.value;u!==l&&(r.value=l,r.callback(l,u))}}}})[0];return r.callback=e,r.facade}var VG=typeof window<"u"?I.useLayoutEffect:I.useEffect,kA=new WeakMap;function UG(t,e){var r=FG(null,function(l){return t.forEach(function(u){return Dw(u,l)})});return VG(function(){var l=kA.get(r);if(l){var u=new Set(l),f=new Set(t),g=r.current;u.forEach(function(w){f.has(w)||Dw(w,null)}),f.forEach(function(w){u.has(w)||Dw(w,g)})}kA.set(r,t)},[t]),r}function $G(t){return t}function GG(t,e){e===void 0&&(e=$G);var r=[],l=!1,u={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:t},useMedium:function(f){var g=e(f,l);return r.push(g),function(){r=r.filter(function(w){return w!==g})}},assignSyncMedium:function(f){for(l=!0;r.length;){var g=r;r=[],g.forEach(f)}r={push:function(w){return f(w)},filter:function(){return r}}},assignMedium:function(f){l=!0;var g=[];if(r.length){var w=r;r=[],w.forEach(f),g=r}var s=function(){var A=g;g=[],A.forEach(f)},S=function(){return Promise.resolve().then(s)};S(),r={push:function(A){g.push(A),S()},filter:function(A){return g=g.filter(A),r}}}};return u}function HG(t){t===void 0&&(t={});var e=GG(null);return e.options=Xc({async:!0,ssr:!1},t),e}var CN=function(t){var e=t.sideCar,r=Qm(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=e.read();if(!l)throw new Error("Sidecar medium not found");return I.createElement(l,Xc({},r))};CN.isSideCarExport=!0;function qG(t,e){return t.useMedium(e),CN}var kN=HG(),Lw=function(){},B0=I.forwardRef(function(t,e){var r=I.useRef(null),l=I.useState({onScrollCapture:Lw,onWheelCapture:Lw,onTouchMoveCapture:Lw}),u=l[0],f=l[1],g=t.forwardProps,w=t.children,s=t.className,S=t.removeScrollBar,A=t.enabled,j=t.shards,O=t.sideCar,L=t.noRelative,W=t.noIsolation,U=t.inert,q=t.allowPinchZoom,Q=t.as,J=Q===void 0?"div":Q,Y=t.gapMode,ie=Qm(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_e=O,Se=UG([r,e]),Ie=Xc(Xc({},ie),u);return I.createElement(I.Fragment,null,A&&I.createElement(_e,{sideCar:kN,removeScrollBar:S,shards:j,noRelative:L,noIsolation:W,inert:U,setCallbacks:f,allowPinchZoom:!!q,lockRef:r,gapMode:Y}),g?I.cloneElement(I.Children.only(w),Xc(Xc({},Ie),{ref:Se})):I.createElement(J,Xc({},Ie,{className:s,ref:Se}),w))});B0.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};B0.classNames={fullWidth:Pv,zeroRight:Av};var WG=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function ZG(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=WG();return e&&t.setAttribute("nonce",e),t}function KG(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function XG(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var YG=function(){var t=0,e=null;return{add:function(r){t==0&&(e=ZG())&&(KG(e,r),XG(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},JG=function(){var t=YG();return function(e,r){I.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&r])}},AN=function(){var t=JG(),e=function(r){var l=r.styles,u=r.dynamic;return t(l,u),null};return e},QG={left:0,top:0,right:0,gap:0},Ow=function(t){return parseInt(t||"",10)||0},eH=function(t){var e=window.getComputedStyle(document.body),r=e[t==="padding"?"paddingLeft":"marginLeft"],l=e[t==="padding"?"paddingTop":"marginTop"],u=e[t==="padding"?"paddingRight":"marginRight"];return[Ow(r),Ow(l),Ow(u)]},tH=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return QG;var e=eH(t),r=document.documentElement.clientWidth,l=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,l-r+e[2]-e[0])}},nH=AN(),jm="data-scroll-locked",rH=function(t,e,r,l){var u=t.left,f=t.top,g=t.right,w=t.gap;return r===void 0&&(r="margin"),`
  .`.concat(zG,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(w,"px ").concat(l,`;
  }
  body[`).concat(jm,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(l,";"),r==="margin"&&`
    padding-left: `.concat(u,`px;
    padding-top: `).concat(f,`px;
    padding-right: `).concat(g,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(w,"px ").concat(l,`;
    `),r==="padding"&&"padding-right: ".concat(w,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Av,` {
    right: `).concat(w,"px ").concat(l,`;
  }
  
  .`).concat(Pv,` {
    margin-right: `).concat(w,"px ").concat(l,`;
  }
  
  .`).concat(Av," .").concat(Av,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(Pv," .").concat(Pv,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(jm,`] {
    `).concat(BG,": ").concat(w,`px;
  }
`)},AA=function(){var t=parseInt(document.body.getAttribute(jm)||"0",10);return isFinite(t)?t:0},iH=function(){I.useEffect(function(){return document.body.setAttribute(jm,(AA()+1).toString()),function(){var t=AA()-1;t<=0?document.body.removeAttribute(jm):document.body.setAttribute(jm,t.toString())}},[])},sH=function(t){var e=t.noRelative,r=t.noImportant,l=t.gapMode,u=l===void 0?"margin":l;iH();var f=I.useMemo(function(){return tH(u)},[u]);return I.createElement(nH,{styles:rH(f,!e,u,r?"":"!important")})},qb=!1;if(typeof window<"u")try{var mv=Object.defineProperty({},"passive",{get:function(){return qb=!0,!0}});window.addEventListener("test",mv,mv),window.removeEventListener("test",mv,mv)}catch{qb=!1}var pm=qb?{passive:!1}:!1,oH=function(t){return t.tagName==="TEXTAREA"},PN=function(t,e){if(!(t instanceof Element))return!1;var r=window.getComputedStyle(t);return r[e]!=="hidden"&&!(r.overflowY===r.overflowX&&!oH(t)&&r[e]==="visible")},aH=function(t){return PN(t,"overflowY")},lH=function(t){return PN(t,"overflowX")},PA=function(t,e){var r=e.ownerDocument,l=e;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var u=MN(t,l);if(u){var f=IN(t,l),g=f[1],w=f[2];if(g>w)return!0}l=l.parentNode}while(l&&l!==r.body);return!1},cH=function(t){var e=t.scrollTop,r=t.scrollHeight,l=t.clientHeight;return[e,r,l]},uH=function(t){var e=t.scrollLeft,r=t.scrollWidth,l=t.clientWidth;return[e,r,l]},MN=function(t,e){return t==="v"?aH(e):lH(e)},IN=function(t,e){return t==="v"?cH(e):uH(e)},dH=function(t,e){return t==="h"&&e==="rtl"?-1:1},hH=function(t,e,r,l,u){var f=dH(t,window.getComputedStyle(e).direction),g=f*l,w=r.target,s=e.contains(w),S=!1,A=g>0,j=0,O=0;do{if(!w)break;var L=IN(t,w),W=L[0],U=L[1],q=L[2],Q=U-q-f*W;(W||Q)&&MN(t,w)&&(j+=Q,O+=W);var J=w.parentNode;w=J&&J.nodeType===Node.DOCUMENT_FRAGMENT_NODE?J.host:J}while(!s&&w!==document.body||s&&(e.contains(w)||e===w));return(A&&Math.abs(j)<1||!A&&Math.abs(O)<1)&&(S=!0),S},gv=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},MA=function(t){return[t.deltaX,t.deltaY]},IA=function(t){return t&&"current"in t?t.current:t},fH=function(t,e){return t[0]===e[0]&&t[1]===e[1]},pH=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},mH=0,mm=[];function gH(t){var e=I.useRef([]),r=I.useRef([0,0]),l=I.useRef(),u=I.useState(mH++)[0],f=I.useState(AN)[0],g=I.useRef(t);I.useEffect(function(){g.current=t},[t]),I.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(u));var U=f6([t.lockRef.current],(t.shards||[]).map(IA),!0).filter(Boolean);return U.forEach(function(q){return q.classList.add("allow-interactivity-".concat(u))}),function(){document.body.classList.remove("block-interactivity-".concat(u)),U.forEach(function(q){return q.classList.remove("allow-interactivity-".concat(u))})}}},[t.inert,t.lockRef.current,t.shards]);var w=I.useCallback(function(U,q){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!g.current.allowPinchZoom;var Q=gv(U),J=r.current,Y="deltaX"in U?U.deltaX:J[0]-Q[0],ie="deltaY"in U?U.deltaY:J[1]-Q[1],_e,Se=U.target,Ie=Math.abs(Y)>Math.abs(ie)?"h":"v";if("touches"in U&&Ie==="h"&&Se.type==="range")return!1;var Ue=window.getSelection(),Je=Ue&&Ue.anchorNode,Me=Je?Je===Se||Je.contains(Se):!1;if(Me)return!1;var lt=PA(Ie,Se);if(!lt)return!0;if(lt?_e=Ie:(_e=Ie==="v"?"h":"v",lt=PA(Ie,Se)),!lt)return!1;if(!l.current&&"changedTouches"in U&&(Y||ie)&&(l.current=_e),!_e)return!0;var ft=l.current||_e;return hH(ft,q,U,ft==="h"?Y:ie)},[]),s=I.useCallback(function(U){var q=U;if(!(!mm.length||mm[mm.length-1]!==f)){var Q="deltaY"in q?MA(q):gv(q),J=e.current.filter(function(_e){return _e.name===q.type&&(_e.target===q.target||q.target===_e.shadowParent)&&fH(_e.delta,Q)})[0];if(J&&J.should){q.cancelable&&q.preventDefault();return}if(!J){var Y=(g.current.shards||[]).map(IA).filter(Boolean).filter(function(_e){return _e.contains(q.target)}),ie=Y.length>0?w(q,Y[0]):!g.current.noIsolation;ie&&q.cancelable&&q.preventDefault()}}},[]),S=I.useCallback(function(U,q,Q,J){var Y={name:U,delta:q,target:Q,should:J,shadowParent:yH(Q)};e.current.push(Y),setTimeout(function(){e.current=e.current.filter(function(ie){return ie!==Y})},1)},[]),A=I.useCallback(function(U){r.current=gv(U),l.current=void 0},[]),j=I.useCallback(function(U){S(U.type,MA(U),U.target,w(U,t.lockRef.current))},[]),O=I.useCallback(function(U){S(U.type,gv(U),U.target,w(U,t.lockRef.current))},[]);I.useEffect(function(){return mm.push(f),t.setCallbacks({onScrollCapture:j,onWheelCapture:j,onTouchMoveCapture:O}),document.addEventListener("wheel",s,pm),document.addEventListener("touchmove",s,pm),document.addEventListener("touchstart",A,pm),function(){mm=mm.filter(function(U){return U!==f}),document.removeEventListener("wheel",s,pm),document.removeEventListener("touchmove",s,pm),document.removeEventListener("touchstart",A,pm)}},[]);var L=t.removeScrollBar,W=t.inert;return I.createElement(I.Fragment,null,W?I.createElement(f,{styles:pH(u)}):null,L?I.createElement(sH,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function yH(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const _H=qG(kN,gH);var F0=I.forwardRef(function(t,e){return I.createElement(B0,Xc({},t,{ref:e,sideCar:_H}))});F0.classNames=B0.classNames;var vH=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},gm=new WeakMap,yv=new WeakMap,_v={},zw=0,RN=function(t){return t&&(t.host||RN(t.parentNode))},xH=function(t,e){return e.map(function(r){if(t.contains(r))return r;var l=RN(r);return l&&t.contains(l)?l:(console.error("aria-hidden",r,"in not contained inside",t,". Doing nothing"),null)}).filter(function(r){return!!r})},wH=function(t,e,r,l){var u=xH(e,Array.isArray(t)?t:[t]);_v[r]||(_v[r]=new WeakMap);var f=_v[r],g=[],w=new Set,s=new Set(u),S=function(j){!j||w.has(j)||(w.add(j),S(j.parentNode))};u.forEach(S);var A=function(j){!j||s.has(j)||Array.prototype.forEach.call(j.children,function(O){if(w.has(O))A(O);else try{var L=O.getAttribute(l),W=L!==null&&L!=="false",U=(gm.get(O)||0)+1,q=(f.get(O)||0)+1;gm.set(O,U),f.set(O,q),g.push(O),U===1&&W&&yv.set(O,!0),q===1&&O.setAttribute(r,"true"),W||O.setAttribute(l,"true")}catch(Q){console.error("aria-hidden: cannot operate on ",O,Q)}})};return A(e),w.clear(),zw++,function(){g.forEach(function(j){var O=gm.get(j)-1,L=f.get(j)-1;gm.set(j,O),f.set(j,L),O||(yv.has(j)||j.removeAttribute(l),yv.delete(j)),L||j.removeAttribute(r)}),zw--,zw||(gm=new WeakMap,gm=new WeakMap,yv=new WeakMap,_v={})}},AT=function(t,e,r){r===void 0&&(r="data-aria-hidden");var l=Array.from(Array.isArray(t)?t:[t]),u=vH(t);return u?(l.push.apply(l,Array.from(u.querySelectorAll("[aria-live], script"))),wH(l,u,r,"aria-hidden")):function(){return null}};function bH(t){const e=TH(t),r=I.forwardRef((l,u)=>{const{children:f,...g}=l,w=I.Children.toArray(f),s=w.find(EH);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}function TH(t){const e=I.forwardRef((r,l)=>{const{children:u,...f}=r;if(I.isValidElement(u)){const g=kH(u),w=CH(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var SH=Symbol("radix.slottable");function EH(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===SH}function CH(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function kH(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var V0="Dialog",[NN]=gl(V0),[AH,ic]=NN(V0),jN=t=>{const{__scopeDialog:e,children:r,open:l,defaultOpen:u,onOpenChange:f,modal:g=!0}=t,w=I.useRef(null),s=I.useRef(null),[S,A]=hh({prop:l,defaultProp:u??!1,onChange:f,caller:V0});return v.jsx(AH,{scope:e,triggerRef:w,contentRef:s,contentId:Qc(),titleId:Qc(),descriptionId:Qc(),open:S,onOpenChange:A,onOpenToggle:I.useCallback(()=>A(j=>!j),[A]),modal:g,children:r})};jN.displayName=V0;var DN="DialogTrigger",LN=I.forwardRef((t,e)=>{const{__scopeDialog:r,...l}=t,u=ic(DN,r),f=ar(e,u.triggerRef);return v.jsx(In.button,{type:"button","aria-haspopup":"dialog","aria-expanded":u.open,"aria-controls":u.contentId,"data-state":IT(u.open),...l,ref:f,onClick:Xt(t.onClick,u.onOpenToggle)})});LN.displayName=DN;var PT="DialogPortal",[PH,ON]=NN(PT,{forceMount:void 0}),zN=t=>{const{__scopeDialog:e,forceMount:r,children:l,container:u}=t,f=ic(PT,e);return v.jsx(PH,{scope:e,forceMount:r,children:I.Children.map(l,g=>v.jsx(Ho,{present:r||f.open,children:v.jsx(Xy,{asChild:!0,container:u,children:g})}))})};zN.displayName=PT;var Jv="DialogOverlay",BN=I.forwardRef((t,e)=>{const r=ON(Jv,t.__scopeDialog),{forceMount:l=r.forceMount,...u}=t,f=ic(Jv,t.__scopeDialog);return f.modal?v.jsx(Ho,{present:l||f.open,children:v.jsx(IH,{...u,ref:e})}):null});BN.displayName=Jv;var MH=bH("DialogOverlay.RemoveScroll"),IH=I.forwardRef((t,e)=>{const{__scopeDialog:r,...l}=t,u=ic(Jv,r);return v.jsx(F0,{as:MH,allowPinchZoom:!0,shards:[u.contentRef],children:v.jsx(In.div,{"data-state":IT(u.open),...l,ref:e,style:{pointerEvents:"auto",...l.style}})})}),Xf="DialogContent",FN=I.forwardRef((t,e)=>{const r=ON(Xf,t.__scopeDialog),{forceMount:l=r.forceMount,...u}=t,f=ic(Xf,t.__scopeDialog);return v.jsx(Ho,{present:l||f.open,children:f.modal?v.jsx(RH,{...u,ref:e}):v.jsx(NH,{...u,ref:e})})});FN.displayName=Xf;var RH=I.forwardRef((t,e)=>{const r=ic(Xf,t.__scopeDialog),l=I.useRef(null),u=ar(e,r.contentRef,l);return I.useEffect(()=>{const f=l.current;if(f)return AT(f)},[]),v.jsx(VN,{...t,ref:u,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Xt(t.onCloseAutoFocus,f=>{f.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:Xt(t.onPointerDownOutside,f=>{const g=f.detail.originalEvent,w=g.button===0&&g.ctrlKey===!0;(g.button===2||w)&&f.preventDefault()}),onFocusOutside:Xt(t.onFocusOutside,f=>f.preventDefault())})}),NH=I.forwardRef((t,e)=>{const r=ic(Xf,t.__scopeDialog),l=I.useRef(!1),u=I.useRef(!1);return v.jsx(VN,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{t.onCloseAutoFocus?.(f),f.defaultPrevented||(l.current||r.triggerRef.current?.focus(),f.preventDefault()),l.current=!1,u.current=!1},onInteractOutside:f=>{t.onInteractOutside?.(f),f.defaultPrevented||(l.current=!0,f.detail.originalEvent.type==="pointerdown"&&(u.current=!0));const g=f.target;r.triggerRef.current?.contains(g)&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&u.current&&f.preventDefault()}})}),VN=I.forwardRef((t,e)=>{const{__scopeDialog:r,trapFocus:l,onOpenAutoFocus:u,onCloseAutoFocus:f,...g}=t,w=ic(Xf,r),s=I.useRef(null),S=ar(e,s);return kT(),v.jsxs(v.Fragment,{children:[v.jsx(z0,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:u,onUnmountAutoFocus:f,children:v.jsx(qm,{role:"dialog",id:w.contentId,"aria-describedby":w.descriptionId,"aria-labelledby":w.titleId,"data-state":IT(w.open),...g,ref:S,onDismiss:()=>w.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(jH,{titleId:w.titleId}),v.jsx(LH,{contentRef:s,descriptionId:w.descriptionId})]})]})}),MT="DialogTitle",UN=I.forwardRef((t,e)=>{const{__scopeDialog:r,...l}=t,u=ic(MT,r);return v.jsx(In.h2,{id:u.titleId,...l,ref:e})});UN.displayName=MT;var $N="DialogDescription",GN=I.forwardRef((t,e)=>{const{__scopeDialog:r,...l}=t,u=ic($N,r);return v.jsx(In.p,{id:u.descriptionId,...l,ref:e})});GN.displayName=$N;var HN="DialogClose",qN=I.forwardRef((t,e)=>{const{__scopeDialog:r,...l}=t,u=ic(HN,r);return v.jsx(In.button,{type:"button",...l,ref:e,onClick:Xt(t.onClick,()=>u.onOpenChange(!1))})});qN.displayName=HN;function IT(t){return t?"open":"closed"}var WN="DialogTitleWarning",[xX,ZN]=oL(WN,{contentName:Xf,titleName:MT,docsSlug:"dialog"}),jH=({titleId:t})=>{const e=ZN(WN),r=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return I.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},DH="DialogDescriptionWarning",LH=({contentRef:t,descriptionId:e})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ZN(DH).contentName}}.`;return I.useEffect(()=>{const u=t.current?.getAttribute("aria-describedby");e&&u&&(document.getElementById(e)||console.warn(l))},[l,t,e]),null},KN=jN,OH=LN,XN=zN,U0=BN,$0=FN,G0=UN,H0=GN,YN=qN;const q0=KN,zH=XN,JN=I.forwardRef(({className:t,...e},r)=>v.jsx(U0,{ref:r,className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));JN.displayName=U0.displayName;const a_=I.forwardRef(({className:t,children:e,...r},l)=>v.jsxs(zH,{children:[v.jsx(JN,{}),v.jsxs($0,{ref:l,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[e,v.jsxs(YN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[v.jsx(xi,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));a_.displayName=$0.displayName;const W0=({className:t,...e})=>v.jsx("div",{className:cn("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});W0.displayName="DialogHeader";const RT=({className:t,...e})=>v.jsx("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});RT.displayName="DialogFooter";const l_=I.forwardRef(({className:t,...e},r)=>v.jsx(G0,{ref:r,className:cn("text-lg font-semibold leading-none tracking-tight",t),...e}));l_.displayName=G0.displayName;const BH=I.forwardRef(({className:t,...e},r)=>v.jsx(H0,{ref:r,className:cn("text-sm text-muted-foreground",t),...e}));BH.displayName=H0.displayName;var Bw="rovingFocusGroup.onEntryFocus",FH={bubbles:!1,cancelable:!0},c_="RovingFocusGroup",[Wb,QN,VH]=c0(c_),[UH,Z0]=gl(c_,[VH]),[$H,GH]=UH(c_),ej=I.forwardRef((t,e)=>v.jsx(Wb.Provider,{scope:t.__scopeRovingFocusGroup,children:v.jsx(Wb.Slot,{scope:t.__scopeRovingFocusGroup,children:v.jsx(HH,{...t,ref:e})})}));ej.displayName=c_;var HH=I.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,orientation:l,loop:u=!1,dir:f,currentTabStopId:g,defaultCurrentTabStopId:w,onCurrentTabStopIdChange:s,onEntryFocus:S,preventScrollOnEntryFocus:A=!1,...j}=t,O=I.useRef(null),L=ar(e,O),W=o_(f),[U,q]=hh({prop:g,defaultProp:w??null,onChange:s,caller:c_}),[Q,J]=I.useState(!1),Y=$i(S),ie=QN(r),_e=I.useRef(!1),[Se,Ie]=I.useState(0);return I.useEffect(()=>{const Ue=O.current;if(Ue)return Ue.addEventListener(Bw,Y),()=>Ue.removeEventListener(Bw,Y)},[Y]),v.jsx($H,{scope:r,orientation:l,dir:W,loop:u,currentTabStopId:U,onItemFocus:I.useCallback(Ue=>q(Ue),[q]),onItemShiftTab:I.useCallback(()=>J(!0),[]),onFocusableItemAdd:I.useCallback(()=>Ie(Ue=>Ue+1),[]),onFocusableItemRemove:I.useCallback(()=>Ie(Ue=>Ue-1),[]),children:v.jsx(In.div,{tabIndex:Q||Se===0?-1:0,"data-orientation":l,...j,ref:L,style:{outline:"none",...t.style},onMouseDown:Xt(t.onMouseDown,()=>{_e.current=!0}),onFocus:Xt(t.onFocus,Ue=>{const Je=!_e.current;if(Ue.target===Ue.currentTarget&&Je&&!Q){const Me=new CustomEvent(Bw,FH);if(Ue.currentTarget.dispatchEvent(Me),!Me.defaultPrevented){const lt=ie().filter(it=>it.focusable),ft=lt.find(it=>it.active),mt=lt.find(it=>it.id===U),Lt=[ft,mt,...lt].filter(Boolean).map(it=>it.ref.current);rj(Lt,A)}}_e.current=!1}),onBlur:Xt(t.onBlur,()=>J(!1))})})}),tj="RovingFocusGroupItem",nj=I.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:r,focusable:l=!0,active:u=!1,tabStopId:f,children:g,...w}=t,s=Qc(),S=f||s,A=GH(tj,r),j=A.currentTabStopId===S,O=QN(r),{onFocusableItemAdd:L,onFocusableItemRemove:W,currentTabStopId:U}=A;return I.useEffect(()=>{if(l)return L(),()=>W()},[l,L,W]),v.jsx(Wb.ItemSlot,{scope:r,id:S,focusable:l,active:u,children:v.jsx(In.span,{tabIndex:j?0:-1,"data-orientation":A.orientation,...w,ref:e,onMouseDown:Xt(t.onMouseDown,q=>{l?A.onItemFocus(S):q.preventDefault()}),onFocus:Xt(t.onFocus,()=>A.onItemFocus(S)),onKeyDown:Xt(t.onKeyDown,q=>{if(q.key==="Tab"&&q.shiftKey){A.onItemShiftTab();return}if(q.target!==q.currentTarget)return;const Q=ZH(q,A.orientation,A.dir);if(Q!==void 0){if(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)return;q.preventDefault();let Y=O().filter(ie=>ie.focusable).map(ie=>ie.ref.current);if(Q==="last")Y.reverse();else if(Q==="prev"||Q==="next"){Q==="prev"&&Y.reverse();const ie=Y.indexOf(q.currentTarget);Y=A.loop?KH(Y,ie+1):Y.slice(ie+1)}setTimeout(()=>rj(Y))}}),children:typeof g=="function"?g({isCurrentTabStop:j,hasTabStop:U!=null}):g})})});nj.displayName=tj;var qH={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function WH(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ZH(t,e,r){const l=WH(t.key,r);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return qH[l]}function rj(t,e=!1){const r=document.activeElement;for(const l of t)if(l===r||(l.focus({preventScroll:e}),document.activeElement!==r))return}function KH(t,e){return t.map((r,l)=>t[(e+l)%t.length])}var ij=ej,sj=nj,K0="Tabs",[XH]=gl(K0,[Z0]),oj=Z0(),[YH,NT]=XH(K0),aj=I.forwardRef((t,e)=>{const{__scopeTabs:r,value:l,onValueChange:u,defaultValue:f,orientation:g="horizontal",dir:w,activationMode:s="automatic",...S}=t,A=o_(w),[j,O]=hh({prop:l,onChange:u,defaultProp:f??"",caller:K0});return v.jsx(YH,{scope:r,baseId:Qc(),value:j,onValueChange:O,orientation:g,dir:A,activationMode:s,children:v.jsx(In.div,{dir:A,"data-orientation":g,...S,ref:e})})});aj.displayName=K0;var lj="TabsList",cj=I.forwardRef((t,e)=>{const{__scopeTabs:r,loop:l=!0,...u}=t,f=NT(lj,r),g=oj(r);return v.jsx(ij,{asChild:!0,...g,orientation:f.orientation,dir:f.dir,loop:l,children:v.jsx(In.div,{role:"tablist","aria-orientation":f.orientation,...u,ref:e})})});cj.displayName=lj;var uj="TabsTrigger",dj=I.forwardRef((t,e)=>{const{__scopeTabs:r,value:l,disabled:u=!1,...f}=t,g=NT(uj,r),w=oj(r),s=pj(g.baseId,l),S=mj(g.baseId,l),A=l===g.value;return v.jsx(sj,{asChild:!0,...w,focusable:!u,active:A,children:v.jsx(In.button,{type:"button",role:"tab","aria-selected":A,"aria-controls":S,"data-state":A?"active":"inactive","data-disabled":u?"":void 0,disabled:u,id:s,...f,ref:e,onMouseDown:Xt(t.onMouseDown,j=>{!u&&j.button===0&&j.ctrlKey===!1?g.onValueChange(l):j.preventDefault()}),onKeyDown:Xt(t.onKeyDown,j=>{[" ","Enter"].includes(j.key)&&g.onValueChange(l)}),onFocus:Xt(t.onFocus,()=>{const j=g.activationMode!=="manual";!A&&!u&&j&&g.onValueChange(l)})})})});dj.displayName=uj;var hj="TabsContent",fj=I.forwardRef((t,e)=>{const{__scopeTabs:r,value:l,forceMount:u,children:f,...g}=t,w=NT(hj,r),s=pj(w.baseId,l),S=mj(w.baseId,l),A=l===w.value,j=I.useRef(A);return I.useEffect(()=>{const O=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(O)},[]),v.jsx(Ho,{present:u||A,children:({present:O})=>v.jsx(In.div,{"data-state":A?"active":"inactive","data-orientation":w.orientation,role:"tabpanel","aria-labelledby":s,hidden:!O,id:S,tabIndex:0,...g,ref:e,style:{...t.style,animationDuration:j.current?"0s":void 0},children:O&&f})})});fj.displayName=hj;function pj(t,e){return`${t}-trigger-${e}`}function mj(t,e){return`${t}-content-${e}`}var JH=aj,gj=cj,yj=dj,_j=fj;const Gy=JH,Fm=I.forwardRef(({className:t,...e},r)=>v.jsx(gj,{ref:r,className:cn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));Fm.displayName=gj.displayName;const as=I.forwardRef(({className:t,...e},r)=>v.jsx(yj,{ref:r,className:cn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...e}));as.displayName=yj.displayName;const Co=I.forwardRef(({className:t,...e},r)=>v.jsx(_j,{ref:r,className:cn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Co.displayName=_j.displayName;const yh=I.forwardRef(({className:t,...e},r)=>v.jsx("textarea",{className:cn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...e}));yh.displayName="Textarea";function QH(t,e=[]){let r=[];function l(f,g){const w=I.createContext(g);w.displayName=f+"Context";const s=r.length;r=[...r,g];const S=j=>{const{scope:O,children:L,...W}=j,U=O?.[t]?.[s]||w,q=I.useMemo(()=>W,Object.values(W));return v.jsx(U.Provider,{value:q,children:L})};S.displayName=f+"Provider";function A(j,O){const L=O?.[t]?.[s]||w,W=I.useContext(L);if(W)return W;if(g!==void 0)return g;throw new Error(`\`${j}\` must be used within \`${f}\``)}return[S,A]}const u=()=>{const f=r.map(g=>I.createContext(g));return function(w){const s=w?.[t]||f;return I.useMemo(()=>({[`__scope${t}`]:{...w,[t]:s}}),[w,s])}};return u.scopeName=t,[l,eq(u,...e)]}function eq(...t){const e=t[0];if(t.length===1)return e;const r=()=>{const l=t.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const g=l.reduce((w,{useScope:s,scopeName:S})=>{const j=s(f)[`__scope${S}`];return{...w,...j}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:g}),[g])}};return r.scopeName=e.scopeName,r}var tq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],jT=tq.reduce((t,e)=>{const r=wT(`Primitive.${e}`),l=I.forwardRef((u,f)=>{const{asChild:g,...w}=u,s=g?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(s,{...w,ref:f})});return l.displayName=`Primitive.${e}`,{...t,[e]:l}},{}),Fw={exports:{}},Vw={};var RA;function nq(){if(RA)return Vw;RA=1;var t=a0();function e(j,O){return j===O&&(j!==0||1/j===1/O)||j!==j&&O!==O}var r=typeof Object.is=="function"?Object.is:e,l=t.useState,u=t.useEffect,f=t.useLayoutEffect,g=t.useDebugValue;function w(j,O){var L=O(),W=l({inst:{value:L,getSnapshot:O}}),U=W[0].inst,q=W[1];return f(function(){U.value=L,U.getSnapshot=O,s(U)&&q({inst:U})},[j,L,O]),u(function(){return s(U)&&q({inst:U}),j(function(){s(U)&&q({inst:U})})},[j]),g(L),L}function s(j){var O=j.getSnapshot;j=j.value;try{var L=O();return!r(j,L)}catch{return!0}}function S(j,O){return O()}var A=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?S:w;return Vw.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:A,Vw}var NA;function rq(){return NA||(NA=1,Fw.exports=nq()),Fw.exports}var iq=rq();function sq(){return iq.useSyncExternalStore(oq,()=>!0,()=>!1)}function oq(){return()=>{}}var DT="Avatar",[aq]=QH(DT),[lq,vj]=aq(DT),xj=I.forwardRef((t,e)=>{const{__scopeAvatar:r,...l}=t,[u,f]=I.useState("idle");return v.jsx(lq,{scope:r,imageLoadingStatus:u,onImageLoadingStatusChange:f,children:v.jsx(jT.span,{...l,ref:e})})});xj.displayName=DT;var wj="AvatarImage",bj=I.forwardRef((t,e)=>{const{__scopeAvatar:r,src:l,onLoadingStatusChange:u=()=>{},...f}=t,g=vj(wj,r),w=cq(l,f),s=$i(S=>{u(S),g.onImageLoadingStatusChange(S)});return Zi(()=>{w!=="idle"&&s(w)},[w,s]),w==="loaded"?v.jsx(jT.img,{...f,ref:e,src:l}):null});bj.displayName=wj;var Tj="AvatarFallback",Sj=I.forwardRef((t,e)=>{const{__scopeAvatar:r,delayMs:l,...u}=t,f=vj(Tj,r),[g,w]=I.useState(l===void 0);return I.useEffect(()=>{if(l!==void 0){const s=window.setTimeout(()=>w(!0),l);return()=>window.clearTimeout(s)}},[l]),g&&f.imageLoadingStatus!=="loaded"?v.jsx(jT.span,{...u,ref:e}):null});Sj.displayName=Tj;function jA(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function cq(t,{referrerPolicy:e,crossOrigin:r}){const l=sq(),u=I.useRef(null),f=l?(u.current||(u.current=new window.Image),u.current):null,[g,w]=I.useState(()=>jA(f,t));return Zi(()=>{w(jA(f,t))},[f,t]),Zi(()=>{const s=j=>()=>{w(j)};if(!f)return;const S=s("loaded"),A=s("error");return f.addEventListener("load",S),f.addEventListener("error",A),e&&(f.referrerPolicy=e),typeof r=="string"&&(f.crossOrigin=r),()=>{f.removeEventListener("load",S),f.removeEventListener("error",A)}},[f,r,e]),g}var Ej=xj,Cj=bj,kj=Sj;const LT=I.forwardRef(({className:t,...e},r)=>v.jsx(Ej,{ref:r,className:cn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));LT.displayName=Ej.displayName;const Aj=I.forwardRef(({className:t,...e},r)=>v.jsx(Cj,{ref:r,className:cn("aspect-square h-full w-full",t),...e}));Aj.displayName=Cj.displayName;const OT=I.forwardRef(({className:t,...e},r)=>v.jsx(kj,{ref:r,className:cn("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));OT.displayName=kj.displayName;const uq=({storeId:t})=>{const{session:e}=ha(),[r,l]=I.useState([]),[u,f]=I.useState(5),[g,w]=I.useState(""),[s,S]=I.useState(!1),A=async()=>{if(!t)return;const L=String(t),{data:W,error:U}=await Wt.from("location_reviews").select("*").eq("store_id",L).order("created_at",{ascending:!1});W&&l(W)};I.useEffect(()=>{A()},[t]);const j=async()=>{if(!e?.user){Jt.error("Vui lng ng nhp  nh gi!");return}if(!g.trim()){Jt.error("Vui lng nhp ni dung nh gi.");return}S(!0);try{const L=String(t),{error:W}=await Wt.from("location_reviews").insert({store_id:L,user_id:e.user.id,rating:u,comment:g});if(W)throw W;Jt.success("Cm n nh gi ca bn!"),window.dispatchEvent(new CustomEvent("review_updated",{detail:L})),w(""),f(5),A()}catch(L){console.error(L),Jt.error(`Li: ${L.message||"Khng gi c nh gi"}`)}finally{S(!1)}},O=r.length>0?(r.reduce((L,W)=>L+W.rating,0)/r.length).toFixed(1):"0.0";return v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl flex items-center gap-4 border border-orange-100",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("h3",{className:"text-3xl font-black text-orange-600",children:O}),v.jsx("div",{className:"flex gap-0.5 justify-center my-1",children:[1,2,3,4,5].map(L=>v.jsx(Uf,{className:`w-3 h-3 ${L<=Number(O)?"fill-orange-500 text-orange-500":"text-gray-300"}`},L))}),v.jsxs("p",{className:"text-xs text-gray-500",children:[r.length," nh gi"]})]}),v.jsx("div",{className:"flex-1 h-full w-[1px] bg-orange-200 mx-2"}),v.jsx("div",{className:"flex-1 text-sm text-gray-600 italic",children:'"Hy  li nh gi  gip cng ng tm c nhng a im tt nht nh!"'})]}),e?.user?v.jsxs("div",{className:"bg-white border rounded-xl p-4 shadow-sm",children:[v.jsxs("h4",{className:"font-bold text-gray-800 mb-2 flex items-center gap-2",children:[v.jsx(ky,{className:"w-4 h-4"})," Vit nh gi ca bn"]}),v.jsxs("div",{className:"flex gap-1 mb-3",children:[[1,2,3,4,5].map(L=>v.jsx("button",{onClick:()=>f(L),className:"transition-transform hover:scale-110 focus:outline-none",children:v.jsx(Uf,{className:`w-6 h-6 ${L<=u?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},L)),v.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500 pt-1",children:u===5?"Tuyt vi":u===4?"Hi lng":u===3?"Bnh thng":"T"})]}),v.jsx(yh,{placeholder:"Chia s tri nghim ca bn v a im ny...",value:g,onChange:L=>w(L.target.value),className:"min-h-[80px] mb-3 bg-gray-50"}),v.jsx("div",{className:"flex justify-end",children:v.jsxs(vn,{size:"sm",onClick:j,disabled:s,className:"bg-orange-500 hover:bg-orange-600 text-white",children:[s?v.jsx(ls,{className:"w-4 h-4 animate-spin mr-2"}):v.jsx(k5,{className:"w-4 h-4 mr-2"}),s?"ang gi...":"Gi nh gi"]})})]}):v.jsx("div",{className:"text-center p-4 bg-gray-100 rounded-xl text-sm text-gray-500",children:"Vui lng ng nhp  vit nh gi."}),v.jsx("div",{className:"space-y-4",children:r.length===0?v.jsx("p",{className:"text-center text-gray-400 py-4",children:"Cha c nh gi no."}):r.map(L=>v.jsxs("div",{className:"border-b pb-4 last:border-0",children:[v.jsxs("div",{className:"flex justify-between items-start mb-1",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(LT,{className:"w-8 h-8",children:v.jsx(OT,{className:"bg-blue-100 text-blue-600 text-xs",children:"U"})}),v.jsxs("div",{children:[v.jsx("p",{className:"text-sm font-bold text-gray-900",children:"Ngi dng n danh"}),v.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(W=>v.jsx(Uf,{className:`w-3 h-3 ${W<=L.rating?"fill-yellow-400 text-yellow-400":"text-gray-200"}`},W))})]})]}),v.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(L.created_at).toLocaleDateString("vi-VN")})]}),v.jsx("p",{className:"text-sm text-gray-600 pl-10 mt-1",children:L.comment})]},L.id))})]})};var dq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hq=dq.reduce((t,e)=>{const r=wT(`Primitive.${e}`),l=I.forwardRef((u,f)=>{const{asChild:g,...w}=u,s=g?r:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(s,{...w,ref:f})});return l.displayName=`Primitive.${e}`,{...t,[e]:l}},{}),fq="Label",Pj=I.forwardRef((t,e)=>v.jsx(hq.label,{...t,ref:e,onMouseDown:r=>{r.target.closest("button, input, select, textarea")||(t.onMouseDown?.(r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Pj.displayName=fq;var Mj=Pj;const pq=Jy("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),hi=I.forwardRef(({className:t,...e},r)=>v.jsx(Mj,{ref:r,className:cn(pq(),t),...e}));hi.displayName=Mj.displayName;function mq(t){const e=gq(t),r=I.forwardRef((l,u)=>{const{children:f,...g}=l,w=I.Children.toArray(f),s=w.find(_q);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}function gq(t){const e=I.forwardRef((r,l)=>{const{children:u,...f}=r;if(I.isValidElement(u)){const g=xq(u),w=vq(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var yq=Symbol("radix.slottable");function _q(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===yq}function vq(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function xq(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}function Ij(t){const e=I.useRef({value:t,previous:t});return I.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var wq=[" ","Enter","ArrowUp","ArrowDown"],bq=[" ","Enter"],Yf="Select",[X0,Y0,Tq]=c0(Yf),[rg]=gl(Yf,[Tq,Xm]),J0=Xm(),[Sq,bh]=rg(Yf),[Eq,Cq]=rg(Yf),Rj=t=>{const{__scopeSelect:e,children:r,open:l,defaultOpen:u,onOpenChange:f,value:g,defaultValue:w,onValueChange:s,dir:S,name:A,autoComplete:j,disabled:O,required:L,form:W}=t,U=J0(e),[q,Q]=I.useState(null),[J,Y]=I.useState(null),[ie,_e]=I.useState(!1),Se=o_(S),[Ie,Ue]=hh({prop:l,defaultProp:u??!1,onChange:f,caller:Yf}),[Je,Me]=hh({prop:g,defaultProp:w,onChange:s,caller:Yf}),lt=I.useRef(null),ft=q?W||!!q.closest("form"):!0,[mt,gt]=I.useState(new Set),Lt=Array.from(mt).map(it=>it.props.value).join(";");return v.jsx(AM,{...U,children:v.jsxs(Sq,{required:L,scope:e,trigger:q,onTriggerChange:Q,valueNode:J,onValueNodeChange:Y,valueNodeHasChildren:ie,onValueNodeHasChildrenChange:_e,contentId:Qc(),value:Je,onValueChange:Me,open:Ie,onOpenChange:Ue,dir:Se,triggerPointerDownPosRef:lt,disabled:O,children:[v.jsx(X0.Provider,{scope:e,children:v.jsx(Eq,{scope:t.__scopeSelect,onNativeOptionAdd:I.useCallback(it=>{gt(We=>new Set(We).add(it))},[]),onNativeOptionRemove:I.useCallback(it=>{gt(We=>{const Le=new Set(We);return Le.delete(it),Le})},[]),children:r})}),ft?v.jsxs(nD,{"aria-hidden":!0,required:L,tabIndex:-1,name:A,autoComplete:j,value:Je,onChange:it=>Me(it.target.value),disabled:O,form:W,children:[Je===void 0?v.jsx("option",{value:""}):null,Array.from(mt)]},Lt):null]})})};Rj.displayName=Yf;var Nj="SelectTrigger",jj=I.forwardRef((t,e)=>{const{__scopeSelect:r,disabled:l=!1,...u}=t,f=J0(r),g=bh(Nj,r),w=g.disabled||l,s=ar(e,g.onTriggerChange),S=Y0(r),A=I.useRef("touch"),[j,O,L]=iD(U=>{const q=S().filter(Y=>!Y.disabled),Q=q.find(Y=>Y.value===g.value),J=sD(q,U,Q);J!==void 0&&g.onValueChange(J.value)}),W=U=>{w||(g.onOpenChange(!0),L()),U&&(g.triggerPointerDownPosRef.current={x:Math.round(U.pageX),y:Math.round(U.pageY)})};return v.jsx(k1,{asChild:!0,...f,children:v.jsx(In.button,{type:"button",role:"combobox","aria-controls":g.contentId,"aria-expanded":g.open,"aria-required":g.required,"aria-autocomplete":"none",dir:g.dir,"data-state":g.open?"open":"closed",disabled:w,"data-disabled":w?"":void 0,"data-placeholder":rD(g.value)?"":void 0,...u,ref:s,onClick:Xt(u.onClick,U=>{U.currentTarget.focus(),A.current!=="mouse"&&W(U)}),onPointerDown:Xt(u.onPointerDown,U=>{A.current=U.pointerType;const q=U.target;q.hasPointerCapture(U.pointerId)&&q.releasePointerCapture(U.pointerId),U.button===0&&U.ctrlKey===!1&&U.pointerType==="mouse"&&(W(U),U.preventDefault())}),onKeyDown:Xt(u.onKeyDown,U=>{const q=j.current!=="";!(U.ctrlKey||U.altKey||U.metaKey)&&U.key.length===1&&O(U.key),!(q&&U.key===" ")&&wq.includes(U.key)&&(W(),U.preventDefault())})})})});jj.displayName=Nj;var Dj="SelectValue",Lj=I.forwardRef((t,e)=>{const{__scopeSelect:r,className:l,style:u,children:f,placeholder:g="",...w}=t,s=bh(Dj,r),{onValueNodeHasChildrenChange:S}=s,A=f!==void 0,j=ar(e,s.onValueNodeChange);return Zi(()=>{S(A)},[S,A]),v.jsx(In.span,{...w,ref:j,style:{pointerEvents:"none"},children:rD(s.value)?v.jsx(v.Fragment,{children:g}):f})});Lj.displayName=Dj;var kq="SelectIcon",Oj=I.forwardRef((t,e)=>{const{__scopeSelect:r,children:l,...u}=t;return v.jsx(In.span,{"aria-hidden":!0,...u,ref:e,children:l||""})});Oj.displayName=kq;var Aq="SelectPortal",zj=t=>v.jsx(Xy,{asChild:!0,...t});zj.displayName=Aq;var Jf="SelectContent",Bj=I.forwardRef((t,e)=>{const r=bh(Jf,t.__scopeSelect),[l,u]=I.useState();if(Zi(()=>{u(new DocumentFragment)},[]),!r.open){const f=l;return f?xh.createPortal(v.jsx(Fj,{scope:t.__scopeSelect,children:v.jsx(X0.Slot,{scope:t.__scopeSelect,children:v.jsx("div",{children:t.children})})}),f):null}return v.jsx(Vj,{...t,ref:e})});Bj.displayName=Jf;var Ql=10,[Fj,Th]=rg(Jf),Pq="SelectContentImpl",Mq=mq("SelectContent.RemoveScroll"),Vj=I.forwardRef((t,e)=>{const{__scopeSelect:r,position:l="item-aligned",onCloseAutoFocus:u,onEscapeKeyDown:f,onPointerDownOutside:g,side:w,sideOffset:s,align:S,alignOffset:A,arrowPadding:j,collisionBoundary:O,collisionPadding:L,sticky:W,hideWhenDetached:U,avoidCollisions:q,...Q}=t,J=bh(Jf,r),[Y,ie]=I.useState(null),[_e,Se]=I.useState(null),Ie=ar(e,ct=>ie(ct)),[Ue,Je]=I.useState(null),[Me,lt]=I.useState(null),ft=Y0(r),[mt,gt]=I.useState(!1),Lt=I.useRef(!1);I.useEffect(()=>{if(Y)return AT(Y)},[Y]),kT();const it=I.useCallback(ct=>{const[Nt,...xn]=ft().map(sn=>sn.ref.current),[un]=xn.slice(-1),Rn=document.activeElement;for(const sn of ct)if(sn===Rn||(sn?.scrollIntoView({block:"nearest"}),sn===Nt&&_e&&(_e.scrollTop=0),sn===un&&_e&&(_e.scrollTop=_e.scrollHeight),sn?.focus(),document.activeElement!==Rn))return},[ft,_e]),We=I.useCallback(()=>it([Ue,Y]),[it,Ue,Y]);I.useEffect(()=>{mt&&We()},[mt,We]);const{onOpenChange:Le,triggerPointerDownPosRef:we}=J;I.useEffect(()=>{if(Y){let ct={x:0,y:0};const Nt=un=>{ct={x:Math.abs(Math.round(un.pageX)-(we.current?.x??0)),y:Math.abs(Math.round(un.pageY)-(we.current?.y??0))}},xn=un=>{ct.x<=10&&ct.y<=10?un.preventDefault():Y.contains(un.target)||Le(!1),document.removeEventListener("pointermove",Nt),we.current=null};return we.current!==null&&(document.addEventListener("pointermove",Nt),document.addEventListener("pointerup",xn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Nt),document.removeEventListener("pointerup",xn,{capture:!0})}}},[Y,Le,we]),I.useEffect(()=>{const ct=()=>Le(!1);return window.addEventListener("blur",ct),window.addEventListener("resize",ct),()=>{window.removeEventListener("blur",ct),window.removeEventListener("resize",ct)}},[Le]);const[st,ke]=iD(ct=>{const Nt=ft().filter(Rn=>!Rn.disabled),xn=Nt.find(Rn=>Rn.ref.current===document.activeElement),un=sD(Nt,ct,xn);un&&setTimeout(()=>un.ref.current.focus())}),Ve=I.useCallback((ct,Nt,xn)=>{const un=!Lt.current&&!xn;(J.value!==void 0&&J.value===Nt||un)&&(Je(ct),un&&(Lt.current=!0))},[J.value]),bt=I.useCallback(()=>Y?.focus(),[Y]),wt=I.useCallback((ct,Nt,xn)=>{const un=!Lt.current&&!xn;(J.value!==void 0&&J.value===Nt||un)&&lt(ct)},[J.value]),Yt=l==="popper"?Zb:Uj,Mt=Yt===Zb?{side:w,sideOffset:s,align:S,alignOffset:A,arrowPadding:j,collisionBoundary:O,collisionPadding:L,sticky:W,hideWhenDetached:U,avoidCollisions:q}:{};return v.jsx(Fj,{scope:r,content:Y,viewport:_e,onViewportChange:Se,itemRefCallback:Ve,selectedItem:Ue,onItemLeave:bt,itemTextRefCallback:wt,focusSelectedItem:We,selectedItemText:Me,position:l,isPositioned:mt,searchRef:st,children:v.jsx(F0,{as:Mq,allowPinchZoom:!0,children:v.jsx(z0,{asChild:!0,trapped:J.open,onMountAutoFocus:ct=>{ct.preventDefault()},onUnmountAutoFocus:Xt(u,ct=>{J.trigger?.focus({preventScroll:!0}),ct.preventDefault()}),children:v.jsx(qm,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:g,onFocusOutside:ct=>ct.preventDefault(),onDismiss:()=>J.onOpenChange(!1),children:v.jsx(Yt,{role:"listbox",id:J.contentId,"data-state":J.open?"open":"closed",dir:J.dir,onContextMenu:ct=>ct.preventDefault(),...Q,...Mt,onPlaced:()=>gt(!0),ref:Ie,style:{display:"flex",flexDirection:"column",outline:"none",...Q.style},onKeyDown:Xt(Q.onKeyDown,ct=>{const Nt=ct.ctrlKey||ct.altKey||ct.metaKey;if(ct.key==="Tab"&&ct.preventDefault(),!Nt&&ct.key.length===1&&ke(ct.key),["ArrowUp","ArrowDown","Home","End"].includes(ct.key)){let un=ft().filter(Rn=>!Rn.disabled).map(Rn=>Rn.ref.current);if(["ArrowUp","End"].includes(ct.key)&&(un=un.slice().reverse()),["ArrowUp","ArrowDown"].includes(ct.key)){const Rn=ct.target,sn=un.indexOf(Rn);un=un.slice(sn+1)}setTimeout(()=>it(un)),ct.preventDefault()}})})})})})})});Vj.displayName=Pq;var Iq="SelectItemAlignedPosition",Uj=I.forwardRef((t,e)=>{const{__scopeSelect:r,onPlaced:l,...u}=t,f=bh(Jf,r),g=Th(Jf,r),[w,s]=I.useState(null),[S,A]=I.useState(null),j=ar(e,Ie=>A(Ie)),O=Y0(r),L=I.useRef(!1),W=I.useRef(!0),{viewport:U,selectedItem:q,selectedItemText:Q,focusSelectedItem:J}=g,Y=I.useCallback(()=>{if(f.trigger&&f.valueNode&&w&&S&&U&&q&&Q){const Ie=f.trigger.getBoundingClientRect(),Ue=S.getBoundingClientRect(),Je=f.valueNode.getBoundingClientRect(),Me=Q.getBoundingClientRect();if(f.dir!=="rtl"){const Rn=Me.left-Ue.left,sn=Je.left-Rn,kr=Ie.left-sn,vr=Ie.width+kr,Es=Math.max(vr,Ue.width),Jn=window.innerWidth-Ql,Ar=Hb(sn,[Ql,Math.max(Ql,Jn-Es)]);w.style.minWidth=vr+"px",w.style.left=Ar+"px"}else{const Rn=Ue.right-Me.right,sn=window.innerWidth-Je.right-Rn,kr=window.innerWidth-Ie.right-sn,vr=Ie.width+kr,Es=Math.max(vr,Ue.width),Jn=window.innerWidth-Ql,Ar=Hb(sn,[Ql,Math.max(Ql,Jn-Es)]);w.style.minWidth=vr+"px",w.style.right=Ar+"px"}const lt=O(),ft=window.innerHeight-Ql*2,mt=U.scrollHeight,gt=window.getComputedStyle(S),Lt=parseInt(gt.borderTopWidth,10),it=parseInt(gt.paddingTop,10),We=parseInt(gt.borderBottomWidth,10),Le=parseInt(gt.paddingBottom,10),we=Lt+it+mt+Le+We,st=Math.min(q.offsetHeight*5,we),ke=window.getComputedStyle(U),Ve=parseInt(ke.paddingTop,10),bt=parseInt(ke.paddingBottom,10),wt=Ie.top+Ie.height/2-Ql,Yt=ft-wt,Mt=q.offsetHeight/2,ct=q.offsetTop+Mt,Nt=Lt+it+ct,xn=we-Nt;if(Nt<=wt){const Rn=lt.length>0&&q===lt[lt.length-1].ref.current;w.style.bottom="0px";const sn=S.clientHeight-U.offsetTop-U.offsetHeight,kr=Math.max(Yt,Mt+(Rn?bt:0)+sn+We),vr=Nt+kr;w.style.height=vr+"px"}else{const Rn=lt.length>0&&q===lt[0].ref.current;w.style.top="0px";const kr=Math.max(wt,Lt+U.offsetTop+(Rn?Ve:0)+Mt)+xn;w.style.height=kr+"px",U.scrollTop=Nt-wt+U.offsetTop}w.style.margin=`${Ql}px 0`,w.style.minHeight=st+"px",w.style.maxHeight=ft+"px",l?.(),requestAnimationFrame(()=>L.current=!0)}},[O,f.trigger,f.valueNode,w,S,U,q,Q,f.dir,l]);Zi(()=>Y(),[Y]);const[ie,_e]=I.useState();Zi(()=>{S&&_e(window.getComputedStyle(S).zIndex)},[S]);const Se=I.useCallback(Ie=>{Ie&&W.current===!0&&(Y(),J?.(),W.current=!1)},[Y,J]);return v.jsx(Nq,{scope:r,contentWrapper:w,shouldExpandOnScrollRef:L,onScrollButtonChange:Se,children:v.jsx("div",{ref:s,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ie},children:v.jsx(In.div,{...u,ref:j,style:{boxSizing:"border-box",maxHeight:"100%",...u.style}})})})});Uj.displayName=Iq;var Rq="SelectPopperPosition",Zb=I.forwardRef((t,e)=>{const{__scopeSelect:r,align:l="start",collisionPadding:u=Ql,...f}=t,g=J0(r);return v.jsx(A1,{...g,...f,ref:e,align:l,collisionPadding:u,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Zb.displayName=Rq;var[Nq,zT]=rg(Jf,{}),Kb="SelectViewport",$j=I.forwardRef((t,e)=>{const{__scopeSelect:r,nonce:l,...u}=t,f=Th(Kb,r),g=zT(Kb,r),w=ar(e,f.onViewportChange),s=I.useRef(0);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),v.jsx(X0.Slot,{scope:r,children:v.jsx(In.div,{"data-radix-select-viewport":"",role:"presentation",...u,ref:w,style:{position:"relative",flex:1,overflow:"hidden auto",...u.style},onScroll:Xt(u.onScroll,S=>{const A=S.currentTarget,{contentWrapper:j,shouldExpandOnScrollRef:O}=g;if(O?.current&&j){const L=Math.abs(s.current-A.scrollTop);if(L>0){const W=window.innerHeight-Ql*2,U=parseFloat(j.style.minHeight),q=parseFloat(j.style.height),Q=Math.max(U,q);if(Q<W){const J=Q+L,Y=Math.min(W,J),ie=J-Y;j.style.height=Y+"px",j.style.bottom==="0px"&&(A.scrollTop=ie>0?ie:0,j.style.justifyContent="flex-end")}}}s.current=A.scrollTop})})})]})});$j.displayName=Kb;var Gj="SelectGroup",[jq,Dq]=rg(Gj),Lq=I.forwardRef((t,e)=>{const{__scopeSelect:r,...l}=t,u=Qc();return v.jsx(jq,{scope:r,id:u,children:v.jsx(In.div,{role:"group","aria-labelledby":u,...l,ref:e})})});Lq.displayName=Gj;var Hj="SelectLabel",qj=I.forwardRef((t,e)=>{const{__scopeSelect:r,...l}=t,u=Dq(Hj,r);return v.jsx(In.div,{id:u.id,...l,ref:e})});qj.displayName=Hj;var Qv="SelectItem",[Oq,Wj]=rg(Qv),Zj=I.forwardRef((t,e)=>{const{__scopeSelect:r,value:l,disabled:u=!1,textValue:f,...g}=t,w=bh(Qv,r),s=Th(Qv,r),S=w.value===l,[A,j]=I.useState(f??""),[O,L]=I.useState(!1),W=ar(e,J=>s.itemRefCallback?.(J,l,u)),U=Qc(),q=I.useRef("touch"),Q=()=>{u||(w.onValueChange(l),w.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return v.jsx(Oq,{scope:r,value:l,disabled:u,textId:U,isSelected:S,onItemTextChange:I.useCallback(J=>{j(Y=>Y||(J?.textContent??"").trim())},[]),children:v.jsx(X0.ItemSlot,{scope:r,value:l,disabled:u,textValue:A,children:v.jsx(In.div,{role:"option","aria-labelledby":U,"data-highlighted":O?"":void 0,"aria-selected":S&&O,"data-state":S?"checked":"unchecked","aria-disabled":u||void 0,"data-disabled":u?"":void 0,tabIndex:u?void 0:-1,...g,ref:W,onFocus:Xt(g.onFocus,()=>L(!0)),onBlur:Xt(g.onBlur,()=>L(!1)),onClick:Xt(g.onClick,()=>{q.current!=="mouse"&&Q()}),onPointerUp:Xt(g.onPointerUp,()=>{q.current==="mouse"&&Q()}),onPointerDown:Xt(g.onPointerDown,J=>{q.current=J.pointerType}),onPointerMove:Xt(g.onPointerMove,J=>{q.current=J.pointerType,u?s.onItemLeave?.():q.current==="mouse"&&J.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Xt(g.onPointerLeave,J=>{J.currentTarget===document.activeElement&&s.onItemLeave?.()}),onKeyDown:Xt(g.onKeyDown,J=>{s.searchRef?.current!==""&&J.key===" "||(bq.includes(J.key)&&Q(),J.key===" "&&J.preventDefault())})})})})});Zj.displayName=Qv;var cy="SelectItemText",Kj=I.forwardRef((t,e)=>{const{__scopeSelect:r,className:l,style:u,...f}=t,g=bh(cy,r),w=Th(cy,r),s=Wj(cy,r),S=Cq(cy,r),[A,j]=I.useState(null),O=ar(e,Q=>j(Q),s.onItemTextChange,Q=>w.itemTextRefCallback?.(Q,s.value,s.disabled)),L=A?.textContent,W=I.useMemo(()=>v.jsx("option",{value:s.value,disabled:s.disabled,children:L},s.value),[s.disabled,s.value,L]),{onNativeOptionAdd:U,onNativeOptionRemove:q}=S;return Zi(()=>(U(W),()=>q(W)),[U,q,W]),v.jsxs(v.Fragment,{children:[v.jsx(In.span,{id:s.textId,...f,ref:O}),s.isSelected&&g.valueNode&&!g.valueNodeHasChildren?xh.createPortal(f.children,g.valueNode):null]})});Kj.displayName=cy;var Xj="SelectItemIndicator",Yj=I.forwardRef((t,e)=>{const{__scopeSelect:r,...l}=t;return Wj(Xj,r).isSelected?v.jsx(In.span,{"aria-hidden":!0,...l,ref:e}):null});Yj.displayName=Xj;var Xb="SelectScrollUpButton",Jj=I.forwardRef((t,e)=>{const r=Th(Xb,t.__scopeSelect),l=zT(Xb,t.__scopeSelect),[u,f]=I.useState(!1),g=ar(e,l.onScrollButtonChange);return Zi(()=>{if(r.viewport&&r.isPositioned){let w=function(){const S=s.scrollTop>0;f(S)};const s=r.viewport;return w(),s.addEventListener("scroll",w),()=>s.removeEventListener("scroll",w)}},[r.viewport,r.isPositioned]),u?v.jsx(eD,{...t,ref:g,onAutoScroll:()=>{const{viewport:w,selectedItem:s}=r;w&&s&&(w.scrollTop=w.scrollTop-s.offsetHeight)}}):null});Jj.displayName=Xb;var Yb="SelectScrollDownButton",Qj=I.forwardRef((t,e)=>{const r=Th(Yb,t.__scopeSelect),l=zT(Yb,t.__scopeSelect),[u,f]=I.useState(!1),g=ar(e,l.onScrollButtonChange);return Zi(()=>{if(r.viewport&&r.isPositioned){let w=function(){const S=s.scrollHeight-s.clientHeight,A=Math.ceil(s.scrollTop)<S;f(A)};const s=r.viewport;return w(),s.addEventListener("scroll",w),()=>s.removeEventListener("scroll",w)}},[r.viewport,r.isPositioned]),u?v.jsx(eD,{...t,ref:g,onAutoScroll:()=>{const{viewport:w,selectedItem:s}=r;w&&s&&(w.scrollTop=w.scrollTop+s.offsetHeight)}}):null});Qj.displayName=Yb;var eD=I.forwardRef((t,e)=>{const{__scopeSelect:r,onAutoScroll:l,...u}=t,f=Th("SelectScrollButton",r),g=I.useRef(null),w=Y0(r),s=I.useCallback(()=>{g.current!==null&&(window.clearInterval(g.current),g.current=null)},[]);return I.useEffect(()=>()=>s(),[s]),Zi(()=>{w().find(A=>A.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[w]),v.jsx(In.div,{"aria-hidden":!0,...u,ref:e,style:{flexShrink:0,...u.style},onPointerDown:Xt(u.onPointerDown,()=>{g.current===null&&(g.current=window.setInterval(l,50))}),onPointerMove:Xt(u.onPointerMove,()=>{f.onItemLeave?.(),g.current===null&&(g.current=window.setInterval(l,50))}),onPointerLeave:Xt(u.onPointerLeave,()=>{s()})})}),zq="SelectSeparator",tD=I.forwardRef((t,e)=>{const{__scopeSelect:r,...l}=t;return v.jsx(In.div,{"aria-hidden":!0,...l,ref:e})});tD.displayName=zq;var Jb="SelectArrow",Bq=I.forwardRef((t,e)=>{const{__scopeSelect:r,...l}=t,u=J0(r),f=bh(Jb,r),g=Th(Jb,r);return f.open&&g.position==="popper"?v.jsx(P1,{...u,...l,ref:e}):null});Bq.displayName=Jb;var Fq="SelectBubbleInput",nD=I.forwardRef(({__scopeSelect:t,value:e,...r},l)=>{const u=I.useRef(null),f=ar(l,u),g=Ij(e);return I.useEffect(()=>{const w=u.current;if(!w)return;const s=window.HTMLSelectElement.prototype,A=Object.getOwnPropertyDescriptor(s,"value").set;if(g!==e&&A){const j=new Event("change",{bubbles:!0});A.call(w,e),w.dispatchEvent(j)}},[g,e]),v.jsx(In.select,{...r,style:{...yP,...r.style},ref:f,defaultValue:e})});nD.displayName=Fq;function rD(t){return t===""||t===void 0}function iD(t){const e=$i(t),r=I.useRef(""),l=I.useRef(0),u=I.useCallback(g=>{const w=r.current+g;e(w),(function s(S){r.current=S,window.clearTimeout(l.current),S!==""&&(l.current=window.setTimeout(()=>s(""),1e3))})(w)},[e]),f=I.useCallback(()=>{r.current="",window.clearTimeout(l.current)},[]);return I.useEffect(()=>()=>window.clearTimeout(l.current),[]),[r,u,f]}function sD(t,e,r){const u=e.length>1&&Array.from(e).every(S=>S===e[0])?e[0]:e,f=r?t.indexOf(r):-1;let g=Vq(t,Math.max(f,0));u.length===1&&(g=g.filter(S=>S!==r));const s=g.find(S=>S.textValue.toLowerCase().startsWith(u.toLowerCase()));return s!==r?s:void 0}function Vq(t,e){return t.map((r,l)=>t[(e+l)%t.length])}var Uq=Rj,oD=jj,$q=Lj,Gq=Oj,Hq=zj,aD=Bj,qq=$j,lD=qj,cD=Zj,Wq=Kj,Zq=Yj,uD=Jj,dD=Qj,hD=tD;const fD=Uq,pD=$q,BT=I.forwardRef(({className:t,children:e,...r},l)=>v.jsxs(oD,{ref:l,className:cn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[e,v.jsx(Gq,{asChild:!0,children:v.jsx(Hf,{className:"h-4 w-4 opacity-50"})})]}));BT.displayName=oD.displayName;const mD=I.forwardRef(({className:t,...e},r)=>v.jsx(uD,{ref:r,className:cn("flex cursor-default items-center justify-center py-1",t),...e,children:v.jsx(Lm,{className:"h-4 w-4"})}));mD.displayName=uD.displayName;const gD=I.forwardRef(({className:t,...e},r)=>v.jsx(dD,{ref:r,className:cn("flex cursor-default items-center justify-center py-1",t),...e,children:v.jsx(Hf,{className:"h-4 w-4"})}));gD.displayName=dD.displayName;const FT=I.forwardRef(({className:t,children:e,position:r="popper",...l},u)=>v.jsx(Hq,{children:v.jsxs(aD,{ref:u,className:cn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...l,children:[v.jsx(mD,{}),v.jsx(qq,{className:cn("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),v.jsx(gD,{})]})}));FT.displayName=aD.displayName;const Kq=I.forwardRef(({className:t,...e},r)=>v.jsx(lD,{ref:r,className:cn("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));Kq.displayName=lD.displayName;const ul=I.forwardRef(({className:t,children:e,...r},l)=>v.jsxs(cD,{ref:l,className:cn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...r,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(Zq,{children:v.jsx(tp,{className:"h-4 w-4"})})}),v.jsx(Wq,{children:e})]}));ul.displayName=cD.displayName;const Xq=I.forwardRef(({className:t,...e},r)=>v.jsx(hD,{ref:r,className:cn("-mx-1 my-1 h-px bg-muted",t),...e}));Xq.displayName=hD.displayName;const Yq="modulepreload",Jq=function(t){return"/"+t},DA={},Qq=function(e,r,l){let u=Promise.resolve();if(r&&r.length>0){let S=function(A){return Promise.all(A.map(j=>Promise.resolve(j).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};var g=S;document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),s=w?.nonce||w?.getAttribute("nonce");u=S(r.map(A=>{if(A=Jq(A),A in DA)return;DA[A]=!0;const j=A.endsWith(".css"),O=j?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${O}`))return;const L=document.createElement("link");if(L.rel=j?"stylesheet":Yq,j||(L.as="script"),L.crossOrigin="",L.href=A,s&&L.setAttribute("nonce",s),document.head.appendChild(L),j)return new Promise((W,U)=>{L.addEventListener("load",W),L.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${A}`)))})}))}function f(w){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=w,window.dispatchEvent(s),!s.defaultPrevented)throw w}return u.then(w=>{for(const s of w||[])s.status==="rejected"&&f(s.reason);return e().catch(f)})},eW=I.createContext(null);function tW(t,e){const r=Array.isArray(t)?t[0]:t?t.x:0,l=Array.isArray(t)?t[1]:t?t.y:0,u=Array.isArray(e)?e[0]:e?e.x:0,f=Array.isArray(e)?e[1]:e?e.y:0;return r===u&&l===f}function Ju(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Ju(t[r],e[r]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),l=Object.keys(e);if(r.length!==l.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!Ju(t[u],e[u]))return!1;return!0}return!1}function nW(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function LA(t,e){if(!t.getProjection)return;const r=t.getProjection(),l=e.getProjection();Ju(r,l)||e.setProjection(r)}function OA(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function zA(t,e){const r=e.viewState||e;let l=!1;if("longitude"in r&&"latitude"in r){const u=t.center;t.center=new u.constructor(r.longitude,r.latitude),l=l||u!==t.center}if("zoom"in r){const u=t.zoom;t.zoom=r.zoom,l=l||u!==t.zoom}if("bearing"in r){const u=t.bearing;t.bearing=r.bearing,l=l||u!==t.bearing}if("pitch"in r){const u=t.pitch;t.pitch=r.pitch,l=l||u!==t.pitch}return r.padding&&!t.isPaddingEqual(r.padding)&&(l=!0,t.padding=r.padding),l}const rW=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function BA(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const l of t.layers)e[l.id]=l;const r=t.layers.map(l=>{let u=null;"interactive"in l&&(u=Object.assign({},l),delete u.interactive);const f=e[l.ref];if(f){u=u||Object.assign({},l),delete u.ref;for(const g of rW)g in f&&(u[g]=f[g])}return u||l});return{...t,layers:r}}var FA={};const VA={version:8,sources:{},layers:[]},UA={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Uw={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},$A={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},iW=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],sW=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Vm{constructor(e,r,l){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=u=>{const f=this.props[$A[u.type]];f?f(u):u.type==="error"&&console.error(u.error)},this._onPointerEvent=u=>{(u.type==="mousemove"||u.type==="mouseout")&&this._updateHover(u);const f=this.props[UA[u.type]];f&&(this.props.interactiveLayerIds&&u.type!=="mouseover"&&u.type!=="mouseout"&&(u.features=this._hoveredFeatures||this._queryRenderedFeatures(u.point)),f(u),delete u.features)},this._onCameraEvent=u=>{if(!this._internalUpdate){const f=this.props[Uw[u.type]];f&&f(u)}u.type in this._deferredEvents&&(this._deferredEvents[u.type]=!1)},this._MapClass=e,this.props=r,this._initialize(l)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const r=this.props;this.props=e;const l=this._updateSettings(e,r);l&&this._createShadowTransform(this._map);const u=this._updateSize(e),f=this._updateViewState(e,!0);this._updateStyle(e,r),this._updateStyleComponents(e,r),this._updateHandlers(e,r),(l||u||f&&!this._map.isMoving())&&this.redraw()}static reuse(e,r){const l=Vm.savedMaps.pop();if(!l)return null;const u=l.map,f=u.getContainer();for(r.className=f.className;f.childNodes.length>0;)r.appendChild(f.childNodes[0]);u._container=r;const g=u._resizeObserver;g&&(g.disconnect(),g.observe(r)),l.setProps({...e,styleDiffing:!1}),u.resize();const{initialViewState:w}=e;return w&&(w.bounds?u.fitBounds(w.bounds,{...w.fitBoundsOptions,duration:0}):l._updateViewState(w,!1)),u.isStyleLoaded()?u.fire("load"):u.once("styledata",()=>u.fire("load")),u._update(),l}_initialize(e){const{props:r}=this,{mapStyle:l=VA}=r,u={...r,...r.initialViewState,accessToken:r.mapboxAccessToken||oW()||null,container:e,style:BA(l)},f=u.initialViewState||u.viewState||u;if(Object.assign(u,{center:[f.longitude||0,f.latitude||0],zoom:f.zoom||0,pitch:f.pitch||0,bearing:f.bearing||0}),r.gl){const A=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=A,r.gl)}const g=new this._MapClass(u);f.padding&&g.setPadding(f.padding),r.cursor&&(g.getCanvas().style.cursor=r.cursor),this._createShadowTransform(g);const w=g._render;g._render=A=>{this._inRender=!0,w.call(g,A),this._inRender=!1};const s=g._renderTaskQueue.run;g._renderTaskQueue.run=A=>{s.call(g._renderTaskQueue,A),this._onBeforeRepaint()},g.on("render",()=>this._onAfterRepaint());const S=g.fire;g.fire=this._fireEvent.bind(this,S),g.on("resize",()=>{this._renderTransform.resize(g.transform.width,g.transform.height)}),g.on("styledata",()=>{this._updateStyleComponents(this.props,{}),LA(g.transform,this._renderTransform)}),g.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const A in UA)g.on(A,this._onPointerEvent);for(const A in Uw)g.on(A,this._onCameraEvent);for(const A in $A)g.on(A,this._onEvent);this._map=g}recycle(){const r=this.map.getContainer().querySelector("[mapboxgl-children]");r?.remove(),Vm.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const r=nW(e.transform);e.painter.transform=r,this._renderTransform=r}_updateSize(e){const{viewState:r}=e;if(r){const l=this._map;if(r.width!==l.transform.width||r.height!==l.transform.height)return l.resize(),!0}return!1}_updateViewState(e,r){if(this._internalUpdate)return!1;const l=this._map,u=this._renderTransform,{zoom:f,pitch:g,bearing:w}=u,s=l.isMoving();s&&(u.cameraElevationReference="sea");const S=zA(u,{...OA(l.transform),...e});if(s&&(u.cameraElevationReference="ground"),S&&r){const A=this._deferredEvents;A.move=!0,A.zoom||(A.zoom=f!==u.zoom),A.rotate||(A.rotate=w!==u.bearing),A.pitch||(A.pitch=g!==u.pitch)}return s||zA(l.transform,e),S}_updateSettings(e,r){const l=this._map;let u=!1;for(const f of iW)if(f in e&&!Ju(e[f],r[f])){u=!0;const g=l[`set${f[0].toUpperCase()}${f.slice(1)}`];g?.call(l,e[f])}return u}_updateStyle(e,r){if(e.cursor!==r.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==r.mapStyle){const{mapStyle:l=VA,styleDiffing:u=!0}=e,f={diff:u};return"localIdeographFontFamily"in e&&(f.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(BA(l),f),!0}return!1}_updateStyleComponents(e,r){const l=this._map;let u=!1;return l.isStyleLoaded()&&("light"in e&&l.setLight&&!Ju(e.light,r.light)&&(u=!0,l.setLight(e.light)),"fog"in e&&l.setFog&&!Ju(e.fog,r.fog)&&(u=!0,l.setFog(e.fog)),"terrain"in e&&l.setTerrain&&!Ju(e.terrain,r.terrain)&&(!e.terrain||l.getSource(e.terrain.source))&&(u=!0,l.setTerrain(e.terrain))),u}_updateHandlers(e,r){var l,u;const f=this._map;let g=!1;for(const w of sW){const s=(l=e[w])!==null&&l!==void 0?l:!0,S=(u=r[w])!==null&&u!==void 0?u:!0;Ju(s,S)||(g=!0,s?f[w].enable(s):f[w].disable())}return g}_queryRenderedFeatures(e){const r=this._map,l=r.transform,{interactiveLayerIds:u=[]}=this.props;try{return r.transform=this._renderTransform,r.queryRenderedFeatures(e,{layers:u.filter(r.getLayer.bind(r))})}catch{return[]}finally{r.transform=l}}_updateHover(e){var r;const{props:l}=this;if(l.interactiveLayerIds&&(l.onMouseMove||l.onMouseEnter||l.onMouseLeave)){const f=e.type,g=((r=this._hoveredFeatures)===null||r===void 0?void 0:r.length)>0,w=this._queryRenderedFeatures(e.point),s=w.length>0;!s&&g&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=w,s&&!g&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=f}else this._hoveredFeatures=null}_fireEvent(e,r,l){const u=this._map,f=u.transform,g=typeof r=="string"?r:r.type;return g==="move"&&this._updateViewState(this.props,!1),g in Uw&&(typeof r=="object"&&(r.viewState=OA(f)),this._map.isMoving())?(u.transform=this._renderTransform,e.call(u,r,l),u.transform=f,u):(e.call(u,r,l),u)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const l in this._deferredEvents)this._deferredEvents[l]&&e.fire(l);this._internalUpdate=!1;const r=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{LA(this._renderTransform,r),e.transform=r}}}Vm.savedMaps=[];function oW(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||FA.MapboxAccessToken}catch{}try{t=t||FA.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const aW=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function lW(t){if(!t)return null;const e=t.map,r={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:l=>{const u=e.transform;e.transform=t.transform;const f=e.project(l);return e.transform=u,f},unproject:l=>{const u=e.transform;e.transform=t.transform;const f=e.unproject(l);return e.transform=u,f},queryTerrainElevation:(l,u)=>{const f=e.transform;e.transform=t.transform;const g=e.queryTerrainElevation(l,u);return e.transform=f,g},queryRenderedFeatures:(l,u)=>{const f=e.transform;e.transform=t.transform;const g=e.queryRenderedFeatures(l,u);return e.transform=f,g}};for(const l of cW(e))!(l in r)&&!aW.includes(l)&&(r[l]=e[l].bind(e));return r}function cW(t){const e=new Set;let r=t;for(;r;){for(const l of Object.getOwnPropertyNames(r))l[0]!=="_"&&typeof t[l]=="function"&&l!=="fire"&&l!=="setEventedParent"&&e.add(l);r=Object.getPrototypeOf(r)}return Array.from(e)}const uW=typeof document<"u"?I.useLayoutEffect:I.useEffect,dW=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function hW(t,e){for(const l of dW)l in e&&(t[l]=e[l]);const{RTLTextPlugin:r="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;r&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(r,l=>{l&&console.error(l)},!0)}const Q0=I.createContext(null);function fW(t,e,r){const l=I.useContext(eW),[u,f]=I.useState(null),g=I.useRef(),{current:w}=I.useRef({mapLib:null,map:null});I.useEffect(()=>{const A=t.mapLib;let j=!0,O;return Promise.resolve(A||r).then(L=>{if(!j)return;if(!L)throw new Error("Invalid mapLib");const W="Map"in L?L:L.default;if(!W.Map)throw new Error("Invalid mapLib");if(hW(W,t),!W.supported||W.supported(t))t.reuseMaps&&(O=Vm.reuse(t,g.current)),O||(O=new Vm(W.Map,t,g.current)),w.map=lW(O),w.mapLib=W,f(O),l?.onMapMount(w.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(L=>{const{onError:W}=t;W?W({type:"error",target:null,originalEvent:null,error:L}):console.error(L)}),()=>{j=!1,O&&(l?.onMapUnmount(t.id),t.reuseMaps?O.recycle():O.destroy())}},[]),uW(()=>{u&&u.setProps(t)}),I.useImperativeHandle(e,()=>w.map,[u]);const s=I.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),S={height:"100%"};return I.createElement("div",{id:t.id,ref:g,style:s},u&&I.createElement(Q0.Provider,{value:w},I.createElement("div",{"mapboxgl-children":"",style:S},t.children)))}const pW=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function sp(t,e){if(!t||!e)return;const r=t.style;for(const l in e){const u=e[l];Number.isFinite(u)&&!pW.test(l)?r[l]=`${u}px`:r[l]=u}}function mW(t,e){const{map:r,mapLib:l}=I.useContext(Q0),u=I.useRef({props:t});u.current.props=t;const f=I.useMemo(()=>{let U=!1;I.Children.forEach(t.children,J=>{J&&(U=!0)});const q={...t,element:U?document.createElement("div"):null},Q=new l.Marker(q);return Q.setLngLat([t.longitude,t.latitude]),Q.getElement().addEventListener("click",J=>{var Y,ie;(ie=(Y=u.current.props).onClick)===null||ie===void 0||ie.call(Y,{type:"click",target:Q,originalEvent:J})}),Q.on("dragstart",J=>{var Y,ie;const _e=J;_e.lngLat=f.getLngLat(),(ie=(Y=u.current.props).onDragStart)===null||ie===void 0||ie.call(Y,_e)}),Q.on("drag",J=>{var Y,ie;const _e=J;_e.lngLat=f.getLngLat(),(ie=(Y=u.current.props).onDrag)===null||ie===void 0||ie.call(Y,_e)}),Q.on("dragend",J=>{var Y,ie;const _e=J;_e.lngLat=f.getLngLat(),(ie=(Y=u.current.props).onDragEnd)===null||ie===void 0||ie.call(Y,_e)}),Q},[]);I.useEffect(()=>(f.addTo(r.getMap()),()=>{f.remove()}),[]);const{longitude:g,latitude:w,offset:s,style:S,draggable:A=!1,popup:j=null,rotation:O=0,rotationAlignment:L="auto",pitchAlignment:W="auto"}=t;return I.useEffect(()=>{sp(f.getElement(),S)},[S]),I.useImperativeHandle(e,()=>f,[]),(f.getLngLat().lng!==g||f.getLngLat().lat!==w)&&f.setLngLat([g,w]),s&&!tW(f.getOffset(),s)&&f.setOffset(s),f.isDraggable()!==A&&f.setDraggable(A),f.getRotation()!==O&&f.setRotation(O),f.getRotationAlignment()!==L&&f.setRotationAlignment(L),f.getPitchAlignment()!==W&&f.setPitchAlignment(W),f.getPopup()!==j&&f.setPopup(j),xh.createPortal(t.children,f.getElement())}const gW=I.memo(I.forwardRef(mW));function GA(t){return new Set(t?t.trim().split(/\s+/):[])}function yW(t,e){const{map:r,mapLib:l}=I.useContext(Q0),u=I.useMemo(()=>document.createElement("div"),[]),f=I.useRef({props:t});f.current.props=t;const g=I.useMemo(()=>{const w={...t},s=new l.Popup(w);return s.setLngLat([t.longitude,t.latitude]),s.once("open",S=>{var A,j;(j=(A=f.current.props).onOpen)===null||j===void 0||j.call(A,S)}),s},[]);if(I.useEffect(()=>{const w=s=>{var S,A;(A=(S=f.current.props).onClose)===null||A===void 0||A.call(S,s)};return g.on("close",w),g.setDOMContent(u).addTo(r.getMap()),()=>{g.off("close",w),g.isOpen()&&g.remove()}},[]),I.useEffect(()=>{sp(g.getElement(),t.style)},[t.style]),I.useImperativeHandle(e,()=>g,[]),g.isOpen()&&((g.getLngLat().lng!==t.longitude||g.getLngLat().lat!==t.latitude)&&g.setLngLat([t.longitude,t.latitude]),t.offset&&!Ju(g.options.offset,t.offset)&&g.setOffset(t.offset),(g.options.anchor!==t.anchor||g.options.maxWidth!==t.maxWidth)&&(g.options.anchor=t.anchor,g.setMaxWidth(t.maxWidth)),g.options.className!==t.className)){const w=GA(g.options.className),s=GA(t.className);for(const S of w)s.has(S)||g.removeClassName(S);for(const S of s)w.has(S)||g.addClassName(S);g.options.className=t.className}return xh.createPortal(t.children,u)}I.memo(I.forwardRef(yW));function u_(t,e,r,l){const u=I.useContext(Q0),f=I.useMemo(()=>t(u),[]);return I.useEffect(()=>{const g=e,w=null,s=typeof e=="function"?e:null,{map:S}=u;return S.hasControl(f)||(S.addControl(f,g?.position),w&&w(u)),()=>{s&&s(u),S.hasControl(f)&&S.removeControl(f)}},[]),f}function _W(t){const e=u_(({mapLib:r})=>new r.AttributionControl(t),{position:t.position});return I.useEffect(()=>{sp(e._container,t.style)},[t.style]),null}I.memo(_W);function vW(t){const e=u_(({mapLib:r})=>new r.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return I.useEffect(()=>{sp(e._controlContainer,t.style)},[t.style]),null}I.memo(vW);function xW(t,e){const r=I.useRef({props:t}),l=u_(({mapLib:u})=>{const f=new u.GeolocateControl(t),g=f._setupUI;return f._setupUI=w=>{f._container.hasChildNodes()||g(w)},f.on("geolocate",w=>{var s,S;(S=(s=r.current.props).onGeolocate)===null||S===void 0||S.call(s,w)}),f.on("error",w=>{var s,S;(S=(s=r.current.props).onError)===null||S===void 0||S.call(s,w)}),f.on("outofmaxbounds",w=>{var s,S;(S=(s=r.current.props).onOutOfMaxBounds)===null||S===void 0||S.call(s,w)}),f.on("trackuserlocationstart",w=>{var s,S;(S=(s=r.current.props).onTrackUserLocationStart)===null||S===void 0||S.call(s,w)}),f.on("trackuserlocationend",w=>{var s,S;(S=(s=r.current.props).onTrackUserLocationEnd)===null||S===void 0||S.call(s,w)}),f},{position:t.position});return r.current.props=t,I.useImperativeHandle(e,()=>l,[]),I.useEffect(()=>{sp(l._container,t.style)},[t.style]),null}I.memo(I.forwardRef(xW));function wW(t){const e=u_(({mapLib:r})=>new r.NavigationControl(t),{position:t.position});return I.useEffect(()=>{sp(e._container,t.style)},[t.style]),null}const bW=I.memo(wW);function TW(t){const e=u_(({mapLib:f})=>new f.ScaleControl(t),{position:t.position}),r=I.useRef(t),l=r.current;r.current=t;const{style:u}=t;return t.maxWidth!==void 0&&t.maxWidth!==l.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==l.unit&&e.setUnit(t.unit),I.useEffect(()=>{sp(e._container,u)},[u]),null}I.memo(TW);const SW=Qq(()=>Promise.resolve().then(()=>xG),void 0),EW=I.forwardRef(function(e,r){return fW(e,r,SW)}),CW=gW,kW=bW,AW=void 0,PW=({isOpen:t,onClose:e,onConfirm:r,initialLat:l,initialLng:u})=>{const f=I.useRef(null),g=I.useRef(null),[w,s]=I.useState({latitude:l||21.0285,longitude:u||105.8542,zoom:15}),[S,A]=I.useState({lat:l||21.0285,lng:u||105.8542}),[j,O]=I.useState(""),[L,W]=I.useState([]),[U,q]=I.useState(!1),[Q,J]=I.useState(!1);I.useEffect(()=>{if(t){const Me=l||21.0285,lt=u||105.8542;A({lat:Me,lng:lt}),s(ft=>({...ft,latitude:Me,longitude:lt})),l&&u?Ue(Me,lt):O(""),W([]),setTimeout(()=>f.current?.resize(),200)}},[t,l,u]);const Y=(Me,lt)=>{f.current?.flyTo({center:[lt,Me],zoom:16,duration:1500,essential:!0})},ie=Me=>{const lt=Me.target.value;O(lt),g.current&&clearTimeout(g.current),lt.length>2?(q(!0),g.current=setTimeout(async()=>{try{const mt=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(lt)}&countrycodes=vn&limit=5&addressdetails=1`)).json();W(mt)}catch(ft){console.error(ft)}finally{q(!1)}},500)):(W([]),q(!1))},_e=Me=>{const lt=parseFloat(Me.lat),ft=parseFloat(Me.lon);A({lat:lt,lng:ft}),Y(lt,ft),O(Me.display_name),W([])},Se=Me=>{const{lng:lt,lat:ft}=Me.lngLat;A({lat:ft,lng:lt})},Ie=async Me=>{const{lng:lt,lat:ft}=Me.lngLat;A({lat:ft,lng:lt}),await Ue(ft,lt)},Ue=async(Me,lt)=>{J(!0);try{const mt=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${Me}&lon=${lt}&zoom=18&addressdetails=1`)).json();mt&&mt.display_name&&O(mt.display_name)}catch(ft){console.error("Li ly a ch:",ft)}finally{J(!1)}},Je=()=>{r(S.lat,S.lng,j),e()};return v.jsx(q0,{open:t,onOpenChange:e,children:v.jsxs(a_,{className:"max-w-2xl h-[85vh] flex flex-col p-0 gap-0 z-[110]",children:[v.jsx(W0,{className:"p-4 border-b",children:v.jsx(l_,{children:"Chn v tr"})}),v.jsxs("div",{className:"flex-1 relative w-full h-full bg-gray-100",children:[v.jsxs("div",{className:"absolute top-4 left-4 right-14 z-20 flex flex-col gap-1",children:[v.jsxs("div",{className:"flex shadow-xl rounded-lg overflow-hidden bg-white ring-1 ring-gray-200",children:[v.jsx(fi,{value:j,onChange:ie,placeholder:"Tm kim a ch...",className:"h-11 bg-white border-0 rounded-none focus-visible:ring-0 pl-4 text-base"}),v.jsx("div",{className:"flex items-center justify-center px-3 bg-white text-gray-400",children:U||Q?v.jsx(ls,{className:"w-5 h-5 animate-spin text-primary"}):j?v.jsx("button",{onClick:()=>{O(""),W([])},children:v.jsx(xi,{className:"w-5 h-5 hover:text-red-500"})}):v.jsx(p0,{className:"w-5 h-5"})})]}),L.length>0&&v.jsx("div",{className:"bg-white rounded-lg shadow-2xl border overflow-hidden max-h-60 overflow-y-auto mt-1 animate-in fade-in slide-in-from-top-2",children:L.map((Me,lt)=>v.jsxs("div",{onClick:()=>_e(Me),className:"p-3 text-sm hover:bg-blue-50 cursor-pointer border-b last:border-0 flex items-start gap-3 transition-colors",children:[v.jsx("div",{className:"bg-gray-100 p-1.5 rounded-full flex-shrink-0 mt-0.5",children:v.jsx(Wi,{className:"w-4 h-4 text-red-500"})}),v.jsxs("div",{className:"flex flex-col",children:[v.jsx("span",{className:"font-medium text-gray-900 line-clamp-1",children:Me.name||Me.display_name.split(",")[0]}),v.jsx("span",{className:"text-xs text-gray-500 line-clamp-2",children:Me.display_name})]})]},lt))})]}),v.jsxs(EW,{ref:f,...w,onMove:Me=>s(Me.viewState),mapStyle:"mapbox://styles/mapbox/streets-v12",mapboxAccessToken:AW,className:"w-full h-full",style:{width:"100%",height:"100%"},children:[v.jsx(kW,{position:"bottom-right"}),v.jsx(CW,{latitude:S.lat,longitude:S.lng,anchor:"bottom",draggable:!0,onDrag:Se,onDragEnd:Ie,children:v.jsxs("div",{className:"relative flex flex-col items-center group cursor-grab active:cursor-grabbing hover:scale-110 transition-transform",children:[v.jsx("div",{className:"absolute -top-8 bg-black/80 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none",children:"Ko ti"}),v.jsx(Wi,{className:"w-12 h-12 text-red-600 drop-shadow-2xl fill-white"}),v.jsx("div",{className:"w-3 h-1 bg-black/30 rounded-full blur-[2px]"})]})})]}),v.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg border text-xs font-medium text-gray-600 pointer-events-none flex items-center gap-2",children:Q?v.jsxs(v.Fragment,{children:[v.jsx(ls,{className:"w-3 h-3 animate-spin"})," ang ly a ch..."]}):"Ko th ghim   cp nht a ch"})]}),v.jsxs(RT,{className:"p-4 border-t bg-white",children:[v.jsx(vn,{variant:"ghost",onClick:e,children:"Hy"}),v.jsxs(vn,{onClick:Je,className:"gap-2 bg-blue-600 hover:bg-blue-700 text-white shadow-lg",children:[v.jsx(Wi,{className:"w-4 h-4"})," Xc nhn v tr ny"]})]})]})})},yD=({isOpen:t,onClose:e,onSubmit:r,initialData:l,isSubmitting:u,customStoreId:f,onUpgradeClick:g})=>{const{session:w}=ha(),A=l?.is_premium===!0||!!f,[j,O]=I.useState({name_vi:"",address_vi:"",phone:"",description_vi:"",category:"cafe",image_url:"",lat:21.0285,lng:105.8542}),[L,W]=I.useState(null),[U,q]=I.useState(""),[Q,J]=I.useState([]),[Y,ie]=I.useState([]),[_e,Se]=I.useState([]),[Ie,Ue]=I.useState(!1),[Je,Me]=I.useState(!1);I.useEffect(()=>{if(t)if(l){O({name_vi:l.name_vi||l.nameVi||"",address_vi:l.address_vi||l.address||"",phone:l.phone||"",description_vi:l.description_vi||l.description||"",category:l.category||l.type||"cafe",image_url:l.image_url||l.image||"",lat:l.lat||21.0285,lng:l.lng||105.8542}),q(l.image_url||l.image||""),W(null);const it=f||l.id;it&&A&&ft(it)}else O({name_vi:"",address_vi:"",phone:"",description_vi:"",category:"cafe",image_url:"",lat:21.0285,lng:105.8542}),q(""),W(null),J([]),ie([]),Se([])},[t,l,f,A]);const lt=(it,We,Le)=>{O(we=>({...we,lat:it,lng:We,address_vi:Le||we.address_vi})),Jt.success(" cp nht v tr!")},ft=async it=>{const We=String(it).includes("user-store-")?String(it).replace("user-store-",""):it;if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(We))return;const{data:we}=await Wt.from("store_gallery").select("*").eq("store_id",We);we&&Se(we)},mt=it=>{const We=it.target.files?.[0];We&&(W(We),q(URL.createObjectURL(We)))},gt=it=>{const We=it.target.files;if(We){const Le=Array.from(We);if(_e.length+Q.length+Le.length>10){Jt.error("Ti a 10 nh trong th vin.");return}J(ke=>[...ke,...Le]);const st=Le.map(ke=>URL.createObjectURL(ke));ie(ke=>[...ke,...st])}},Lt=async it=>{it.preventDefault(),Me(!0);try{let We=j.image_url;if(L){const Ve=L.name.split(".").pop(),bt=`avatars/${Date.now()}_avatar.${Ve}`,{error:wt}=await Wt.storage.from("avatars").upload(bt,L,{upsert:!0});if(!wt){const{data:Yt}=Wt.storage.from("avatars").getPublicUrl(bt);We=Yt.publicUrl}}let Le=f||l?.id;const we={id:Le,user_id:w?.user?.id,name_vi:j.name_vi,address_vi:j.address_vi,phone:j.phone,description_vi:A?j.description_vi:null,category:j.category,image_url:We,lat:j.lat,lng:j.lng,is_premium:f?!0:l?.is_premium||!1},{data:st,error:ke}=await Wt.from("user_stores").upsert(we).select().single();if(ke)throw ke;if(!Le&&st&&(Le=st.id),Le&&A&&Q.length>0){let Ve=0;for(const bt of Q){const wt=bt.name.split(".").pop(),Yt=`${Le}/${Date.now()}_${Math.random()}.${wt}`,{error:Mt}=await Wt.storage.from("avatars").upload(Yt,bt);if(!Mt){const{data:ct}=Wt.storage.from("avatars").getPublicUrl(Yt);await Wt.from("store_gallery").insert({store_id:Le,image_url:ct.publicUrl}),Ve++}}Ve>0&&Jt.success(` thm ${Ve} nh vo th vin!`)}Jt.success(f?" cp nht a im h thng!":" lu ca hng!"),r&&await r(we),e()}catch(We){console.error(We),Jt.error("C li xy ra: "+We.message)}finally{Me(!1)}};return v.jsxs(v.Fragment,{children:[v.jsx(q0,{open:t,onOpenChange:e,children:v.jsxs(a_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto bg-white p-0 gap-0 rounded-xl z-[100]",children:[v.jsxs(W0,{className:"p-6 border-b sticky top-0 bg-white z-20 flex flex-row items-center justify-between",children:[v.jsx(l_,{className:"text-xl font-bold",children:f?"Chnh sa a im (Admin)":l?"Chnh sa ca hng":"Thm ca hng mi"}),A?v.jsxs("span",{className:"flex items-center gap-1 text-xs font-bold bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full border border-yellow-200 shadow-sm animate-pulse",children:[v.jsx(fl,{className:"w-3 h-3 fill-yellow-500 text-yellow-500"})," PREMIUM STORE"]}):v.jsx("span",{className:"text-xs font-bold bg-gray-100 text-gray-500 px-2 py-1 rounded-full border border-gray-200",children:"Gi Min Ph"})]}),v.jsxs("form",{onSubmit:Lt,className:"p-6 space-y-6",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-6",children:[v.jsxs("div",{className:"md:col-span-4 space-y-3",children:[v.jsxs(hi,{className:"font-semibold",children:["nh i din ",v.jsx("span",{className:"text-green-600 text-xs font-normal",children:"(Min ph)"})]}),v.jsxs("div",{className:"aspect-square w-full rounded-2xl border-2 border-dashed border-gray-300 bg-gray-50 flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all relative overflow-hidden group",onClick:()=>document.getElementById("avatar-input")?.click(),children:[U?v.jsxs(v.Fragment,{children:[v.jsx("img",{src:U,className:"w-full h-full object-cover"}),v.jsxs("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[v.jsx(f5,{className:"text-white w-8 h-8"}),v.jsx("span",{className:"text-white text-xs font-medium absolute bottom-4",children:"i nh"})]})]}):v.jsxs(v.Fragment,{children:[v.jsx($E,{className:"w-10 h-10 text-gray-400 mb-2"}),v.jsx("span",{className:"text-sm text-gray-500 font-medium",children:"Ti nh ln"})]}),v.jsx("input",{id:"avatar-input",type:"file",accept:"image/*",onChange:mt,className:"hidden"})]})]}),v.jsxs("div",{className:"md:col-span-8 space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsxs(hi,{children:["Tn a im ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{required:!0,value:j.name_vi,onChange:it=>O({...j,name_vi:it.target.value})})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsxs(hi,{children:["Danh mc ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsxs(fD,{value:j.category,onValueChange:it=>O({...j,category:it}),children:[v.jsx(BT,{className:"bg-white",children:v.jsx(pD,{placeholder:"Chn danh mc"})}),v.jsxs(FT,{className:"max-h-[300px] bg-white z-[200]",children:[v.jsx(ul,{value:"food",children:"Qun n"}),v.jsx(ul,{value:"cafe",children:"Caf"}),v.jsx(ul,{value:"entertainment",children:"Vui chi"}),v.jsx(ul,{value:"lecture_hall",children:"Ging ng"}),v.jsx(ul,{value:"office",children:"Vn phng"}),v.jsx(ul,{value:"housing",children:"Nh tr"}),v.jsx(ul,{value:"job",children:"Vic lm"}),v.jsx(ul,{value:"building",children:"Ta nh"}),v.jsx(ul,{value:"checkin",children:"Check-in"})]})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(hi,{children:"Lin h & V tr"}),v.jsxs("div",{className:"flex gap-2",children:[v.jsx("div",{className:"flex-1",children:v.jsx(fi,{value:j.phone,onChange:it=>O({...j,phone:it.target.value}),placeholder:"S in thoi..."})}),v.jsxs(vn,{type:"button",className:"bg-blue-600 text-white min-w-[140px] gap-2",onClick:()=>Ue(!0),children:[v.jsx(Wi,{className:"w-4 h-4"})," ",j.lat?"Sa v tr":"Chn v tr"]})]}),v.jsxs("div",{className:"bg-gray-50 border rounded-md p-2 text-sm flex items-start gap-2",children:[v.jsx(Wi,{className:j.lat?"w-4 h-4 text-green-600 mt-0.5":"w-4 h-4 text-gray-400 mt-0.5"}),v.jsx("span",{className:"font-medium text-gray-800 flex-1",children:j.address_vi||"Cha chn v tr"})]})]}),v.jsxs("div",{className:"space-y-2 relative",children:[v.jsxs(hi,{className:"flex items-center gap-2 font-semibold",children:["M t / Gii thiu",!A&&v.jsx(Cy,{className:"w-3.5 h-3.5 text-yellow-600"})]}),v.jsxs("div",{className:"relative",children:[v.jsx(yh,{rows:3,value:j.description_vi,onChange:it=>O({...j,description_vi:it.target.value}),disabled:!A,placeholder:A?"Nhp m t...":"Nng cp VIP  vit m t chi tit, gii thiu v qun...",className:A?"":"bg-gray-100 text-gray-400 resize-none blur-[1px]"}),!A&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:v.jsxs(vn,{type:"button",size:"sm",onClick:g,className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white hover:from-yellow-500 hover:to-orange-600 shadow-md transform hover:scale-105 transition-all",children:[v.jsx(fl,{className:"w-4 h-4 mr-1"})," M kha M t"]})})]})]})]}),v.jsxs("div",{className:"col-span-full space-y-3 pt-4 border-t relative",children:[v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsxs(hi,{className:"text-base font-semibold flex items-center gap-2",children:["Th vin nh VIP",!A&&v.jsx(Cy,{className:"w-4 h-4 text-gray-400"})]}),A?v.jsxs(v.Fragment,{children:[v.jsxs(vn,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("gallery-input")?.click(),disabled:_e.length+Q.length>=10,children:[v.jsx($E,{className:"w-4 h-4 mr-2"})," Thm nh"]}),v.jsx("input",{id:"gallery-input",type:"file",multiple:!0,accept:"image/*",onChange:gt,className:"hidden"})]}):v.jsx("span",{className:"text-xs text-red-500 font-medium bg-red-50 px-2 py-1 rounded",children:"Tnh nng VIP"})]}),v.jsxs("div",{className:`flex gap-4 overflow-x-auto pb-4 pt-2 scrollbar-thin scrollbar-thumb-gray-200 ${A?"":"opacity-40 pointer-events-none select-none filter blur-[2px]"}`,children:[!A&&[1,2,3,4].map(it=>v.jsx("div",{className:"w-24 h-24 flex-shrink-0 rounded-lg bg-gray-200 animate-pulse"},it)),A&&_e.map(it=>v.jsx("div",{className:"relative w-24 h-24 flex-shrink-0 rounded-lg overflow-hidden border group",children:v.jsx("img",{src:it.image_url,className:"w-full h-full object-cover transition-transform group-hover:scale-110"})},it.id)),A&&Y.map((it,We)=>v.jsx("div",{className:"relative w-24 h-24 flex-shrink-0 rounded-lg overflow-hidden border",children:v.jsx("img",{src:it,className:"w-full h-full object-cover"})},We))]}),!A&&v.jsx("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/60 backdrop-blur-sm rounded-xl border border-dashed border-gray-300",children:v.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-xl flex flex-col items-center border border-yellow-100 max-w-xs text-center",children:[v.jsx("div",{className:"bg-yellow-100 p-3 rounded-full mb-3",children:v.jsx(fl,{className:"w-6 h-6 text-yellow-600 fill-yellow-600"})}),v.jsx("h3",{className:"font-bold text-gray-900 text-sm mb-1",children:"Th vin nh VIP"}),v.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"ng ti 10 nh Menu & Khng gian  thu ht khch hng gp 3 ln!"}),v.jsx(vn,{type:"button",size:"sm",onClick:g,className:"bg-yellow-500 hover:bg-yellow-600 text-white w-full font-bold shadow-lg shadow-yellow-200",children:"Nng cp ngay"})]})})]})]}),v.jsxs(RT,{className:"pt-4 border-t sticky bottom-0 bg-white z-20",children:[v.jsx(vn,{type:"button",variant:"ghost",onClick:e,children:"Hy"}),v.jsxs(vn,{type:"submit",disabled:Je||u,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold shadow-md",children:[(Je||u)&&v.jsx(ls,{className:"w-4 h-4 mr-2 animate-spin"}),"Lu thng tin"]})]})]})]})}),v.jsx(PW,{isOpen:Ie,onClose:()=>Ue(!1),onConfirm:lt,initialLat:j.lat,initialLng:j.lng})]})},_D=({isOpen:t,onClose:e,location:r,onNavigate:l})=>{if(!r)return null;const{session:u}=ha(),[f,g]=I.useState("info"),[w,s]=I.useState(r),[S,A]=I.useState([]),[j,O]=I.useState([]),[L,W]=I.useState([]),[U,q]=I.useState(new Set),[Q,J]=I.useState(0),[Y,ie]=I.useState(0),[_e,Se]=I.useState(!0),[Ie,Ue]=I.useState(!1),Je=String(r.id).replace("user-store-",""),Me=u?.user?.email==="admin@example.com",lt=w?.user_id===u?.user?.id,ft=Me||lt;I.useEffect(()=>{t&&r&&mt()},[t,r.id]);const mt=async()=>{Se(!0);const{data:Ve}=await Wt.from("user_stores").select("*").eq("id",Je).maybeSingle();s(Ve||r);const[wt,Yt,Mt,ct]=await Promise.all([Wt.from("store_menu_items").select("*").eq("store_id",Je),Wt.from("store_gallery").select("*").eq("store_id",Je),Wt.from("store_vouchers").select("*").eq("store_id",Je).eq("is_active",!0),Wt.from("location_reviews").select("rating").eq("store_id",Je)]);if(wt.data&&O(wt.data),Yt.data&&W(Yt.data),Mt.data&&A(Mt.data),ct.data&&ct.data.length>0){const xn=ct.data.reduce((un,Rn)=>un+Rn.rating,0)/ct.data.length;J(Number(xn.toFixed(1))),ie(ct.data.length)}else J(0),ie(0);if(u?.user&&Mt.data&&Mt.data.length>0){const Nt=Mt.data.map(un=>un.id),{data:xn}=await Wt.from("user_saved_vouchers").select("voucher_id").eq("user_id",u.user.id).in("voucher_id",Nt);xn&&q(new Set(xn.map(un=>un.voucher_id)))}Se(!1)},gt=async()=>{await mt()},Lt=async Ve=>{if(!u?.user){Jt.error("Vui lng ng nhp  lu voucher!");return}if(U.has(Ve.id))return;const{error:bt}=await Wt.from("user_saved_vouchers").insert({user_id:u.user.id,voucher_id:Ve.id});!bt||bt.code==="23505"?(Jt.success(" lu voucher vo v!"),q(wt=>new Set(wt).add(Ve.id))):Jt.error("Khng th lu voucher lc ny")},it=w.image_url||w.image||"https://images.unsplash.com/photo-1554118811-1e0d58224f24",We=w.name_vi||w.nameVi||w.name||"a im cha c tn",Le=w.address_vi||w.address||"ang cp nht a ch",we=w.phone||r.phone||"Cha cp nht",st=w.open_hours_vi||"08:00 - 22:00",ke=w.description_vi||w.description;return v.jsxs(v.Fragment,{children:[v.jsx(q0,{open:t,onOpenChange:e,children:v.jsxs(a_,{className:"max-w-2xl h-[90vh] p-0 bg-white gap-0 border-none rounded-2xl overflow-hidden z-[100] flex flex-col focus:outline-none",children:[v.jsx(l_,{className:"sr-only",children:We}),_e?v.jsx("div",{className:"flex-1 flex items-center justify-center",children:v.jsx(ls,{className:"w-8 h-8 animate-spin text-primary"})}):v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"relative h-48 bg-gray-200 flex-shrink-0",children:[v.jsx("img",{src:it,className:"w-full h-full object-cover",alt:We,onError:Ve=>{Ve.currentTarget.src="https://placehold.co/600x400?text=No+Image"}}),v.jsx("button",{onClick:e,className:"absolute top-4 right-4 bg-black/50 p-1.5 rounded-full text-white hover:bg-black/70 transition-colors z-10",children:v.jsx(xi,{className:"w-5 h-5"})}),ft&&v.jsxs(vn,{size:"sm",className:"absolute bottom-4 right-4 bg-white/90 text-black hover:bg-white shadow-md border backdrop-blur-sm",onClick:()=>Ue(!0),children:[v.jsx(S5,{className:"w-3.5 h-3.5 mr-2"})," Chnh sa"]})]}),v.jsxs("div",{className:"pt-4 px-6 pb-2 flex-shrink-0",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900 leading-tight",children:We}),v.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mt-1",children:[v.jsx(Uf,{className:`w-4 h-4 ${Q>0?"fill-yellow-500 text-yellow-500":"text-gray-300"}`}),v.jsx("span",{className:"font-bold text-gray-900",children:Q>0?Q:"Cha c nh gi"}),Y>0&&v.jsxs("span",{children:["(",Y,")"]}),v.jsx("span",{className:"capitalize px-2 py-0.5 bg-gray-100 rounded-full text-xs",children:w.category||w.type||"a im"})]}),v.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-3",children:[v.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-600",children:[v.jsx(f0,{className:"w-4 h-4 text-green-600"})," ",v.jsx("span",{children:st})]}),v.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-gray-600",children:[v.jsx(Qy,{className:"w-4 h-4 text-blue-600"})," ",v.jsx("span",{children:we})]})]}),v.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mt-2",children:[v.jsx(Wi,{className:"w-4 h-4 flex-shrink-0 text-red-500"}),v.jsx("span",{className:"truncate",children:Le})]})]}),v.jsxs(Gy,{defaultValue:"info",className:"flex-1 flex flex-col min-h-0",value:f,onValueChange:g,children:[v.jsx("div",{className:"px-6 border-b flex-shrink-0 bg-white sticky top-0 z-10",children:v.jsxs(Fm,{className:"w-full justify-start bg-transparent h-12 p-0 gap-6 overflow-x-auto no-scrollbar",children:[v.jsx(as,{value:"info",className:"data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:text-primary rounded-none h-full px-0 bg-transparent font-medium",children:"Thng tin"}),v.jsxs(as,{value:"menu",className:"data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:text-primary rounded-none h-full px-0 bg-transparent font-medium",children:["Thc n (",j.length,")"]}),v.jsxs(as,{value:"vouchers",className:"data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:text-primary rounded-none h-full px-0 bg-transparent font-medium",children:["Voucher (",S.length,")"]}),v.jsxs(as,{value:"gallery",className:"data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:text-primary rounded-none h-full px-0 bg-transparent font-medium",children:["nh (",L.length,")"]}),v.jsxs(as,{value:"reviews",className:"data-[state=active]:border-b-2 data-[state=active]:border-primary data-[state=active]:text-primary rounded-none h-full px-0 bg-transparent font-medium",children:["nh gi (",Y,")"]})]})}),v.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 scroll-smooth",children:[v.jsx(Co,{value:"info",className:"m-0 focus:outline-none",children:v.jsxs("div",{className:"bg-white p-5 rounded-xl shadow-sm border space-y-3",children:[v.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[v.jsx(g1,{className:"w-4 h-4 text-blue-500"})," Gii thiu"]}),v.jsx("p",{className:"text-sm text-gray-600 leading-relaxed whitespace-pre-wrap",children:ke||"Cha c m t chi tit v a im ny."})]})}),v.jsx(Co,{value:"menu",className:"space-y-4 m-0 focus:outline-none",children:j.length===0?v.jsxs("div",{className:"text-center py-12 text-gray-400",children:[v.jsx(m0,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),v.jsx("p",{children:"Cha cp nht thc n."})]}):v.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:j.map(Ve=>v.jsxs("div",{className:"bg-white p-2 rounded-xl border flex gap-3 hover:shadow-md transition-shadow",children:[v.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0",children:v.jsx("img",{src:Ve.image_url||"https://placehold.co/100x100",className:"w-full h-full object-cover",alt:Ve.name,onError:bt=>{bt.currentTarget.src="https://placehold.co/100x100?text=Food"}})}),v.jsxs("div",{className:"flex-1 py-1 flex flex-col justify-between",children:[v.jsx("h4",{className:"font-bold text-gray-900 text-sm line-clamp-2",children:Ve.name}),v.jsxs("span",{className:"font-bold text-primary block",children:[Ve.price?new Intl.NumberFormat("vi-VN").format(Number(Ve.price)):0,""]})]})]},Ve.id))})}),v.jsx(Co,{value:"vouchers",className:"space-y-3 m-0 focus:outline-none",children:S.length===0?v.jsxs("div",{className:"text-center py-12 text-gray-400",children:[v.jsx(fh,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),v.jsx("p",{children:"Khng c m gim gi no."})]}):S.map(Ve=>{const bt=U.has(Ve.id);return v.jsx("div",{className:"bg-white rounded-xl border border-dashed border-orange-200 p-4 shadow-sm relative group hover:border-orange-400 transition-colors",children:v.jsxs("div",{className:"flex gap-4 items-center",children:[v.jsxs("div",{className:"w-16 h-16 bg-orange-50 rounded-lg flex flex-col items-center justify-center border border-orange-100 text-orange-600 flex-shrink-0",children:[v.jsx("span",{className:"text-xl font-black",children:Ve.discount_value}),v.jsx("span",{className:"text-xs font-bold uppercase",children:Ve.discount_type==="percent"?"%":"k"})]}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("h4",{className:"font-bold text-gray-900 truncate",children:Ve.title_vi}),v.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:["M: ",v.jsx("span",{className:"font-mono bg-gray-100 px-1.5 py-0.5 rounded text-gray-700 font-bold",children:Ve.code})]})]}),v.jsx(vn,{onClick:()=>Lt(Ve),disabled:bt,size:"sm",className:`shrink-0 ${bt?"bg-green-100 text-green-700 hover:bg-green-200":"bg-orange-500 text-white hover:bg-orange-600"}`,children:bt?v.jsxs(v.Fragment,{children:[v.jsx(tp,{className:"w-4 h-4 mr-1"}),"  lu"]}):"Lu m"})]})},Ve.id)})}),v.jsx(Co,{value:"gallery",className:"m-0 focus:outline-none",children:L.length===0?v.jsxs("div",{className:"text-center py-12 text-gray-400",children:[v.jsx(GP,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),v.jsx("p",{children:"Cha c hnh nh no khc."})]}):v.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.map(Ve=>v.jsx("div",{className:"aspect-square rounded-xl overflow-hidden border bg-gray-100 cursor-pointer hover:opacity-90",children:v.jsx("img",{src:Ve.image_url,className:"w-full h-full object-cover",alt:""})},Ve.id))})}),v.jsx(Co,{value:"reviews",className:"m-0 focus:outline-none",children:v.jsx(uq,{storeId:Je})})]})]})]})]})}),Ie&&v.jsx(yD,{isOpen:Ie,onClose:()=>Ue(!1),onSubmit:gt,initialData:w,customStoreId:Je})]})},MW={food:"m thc",cafe:"Caf",entertainment:"Vui chi",lecture_hall:"Ging ng",office:"Vn phng",housing:"Nh tr",job:"Vic lm",building:"Ta nh",checkin:"Check-in"},IW=({location:t,onClose:e,onNavigate:r,onOpenDetail:l,onClaim:u})=>{const{language:f}=da(),{session:g}=ha(),{isFavorite:w,toggleFavorite:s}=SN(),S=w(t.id),A=t.is_premium,j=!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(String(t.id)),O=String(t.id).replace("user-store-",""),[L,W]=I.useState({rating:0,count:0}),[U,q]=I.useState(!1);I.useEffect(()=>{const We=async(we=!1)=>{if(!we&&t.reviews&&t.reviews.length>0){const Ve=t.reviews.reduce((bt,wt)=>bt+wt.rating,0);W({rating:Number((Ve/t.reviews.length).toFixed(1)),count:t.reviews.length});return}q(!0);const{data:st,error:ke}=await Wt.from("location_reviews").select("rating").eq("store_id",O);if(!ke&&st&&st.length>0){const Ve=st.reduce((bt,wt)=>bt+wt.rating,0);W({rating:Number((Ve/st.length).toFixed(1)),count:st.length})}else!we&&t.rating?W({rating:t.rating,count:t.reviews?.length||0}):W({rating:0,count:0});q(!1)};We();const Le=we=>{String(we.detail)===String(O)&&(console.log(" BottomSheet: Nhn tn hiu update (ID khp) -> Ti li!"),We(!0))};return window.addEventListener("review_updated",Le),()=>{window.removeEventListener("review_updated",Le)}},[t.id,O]);const[Q,J]=I.useState([]),[Y,ie]=I.useState(new Set),[_e,Se]=I.useState(!1),[Ie,Ue]=I.useState(!1),[Je,Me]=I.useState(!1);I.useEffect(()=>{(async()=>{if(j){J([]);return}Se(!0);const{data:Le}=await Wt.from("store_vouchers").select("*").eq("store_id",O).eq("is_active",!0);if(Le&&Le.length>0){if(J(Le),g?.user){const we=Le.map(ke=>ke.id),{data:st}=await Wt.from("user_saved_vouchers").select("voucher_id").eq("user_id",g.user.id).in("voucher_id",we);st&&ie(new Set(st.map(ke=>ke.voucher_id)))}}else J([]);Se(!1)})()},[t.id,O,g,j]);const lt=async We=>{if(!g?.user){Jt.error("ng nhp  lu!");return}if(Y.has(We.id))return;const{error:Le}=await Wt.from("user_saved_vouchers").insert({user_id:g.user.id,voucher_id:We.id});Le||(Jt.success(" lu!"),ie(we=>new Set(we).add(We.id)))},ft=()=>{Me(!0),r(t)},mt=()=>{l?l(t):Ue(!0)},gt=f==="en"&&t.name?t.name:t.nameVi,Lt=f==="en"&&t.descriptionEn?t.descriptionEn:t.description,it=MW[t.category||t.type]||"a im";return v.jsxs(v.Fragment,{children:[v.jsxs(_r.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-[60] max-h-[85vh] overflow-y-auto md:max-w-md md:left-auto md:right-4 md:bottom-4 md:rounded-3xl border border-gray-100",children:[v.jsxs("div",{className:"relative h-48 w-full bg-gray-200 cursor-pointer",onClick:mt,children:[v.jsx("img",{src:t.image||"https://images.unsplash.com/photo-1554118811-1e0d58224f24",alt:gt,className:"w-full h-full object-cover",loading:"lazy",onError:We=>{We.currentTarget.src="https://placehold.co/600x400?text=No+Image"}}),v.jsx("button",{onClick:We=>{We.stopPropagation(),e()},className:"absolute top-4 right-4 w-8 h-8 bg-black/50 hover:bg-black/70 rounded-full flex items-center justify-center text-white backdrop-blur-sm",children:v.jsx(xi,{className:"w-5 h-5"})}),v.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[v.jsx("div",{className:"px-3 py-1 bg-white/90 backdrop-blur text-xs font-bold rounded-full uppercase tracking-wider text-gray-800 shadow-sm border border-white/50",children:it}),A&&v.jsxs("div",{className:"px-2 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full flex items-center gap-1 shadow-sm animate-pulse border border-white",children:[v.jsx(fl,{className:"w-3 h-3 fill-yellow-900"}),"VIP"]})]})]}),v.jsxs("div",{className:"p-6",children:[v.jsxs("div",{className:"flex justify-between items-start mb-2 gap-3",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900 leading-tight flex-1",onClick:mt,children:gt}),v.jsxs("div",{className:"flex flex-col items-end gap-2 shrink-0",children:[U?v.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-lg border border-gray-100",children:[v.jsx(ls,{className:"w-3 h-3 animate-spin text-gray-400"}),v.jsx("span",{className:"text-[10px] text-gray-400",children:"ang ti..."})]}):Number(L.rating)>0?v.jsxs("div",{className:"flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded-lg border border-yellow-100",children:[v.jsx(Uf,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),v.jsx("span",{className:"font-bold text-sm text-yellow-700",children:L.rating}),v.jsxs("span",{className:"text-[10px] text-gray-400",children:["(",L.count,")"]})]}):v.jsx("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-lg border border-gray-100",children:v.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Cha c nh gi"})}),v.jsx("button",{onClick:We=>{We.stopPropagation(),s(t)},className:"p-1.5 rounded-full hover:bg-gray-100 active:scale-95 transition-all",children:v.jsx(ih,{className:`w-5 h-5 ${S?"fill-red-500 text-red-500":"text-gray-400"}`})})]})]}),v.jsxs("div",{className:"flex items-start gap-2 text-gray-600 mb-6",children:[v.jsx(Wi,{className:"w-4 h-4 mt-1 flex-shrink-0 text-primary"}),v.jsx("p",{className:"text-sm",children:t.address||"ang cp nht a ch..."})]}),v.jsx("div",{className:"mb-4",children:v.jsxs(vn,{className:"w-full h-12 text-base font-bold bg-primary hover:bg-primary/90 text-white shadow-lg shadow-primary/20 rounded-xl",onClick:ft,disabled:Je,children:[Je?v.jsx(ls,{className:"w-5 h-5 animate-spin mr-2"}):v.jsx(Rv,{className:"w-5 h-5 mr-2"}),Je?"ang x l...":"Ch ng n y"]})}),j&&v.jsxs("div",{className:"mb-6 p-3 bg-blue-50 border border-blue-100 rounded-xl flex flex-col gap-2",children:[v.jsxs("div",{className:"flex items-start gap-2",children:[v.jsx("div",{className:"p-1 bg-blue-100 rounded-full text-blue-600",children:v.jsx(fl,{size:14})}),v.jsxs("div",{children:[v.jsx("p",{className:"text-sm font-bold text-blue-900",children:"Bn l ch a im ny?"}),v.jsx("p",{className:"text-xs text-blue-600",children:"Xc minh ngay  qun l thng tin v hnh nh."})]})]}),v.jsx(vn,{variant:"outline",className:"w-full bg-white text-blue-600 border-blue-200 hover:bg-blue-100 h-9 text-xs font-bold",onClick:()=>u?.(t),children:"Xc nhn ch s hu"})]}),_e?v.jsx("div",{className:"h-16 bg-gray-50 rounded-xl mb-6 flex items-center justify-center",children:v.jsx(ls,{className:"w-4 h-4 animate-spin text-gray-300"})}):Q.length>0&&v.jsxs("div",{className:"mb-6 space-y-3",children:[v.jsxs("h3",{className:"font-bold text-gray-800 flex items-center gap-2",children:[v.jsx(fh,{className:"w-5 h-5 text-orange-500"})," u i (",Q.length,")"]}),Q.slice(0,2).map(We=>{const Le=Y.has(We.id);return v.jsxs("div",{className:"border border-dashed border-orange-200 bg-orange-50/50 rounded-xl p-3 flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsxs("div",{className:"w-10 h-10 bg-white text-orange-600 rounded-lg flex items-center justify-center font-bold text-xs flex-col shadow-sm",children:[v.jsx("span",{children:We.discount_value}),v.jsx("span",{children:We.discount_type==="percent"?"%":"k"})]}),v.jsxs("div",{children:[v.jsx("p",{className:"font-bold text-sm text-gray-900 truncate max-w-[120px]",children:We.title_vi}),v.jsxs("p",{className:"text-xs text-gray-500 font-mono",children:["#",We.code]})]})]}),v.jsx(vn,{size:"sm",variant:Le?"ghost":"default",className:`h-7 px-2 text-xs ${Le?"text-green-600 bg-green-100":"bg-orange-500 text-white"}`,onClick:()=>lt(We),disabled:Le,children:Le?" c":"Lu"})]},We.id)})]}),v.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[v.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[v.jsx(f0,{className:"w-4 h-4 text-gray-400"}),v.jsx("span",{children:"08:00 - 22:00 (M ca)"})]}),v.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[v.jsx(Qy,{className:"w-4 h-4 text-gray-400"}),v.jsx("span",{children:t.phone||"0912 345 678"})]})]}),Lt&&v.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:v.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:Lt})}),v.jsx("div",{className:"mt-6 pt-2 sticky bottom-0 bg-white pb-2 z-10",children:v.jsxs(vn,{variant:"secondary",className:"w-full h-12 font-bold text-gray-800 bg-gray-100 hover:bg-gray-200 border-none shadow-sm flex items-center justify-center gap-2",onClick:mt,children:[A?"Xem Menu & nh ca hng":"Xem chi tit y ",v.jsx(u1,{className:"w-4 h-4"})]})})]})]}),v.jsx(_D,{isOpen:Ie,onClose:()=>Ue(!1),location:t})]})},RW=()=>{const[t,e]=I.useState({origin:null,destination:null,route:null,isLoading:!1,error:null,transportMode:"walking",routePreference:"shortest"}),r=I.useCallback(g=>{e(w=>({...w,transportMode:g}))},[]),l=I.useCallback(g=>{e(w=>({...w,routePreference:g}))},[]),u=I.useCallback(async(g,w,s="walking",S="shortest")=>{e(A=>({...A,origin:g,destination:w,transportMode:s,routePreference:S,isLoading:!0,error:null}));try{const A=O0(),O=await fetch(`https://api.mapbox.com/directions/v5/mapbox/${s==="walking"?"walking":s==="cycling"?"cycling":"driving"}/${g[0]},${g[1]};${w[0]},${w[1]}?geometries=geojson&steps=true&overview=full&alternatives=true&access_token=${A}`);if(!O.ok)throw new Error("Failed to fetch directions");const L=await O.json();if(L.routes&&L.routes.length>0){const U=[...L.routes].sort((Q,J)=>S==="shortest"?Q.distance-J.distance:Q.duration-J.duration)[0],q=[];U.legs&&U.legs.length>0&&U.legs.forEach(Q=>{Q.steps&&Q.steps.forEach(J=>{q.push({instruction:J.maneuver?.instruction||"",distance:J.distance,duration:J.duration,maneuver:{type:J.maneuver?.type||"",modifier:J.maneuver?.modifier}})})}),e(Q=>({...Q,route:{distance:U.distance,duration:U.duration,geometry:U.geometry,steps:q},isLoading:!1}))}else throw new Error("No route found")}catch(A){e(j=>({...j,error:A instanceof Error?A.message:"Unknown error",isLoading:!1}))}},[]),f=I.useCallback(()=>{e(g=>({origin:null,destination:null,route:null,isLoading:!1,error:null,transportMode:g.transportMode,routePreference:g.routePreference}))},[]);return{...t,getDirections:u,clearDirections:f,setTransportMode:r,setRoutePreference:l}},vv=t=>t<1e3?`${Math.round(t)} m`:`${(t/1e3).toFixed(1)} km`,NW=(t,e)=>{if(e==="en")return t;let r=t;const l=[[/Turn left/gi,"R tri"],[/Turn right/gi,"R phi"],[/Turn slight left/gi,"R nh sang tri"],[/Turn slight right/gi,"R nh sang phi"],[/Turn sharp left/gi,"R gp sang tri"],[/Turn sharp right/gi,"R gp sang phi"],[/Slight left/gi,"R nh sang tri"],[/Slight right/gi,"R nh sang phi"],[/Sharp left/gi,"R gp sang tri"],[/Sharp right/gi,"R gp sang phi"],[/Continue straight/gi,"Tip tc i thng"],[/Continue on/gi,"Tip tc theo"],[/Continue/gi,"Tip tc"],[/Go straight/gi,"i thng"],[/Head (north|south|east|west)/gi,"i v hng $1"],[/north/gi,"bc"],[/south/gi,"nam"],[/east/gi,"ng"],[/west/gi,"ty"],[/northeast/gi,"ng bc"],[/northwest/gi,"ty bc"],[/southeast/gi,"ng nam"],[/southwest/gi,"ty nam"],[/You have arrived at your destination/gi,"Bn  n im ch"],[/You have arrived/gi,"Bn  n ni"],[/Arrive at/gi,"n"],[/Your destination is on the left/gi,"im n  bn tri"],[/Your destination is on the right/gi,"im n  bn phi"],[/destination/gi,"im n"],[/Make a U-turn/gi,"Quay u"],[/U-turn/gi,"Quay u"],[/Enter the roundabout/gi,"i vo vng xuyn"],[/Exit the roundabout/gi,"Ra khi vng xuyn"],[/roundabout/gi,"vng xuyn"],[/Take the exit/gi,"i theo li ra"],[/Merge/gi,"Nhp ln"],[/Fork left/gi,"R tri ti ng ba"],[/Fork right/gi,"R phi ti ng ba"],[/Keep left/gi,"i bn tri"],[/Keep right/gi,"i bn phi"],[/for (\d+) meters/gi,"trong $1 mt"],[/for (\d+) m/gi,"trong $1 mt"],[/for (\d+\.?\d*) kilometers/gi,"trong $1 km"],[/for (\d+\.?\d*) km/gi,"trong $1 km"],[/onto/gi,"vo"],[/on the left/gi," bn tri"],[/on the right/gi," bn phi"],[/on your left/gi,"bn tri bn"],[/on your right/gi,"bn phi bn"],[/at the end of the road/gi," cui ng"],[/at the intersection/gi,"ti ng t"]];for(const[u,f]of l)r=r.replace(u,f);return r},HA=(t,e)=>{switch(t){case"turn":return e==="left"||e==="slight left"||e==="sharp left"?v.jsx(Jx,{className:"w-4 h-4"}):e==="right"||e==="slight right"||e==="sharp right"?v.jsx(Qx,{className:"w-4 h-4"}):v.jsx(UE,{className:"w-4 h-4"});case"depart":return v.jsx(Wi,{className:"w-4 h-4"});case"arrive":return v.jsx(v5,{className:"w-4 h-4"});case"merge":case"on ramp":case"off ramp":return e?.includes("left")?v.jsx(h0,{className:"w-4 h-4"}):v.jsx(u1,{className:"w-4 h-4"});case"fork":return e?.includes("left")?v.jsx(Jx,{className:"w-4 h-4"}):v.jsx(Qx,{className:"w-4 h-4"});case"end of road":return e?.includes("left")?v.jsx(Jx,{className:"w-4 h-4"}):v.jsx(Qx,{className:"w-4 h-4"});default:return v.jsx(UE,{className:"w-4 h-4"})}},jW=({routeInfo:t,destinationName:e,isLoading:r,transportMode:l,routePreference:u,currentStepIndex:f=0,distanceToNextStep:g=0,isTracking:w=!1,userAccuracy:s,onClose:S,onChangeTransportMode:A,onChangeRoutePreference:j,onAddStop:O})=>{const{t:L,language:W}=da(),[U,q]=I.useState(!1),[Q,J]=I.useState(!1),Y=Ie=>NW(Ie,W)||L("continueStright"),ie=Ie=>{const Ue=Math.round(Ie/60);return Ue>=60?`${Math.floor(Ue/60)}g ${Ue%60}p`:`${Ue} pht`},_e=t.steps[f],Se=[{mode:"walking",icon:$P,labelKey:"walking"},{mode:"cycling",icon:FP,labelKey:"cycling"},{mode:"driving",icon:VP,labelKey:"driving"}];return Q?v.jsx(_r.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},className:"absolute top-16 left-3 right-3 z-30",children:v.jsxs("button",{onClick:()=>J(!1),className:"w-full flex items-center gap-2 px-3 py-2 bg-card/95 backdrop-blur-sm rounded-full shadow-lg border border-border",children:[v.jsx(Rv,{className:"w-4 h-4 text-primary"}),v.jsx("span",{className:"text-xs font-medium text-foreground truncate flex-1 text-left",children:e}),v.jsx("span",{className:"text-xs font-bold text-primary",children:vv(t.distance)}),v.jsx("span",{className:"text-xs text-muted-foreground",children:ie(t.duration)}),v.jsx(Hf,{className:"w-3.5 h-3.5 text-muted-foreground"})]})}):v.jsx(_r.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},className:"absolute top-16 left-3 right-3 z-30",children:v.jsxs("div",{className:"bg-card/95 backdrop-blur-sm rounded-xl shadow-lg border border-border p-2",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(Rv,{className:"w-4 h-4 text-primary flex-shrink-0"}),v.jsx("span",{className:"text-xs font-medium text-foreground truncate flex-1",children:e}),v.jsx("div",{className:"flex bg-muted/50 rounded-md p-0.5",children:Se.map(({mode:Ie,icon:Ue})=>v.jsx("button",{onClick:()=>A(Ie),className:cn("p-1 rounded transition-all",l===Ie?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:v.jsx(Ue,{className:"w-3 h-3"})},Ie))}),v.jsx("span",{className:"text-xs font-bold text-primary",children:vv(t.distance)}),v.jsx("span",{className:"text-xs text-muted-foreground",children:ie(t.duration)}),O&&v.jsx("button",{onClick:O,className:"p-1 hover:bg-blue-100 text-blue-600 rounded transition-colors",title:"Thm im dng",children:v.jsx(Sm,{className:"w-3.5 h-3.5"})}),t.steps?.length>0&&v.jsx("button",{onClick:()=>q(!U),className:"p-1 hover:bg-muted rounded",children:U?v.jsx(Lm,{className:"w-3.5 h-3.5 text-muted-foreground"}):v.jsx(Hf,{className:"w-3.5 h-3.5 text-muted-foreground"})}),v.jsx("button",{onClick:()=>J(!0),className:"p-1 hover:bg-muted rounded",children:v.jsx(Lm,{className:"w-3.5 h-3.5 text-muted-foreground"})}),v.jsx("button",{onClick:S,className:"p-1 hover:bg-destructive/20 rounded",children:v.jsx(xi,{className:"w-3.5 h-3.5 text-muted-foreground"})})]}),r&&v.jsx("div",{className:"flex items-center justify-center py-2",children:v.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})}),w&&_e&&v.jsxs("div",{className:"mt-2 p-2 bg-primary/10 rounded-lg flex items-center gap-2",children:[v.jsx("div",{className:"w-5 h-5 bg-primary rounded-full flex items-center justify-center flex-shrink-0 text-primary-foreground",children:HA(_e.maneuver.type,_e.maneuver.modifier)}),v.jsx("p",{className:"text-xs text-foreground flex-1 truncate",children:Y(_e.instruction)}),g>0&&v.jsx("span",{className:"text-xs text-primary font-medium",children:vv(g)})]}),v.jsx(Da,{children:U&&t.steps&&v.jsx(_r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:v.jsx(L0,{className:"max-h-40 mt-2 border-t border-border pt-2",children:v.jsx("div",{className:"space-y-1",children:t.steps.map((Ie,Ue)=>{const Je=w&&Ue===f,Me=w&&Ue<f;return v.jsxs("div",{className:cn("flex items-center gap-2 p-1.5 rounded-lg text-xs",Je?"bg-primary/20":Me?"opacity-50":"bg-muted/30"),children:[v.jsx("div",{className:cn("w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 text-[10px]",Je||Ue===0?"bg-primary text-primary-foreground":Ue===t.steps.length-1?"bg-destructive text-destructive-foreground":"bg-muted text-muted-foreground"),children:Me?"":HA(Ie.maneuver.type,Ie.maneuver.modifier)}),v.jsx("span",{className:"flex-1 truncate text-foreground",children:Y(Ie.instruction)}),v.jsx("span",{className:"text-muted-foreground",children:vv(Ie.distance)})]},Ue)})})})})})]})})},DW=()=>{const[t,e]=I.useState({origin:null,waypoints:[],route:null,isLoading:!1,error:null,transportMode:"walking"}),r=I.useCallback(S=>{e(A=>({...A,transportMode:S}))},[]),l=I.useCallback(S=>{e(A=>({...A,waypoints:[...A.waypoints,S]}))},[]),u=I.useCallback(S=>{e(A=>({...A,waypoints:A.waypoints.filter((j,O)=>O!==S)}))},[]),f=I.useCallback(S=>{e(A=>({...A,waypoints:S}))},[]),g=I.useCallback(()=>{e(S=>({...S,waypoints:[],route:null}))},[]),w=I.useCallback(async(S,A,j="walking")=>{if(A.length!==0){e(O=>({...O,origin:S,waypoints:A,transportMode:j,isLoading:!0,error:null}));try{const O=O0(),L=j==="walking"?"walking":j==="cycling"?"cycling":"driving",W=[S,...A],U=W.map(J=>`${J.coordinates[0]},${J.coordinates[1]}`).join(";"),q=await fetch(`https://api.mapbox.com/directions/v5/mapbox/${L}/${U}?geometries=geojson&steps=true&overview=full&access_token=${O}`);if(!q.ok)throw new Error("Failed to fetch directions");const Q=await q.json();if(Q.routes&&Q.routes.length>0){const J=Q.routes[0],Y=J.legs.map((ie,_e)=>{const Se=ie.steps?.map(Ie=>({instruction:Ie.maneuver?.instruction||"",distance:Ie.distance,duration:Ie.duration,maneuver:{type:Ie.maneuver?.type||"",modifier:Ie.maneuver?.modifier}}))||[];return{distance:ie.distance,duration:ie.duration,steps:Se,originName:_e===0?S.name:A[_e-1].name,destinationName:A[_e].name}});e(ie=>({...ie,route:{totalDistance:J.distance,totalDuration:J.duration,geometry:J.geometry,legs:Y,waypoints:W},isLoading:!1}))}else throw new Error("No route found")}catch(O){e(L=>({...L,error:O instanceof Error?O.message:"Unknown error",isLoading:!1}))}}},[]),s=I.useCallback(()=>{e({origin:null,waypoints:[],route:null,isLoading:!1,error:null,transportMode:t.transportMode})},[t.transportMode]);return{...t,addWaypoint:l,removeWaypoint:u,reorderWaypoints:f,clearWaypoints:g,getMultiStopDirections:w,clearRoute:s,setTransportMode:r}},$w=t=>t<1e3?`${Math.round(t)} m`:`${(t/1e3).toFixed(1)} km`,qA=(t,e="vi")=>{const r=Math.round(t/60),l=e==="vi"?"pht":"min",u=e==="vi"?"gi":"hr";if(r<60)return`${r} ${l}`;const f=Math.floor(r/60),g=r%60;return`${f} ${u} ${g} ${l}`},LW=({routeInfo:t,waypoints:e,isLoading:r,transportMode:l,onClose:u,onChangeTransportMode:f,onRemoveWaypoint:g,onReorderWaypoints:w,onAddStop:s,isAddingStop:S})=>{const{t:A,language:j}=da(),[O,L]=I.useState(null),[W,U]=I.useState(!1),[q,Q]=I.useState(!1),J=t?.waypoints.slice(1)||[],Y=[{mode:"walking",icon:$P,labelKey:"walking"},{mode:"cycling",icon:FP,labelKey:"cycling"},{mode:"driving",icon:VP,labelKey:"driving"}];return q?v.jsx(_r.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:-50,opacity:0},className:"absolute top-16 left-3 right-3 z-30",children:v.jsxs("button",{onClick:()=>Q(!1),className:"w-full flex items-center gap-2 px-3 py-2 bg-card/95 backdrop-blur-sm rounded-full shadow-lg border border-border",children:[v.jsx(GE,{className:"w-4 h-4 text-purple-500"}),v.jsxs("span",{className:"text-xs font-medium text-foreground",children:[e.length," ",j==="vi"?"im":"stops"]}),t&&v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"text-xs font-bold text-purple-600",children:$w(t.totalDistance)}),v.jsx("span",{className:"text-xs text-muted-foreground",children:qA(t.totalDuration,j)})]}),v.jsx(Hf,{className:"w-3.5 h-3.5 text-muted-foreground ml-auto"})]})}):v.jsx(_r.div,{initial:{y:-100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},className:"absolute top-16 left-3 right-3 z-30",children:v.jsxs("div",{className:"bg-card/95 backdrop-blur-sm rounded-xl shadow-lg border border-border p-2",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v.jsx(GE,{className:"w-4 h-4 text-purple-500 flex-shrink-0"}),v.jsxs("span",{className:"text-xs font-medium text-foreground",children:[e.length," ",j==="vi"?"im":"stops"]}),v.jsx("div",{className:"flex bg-muted/50 rounded-md p-0.5",children:Y.map(({mode:ie,icon:_e})=>v.jsx("button",{onClick:()=>f(ie),className:cn("p-1 rounded transition-all",l===ie?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:v.jsx(_e,{className:"w-3 h-3"})},ie))}),t&&v.jsxs(v.Fragment,{children:[v.jsx("span",{className:"text-xs font-bold text-purple-600",children:$w(t.totalDistance)}),v.jsx("span",{className:"text-xs text-muted-foreground",children:qA(t.totalDuration,j)})]}),v.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[v.jsx("button",{onClick:()=>Q(!0),className:"p-1 hover:bg-muted rounded",children:v.jsx(Lm,{className:"w-3.5 h-3.5 text-muted-foreground"})}),v.jsx("button",{onClick:u,className:"p-1 hover:bg-destructive/20 rounded",children:v.jsx(xi,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]}),v.jsx(L0,{className:"max-h-28 mb-2",children:v.jsxs("div",{className:"space-y-1",children:[t?.waypoints[0]&&v.jsxs("div",{className:"flex items-center gap-1.5 p-1 bg-muted/30 rounded-lg",children:[v.jsx("div",{className:"w-5 h-5 rounded-full bg-green-500 flex items-center justify-center text-white text-[10px]",children:""}),v.jsx("span",{className:"text-[10px] text-foreground truncate flex-1",children:t.waypoints[0].name})]}),J.length>0&&v.jsx(j7,{axis:"y",values:J,onReorder:w,className:"space-y-1",children:J.map((ie,_e)=>{const Se=_e===J.length-1;return v.jsx($7,{value:ie,onDragStart:()=>U(!0),onDragEnd:()=>U(!1),className:"cursor-grab active:cursor-grabbing",whileDrag:{scale:1.02,zIndex:50},children:v.jsxs("div",{className:cn("flex items-center gap-1.5 p-1 rounded-lg",W?"bg-muted":"bg-muted/30"),children:[v.jsx(w5,{className:"w-3 h-3 text-muted-foreground flex-shrink-0"}),v.jsx("div",{className:cn("w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold text-white",Se?"bg-destructive":"bg-primary"),children:Se?"":_e+1}),v.jsx("span",{className:"text-[10px] text-foreground truncate flex-1",children:ie.name}),t?.legs[_e]&&v.jsx("span",{className:"text-[10px] text-muted-foreground",children:$w(t.legs[_e].distance)}),v.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),g(_e)},className:"w-4 h-4 hover:bg-destructive/20 rounded flex items-center justify-center",children:v.jsx(ch,{className:"w-2.5 h-2.5 text-destructive"})})]})},ie.name+_e)})})]})}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsxs(vn,{onClick:s,variant:"outline",size:"sm",className:"h-6 text-[10px] border-dashed flex-1",disabled:S,children:[v.jsx(Sm,{className:"w-3 h-3 mr-1"}),S?j==="vi"?"Chn...":"Select...":j==="vi"?"Thm im":"Add stop"]}),r&&v.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})]})]})})};var Cr;(function(t){t.assertEqual=u=>{};function e(u){}t.assertIs=e;function r(u){throw new Error}t.assertNever=r,t.arrayToEnum=u=>{const f={};for(const g of u)f[g]=g;return f},t.getValidEnumValues=u=>{const f=t.objectKeys(u).filter(w=>typeof u[u[w]]!="number"),g={};for(const w of f)g[w]=u[w];return t.objectValues(g)},t.objectValues=u=>t.objectKeys(u).map(function(f){return u[f]}),t.objectKeys=typeof Object.keys=="function"?u=>Object.keys(u):u=>{const f=[];for(const g in u)Object.prototype.hasOwnProperty.call(u,g)&&f.push(g);return f},t.find=(u,f)=>{for(const g of u)if(f(g))return g},t.isInteger=typeof Number.isInteger=="function"?u=>Number.isInteger(u):u=>typeof u=="number"&&Number.isFinite(u)&&Math.floor(u)===u;function l(u,f=" | "){return u.map(g=>typeof g=="string"?`'${g}'`:g).join(f)}t.joinValues=l,t.jsonStringifyReplacer=(u,f)=>typeof f=="bigint"?f.toString():f})(Cr||(Cr={}));var WA;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(WA||(WA={}));const wn=Cr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),nh=t=>{switch(typeof t){case"undefined":return wn.undefined;case"string":return wn.string;case"number":return Number.isNaN(t)?wn.nan:wn.number;case"boolean":return wn.boolean;case"function":return wn.function;case"bigint":return wn.bigint;case"symbol":return wn.symbol;case"object":return Array.isArray(t)?wn.array:t===null?wn.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?wn.promise:typeof Map<"u"&&t instanceof Map?wn.map:typeof Set<"u"&&t instanceof Set?wn.set:typeof Date<"u"&&t instanceof Date?wn.date:wn.object;default:return wn.unknown}},qt=Cr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class su extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=l=>{this.issues=[...this.issues,l]},this.addIssues=(l=[])=>{this.issues=[...this.issues,...l]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){const r=e||function(f){return f.message},l={_errors:[]},u=f=>{for(const g of f.issues)if(g.code==="invalid_union")g.unionErrors.map(u);else if(g.code==="invalid_return_type")u(g.returnTypeError);else if(g.code==="invalid_arguments")u(g.argumentsError);else if(g.path.length===0)l._errors.push(r(g));else{let w=l,s=0;for(;s<g.path.length;){const S=g.path[s];s===g.path.length-1?(w[S]=w[S]||{_errors:[]},w[S]._errors.push(r(g))):w[S]=w[S]||{_errors:[]},w=w[S],s++}}};return u(this),l}static assert(e){if(!(e instanceof su))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Cr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},l=[];for(const u of this.issues)if(u.path.length>0){const f=u.path[0];r[f]=r[f]||[],r[f].push(e(u))}else l.push(e(u));return{formErrors:l,fieldErrors:r}}get formErrors(){return this.flatten()}}su.create=t=>new su(t);const Qb=(t,e)=>{let r;switch(t.code){case qt.invalid_type:t.received===wn.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case qt.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Cr.jsonStringifyReplacer)}`;break;case qt.unrecognized_keys:r=`Unrecognized key(s) in object: ${Cr.joinValues(t.keys,", ")}`;break;case qt.invalid_union:r="Invalid input";break;case qt.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Cr.joinValues(t.options)}`;break;case qt.invalid_enum_value:r=`Invalid enum value. Expected ${Cr.joinValues(t.options)}, received '${t.received}'`;break;case qt.invalid_arguments:r="Invalid function arguments";break;case qt.invalid_return_type:r="Invalid function return type";break;case qt.invalid_date:r="Invalid date";break;case qt.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Cr.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case qt.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case qt.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case qt.custom:r="Invalid input";break;case qt.invalid_intersection_types:r="Intersection results could not be merged";break;case qt.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case qt.not_finite:r="Number must be finite";break;default:r=e.defaultError,Cr.assertNever(t)}return{message:r}};let OW=Qb;function zW(){return OW}const BW=t=>{const{data:e,path:r,errorMaps:l,issueData:u}=t,f=[...r,...u.path||[]],g={...u,path:f};if(u.message!==void 0)return{...u,path:f,message:u.message};let w="";const s=l.filter(S=>!!S).slice().reverse();for(const S of s)w=S(g,{data:e,defaultError:w}).message;return{...u,path:f,message:w}};function an(t,e){const r=zW(),l=BW({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Qb?void 0:Qb].filter(u=>!!u)});t.common.issues.push(l)}class Oa{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const l=[];for(const u of r){if(u.status==="aborted")return Xn;u.status==="dirty"&&e.dirty(),l.push(u.value)}return{status:e.value,value:l}}static async mergeObjectAsync(e,r){const l=[];for(const u of r){const f=await u.key,g=await u.value;l.push({key:f,value:g})}return Oa.mergeObjectSync(e,l)}static mergeObjectSync(e,r){const l={};for(const u of r){const{key:f,value:g}=u;if(f.status==="aborted"||g.status==="aborted")return Xn;f.status==="dirty"&&e.dirty(),g.status==="dirty"&&e.dirty(),f.value!=="__proto__"&&(typeof g.value<"u"||u.alwaysSet)&&(l[f.value]=g.value)}return{status:e.value,value:l}}}const Xn=Object.freeze({status:"aborted"}),uy=t=>({status:"dirty",value:t}),_l=t=>({status:"valid",value:t}),ZA=t=>t.status==="aborted",KA=t=>t.status==="dirty",Um=t=>t.status==="valid",e0=t=>typeof Promise<"u"&&t instanceof Promise;var Sn;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(Sn||(Sn={}));class _h{constructor(e,r,l,u){this._cachedPath=[],this.parent=e,this.data=r,this._path=l,this._key=u}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const XA=(t,e)=>{if(Um(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new su(t.common.issues);return this._error=r,this._error}}};function pr(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:l,description:u}=t;if(e&&(r||l))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:u}:{errorMap:(g,w)=>{const{message:s}=t;return g.code==="invalid_enum_value"?{message:s??w.defaultError}:typeof w.data>"u"?{message:s??l??w.defaultError}:g.code!=="invalid_type"?{message:w.defaultError}:{message:s??r??w.defaultError}},description:u}}class br{get description(){return this._def.description}_getType(e){return nh(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:nh(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Oa,ctx:{common:e.parent.common,data:e.data,parsedType:nh(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(e0(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const l=this.safeParse(e,r);if(l.success)return l.data;throw l.error}safeParse(e,r){const l={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:nh(e)},u=this._parseSync({data:e,path:l.path,parent:l});return XA(l,u)}"~validate"(e){const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:nh(e)};if(!this["~standard"].async)try{const l=this._parseSync({data:e,path:[],parent:r});return Um(l)?{value:l.value}:{issues:r.common.issues}}catch(l){l?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(l=>Um(l)?{value:l.value}:{issues:r.common.issues})}async parseAsync(e,r){const l=await this.safeParseAsync(e,r);if(l.success)return l.data;throw l.error}async safeParseAsync(e,r){const l={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:nh(e)},u=this._parse({data:e,path:l.path,parent:l}),f=await(e0(u)?u:Promise.resolve(u));return XA(l,f)}refine(e,r){const l=u=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(u):r;return this._refinement((u,f)=>{const g=e(u),w=()=>f.addIssue({code:qt.custom,...l(u)});return typeof Promise<"u"&&g instanceof Promise?g.then(s=>s?!0:(w(),!1)):g?!0:(w(),!1)})}refinement(e,r){return this._refinement((l,u)=>e(l)?!0:(u.addIssue(typeof r=="function"?r(l,u):r),!1))}_refinement(e){return new Gm({schema:this,typeName:Yn.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return dh.create(this,this._def)}nullable(){return Hm.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return nu.create(this)}promise(){return i0.create(this,this._def)}or(e){return n0.create([this,e],this._def)}and(e){return r0.create(this,e,this._def)}transform(e){return new Gm({...pr(this._def),schema:this,typeName:Yn.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new t1({...pr(this._def),innerType:this,defaultValue:r,typeName:Yn.ZodDefault})}brand(){return new lZ({typeName:Yn.ZodBranded,type:this,...pr(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new n1({...pr(this._def),innerType:this,catchValue:r,typeName:Yn.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return VT.create(this,e)}readonly(){return r1.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const FW=/^c[^\s-]{8,}$/i,VW=/^[0-9a-z]+$/,UW=/^[0-9A-HJKMNP-TV-Z]{26}$/i,$W=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,GW=/^[a-z0-9_-]{21}$/i,HW=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,qW=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,WW=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ZW="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Gw;const KW=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,XW=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,YW=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,JW=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,QW=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,eZ=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,vD="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tZ=new RegExp(`^${vD}$`);function xD(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const r=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${r}`}function nZ(t){return new RegExp(`^${xD(t)}$`)}function rZ(t){let e=`${vD}T${xD(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function iZ(t,e){return!!((e==="v4"||!e)&&KW.test(t)||(e==="v6"||!e)&&YW.test(t))}function sZ(t,e){if(!HW.test(t))return!1;try{const[r]=t.split(".");if(!r)return!1;const l=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),u=JSON.parse(atob(l));return!(typeof u!="object"||u===null||"typ"in u&&u?.typ!=="JWT"||!u.alg||e&&u.alg!==e)}catch{return!1}}function oZ(t,e){return!!((e==="v4"||!e)&&XW.test(t)||(e==="v6"||!e)&&JW.test(t))}class ah extends br{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==wn.string){const f=this._getOrReturnCtx(e);return an(f,{code:qt.invalid_type,expected:wn.string,received:f.parsedType}),Xn}const l=new Oa;let u;for(const f of this._def.checks)if(f.kind==="min")e.data.length<f.value&&(u=this._getOrReturnCtx(e,u),an(u,{code:qt.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),l.dirty());else if(f.kind==="max")e.data.length>f.value&&(u=this._getOrReturnCtx(e,u),an(u,{code:qt.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!1,message:f.message}),l.dirty());else if(f.kind==="length"){const g=e.data.length>f.value,w=e.data.length<f.value;(g||w)&&(u=this._getOrReturnCtx(e,u),g?an(u,{code:qt.too_big,maximum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}):w&&an(u,{code:qt.too_small,minimum:f.value,type:"string",inclusive:!0,exact:!0,message:f.message}),l.dirty())}else if(f.kind==="email")WW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"email",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="emoji")Gw||(Gw=new RegExp(ZW,"u")),Gw.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"emoji",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="uuid")$W.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"uuid",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="nanoid")GW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"nanoid",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="cuid")FW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"cuid",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="cuid2")VW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"cuid2",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="ulid")UW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"ulid",code:qt.invalid_string,message:f.message}),l.dirty());else if(f.kind==="url")try{new URL(e.data)}catch{u=this._getOrReturnCtx(e,u),an(u,{validation:"url",code:qt.invalid_string,message:f.message}),l.dirty()}else f.kind==="regex"?(f.regex.lastIndex=0,f.regex.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"regex",code:qt.invalid_string,message:f.message}),l.dirty())):f.kind==="trim"?e.data=e.data.trim():f.kind==="includes"?e.data.includes(f.value,f.position)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:{includes:f.value,position:f.position},message:f.message}),l.dirty()):f.kind==="toLowerCase"?e.data=e.data.toLowerCase():f.kind==="toUpperCase"?e.data=e.data.toUpperCase():f.kind==="startsWith"?e.data.startsWith(f.value)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:{startsWith:f.value},message:f.message}),l.dirty()):f.kind==="endsWith"?e.data.endsWith(f.value)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:{endsWith:f.value},message:f.message}),l.dirty()):f.kind==="datetime"?rZ(f).test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:"datetime",message:f.message}),l.dirty()):f.kind==="date"?tZ.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:"date",message:f.message}),l.dirty()):f.kind==="time"?nZ(f).test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{code:qt.invalid_string,validation:"time",message:f.message}),l.dirty()):f.kind==="duration"?qW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"duration",code:qt.invalid_string,message:f.message}),l.dirty()):f.kind==="ip"?iZ(e.data,f.version)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"ip",code:qt.invalid_string,message:f.message}),l.dirty()):f.kind==="jwt"?sZ(e.data,f.alg)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"jwt",code:qt.invalid_string,message:f.message}),l.dirty()):f.kind==="cidr"?oZ(e.data,f.version)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"cidr",code:qt.invalid_string,message:f.message}),l.dirty()):f.kind==="base64"?QW.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"base64",code:qt.invalid_string,message:f.message}),l.dirty()):f.kind==="base64url"?eZ.test(e.data)||(u=this._getOrReturnCtx(e,u),an(u,{validation:"base64url",code:qt.invalid_string,message:f.message}),l.dirty()):Cr.assertNever(f);return{status:l.value,value:e.data}}_regex(e,r,l){return this.refinement(u=>e.test(u),{validation:r,code:qt.invalid_string,...Sn.errToObj(l)})}_addCheck(e){return new ah({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Sn.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Sn.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Sn.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Sn.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Sn.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Sn.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Sn.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Sn.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Sn.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Sn.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Sn.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Sn.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Sn.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Sn.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Sn.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Sn.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...Sn.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...Sn.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...Sn.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...Sn.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...Sn.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...Sn.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...Sn.errToObj(r)})}nonempty(e){return this.min(1,Sn.errToObj(e))}trim(){return new ah({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ah({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ah({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}ah.create=t=>new ah({checks:[],typeName:Yn.ZodString,coerce:t?.coerce??!1,...pr(t)});function aZ(t,e){const r=(t.toString().split(".")[1]||"").length,l=(e.toString().split(".")[1]||"").length,u=r>l?r:l,f=Number.parseInt(t.toFixed(u).replace(".","")),g=Number.parseInt(e.toFixed(u).replace(".",""));return f%g/10**u}class Hy extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==wn.number){const f=this._getOrReturnCtx(e);return an(f,{code:qt.invalid_type,expected:wn.number,received:f.parsedType}),Xn}let l;const u=new Oa;for(const f of this._def.checks)f.kind==="int"?Cr.isInteger(e.data)||(l=this._getOrReturnCtx(e,l),an(l,{code:qt.invalid_type,expected:"integer",received:"float",message:f.message}),u.dirty()):f.kind==="min"?(f.inclusive?e.data<f.value:e.data<=f.value)&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.too_small,minimum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),u.dirty()):f.kind==="max"?(f.inclusive?e.data>f.value:e.data>=f.value)&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.too_big,maximum:f.value,type:"number",inclusive:f.inclusive,exact:!1,message:f.message}),u.dirty()):f.kind==="multipleOf"?aZ(e.data,f.value)!==0&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.not_multiple_of,multipleOf:f.value,message:f.message}),u.dirty()):f.kind==="finite"?Number.isFinite(e.data)||(l=this._getOrReturnCtx(e,l),an(l,{code:qt.not_finite,message:f.message}),u.dirty()):Cr.assertNever(f);return{status:u.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,Sn.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Sn.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Sn.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Sn.toString(r))}setLimit(e,r,l,u){return new Hy({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:l,message:Sn.toString(u)}]})}_addCheck(e){return new Hy({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Sn.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Sn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Sn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Sn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Sn.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Sn.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:Sn.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Sn.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Sn.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Cr.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const l of this._def.checks){if(l.kind==="finite"||l.kind==="int"||l.kind==="multipleOf")return!0;l.kind==="min"?(r===null||l.value>r)&&(r=l.value):l.kind==="max"&&(e===null||l.value<e)&&(e=l.value)}return Number.isFinite(r)&&Number.isFinite(e)}}Hy.create=t=>new Hy({checks:[],typeName:Yn.ZodNumber,coerce:t?.coerce||!1,...pr(t)});class qy extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==wn.bigint)return this._getInvalidInput(e);let l;const u=new Oa;for(const f of this._def.checks)f.kind==="min"?(f.inclusive?e.data<f.value:e.data<=f.value)&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.too_small,type:"bigint",minimum:f.value,inclusive:f.inclusive,message:f.message}),u.dirty()):f.kind==="max"?(f.inclusive?e.data>f.value:e.data>=f.value)&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.too_big,type:"bigint",maximum:f.value,inclusive:f.inclusive,message:f.message}),u.dirty()):f.kind==="multipleOf"?e.data%f.value!==BigInt(0)&&(l=this._getOrReturnCtx(e,l),an(l,{code:qt.not_multiple_of,multipleOf:f.value,message:f.message}),u.dirty()):Cr.assertNever(f);return{status:u.value,value:e.data}}_getInvalidInput(e){const r=this._getOrReturnCtx(e);return an(r,{code:qt.invalid_type,expected:wn.bigint,received:r.parsedType}),Xn}gte(e,r){return this.setLimit("min",e,!0,Sn.toString(r))}gt(e,r){return this.setLimit("min",e,!1,Sn.toString(r))}lte(e,r){return this.setLimit("max",e,!0,Sn.toString(r))}lt(e,r){return this.setLimit("max",e,!1,Sn.toString(r))}setLimit(e,r,l,u){return new qy({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:l,message:Sn.toString(u)}]})}_addCheck(e){return new qy({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Sn.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Sn.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Sn.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Sn.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:Sn.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}qy.create=t=>new qy({checks:[],typeName:Yn.ZodBigInt,coerce:t?.coerce??!1,...pr(t)});class YA extends br{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==wn.boolean){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.boolean,received:l.parsedType}),Xn}return _l(e.data)}}YA.create=t=>new YA({typeName:Yn.ZodBoolean,coerce:t?.coerce||!1,...pr(t)});class t0 extends br{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==wn.date){const f=this._getOrReturnCtx(e);return an(f,{code:qt.invalid_type,expected:wn.date,received:f.parsedType}),Xn}if(Number.isNaN(e.data.getTime())){const f=this._getOrReturnCtx(e);return an(f,{code:qt.invalid_date}),Xn}const l=new Oa;let u;for(const f of this._def.checks)f.kind==="min"?e.data.getTime()<f.value&&(u=this._getOrReturnCtx(e,u),an(u,{code:qt.too_small,message:f.message,inclusive:!0,exact:!1,minimum:f.value,type:"date"}),l.dirty()):f.kind==="max"?e.data.getTime()>f.value&&(u=this._getOrReturnCtx(e,u),an(u,{code:qt.too_big,message:f.message,inclusive:!0,exact:!1,maximum:f.value,type:"date"}),l.dirty()):Cr.assertNever(f);return{status:l.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t0({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:Sn.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:Sn.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}t0.create=t=>new t0({checks:[],coerce:t?.coerce||!1,typeName:Yn.ZodDate,...pr(t)});class JA extends br{_parse(e){if(this._getType(e)!==wn.symbol){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.symbol,received:l.parsedType}),Xn}return _l(e.data)}}JA.create=t=>new JA({typeName:Yn.ZodSymbol,...pr(t)});class QA extends br{_parse(e){if(this._getType(e)!==wn.undefined){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.undefined,received:l.parsedType}),Xn}return _l(e.data)}}QA.create=t=>new QA({typeName:Yn.ZodUndefined,...pr(t)});class eP extends br{_parse(e){if(this._getType(e)!==wn.null){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.null,received:l.parsedType}),Xn}return _l(e.data)}}eP.create=t=>new eP({typeName:Yn.ZodNull,...pr(t)});class tP extends br{constructor(){super(...arguments),this._any=!0}_parse(e){return _l(e.data)}}tP.create=t=>new tP({typeName:Yn.ZodAny,...pr(t)});class nP extends br{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _l(e.data)}}nP.create=t=>new nP({typeName:Yn.ZodUnknown,...pr(t)});class vh extends br{_parse(e){const r=this._getOrReturnCtx(e);return an(r,{code:qt.invalid_type,expected:wn.never,received:r.parsedType}),Xn}}vh.create=t=>new vh({typeName:Yn.ZodNever,...pr(t)});class rP extends br{_parse(e){if(this._getType(e)!==wn.undefined){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.void,received:l.parsedType}),Xn}return _l(e.data)}}rP.create=t=>new rP({typeName:Yn.ZodVoid,...pr(t)});class nu extends br{_parse(e){const{ctx:r,status:l}=this._processInputParams(e),u=this._def;if(r.parsedType!==wn.array)return an(r,{code:qt.invalid_type,expected:wn.array,received:r.parsedType}),Xn;if(u.exactLength!==null){const g=r.data.length>u.exactLength.value,w=r.data.length<u.exactLength.value;(g||w)&&(an(r,{code:g?qt.too_big:qt.too_small,minimum:w?u.exactLength.value:void 0,maximum:g?u.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:u.exactLength.message}),l.dirty())}if(u.minLength!==null&&r.data.length<u.minLength.value&&(an(r,{code:qt.too_small,minimum:u.minLength.value,type:"array",inclusive:!0,exact:!1,message:u.minLength.message}),l.dirty()),u.maxLength!==null&&r.data.length>u.maxLength.value&&(an(r,{code:qt.too_big,maximum:u.maxLength.value,type:"array",inclusive:!0,exact:!1,message:u.maxLength.message}),l.dirty()),r.common.async)return Promise.all([...r.data].map((g,w)=>u.type._parseAsync(new _h(r,g,r.path,w)))).then(g=>Oa.mergeArray(l,g));const f=[...r.data].map((g,w)=>u.type._parseSync(new _h(r,g,r.path,w)));return Oa.mergeArray(l,f)}get element(){return this._def.type}min(e,r){return new nu({...this._def,minLength:{value:e,message:Sn.toString(r)}})}max(e,r){return new nu({...this._def,maxLength:{value:e,message:Sn.toString(r)}})}length(e,r){return new nu({...this._def,exactLength:{value:e,message:Sn.toString(r)}})}nonempty(e){return this.min(1,e)}}nu.create=(t,e)=>new nu({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Yn.ZodArray,...pr(e)});function wm(t){if(t instanceof bs){const e={};for(const r in t.shape){const l=t.shape[r];e[r]=dh.create(wm(l))}return new bs({...t._def,shape:()=>e})}else return t instanceof nu?new nu({...t._def,type:wm(t.element)}):t instanceof dh?dh.create(wm(t.unwrap())):t instanceof Hm?Hm.create(wm(t.unwrap())):t instanceof Qf?Qf.create(t.items.map(e=>wm(e))):t}class bs extends br{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=Cr.objectKeys(e);return this._cached={shape:e,keys:r},this._cached}_parse(e){if(this._getType(e)!==wn.object){const S=this._getOrReturnCtx(e);return an(S,{code:qt.invalid_type,expected:wn.object,received:S.parsedType}),Xn}const{status:l,ctx:u}=this._processInputParams(e),{shape:f,keys:g}=this._getCached(),w=[];if(!(this._def.catchall instanceof vh&&this._def.unknownKeys==="strip"))for(const S in u.data)g.includes(S)||w.push(S);const s=[];for(const S of g){const A=f[S],j=u.data[S];s.push({key:{status:"valid",value:S},value:A._parse(new _h(u,j,u.path,S)),alwaysSet:S in u.data})}if(this._def.catchall instanceof vh){const S=this._def.unknownKeys;if(S==="passthrough")for(const A of w)s.push({key:{status:"valid",value:A},value:{status:"valid",value:u.data[A]}});else if(S==="strict")w.length>0&&(an(u,{code:qt.unrecognized_keys,keys:w}),l.dirty());else if(S!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const S=this._def.catchall;for(const A of w){const j=u.data[A];s.push({key:{status:"valid",value:A},value:S._parse(new _h(u,j,u.path,A)),alwaysSet:A in u.data})}}return u.common.async?Promise.resolve().then(async()=>{const S=[];for(const A of s){const j=await A.key,O=await A.value;S.push({key:j,value:O,alwaysSet:A.alwaysSet})}return S}).then(S=>Oa.mergeObjectSync(l,S)):Oa.mergeObjectSync(l,s)}get shape(){return this._def.shape()}strict(e){return Sn.errToObj,new bs({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,l)=>{const u=this._def.errorMap?.(r,l).message??l.defaultError;return r.code==="unrecognized_keys"?{message:Sn.errToObj(e).message??u}:{message:u}}}:{}})}strip(){return new bs({...this._def,unknownKeys:"strip"})}passthrough(){return new bs({...this._def,unknownKeys:"passthrough"})}extend(e){return new bs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new bs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Yn.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new bs({...this._def,catchall:e})}pick(e){const r={};for(const l of Cr.objectKeys(e))e[l]&&this.shape[l]&&(r[l]=this.shape[l]);return new bs({...this._def,shape:()=>r})}omit(e){const r={};for(const l of Cr.objectKeys(this.shape))e[l]||(r[l]=this.shape[l]);return new bs({...this._def,shape:()=>r})}deepPartial(){return wm(this)}partial(e){const r={};for(const l of Cr.objectKeys(this.shape)){const u=this.shape[l];e&&!e[l]?r[l]=u:r[l]=u.optional()}return new bs({...this._def,shape:()=>r})}required(e){const r={};for(const l of Cr.objectKeys(this.shape))if(e&&!e[l])r[l]=this.shape[l];else{let f=this.shape[l];for(;f instanceof dh;)f=f._def.innerType;r[l]=f}return new bs({...this._def,shape:()=>r})}keyof(){return wD(Cr.objectKeys(this.shape))}}bs.create=(t,e)=>new bs({shape:()=>t,unknownKeys:"strip",catchall:vh.create(),typeName:Yn.ZodObject,...pr(e)});bs.strictCreate=(t,e)=>new bs({shape:()=>t,unknownKeys:"strict",catchall:vh.create(),typeName:Yn.ZodObject,...pr(e)});bs.lazycreate=(t,e)=>new bs({shape:t,unknownKeys:"strip",catchall:vh.create(),typeName:Yn.ZodObject,...pr(e)});class n0 extends br{_parse(e){const{ctx:r}=this._processInputParams(e),l=this._def.options;function u(f){for(const w of f)if(w.result.status==="valid")return w.result;for(const w of f)if(w.result.status==="dirty")return r.common.issues.push(...w.ctx.common.issues),w.result;const g=f.map(w=>new su(w.ctx.common.issues));return an(r,{code:qt.invalid_union,unionErrors:g}),Xn}if(r.common.async)return Promise.all(l.map(async f=>{const g={...r,common:{...r.common,issues:[]},parent:null};return{result:await f._parseAsync({data:r.data,path:r.path,parent:g}),ctx:g}})).then(u);{let f;const g=[];for(const s of l){const S={...r,common:{...r.common,issues:[]},parent:null},A=s._parseSync({data:r.data,path:r.path,parent:S});if(A.status==="valid")return A;A.status==="dirty"&&!f&&(f={result:A,ctx:S}),S.common.issues.length&&g.push(S.common.issues)}if(f)return r.common.issues.push(...f.ctx.common.issues),f.result;const w=g.map(s=>new su(s));return an(r,{code:qt.invalid_union,unionErrors:w}),Xn}}get options(){return this._def.options}}n0.create=(t,e)=>new n0({options:t,typeName:Yn.ZodUnion,...pr(e)});function e1(t,e){const r=nh(t),l=nh(e);if(t===e)return{valid:!0,data:t};if(r===wn.object&&l===wn.object){const u=Cr.objectKeys(e),f=Cr.objectKeys(t).filter(w=>u.indexOf(w)!==-1),g={...t,...e};for(const w of f){const s=e1(t[w],e[w]);if(!s.valid)return{valid:!1};g[w]=s.data}return{valid:!0,data:g}}else if(r===wn.array&&l===wn.array){if(t.length!==e.length)return{valid:!1};const u=[];for(let f=0;f<t.length;f++){const g=t[f],w=e[f],s=e1(g,w);if(!s.valid)return{valid:!1};u.push(s.data)}return{valid:!0,data:u}}else return r===wn.date&&l===wn.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class r0 extends br{_parse(e){const{status:r,ctx:l}=this._processInputParams(e),u=(f,g)=>{if(ZA(f)||ZA(g))return Xn;const w=e1(f.value,g.value);return w.valid?((KA(f)||KA(g))&&r.dirty(),{status:r.value,value:w.data}):(an(l,{code:qt.invalid_intersection_types}),Xn)};return l.common.async?Promise.all([this._def.left._parseAsync({data:l.data,path:l.path,parent:l}),this._def.right._parseAsync({data:l.data,path:l.path,parent:l})]).then(([f,g])=>u(f,g)):u(this._def.left._parseSync({data:l.data,path:l.path,parent:l}),this._def.right._parseSync({data:l.data,path:l.path,parent:l}))}}r0.create=(t,e,r)=>new r0({left:t,right:e,typeName:Yn.ZodIntersection,...pr(r)});class Qf extends br{_parse(e){const{status:r,ctx:l}=this._processInputParams(e);if(l.parsedType!==wn.array)return an(l,{code:qt.invalid_type,expected:wn.array,received:l.parsedType}),Xn;if(l.data.length<this._def.items.length)return an(l,{code:qt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Xn;!this._def.rest&&l.data.length>this._def.items.length&&(an(l,{code:qt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const f=[...l.data].map((g,w)=>{const s=this._def.items[w]||this._def.rest;return s?s._parse(new _h(l,g,l.path,w)):null}).filter(g=>!!g);return l.common.async?Promise.all(f).then(g=>Oa.mergeArray(r,g)):Oa.mergeArray(r,f)}get items(){return this._def.items}rest(e){return new Qf({...this._def,rest:e})}}Qf.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Qf({items:t,typeName:Yn.ZodTuple,rest:null,...pr(e)})};class iP extends br{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:l}=this._processInputParams(e);if(l.parsedType!==wn.map)return an(l,{code:qt.invalid_type,expected:wn.map,received:l.parsedType}),Xn;const u=this._def.keyType,f=this._def.valueType,g=[...l.data.entries()].map(([w,s],S)=>({key:u._parse(new _h(l,w,l.path,[S,"key"])),value:f._parse(new _h(l,s,l.path,[S,"value"]))}));if(l.common.async){const w=new Map;return Promise.resolve().then(async()=>{for(const s of g){const S=await s.key,A=await s.value;if(S.status==="aborted"||A.status==="aborted")return Xn;(S.status==="dirty"||A.status==="dirty")&&r.dirty(),w.set(S.value,A.value)}return{status:r.value,value:w}})}else{const w=new Map;for(const s of g){const S=s.key,A=s.value;if(S.status==="aborted"||A.status==="aborted")return Xn;(S.status==="dirty"||A.status==="dirty")&&r.dirty(),w.set(S.value,A.value)}return{status:r.value,value:w}}}}iP.create=(t,e,r)=>new iP({valueType:e,keyType:t,typeName:Yn.ZodMap,...pr(r)});class Wy extends br{_parse(e){const{status:r,ctx:l}=this._processInputParams(e);if(l.parsedType!==wn.set)return an(l,{code:qt.invalid_type,expected:wn.set,received:l.parsedType}),Xn;const u=this._def;u.minSize!==null&&l.data.size<u.minSize.value&&(an(l,{code:qt.too_small,minimum:u.minSize.value,type:"set",inclusive:!0,exact:!1,message:u.minSize.message}),r.dirty()),u.maxSize!==null&&l.data.size>u.maxSize.value&&(an(l,{code:qt.too_big,maximum:u.maxSize.value,type:"set",inclusive:!0,exact:!1,message:u.maxSize.message}),r.dirty());const f=this._def.valueType;function g(s){const S=new Set;for(const A of s){if(A.status==="aborted")return Xn;A.status==="dirty"&&r.dirty(),S.add(A.value)}return{status:r.value,value:S}}const w=[...l.data.values()].map((s,S)=>f._parse(new _h(l,s,l.path,S)));return l.common.async?Promise.all(w).then(s=>g(s)):g(w)}min(e,r){return new Wy({...this._def,minSize:{value:e,message:Sn.toString(r)}})}max(e,r){return new Wy({...this._def,maxSize:{value:e,message:Sn.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Wy.create=(t,e)=>new Wy({valueType:t,minSize:null,maxSize:null,typeName:Yn.ZodSet,...pr(e)});class sP extends br{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}sP.create=(t,e)=>new sP({getter:t,typeName:Yn.ZodLazy,...pr(e)});class oP extends br{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return an(r,{received:r.data,code:qt.invalid_literal,expected:this._def.value}),Xn}return{status:"valid",value:e.data}}get value(){return this._def.value}}oP.create=(t,e)=>new oP({value:t,typeName:Yn.ZodLiteral,...pr(e)});function wD(t,e){return new $m({values:t,typeName:Yn.ZodEnum,...pr(e)})}class $m extends br{_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),l=this._def.values;return an(r,{expected:Cr.joinValues(l),received:r.parsedType,code:qt.invalid_type}),Xn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const r=this._getOrReturnCtx(e),l=this._def.values;return an(r,{received:r.data,code:qt.invalid_enum_value,options:l}),Xn}return _l(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return $m.create(e,{...this._def,...r})}exclude(e,r=this._def){return $m.create(this.options.filter(l=>!e.includes(l)),{...this._def,...r})}}$m.create=wD;class aP extends br{_parse(e){const r=Cr.getValidEnumValues(this._def.values),l=this._getOrReturnCtx(e);if(l.parsedType!==wn.string&&l.parsedType!==wn.number){const u=Cr.objectValues(r);return an(l,{expected:Cr.joinValues(u),received:l.parsedType,code:qt.invalid_type}),Xn}if(this._cache||(this._cache=new Set(Cr.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const u=Cr.objectValues(r);return an(l,{received:l.data,code:qt.invalid_enum_value,options:u}),Xn}return _l(e.data)}get enum(){return this._def.values}}aP.create=(t,e)=>new aP({values:t,typeName:Yn.ZodNativeEnum,...pr(e)});class i0 extends br{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==wn.promise&&r.common.async===!1)return an(r,{code:qt.invalid_type,expected:wn.promise,received:r.parsedType}),Xn;const l=r.parsedType===wn.promise?r.data:Promise.resolve(r.data);return _l(l.then(u=>this._def.type.parseAsync(u,{path:r.path,errorMap:r.common.contextualErrorMap})))}}i0.create=(t,e)=>new i0({type:t,typeName:Yn.ZodPromise,...pr(e)});class Gm extends br{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Yn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:l}=this._processInputParams(e),u=this._def.effect||null,f={addIssue:g=>{an(l,g),g.fatal?r.abort():r.dirty()},get path(){return l.path}};if(f.addIssue=f.addIssue.bind(f),u.type==="preprocess"){const g=u.transform(l.data,f);if(l.common.async)return Promise.resolve(g).then(async w=>{if(r.value==="aborted")return Xn;const s=await this._def.schema._parseAsync({data:w,path:l.path,parent:l});return s.status==="aborted"?Xn:s.status==="dirty"||r.value==="dirty"?uy(s.value):s});{if(r.value==="aborted")return Xn;const w=this._def.schema._parseSync({data:g,path:l.path,parent:l});return w.status==="aborted"?Xn:w.status==="dirty"||r.value==="dirty"?uy(w.value):w}}if(u.type==="refinement"){const g=w=>{const s=u.refinement(w,f);if(l.common.async)return Promise.resolve(s);if(s instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return w};if(l.common.async===!1){const w=this._def.schema._parseSync({data:l.data,path:l.path,parent:l});return w.status==="aborted"?Xn:(w.status==="dirty"&&r.dirty(),g(w.value),{status:r.value,value:w.value})}else return this._def.schema._parseAsync({data:l.data,path:l.path,parent:l}).then(w=>w.status==="aborted"?Xn:(w.status==="dirty"&&r.dirty(),g(w.value).then(()=>({status:r.value,value:w.value}))))}if(u.type==="transform")if(l.common.async===!1){const g=this._def.schema._parseSync({data:l.data,path:l.path,parent:l});if(!Um(g))return Xn;const w=u.transform(g.value,f);if(w instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:w}}else return this._def.schema._parseAsync({data:l.data,path:l.path,parent:l}).then(g=>Um(g)?Promise.resolve(u.transform(g.value,f)).then(w=>({status:r.value,value:w})):Xn);Cr.assertNever(u)}}Gm.create=(t,e,r)=>new Gm({schema:t,typeName:Yn.ZodEffects,effect:e,...pr(r)});Gm.createWithPreprocess=(t,e,r)=>new Gm({schema:e,effect:{type:"preprocess",transform:t},typeName:Yn.ZodEffects,...pr(r)});class dh extends br{_parse(e){return this._getType(e)===wn.undefined?_l(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}dh.create=(t,e)=>new dh({innerType:t,typeName:Yn.ZodOptional,...pr(e)});class Hm extends br{_parse(e){return this._getType(e)===wn.null?_l(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Hm.create=(t,e)=>new Hm({innerType:t,typeName:Yn.ZodNullable,...pr(e)});class t1 extends br{_parse(e){const{ctx:r}=this._processInputParams(e);let l=r.data;return r.parsedType===wn.undefined&&(l=this._def.defaultValue()),this._def.innerType._parse({data:l,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}t1.create=(t,e)=>new t1({innerType:t,typeName:Yn.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...pr(e)});class n1 extends br{_parse(e){const{ctx:r}=this._processInputParams(e),l={...r,common:{...r.common,issues:[]}},u=this._def.innerType._parse({data:l.data,path:l.path,parent:{...l}});return e0(u)?u.then(f=>({status:"valid",value:f.status==="valid"?f.value:this._def.catchValue({get error(){return new su(l.common.issues)},input:l.data})})):{status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new su(l.common.issues)},input:l.data})}}removeCatch(){return this._def.innerType}}n1.create=(t,e)=>new n1({innerType:t,typeName:Yn.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...pr(e)});class lP extends br{_parse(e){if(this._getType(e)!==wn.nan){const l=this._getOrReturnCtx(e);return an(l,{code:qt.invalid_type,expected:wn.nan,received:l.parsedType}),Xn}return{status:"valid",value:e.data}}}lP.create=t=>new lP({typeName:Yn.ZodNaN,...pr(t)});class lZ extends br{_parse(e){const{ctx:r}=this._processInputParams(e),l=r.data;return this._def.type._parse({data:l,path:r.path,parent:r})}unwrap(){return this._def.type}}class VT extends br{_parse(e){const{status:r,ctx:l}=this._processInputParams(e);if(l.common.async)return(async()=>{const f=await this._def.in._parseAsync({data:l.data,path:l.path,parent:l});return f.status==="aborted"?Xn:f.status==="dirty"?(r.dirty(),uy(f.value)):this._def.out._parseAsync({data:f.value,path:l.path,parent:l})})();{const u=this._def.in._parseSync({data:l.data,path:l.path,parent:l});return u.status==="aborted"?Xn:u.status==="dirty"?(r.dirty(),{status:"dirty",value:u.value}):this._def.out._parseSync({data:u.value,path:l.path,parent:l})}}static create(e,r){return new VT({in:e,out:r,typeName:Yn.ZodPipeline})}}class r1 extends br{_parse(e){const r=this._def.innerType._parse(e),l=u=>(Um(u)&&(u.value=Object.freeze(u.value)),u);return e0(r)?r.then(u=>l(u)):l(r)}unwrap(){return this._def.innerType}}r1.create=(t,e)=>new r1({innerType:t,typeName:Yn.ZodReadonly,...pr(e)});var Yn;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Yn||(Yn={}));const bD=ah.create;vh.create;nu.create;n0.create;r0.create;Qf.create;$m.create;i0.create;dh.create;Hm.create;const cZ=bD().email("Email khng hp l"),uZ=bD().min(6,"Mt khu phi c t nht 6 k t"),dZ=({isOpen:t,onClose:e})=>{const[r,l]=I.useState("login"),[u,f]=I.useState(""),[g,w]=I.useState(""),[s,S]=I.useState(""),[A,j]=I.useState(!1),{signIn:O,signUp:L}=ha(),{language:W}=da(),U=rp(),q=async Y=>{Y.preventDefault(),S("");try{cZ.parse(u),uZ.parse(g)}catch(ie){if(ie instanceof su){S(ie.errors[0].message);return}}j(!0);try{let ie;r==="login"?(console.log("ang th ng nhp vi:",u),ie=await O(u,g)):(console.log("ang th ng k vi:",u),ie=await L(u,g)),console.log("Kt qu t Supabase:",ie),ie.error?ie.error.message.includes("Invalid login credentials")?S(W==="vi"?"Sai email hoc mt khu":"Invalid email or password"):ie.error.message.includes("User already registered")?S(W==="vi"?"Email ny  c ng k":"Email already registered"):S(ie.error.message):(console.log("ng nhp thnh cng!"),e(),f(""),w(""),u==="admin@gmail.com"&&U("/admin"))}catch(ie){console.error("Li khng mong mun:",ie),S("C li xy ra, vui lng th li.")}finally{j(!1)}},J={vi:{login:"ng nhp",signup:"ng k",email:"Email",password:"Mt khu",noAccount:"Cha c ti khon?",hasAccount:" c ti khon?",signupNow:"ng k ngay",loginNow:"ng nhp",welcome:"Cho mng bn",createAccount:"To ti khon",saveFavorites:"Lu a im yu thch trn mi thit b"},en:{login:"Login",signup:"Sign up",email:"Email",password:"Password",noAccount:"Don't have an account?",hasAccount:"Already have an account?",signupNow:"Sign up now",loginNow:"Login",welcome:"Welcome back",createAccount:"Create account",saveFavorites:"Save favorite locations across all devices"}}[W];return t?v.jsx(Da,{children:v.jsx(_r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:e,children:v.jsxs(_r.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-md bg-background rounded-3xl shadow-2xl overflow-hidden",onClick:Y=>Y.stopPropagation(),children:[v.jsxs("div",{className:"relative p-6 pb-4 bg-gradient-to-br from-primary to-primary/80",children:[v.jsx("button",{onClick:e,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 transition-colors",children:v.jsx(xi,{className:"w-4 h-4 text-white"})}),v.jsx("div",{className:"flex items-center gap-3 mb-2",children:v.jsx("div",{className:"w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center",children:v.jsx(ky,{className:"w-6 h-6 text-white"})})}),v.jsx("h2",{className:"text-2xl font-bold text-white",children:r==="login"?J.welcome:J.createAccount}),v.jsx("p",{className:"text-white/80 text-sm mt-1",children:J.saveFavorites})]}),v.jsxs("form",{onSubmit:q,className:"p-6 space-y-4",children:[v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"relative",children:[v.jsx(y1,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),v.jsx(fi,{type:"email",placeholder:J.email,value:u,onChange:Y=>f(Y.target.value),className:"pl-12 h-14 rounded-2xl border-2 text-base",required:!0})]}),v.jsxs("div",{className:"relative",children:[v.jsx(Cy,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),v.jsx(fi,{type:"password",placeholder:J.password,value:g,onChange:Y=>w(Y.target.value),className:"pl-12 h-14 rounded-2xl border-2 text-base",required:!0})]})]}),s&&v.jsx(_r.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-destructive text-sm text-center",children:s}),v.jsx(vn,{type:"submit",disabled:A,className:"w-full h-14 text-base font-semibold rounded-2xl",children:A?v.jsx(ls,{className:"w-5 h-5 animate-spin"}):r==="login"?J.login:J.signup}),v.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:[r==="login"?J.noAccount:J.hasAccount," ",v.jsx("button",{type:"button",onClick:()=>{l(r==="login"?"signup":"login"),S("")},className:"text-primary font-semibold hover:underline",children:r==="login"?J.signupNow:J.loginNow})]})]})]})})}):null},hZ=({isOpen:t,onClose:e,onSelectLocation:r,onNavigate:l,onLoginClick:u})=>{const{session:f}=ha(),[g,w]=I.useState([]),[s,S]=I.useState([]),[A,j]=I.useState(!0),[O,L]=I.useState("locations"),W=async()=>{if(f?.user){j(!0);try{const{data:Y}=await Wt.from("favorites").select("*").eq("user_id",f.user.id);if(Y){const _e=Y.map(Se=>({id:Se.location_id,name:Se.location_name_en||Se.location_name,nameVi:Se.location_name,lat:Se.location_lat,lng:Se.location_lng,type:Se.location_type,address:" lu",description:"",image:""}));w(_e)}const{data:ie}=await Wt.from("user_saved_vouchers").select(`
          id,
          voucher:store_vouchers (
            id, code, title_vi, discount_value, discount_type,
            store:user_stores (
              id, name_vi, lat, lng, address_vi, image_url
            )
          )
        `).eq("user_id",f.user.id);console.log(" D liu Voucher ti v:",ie),console.log(" Li nu c:",Error),ie&&S(ie)}catch(Y){console.error("Li:",Y)}finally{j(!1)}}};I.useEffect(()=>{t&&W()},[f,t]);const U=async Y=>{w(ie=>ie.filter(_e=>_e.id!==Y)),await Wt.from("favorites").delete().eq("location_id",Y),Jt.success(" xa khi yu thch")},q=async(Y,ie)=>{Y.stopPropagation();const{error:_e}=await Wt.from("user_saved_vouchers").delete().eq("id",ie);_e||(Jt.success(" xa voucher"),S(Se=>Se.filter(Ie=>Ie.id!==ie)))},Q=Y=>{l?l(Y):r&&r(Y),e()},J=Y=>{const ie={id:Y.voucher.store.id,nameVi:Y.voucher.store.name_vi,name:Y.voucher.store.name_vi,lat:Y.voucher.store.lat,lng:Y.voucher.store.lng,type:"food",address:Y.voucher.store.address_vi,description:`M gim gi: ${Y.voucher.code} - ${Y.voucher.title_vi}`,image:Y.voucher.store.image_url||"https://placehold.co/600x400?text=Store"};Q(ie),Jt.success(`ang di chuyn n: ${ie.nameVi}`)};return t?v.jsxs("div",{className:"fixed inset-y-0 left-0 z-50 w-full md:w-[400px] bg-white shadow-2xl transform transition-transform duration-300 ease-in-out flex flex-col border-r",children:[v.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[v.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[v.jsx(ih,{className:"w-5 h-5 text-red-500"}),"  lu"]}),v.jsx(vn,{variant:"ghost",size:"icon",onClick:e,children:v.jsx(xi,{className:"w-5 h-5"})})]}),v.jsx("div",{className:"flex-1 overflow-hidden p-4 bg-white",children:f?v.jsxs(Gy,{defaultValue:"locations",className:"w-full h-full flex flex-col",onValueChange:L,children:[v.jsxs(Fm,{className:"grid w-full grid-cols-2 mb-4 bg-gray-100 p-1",children:[v.jsxs(as,{value:"locations",className:"flex items-center gap-2",children:[v.jsx(ih,{className:"w-4 h-4"})," a im"]}),v.jsxs(as,{value:"vouchers",className:"flex items-center gap-2",children:[v.jsx(fh,{className:"w-4 h-4"})," Voucher (",s.length,")"]})]}),v.jsx(Co,{value:"locations",className:"flex-1 overflow-y-auto pr-2 space-y-3",children:A?v.jsx("div",{className:"text-center py-4 text-gray-400",children:"ang ti..."}):g.length===0?v.jsx("p",{className:"text-center text-gray-400 py-10",children:"Cha lu a im no."}):g.map(Y=>v.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border rounded-xl hover:shadow-md hover:border-primary cursor-pointer transition-all group",onClick:()=>Q(Y),children:[v.jsx("div",{className:"bg-red-50 p-2.5 rounded-full text-red-500 flex-shrink-0 group-hover:scale-110 transition-transform",children:v.jsx(ih,{className:"w-5 h-5 fill-current"})}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("h4",{className:"font-semibold text-sm truncate text-gray-900",children:Y.nameVi}),v.jsx("p",{className:"text-xs text-gray-500 truncate",children:Y.address})]}),v.jsx(vn,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-300 hover:text-red-600 hover:bg-red-50",onClick:ie=>{ie.stopPropagation(),U(Y.id)},children:v.jsx(ch,{className:"w-4 h-4"})})]},Y.id))}),v.jsx(Co,{value:"vouchers",className:"flex-1 overflow-y-auto pr-2 space-y-3",children:A?v.jsx("div",{className:"text-center py-4 text-gray-400",children:"ang ti..."}):s.length===0?v.jsxs("div",{className:"text-center py-10 space-y-2",children:[v.jsx(fh,{className:"w-12 h-12 text-gray-200 mx-auto"}),v.jsx("p",{className:"text-gray-400",children:"V voucher trng."})]}):s.map(Y=>v.jsxs("div",{className:"relative bg-white border border-dashed border-primary/40 rounded-xl overflow-hidden hover:shadow-lg transition-all group cursor-pointer hover:bg-primary/5",onClick:()=>J(Y),children:[v.jsxs("div",{className:"flex items-stretch",children:[v.jsxs("div",{className:"bg-primary/10 w-24 flex flex-col items-center justify-center p-2 border-r border-dashed border-primary/40",children:[v.jsxs("span",{className:"text-2xl font-black text-primary leading-none",children:[Y.voucher.discount_value,v.jsx("span",{className:"text-sm font-bold",children:Y.voucher.discount_type==="percent"?"%":"k"})]}),v.jsx("span",{className:"text-[10px] text-primary/70 font-bold uppercase mt-1",children:"Gim gi"})]}),v.jsxs("div",{className:"flex-1 p-3 min-w-0 flex flex-col justify-center",children:[v.jsx("h4",{className:"font-bold text-sm truncate text-gray-900 mb-1",children:Y.voucher.store.name_vi}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("code",{className:"bg-white border px-2 py-0.5 rounded text-xs font-mono font-bold text-gray-600 shadow-sm",children:Y.voucher.code}),v.jsxs("span",{className:"text-xs text-primary font-medium flex items-center group-hover:translate-x-1 transition-transform",children:["Dng ngay ",v.jsx(m5,{className:"w-3 h-3 ml-1"})]})]})]})]}),v.jsx("button",{onClick:ie=>q(ie,Y.id),className:"absolute top-1 right-1 p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",title:"Xa voucher",children:v.jsx(ch,{className:"w-3 h-3"})})]},Y.id))})]}):v.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center space-y-4",children:[v.jsx(ih,{className:"w-12 h-12 text-gray-200"}),v.jsx("p",{className:"text-gray-500",children:"Vui lng ng nhp  xem danh sch  lu."}),v.jsx(vn,{onClick:u,children:"ng nhp ngay"})]})})]}):null},UT=()=>{const{session:t}=ha(),e=b0(),r=t?.user,{data:l=[],isLoading:u,refetch:f}=L1({queryKey:["user_stores",r?.id],queryFn:async()=>{if(!r)return[];const{data:J,error:Y}=await Wt.from("user_stores").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(Y)throw Y;return J},enabled:!!r}),g=Yl({mutationFn:async J=>{if(!r)throw new Error("Vui lng ng nhp");const{id:Y,created_at:ie,updated_at:_e,...Se}=J,{data:Ie,error:Ue}=await Wt.from("user_stores").insert({...Se,user_id:r.id,status:"pending"}).select().single();if(Ue)throw Ue;return Ie},onSuccess:()=>{e.invalidateQueries({queryKey:["user_stores"]}),Jt.success(" gi yu cu to ca hng!")},onError:J=>Jt.error("Li: "+J.message)}),w=Yl({mutationFn:async({id:J,data:Y})=>{const{error:ie}=await Wt.from("user_stores").update(Y).eq("id",J);if(ie)throw ie},onSuccess:()=>{e.invalidateQueries({queryKey:["user_stores"]}),Jt.success(" cp nht ca hng!")},onError:J=>Jt.error("Li: "+J.message)}),s=Yl({mutationFn:async J=>{const{error:Y}=await Wt.from("user_stores").delete().eq("id",J);if(Y)throw Y},onSuccess:()=>{e.invalidateQueries({queryKey:["user_stores"]}),Jt.success(" xa ca hng!")},onError:J=>Jt.error("Li xa: "+J.message)}),S=async J=>{const{data:Y}=await Wt.from("store_menu_items").select("*").eq("store_id",J).order("sort_order",{ascending:!0});return Y||[]},A=Yl({mutationFn:async J=>{const{error:Y}=await Wt.from("store_menu_items").insert(J);if(Y)throw Y},onSuccess:()=>Jt.success(" thm mn mi"),onError:J=>Jt.error("Li thm mn: "+J.message)}),j=Yl({mutationFn:async({id:J,data:Y})=>{const{error:ie}=await Wt.from("store_menu_items").update(Y).eq("id",J);if(ie)throw ie},onSuccess:()=>Jt.success(" cp nht mn"),onError:J=>Jt.error("Li cp nht: "+J.message)}),O=Yl({mutationFn:async J=>{const{error:Y}=await Wt.from("store_menu_items").delete().eq("id",J);if(Y)throw Y},onSuccess:()=>Jt.success(" xa mn n")}),L=async J=>{const{data:Y}=await Wt.from("store_vouchers").select("*").eq("store_id",J).order("created_at",{ascending:!1});return Y||[]},W=Yl({mutationFn:async J=>{const{error:Y}=await Wt.from("store_vouchers").insert(J);if(Y)throw Y},onSuccess:()=>Jt.success(" to voucher"),onError:J=>Jt.error("Li to voucher: "+J.message)}),U=Yl({mutationFn:async({id:J,data:Y})=>{const{error:ie}=await Wt.from("store_vouchers").update(Y).eq("id",J);if(ie)throw ie},onSuccess:()=>Jt.success(" cp nht voucher"),onError:J=>Jt.error("Li cp nht: "+J.message)}),q=Yl({mutationFn:async J=>{const{error:Y}=await Wt.from("store_vouchers").delete().eq("id",J);if(Y)throw Y},onSuccess:()=>Jt.success(" xa voucher")}),Q=async(J,Y="common")=>{try{if(!r)return null;const ie=J.name.split(".").pop(),_e=`${r.id}/${Y}/${Date.now()}.${ie}`,{error:Se}=await Wt.storage.from("avatars").upload(_e,J);if(Se)throw Se;const{data:Ie}=Wt.storage.from("avatars").getPublicUrl(_e);return Ie.publicUrl}catch(ie){return console.error("Upload failed:",ie),Jt.error("Li ti nh ln"),null}};return{stores:l,isLoading:u,fetchStores:f,createStore:g.mutateAsync,updateStore:async(J,Y)=>await w.mutateAsync({id:J,data:Y}),deleteStore:s.mutateAsync,fetchMenuItems:S,createMenuItem:A.mutateAsync,updateMenuItem:async(J,Y)=>await j.mutateAsync({id:J,data:Y}),deleteMenuItem:O.mutateAsync,fetchVouchers:L,createVoucher:W.mutateAsync,updateVoucher:async(J,Y)=>await U.mutateAsync({id:J,data:Y}),deleteVoucher:q.mutateAsync,uploadImage:Q}};var ex="Switch",[fZ]=gl(ex),[pZ,mZ]=fZ(ex),TD=I.forwardRef((t,e)=>{const{__scopeSwitch:r,name:l,checked:u,defaultChecked:f,required:g,disabled:w,value:s="on",onCheckedChange:S,form:A,...j}=t,[O,L]=I.useState(null),W=ar(e,Y=>L(Y)),U=I.useRef(!1),q=O?A||!!O.closest("form"):!0,[Q,J]=hh({prop:u,defaultProp:f??!1,onChange:S,caller:ex});return v.jsxs(pZ,{scope:r,checked:Q,disabled:w,children:[v.jsx(In.button,{type:"button",role:"switch","aria-checked":Q,"aria-required":g,"data-state":kD(Q),"data-disabled":w?"":void 0,disabled:w,value:s,...j,ref:W,onClick:Xt(t.onClick,Y=>{J(ie=>!ie),q&&(U.current=Y.isPropagationStopped(),U.current||Y.stopPropagation())})}),q&&v.jsx(CD,{control:O,bubbles:!U.current,name:l,value:s,checked:Q,required:g,disabled:w,form:A,style:{transform:"translateX(-100%)"}})]})});TD.displayName=ex;var SD="SwitchThumb",ED=I.forwardRef((t,e)=>{const{__scopeSwitch:r,...l}=t,u=mZ(SD,r);return v.jsx(In.span,{"data-state":kD(u.checked),"data-disabled":u.disabled?"":void 0,...l,ref:e})});ED.displayName=SD;var gZ="SwitchBubbleInput",CD=I.forwardRef(({__scopeSwitch:t,control:e,checked:r,bubbles:l=!0,...u},f)=>{const g=I.useRef(null),w=ar(g,f),s=Ij(r),S=_M(e);return I.useEffect(()=>{const A=g.current;if(!A)return;const j=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(j,"checked").set;if(s!==r&&L){const W=new Event("click",{bubbles:l});L.call(A,r),A.dispatchEvent(W)}},[s,r,l]),v.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...u,tabIndex:-1,ref:w,style:{...u.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});CD.displayName=gZ;function kD(t){return t?"checked":"unchecked"}var AD=TD,yZ=ED;const $T=I.forwardRef(({className:t,...e},r)=>v.jsx(AD,{className:cn("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...e,ref:r,children:v.jsx(yZ,{className:cn("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));$T.displayName=AD.displayName;const _Z=({storeId:t,item:e,onClose:r,onSuccess:l})=>{const{language:u}=da(),{createMenuItem:f,updateMenuItem:g,uploadImage:w}=UT(),s=I.useRef(null),[S,A]=I.useState(!1),[j,O]=I.useState(e?.image_url||null),[L,W]=I.useState(null),[U,q]=I.useState({name_vi:e?.name_vi||"",name_en:e?.name_en||"",description_vi:e?.description_vi||"",description_en:e?.description_en||"",price:e?.price||0,is_available:e?.is_available??!0,sort_order:e?.sort_order||0}),Q=Y=>{const ie=Y.target.files?.[0];if(ie){W(ie);const _e=new FileReader;_e.onloadend=()=>{O(_e.result)},_e.readAsDataURL(ie)}},J=async Y=>{Y.preventDefault(),A(!0);try{let ie=e?.image_url||null;if(L){const Se=await w(L,"menu");Se&&(ie=Se)}const _e={store_id:t,...U,image_url:ie};e?await g(e.id,_e):await f(_e),l(),r()}catch(ie){console.error("Error saving menu item:",ie)}finally{A(!1)}};return v.jsxs(_r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"bg-muted/50 rounded-xl p-4 mb-4",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h4",{className:"font-semibold",children:e?u==="vi"?"Chnh sa mn":"Edit Item":u==="vi"?"Thm mn mi":"Add New Item"}),v.jsx("button",{onClick:r,className:"p-1 hover:bg-muted rounded-full",children:v.jsx(xi,{className:"w-4 h-4"})})]}),v.jsxs("form",{onSubmit:J,className:"space-y-3",children:[v.jsx("div",{onClick:()=>s.current?.click(),className:"border-2 border-dashed rounded-lg p-3 text-center cursor-pointer hover:border-primary transition-colors",children:j?v.jsx("img",{src:j,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg mx-auto"}):v.jsxs("div",{className:"py-2 text-muted-foreground",children:[v.jsx(GP,{className:"w-8 h-8 mx-auto mb-1 opacity-50"}),v.jsx("p",{className:"text-xs",children:u==="vi"?"Thm nh":"Add image"})]})}),v.jsx("input",{ref:s,type:"file",accept:"image/*",onChange:Q,className:"hidden"}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Tn mn (VI) *"}),v.jsx(fi,{value:U.name_vi,onChange:Y=>q(ie=>({...ie,name_vi:Y.target.value})),placeholder:"Tn mn",required:!0,className:"h-9"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Name (EN)"}),v.jsx(fi,{value:U.name_en,onChange:Y=>q(ie=>({...ie,name_en:Y.target.value})),placeholder:"Item name",className:"h-9"})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"M t (VI)"}),v.jsx(yh,{value:U.description_vi,onChange:Y=>q(ie=>({...ie,description_vi:Y.target.value})),placeholder:"M t",rows:2,className:"text-sm"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Description (EN)"}),v.jsx(yh,{value:U.description_en,onChange:Y=>q(ie=>({...ie,description_en:Y.target.value})),placeholder:"Description",rows:2,className:"text-sm"})]})]}),v.jsxs("div",{className:"flex gap-3 items-end",children:[v.jsxs("div",{className:"flex-1",children:[v.jsxs(hi,{className:"text-xs flex items-center gap-1",children:[v.jsx(p5,{className:"w-3 h-3"})," ",u==="vi"?"Gi (VN)":"Price (VND)"]}),v.jsx(fi,{type:"number",value:U.price,onChange:Y=>q(ie=>({...ie,price:parseInt(Y.target.value)||0})),className:"h-9"})]}),v.jsxs("div",{className:"flex items-center gap-2 pb-2",children:[v.jsx($T,{checked:U.is_available,onCheckedChange:Y=>q(ie=>({...ie,is_available:Y}))}),v.jsx(hi,{className:"text-xs",children:u==="vi"?"Cn hng":"Available"})]})]}),v.jsxs("div",{className:"flex gap-2 pt-2",children:[v.jsx(vn,{type:"button",variant:"ghost",onClick:r,size:"sm",className:"flex-1",children:u==="vi"?"Hy":"Cancel"}),v.jsx(vn,{type:"submit",disabled:S,size:"sm",className:"flex-1",children:S?"...":e?u==="vi"?"Cp nht":"Update":u==="vi"?"Thm":"Add"})]})]})]})},vZ=({storeId:t,voucher:e,onClose:r,onSuccess:l})=>{const{language:u}=da(),{createVoucher:f,updateVoucher:g}=UT(),[w,s]=I.useState(!1),[S,A]=I.useState({code:e?.code||"",title_vi:e?.title_vi||"",title_en:e?.title_en||"",description_vi:e?.description_vi||"",description_en:e?.description_en||"",discount_type:e?.discount_type||"percent",discount_value:e?.discount_value||10,min_order:e?.min_order||0,max_uses:e?.max_uses||null,is_active:e?.is_active??!0,start_date:e?.start_date?new Date(e.start_date).toISOString().split("T")[0]:"",end_date:e?.end_date?new Date(e.end_date).toISOString().split("T")[0]:""}),j=async O=>{O.preventDefault(),s(!0);try{const L={store_id:t,code:S.code.toUpperCase(),title_vi:S.title_vi,title_en:S.title_en||null,description_vi:S.description_vi||null,description_en:S.description_en||null,discount_type:S.discount_type,discount_value:S.discount_value,min_order:S.min_order||null,max_uses:S.max_uses||null,is_active:S.is_active,start_date:S.start_date?new Date(S.start_date).toISOString():null,end_date:S.end_date?new Date(S.end_date).toISOString():null};e?await g(e.id,L):await f(L),l(),r()}catch(L){console.error("Error saving voucher:",L)}finally{s(!1)}};return v.jsxs(_r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"bg-muted/50 rounded-xl p-4 mb-4",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[v.jsx(qP,{className:"w-4 h-4 text-accent"}),e?u==="vi"?"Chnh sa voucher":"Edit Voucher":u==="vi"?"To voucher mi":"Create New Voucher"]}),v.jsx("button",{onClick:r,className:"p-1 hover:bg-muted rounded-full",children:v.jsx(xi,{className:"w-4 h-4"})})]}),v.jsxs("form",{onSubmit:j,className:"space-y-3",children:[v.jsxs("div",{children:[v.jsxs(hi,{className:"text-xs",children:[u==="vi"?"M voucher":"Voucher Code"," *"]}),v.jsx(fi,{value:S.code,onChange:O=>A(L=>({...L,code:O.target.value.toUpperCase()})),placeholder:"GIAM20",required:!0,className:"h-9 uppercase"})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Tiu  (VI) *"}),v.jsx(fi,{value:S.title_vi,onChange:O=>A(L=>({...L,title_vi:O.target.value})),placeholder:"Gim 20%",required:!0,className:"h-9"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Title (EN)"}),v.jsx(fi,{value:S.title_en,onChange:O=>A(L=>({...L,title_en:O.target.value})),placeholder:"20% off",className:"h-9"})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"M t (VI)"}),v.jsx(yh,{value:S.description_vi,onChange:O=>A(L=>({...L,description_vi:O.target.value})),placeholder:"p dng cho n t 50k",rows:2,className:"text-sm"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:"Description (EN)"}),v.jsx(yh,{value:S.description_en,onChange:O=>A(L=>({...L,description_en:O.target.value})),placeholder:"Valid for orders over 50k",rows:2,className:"text-sm"})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:u==="vi"?"Loi gim gi":"Discount Type"}),v.jsxs(fD,{value:S.discount_type,onValueChange:O=>A(L=>({...L,discount_type:O})),children:[v.jsx(BT,{className:"h-9",children:v.jsx(pD,{})}),v.jsxs(FT,{children:[v.jsx(ul,{value:"percent",children:v.jsxs("span",{className:"flex items-center gap-1",children:[v.jsx(E5,{className:"w-3 h-3"})," ",u==="vi"?"Phn trm":"Percentage"]})}),v.jsx(ul,{value:"fixed",children:u==="vi"?"C nh (VN)":"Fixed (VND)"})]})]})]}),v.jsxs("div",{children:[v.jsxs(hi,{className:"text-xs",children:[u==="vi"?"Gi tr":"Value"," ",S.discount_type==="percent"?"(%)":"(VN)"]}),v.jsx(fi,{type:"number",value:S.discount_value,onChange:O=>A(L=>({...L,discount_value:parseInt(O.target.value)||0})),className:"h-9"})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:u==="vi"?"n ti thiu (VN)":"Min Order (VND)"}),v.jsx(fi,{type:"number",value:S.min_order,onChange:O=>A(L=>({...L,min_order:parseInt(O.target.value)||0})),className:"h-9"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:u==="vi"?"S ln s dng ti a":"Max Uses"}),v.jsx(fi,{type:"number",value:S.max_uses||"",onChange:O=>A(L=>({...L,max_uses:O.target.value?parseInt(O.target.value):null})),placeholder:u==="vi"?"Khng gii hn":"Unlimited",className:"h-9"})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:u==="vi"?"Ngy bt u":"Start Date"}),v.jsx(fi,{type:"date",value:S.start_date,onChange:O=>A(L=>({...L,start_date:O.target.value})),className:"h-9"})]}),v.jsxs("div",{children:[v.jsx(hi,{className:"text-xs",children:u==="vi"?"Ngy kt thc":"End Date"}),v.jsx(fi,{type:"date",value:S.end_date,onChange:O=>A(L=>({...L,end_date:O.target.value})),className:"h-9"})]})]}),v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx($T,{checked:S.is_active,onCheckedChange:O=>A(L=>({...L,is_active:O}))}),v.jsx(hi,{className:"text-sm",children:u==="vi"?"Kch hot voucher":"Activate voucher"})]}),v.jsxs("div",{className:"flex gap-2 pt-2",children:[v.jsx(vn,{type:"button",variant:"ghost",onClick:r,size:"sm",className:"flex-1",children:u==="vi"?"Hy":"Cancel"}),v.jsx(vn,{type:"submit",disabled:w,size:"sm",className:"flex-1",children:w?"...":e?u==="vi"?"Cp nht":"Update":u==="vi"?"To":"Create"})]})]})]})},xZ={pending:"bg-yellow-500/20 text-yellow-600",approved:"bg-green-500/20 text-green-600",rejected:"bg-red-500/20 text-red-600"},wZ={pending:{vi:"Ch duyt",en:"Pending"},approved:{vi:" duyt",en:"Approved"},rejected:{vi:"T chi",en:"Rejected"}},bZ=({isOpen:t,onClose:e,onLoginClick:r})=>{const{language:l}=da(),{session:u}=ha(),{stores:f,isLoading:g,fetchStores:w,deleteStore:s,fetchMenuItems:S,fetchVouchers:A,deleteMenuItem:j,deleteVoucher:O}=UT(),[L,W]=I.useState(!1),[U,q]=I.useState(null),[Q,J]=I.useState(null),[Y,ie]=I.useState("menu"),[_e,Se]=I.useState([]),[Ie,Ue]=I.useState([]),[Je,Me]=I.useState(!1),[lt,ft]=I.useState(!1),[mt,gt]=I.useState(null),[Lt,it]=I.useState(null),[We,Le]=I.useState(!1);I.useEffect(()=>{Q&&we(Q)},[Q]);const we=async Mt=>{const[ct,Nt]=await Promise.all([S(Mt),A(Mt)]);Se(ct),Ue(Nt)},st=async Mt=>{try{await w()}catch(ct){console.error(ct)}W(!1),q(null)},ke=async Mt=>{confirm(l==="vi"?"Bn c chc mun xa ca hng ny?":"Are you sure you want to delete this store?")&&await s(Mt)},Ve=async Mt=>{confirm(l==="vi"?"Xa mn ny?":"Delete this item?")&&(await j(Mt),Q&&we(Q))},bt=async Mt=>{confirm(l==="vi"?"Xa voucher ny?":"Delete this voucher?")&&(await O(Mt),Q&&we(Q))},wt=async Mt=>{Le(!0);try{const{data:ct,error:Nt}=await Wt.functions.invoke("create-checkout",{body:{storeId:Mt,type:"vip",categoryId:1,returnUrl:window.location.href,cancelUrl:window.location.href}});if(Nt)throw Nt;if(ct&&ct.checkoutUrl)window.location.href=ct.checkoutUrl;else throw new Error("Khng ly c link thanh ton")}catch(ct){alert("Li: "+ct.message)}finally{Le(!1)}},Yt=Mt=>new Intl.NumberFormat("vi-VN").format(Mt)+"";return t?v.jsxs(v.Fragment,{children:[v.jsx(_r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 bg-transparent pointer-events-none",onClick:e}),v.jsxs(_r.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-background z-50 shadow-2xl flex flex-col bg-white",children:[v.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[v.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[v.jsx(Yc,{className:"w-5 h-5 text-primary"}),l==="vi"?"Ca hng ca ti":"My Stores"]}),v.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:v.jsx(xi,{className:"w-5 h-5"})})]}),v.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50/50",children:u?g?v.jsx("div",{className:"text-center py-12",children:v.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"})}):f.length===0?v.jsxs("div",{className:"text-center py-12",children:[v.jsx(Yc,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),v.jsx("p",{className:"text-muted-foreground mb-4",children:l==="vi"?"Bn cha c ca hng no":"You don't have any stores yet"}),v.jsxs(vn,{onClick:()=>W(!0),children:[v.jsx(Sm,{className:"w-4 h-4 mr-2"}),l==="vi"?"Thm ca hng":"Add Store"]})]}):v.jsxs("div",{className:"space-y-4",children:[f.map(Mt=>{const ct=Mt.is_premium===!0;return v.jsxs("div",{className:"border bg-white rounded-xl overflow-hidden shadow-sm relative",children:[ct&&v.jsxs("div",{className:"absolute top-0 right-0 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-2 py-0.5 rounded-bl-lg z-10 flex items-center gap-1",children:[v.jsx(fl,{className:"w-3 h-3 fill-yellow-900"})," VIP"]}),v.jsxs("div",{className:"p-4",children:[v.jsxs("div",{className:"flex gap-3",children:[v.jsx("div",{className:"w-16 h-16 flex-shrink-0",children:Mt.image_url?v.jsx("img",{src:Mt.image_url,alt:Mt.name_vi,className:"w-full h-full rounded-lg object-cover border",onError:Nt=>{Nt.currentTarget.src="https://placehold.co/100x100?text=No+Img"}}):v.jsx("div",{className:"w-full h-full rounded-lg bg-gray-100 flex items-center justify-center border",children:v.jsx(Yc,{className:"w-6 h-6 text-gray-400"})})}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("div",{className:"flex items-start justify-between gap-2",children:v.jsx("h3",{className:"font-semibold truncate text-gray-900 pr-8",children:l==="en"&&Mt.name_en?Mt.name_en:Mt.name_vi})}),v.jsx("div",{className:"flex items-center gap-2 mt-1",children:v.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase ${xZ[Mt.status]}`,children:wZ[Mt.status]?.[l]||Mt.status})}),v.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[v.jsx(Wi,{className:"w-3 h-3 flex-shrink-0"}),v.jsx("span",{className:"truncate",children:l==="en"&&Mt.address_en?Mt.address_en:Mt.address_vi})]})]})]}),v.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t",children:[v.jsxs(vn,{variant:"outline",size:"sm",onClick:()=>{q(Mt),W(!0)},className:"flex-1 h-8 text-xs",children:[v.jsx(ew,{className:"w-3 h-3 mr-1"}),l==="vi"?"Sa":"Edit"]}),v.jsx(vn,{variant:"outline",size:"sm",onClick:()=>ke(Mt.id),className:"h-8 w-8 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 border-red-200",children:v.jsx(ch,{className:"w-3 h-3"})}),v.jsx(vn,{variant:"ghost",size:"sm",onClick:()=>J(Q===Mt.id?null:Mt.id),className:"h-8 w-8 p-0",children:Q===Mt.id?v.jsx(Lm,{className:"w-4 h-4"}):v.jsx(Hf,{className:"w-4 h-4"})})]})]}),v.jsx(Da,{children:Q===Mt.id&&v.jsxs(_r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t bg-gray-50",children:[v.jsxs("div",{className:"flex border-b bg-white",children:[v.jsxs("button",{onClick:()=>ie("menu"),className:`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${Y==="menu"?"border-b-2 border-primary text-primary":"text-gray-500 hover:text-gray-800"}`,children:[v.jsx(KP,{className:"w-4 h-4"}),"Menu (",_e.length,")"]}),v.jsxs("button",{onClick:()=>ie("voucher"),className:`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${Y==="voucher"?"border-b-2 border-primary text-primary":"text-gray-500 hover:text-gray-800"}`,children:[v.jsx(qP,{className:"w-4 h-4"}),"Voucher (",Ie.length,")"]})]}),v.jsx("div",{className:"p-4",children:Y==="menu"?v.jsxs(v.Fragment,{children:[v.jsx(Da,{children:Je&&v.jsx(_Z,{storeId:Mt.id,item:mt,onClose:()=>{Me(!1),gt(null)},onSuccess:()=>we(Mt.id)})}),!Je&&(ct?v.jsxs(vn,{variant:"outline",size:"sm",onClick:()=>Me(!0),className:"w-full mb-3 bg-white border-dashed border-2 hover:border-primary hover:text-primary",children:[v.jsx(Sm,{className:"w-4 h-4 mr-1"}),l==="vi"?"Thm mn mi":"Add Item"]}):v.jsxs("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-center",children:[v.jsx(Cy,{className:"w-5 h-5 mx-auto text-yellow-600 mb-1"}),v.jsx("p",{className:"text-xs font-medium text-yellow-800 mb-2",children:"Tnh nng Menu ch dnh cho VIP"}),v.jsxs(vn,{size:"sm",onClick:()=>wt(Mt.id),disabled:We,className:"bg-yellow-500 hover:bg-yellow-600 text-white w-full",children:[We?v.jsx(ls,{className:"w-3 h-3 animate-spin"}):v.jsx(fl,{className:"w-3 h-3 mr-1"}),"Nng cp ngay (5.000)"]})]})),v.jsx("div",{className:"space-y-2",children:_e.map(Nt=>v.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white rounded-lg border shadow-sm",children:[v.jsx("img",{src:Nt.image_url||"https://placehold.co/100x100?text=Food",alt:Nt.name_vi,className:"w-12 h-12 rounded-lg object-cover bg-gray-100",onError:xn=>{xn.currentTarget.src="https://placehold.co/100x100?text=Food"}}),v.jsxs("div",{className:"flex-1 min-w-0",children:[v.jsx("p",{className:"font-medium text-sm truncate text-gray-900",children:l==="en"&&Nt.name_en?Nt.name_en:Nt.name_vi}),v.jsx("p",{className:"text-xs text-primary font-bold",children:Yt(Nt.price)})]}),v.jsxs("div",{className:"flex gap-1",children:[v.jsx("button",{onClick:()=>{gt(Nt),Me(!0)},className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",children:v.jsx(ew,{className:"w-3 h-3"})}),v.jsx("button",{onClick:()=>Ve(Nt.id),className:"p-1.5 hover:bg-red-50 rounded text-red-500",children:v.jsx(ch,{className:"w-3 h-3"})})]})]},Nt.id))})]}):v.jsxs(v.Fragment,{children:[v.jsx(Da,{children:lt&&v.jsx(vZ,{storeId:Mt.id,voucher:Lt,onClose:()=>{ft(!1),it(null)},onSuccess:()=>we(Mt.id)})}),!lt&&(ct?v.jsxs(vn,{variant:"outline",size:"sm",onClick:()=>ft(!0),className:"w-full mb-3 bg-white border-dashed border-2 hover:border-primary hover:text-primary",children:[v.jsx(Sm,{className:"w-4 h-4 mr-1"}),l==="vi"?"To voucher mi":"Create Voucher"]}):v.jsxs("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-center",children:[v.jsx(Cy,{className:"w-5 h-5 mx-auto text-yellow-600 mb-1"}),v.jsx("p",{className:"text-xs font-medium text-yellow-800 mb-2",children:"Tnh nng Voucher ch dnh cho VIP"}),v.jsxs(vn,{size:"sm",onClick:()=>wt(Mt.id),disabled:We,className:"bg-yellow-500 hover:bg-yellow-600 text-white w-full",children:[We?v.jsx(ls,{className:"w-3 h-3 animate-spin"}):v.jsx(fl,{className:"w-3 h-3 mr-1"}),"Nng cp ngay (5.000)"]})]})),v.jsx("div",{className:"space-y-2",children:Ie.map(Nt=>v.jsx("div",{className:"p-3 bg-white rounded-lg border border-dashed border-primary/30",children:v.jsxs("div",{className:"flex items-start justify-between gap-2",children:[v.jsxs("div",{children:[v.jsx("div",{className:"flex items-center gap-2",children:v.jsx("span",{className:"font-mono text-xs font-bold bg-primary/10 text-primary px-2 py-0.5 rounded",children:Nt.code})}),v.jsx("p",{className:"text-sm font-medium mt-1 text-gray-900",children:l==="en"&&Nt.title_en?Nt.title_en:Nt.title_vi}),v.jsxs("p",{className:"text-xs text-gray-500",children:["Gim: ",Nt.discount_type==="percent"?`${Nt.discount_value}%`:Yt(Nt.discount_value)]})]}),v.jsxs("div",{className:"flex gap-1",children:[v.jsx("button",{onClick:()=>{it(Nt),ft(!0)},className:"p-1.5 hover:bg-gray-100 rounded text-gray-600",children:v.jsx(ew,{className:"w-3 h-3"})}),v.jsx("button",{onClick:()=>bt(Nt.id),className:"p-1.5 hover:bg-red-50 rounded text-red-500",children:v.jsx(ch,{className:"w-3 h-3"})})]})]})},Nt.id))})]})})]})})]},Mt.id)}),v.jsxs(vn,{onClick:()=>W(!0),className:"w-full shadow-lg",children:[v.jsx(Sm,{className:"w-4 h-4 mr-2"}),l==="vi"?"Thm ca hng mi":"Add New Store"]})]}):v.jsxs("div",{className:"text-center py-12",children:[v.jsx(Yc,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),v.jsx("p",{className:"text-muted-foreground mb-4",children:l==="vi"?"ng nhp  qun l ca hng":"Login to manage your stores"}),v.jsx(vn,{onClick:r,children:l==="vi"?"ng nhp":"Login"})]})})]}),v.jsx(yD,{isOpen:L,onClose:()=>{W(!1),q(null)},initialData:U,onSubmit:st,isSubmitting:g,onUpgradeClick:()=>{U?wt(U.id):alert("Vui lng lu ca hng trc khi nng cp!")}})]}):null};function TZ(t){const e=SZ(t),r=I.forwardRef((l,u)=>{const{children:f,...g}=l,w=I.Children.toArray(f),s=w.find(CZ);if(s){const S=s.props.children,A=w.map(j=>j===s?I.Children.count(S)>1?I.Children.only(null):I.isValidElement(S)?S.props.children:null:j);return v.jsx(e,{...g,ref:u,children:I.isValidElement(S)?I.cloneElement(S,void 0,A):null})}return v.jsx(e,{...g,ref:u,children:f})});return r.displayName=`${t}.Slot`,r}function SZ(t){const e=I.forwardRef((r,l)=>{const{children:u,...f}=r;if(I.isValidElement(u)){const g=AZ(u),w=kZ(f,u.props);return u.type!==I.Fragment&&(w.ref=l?id(l,g):g),I.cloneElement(u,w)}return I.Children.count(u)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var EZ=Symbol("radix.slottable");function CZ(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===EZ}function kZ(t,e){const r={...e};for(const l in e){const u=t[l],f=e[l];/^on[A-Z]/.test(l)?u&&f?r[l]=(...w)=>{const s=f(...w);return u(...w),s}:u&&(r[l]=u):l==="style"?r[l]={...u,...f}:l==="className"&&(r[l]=[u,f].filter(Boolean).join(" "))}return{...t,...r}}function AZ(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning;return r?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=e&&"isReactWarning"in e&&e.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var i1=["Enter"," "],PZ=["ArrowDown","PageUp","Home"],PD=["ArrowUp","PageDown","End"],MZ=[...PZ,...PD],IZ={ltr:[...i1,"ArrowRight"],rtl:[...i1,"ArrowLeft"]},RZ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},d_="Menu",[Zy,NZ,jZ]=c0(d_),[op,MD]=gl(d_,[jZ,Xm,Z0]),tx=Xm(),ID=Z0(),[DZ,ap]=op(d_),[LZ,h_]=op(d_),RD=t=>{const{__scopeMenu:e,open:r=!1,children:l,dir:u,onOpenChange:f,modal:g=!0}=t,w=tx(e),[s,S]=I.useState(null),A=I.useRef(!1),j=$i(f),O=o_(u);return I.useEffect(()=>{const L=()=>{A.current=!0,document.addEventListener("pointerdown",W,{capture:!0,once:!0}),document.addEventListener("pointermove",W,{capture:!0,once:!0})},W=()=>A.current=!1;return document.addEventListener("keydown",L,{capture:!0}),()=>{document.removeEventListener("keydown",L,{capture:!0}),document.removeEventListener("pointerdown",W,{capture:!0}),document.removeEventListener("pointermove",W,{capture:!0})}},[]),v.jsx(AM,{...w,children:v.jsx(DZ,{scope:e,open:r,onOpenChange:j,content:s,onContentChange:S,children:v.jsx(LZ,{scope:e,onClose:I.useCallback(()=>j(!1),[j]),isUsingKeyboardRef:A,dir:O,modal:g,children:l})})})};RD.displayName=d_;var OZ="MenuAnchor",GT=I.forwardRef((t,e)=>{const{__scopeMenu:r,...l}=t,u=tx(r);return v.jsx(k1,{...u,...l,ref:e})});GT.displayName=OZ;var HT="MenuPortal",[zZ,ND]=op(HT,{forceMount:void 0}),jD=t=>{const{__scopeMenu:e,forceMount:r,children:l,container:u}=t,f=ap(HT,e);return v.jsx(zZ,{scope:e,forceMount:r,children:v.jsx(Ho,{present:r||f.open,children:v.jsx(Xy,{asChild:!0,container:u,children:l})})})};jD.displayName=HT;var ml="MenuContent",[BZ,qT]=op(ml),DD=I.forwardRef((t,e)=>{const r=ND(ml,t.__scopeMenu),{forceMount:l=r.forceMount,...u}=t,f=ap(ml,t.__scopeMenu),g=h_(ml,t.__scopeMenu);return v.jsx(Zy.Provider,{scope:t.__scopeMenu,children:v.jsx(Ho,{present:l||f.open,children:v.jsx(Zy.Slot,{scope:t.__scopeMenu,children:g.modal?v.jsx(FZ,{...u,ref:e}):v.jsx(VZ,{...u,ref:e})})})})}),FZ=I.forwardRef((t,e)=>{const r=ap(ml,t.__scopeMenu),l=I.useRef(null),u=ar(e,l);return I.useEffect(()=>{const f=l.current;if(f)return AT(f)},[]),v.jsx(WT,{...t,ref:u,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Xt(t.onFocusOutside,f=>f.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),VZ=I.forwardRef((t,e)=>{const r=ap(ml,t.__scopeMenu);return v.jsx(WT,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),UZ=TZ("MenuContent.ScrollLock"),WT=I.forwardRef((t,e)=>{const{__scopeMenu:r,loop:l=!1,trapFocus:u,onOpenAutoFocus:f,onCloseAutoFocus:g,disableOutsidePointerEvents:w,onEntryFocus:s,onEscapeKeyDown:S,onPointerDownOutside:A,onFocusOutside:j,onInteractOutside:O,onDismiss:L,disableOutsideScroll:W,...U}=t,q=ap(ml,r),Q=h_(ml,r),J=tx(r),Y=ID(r),ie=NZ(r),[_e,Se]=I.useState(null),Ie=I.useRef(null),Ue=ar(e,Ie,q.onContentChange),Je=I.useRef(0),Me=I.useRef(""),lt=I.useRef(0),ft=I.useRef(null),mt=I.useRef("right"),gt=I.useRef(0),Lt=W?F0:I.Fragment,it=W?{as:UZ,allowPinchZoom:!0}:void 0,We=we=>{const st=Me.current+we,ke=ie().filter(ct=>!ct.disabled),Ve=document.activeElement,bt=ke.find(ct=>ct.ref.current===Ve)?.textValue,wt=ke.map(ct=>ct.textValue),Yt=eK(wt,st,bt),Mt=ke.find(ct=>ct.textValue===Yt)?.ref.current;(function ct(Nt){Me.current=Nt,window.clearTimeout(Je.current),Nt!==""&&(Je.current=window.setTimeout(()=>ct(""),1e3))})(st),Mt&&setTimeout(()=>Mt.focus())};I.useEffect(()=>()=>window.clearTimeout(Je.current),[]),kT();const Le=I.useCallback(we=>mt.current===ft.current?.side&&nK(we,ft.current?.area),[]);return v.jsx(BZ,{scope:r,searchRef:Me,onItemEnter:I.useCallback(we=>{Le(we)&&we.preventDefault()},[Le]),onItemLeave:I.useCallback(we=>{Le(we)||(Ie.current?.focus(),Se(null))},[Le]),onTriggerLeave:I.useCallback(we=>{Le(we)&&we.preventDefault()},[Le]),pointerGraceTimerRef:lt,onPointerGraceIntentChange:I.useCallback(we=>{ft.current=we},[]),children:v.jsx(Lt,{...it,children:v.jsx(z0,{asChild:!0,trapped:u,onMountAutoFocus:Xt(f,we=>{we.preventDefault(),Ie.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:g,children:v.jsx(qm,{asChild:!0,disableOutsidePointerEvents:w,onEscapeKeyDown:S,onPointerDownOutside:A,onFocusOutside:j,onInteractOutside:O,onDismiss:L,children:v.jsx(ij,{asChild:!0,...Y,dir:Q.dir,orientation:"vertical",loop:l,currentTabStopId:_e,onCurrentTabStopIdChange:Se,onEntryFocus:Xt(s,we=>{Q.isUsingKeyboardRef.current||we.preventDefault()}),preventScrollOnEntryFocus:!0,children:v.jsx(A1,{role:"menu","aria-orientation":"vertical","data-state":YD(q.open),"data-radix-menu-content":"",dir:Q.dir,...J,...U,ref:Ue,style:{outline:"none",...U.style},onKeyDown:Xt(U.onKeyDown,we=>{const ke=we.target.closest("[data-radix-menu-content]")===we.currentTarget,Ve=we.ctrlKey||we.altKey||we.metaKey,bt=we.key.length===1;ke&&(we.key==="Tab"&&we.preventDefault(),!Ve&&bt&&We(we.key));const wt=Ie.current;if(we.target!==wt||!MZ.includes(we.key))return;we.preventDefault();const Mt=ie().filter(ct=>!ct.disabled).map(ct=>ct.ref.current);PD.includes(we.key)&&Mt.reverse(),JZ(Mt)}),onBlur:Xt(t.onBlur,we=>{we.currentTarget.contains(we.target)||(window.clearTimeout(Je.current),Me.current="")}),onPointerMove:Xt(t.onPointerMove,Ky(we=>{const st=we.target,ke=gt.current!==we.clientX;if(we.currentTarget.contains(st)&&ke){const Ve=we.clientX>gt.current?"right":"left";mt.current=Ve,gt.current=we.clientX}}))})})})})})})});DD.displayName=ml;var $Z="MenuGroup",ZT=I.forwardRef((t,e)=>{const{__scopeMenu:r,...l}=t;return v.jsx(In.div,{role:"group",...l,ref:e})});ZT.displayName=$Z;var GZ="MenuLabel",LD=I.forwardRef((t,e)=>{const{__scopeMenu:r,...l}=t;return v.jsx(In.div,{...l,ref:e})});LD.displayName=GZ;var s0="MenuItem",cP="menu.itemSelect",nx=I.forwardRef((t,e)=>{const{disabled:r=!1,onSelect:l,...u}=t,f=I.useRef(null),g=h_(s0,t.__scopeMenu),w=qT(s0,t.__scopeMenu),s=ar(e,f),S=I.useRef(!1),A=()=>{const j=f.current;if(!r&&j){const O=new CustomEvent(cP,{bubbles:!0,cancelable:!0});j.addEventListener(cP,L=>l?.(L),{once:!0}),o1(j,O),O.defaultPrevented?S.current=!1:g.onClose()}};return v.jsx(OD,{...u,ref:s,disabled:r,onClick:Xt(t.onClick,A),onPointerDown:j=>{t.onPointerDown?.(j),S.current=!0},onPointerUp:Xt(t.onPointerUp,j=>{S.current||j.currentTarget?.click()}),onKeyDown:Xt(t.onKeyDown,j=>{const O=w.searchRef.current!=="";r||O&&j.key===" "||i1.includes(j.key)&&(j.currentTarget.click(),j.preventDefault())})})});nx.displayName=s0;var OD=I.forwardRef((t,e)=>{const{__scopeMenu:r,disabled:l=!1,textValue:u,...f}=t,g=qT(s0,r),w=ID(r),s=I.useRef(null),S=ar(e,s),[A,j]=I.useState(!1),[O,L]=I.useState("");return I.useEffect(()=>{const W=s.current;W&&L((W.textContent??"").trim())},[f.children]),v.jsx(Zy.ItemSlot,{scope:r,disabled:l,textValue:u??O,children:v.jsx(sj,{asChild:!0,...w,focusable:!l,children:v.jsx(In.div,{role:"menuitem","data-highlighted":A?"":void 0,"aria-disabled":l||void 0,"data-disabled":l?"":void 0,...f,ref:S,onPointerMove:Xt(t.onPointerMove,Ky(W=>{l?g.onItemLeave(W):(g.onItemEnter(W),W.defaultPrevented||W.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Xt(t.onPointerLeave,Ky(W=>g.onItemLeave(W))),onFocus:Xt(t.onFocus,()=>j(!0)),onBlur:Xt(t.onBlur,()=>j(!1))})})})}),HZ="MenuCheckboxItem",zD=I.forwardRef((t,e)=>{const{checked:r=!1,onCheckedChange:l,...u}=t;return v.jsx($D,{scope:t.__scopeMenu,checked:r,children:v.jsx(nx,{role:"menuitemcheckbox","aria-checked":o0(r)?"mixed":r,...u,ref:e,"data-state":XT(r),onSelect:Xt(u.onSelect,()=>l?.(o0(r)?!0:!r),{checkForDefaultPrevented:!1})})})});zD.displayName=HZ;var BD="MenuRadioGroup",[qZ,WZ]=op(BD,{value:void 0,onValueChange:()=>{}}),FD=I.forwardRef((t,e)=>{const{value:r,onValueChange:l,...u}=t,f=$i(l);return v.jsx(qZ,{scope:t.__scopeMenu,value:r,onValueChange:f,children:v.jsx(ZT,{...u,ref:e})})});FD.displayName=BD;var VD="MenuRadioItem",UD=I.forwardRef((t,e)=>{const{value:r,...l}=t,u=WZ(VD,t.__scopeMenu),f=r===u.value;return v.jsx($D,{scope:t.__scopeMenu,checked:f,children:v.jsx(nx,{role:"menuitemradio","aria-checked":f,...l,ref:e,"data-state":XT(f),onSelect:Xt(l.onSelect,()=>u.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});UD.displayName=VD;var KT="MenuItemIndicator",[$D,ZZ]=op(KT,{checked:!1}),GD=I.forwardRef((t,e)=>{const{__scopeMenu:r,forceMount:l,...u}=t,f=ZZ(KT,r);return v.jsx(Ho,{present:l||o0(f.checked)||f.checked===!0,children:v.jsx(In.span,{...u,ref:e,"data-state":XT(f.checked)})})});GD.displayName=KT;var KZ="MenuSeparator",HD=I.forwardRef((t,e)=>{const{__scopeMenu:r,...l}=t;return v.jsx(In.div,{role:"separator","aria-orientation":"horizontal",...l,ref:e})});HD.displayName=KZ;var XZ="MenuArrow",qD=I.forwardRef((t,e)=>{const{__scopeMenu:r,...l}=t,u=tx(r);return v.jsx(P1,{...u,...l,ref:e})});qD.displayName=XZ;var YZ="MenuSub",[wX,WD]=op(YZ),dy="MenuSubTrigger",ZD=I.forwardRef((t,e)=>{const r=ap(dy,t.__scopeMenu),l=h_(dy,t.__scopeMenu),u=WD(dy,t.__scopeMenu),f=qT(dy,t.__scopeMenu),g=I.useRef(null),{pointerGraceTimerRef:w,onPointerGraceIntentChange:s}=f,S={__scopeMenu:t.__scopeMenu},A=I.useCallback(()=>{g.current&&window.clearTimeout(g.current),g.current=null},[]);return I.useEffect(()=>A,[A]),I.useEffect(()=>{const j=w.current;return()=>{window.clearTimeout(j),s(null)}},[w,s]),v.jsx(GT,{asChild:!0,...S,children:v.jsx(OD,{id:u.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":u.contentId,"data-state":YD(r.open),...t,ref:id(e,u.onTriggerChange),onClick:j=>{t.onClick?.(j),!(t.disabled||j.defaultPrevented)&&(j.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Xt(t.onPointerMove,Ky(j=>{f.onItemEnter(j),!j.defaultPrevented&&!t.disabled&&!r.open&&!g.current&&(f.onPointerGraceIntentChange(null),g.current=window.setTimeout(()=>{r.onOpenChange(!0),A()},100))})),onPointerLeave:Xt(t.onPointerLeave,Ky(j=>{A();const O=r.content?.getBoundingClientRect();if(O){const L=r.content?.dataset.side,W=L==="right",U=W?-5:5,q=O[W?"left":"right"],Q=O[W?"right":"left"];f.onPointerGraceIntentChange({area:[{x:j.clientX+U,y:j.clientY},{x:q,y:O.top},{x:Q,y:O.top},{x:Q,y:O.bottom},{x:q,y:O.bottom}],side:L}),window.clearTimeout(w.current),w.current=window.setTimeout(()=>f.onPointerGraceIntentChange(null),300)}else{if(f.onTriggerLeave(j),j.defaultPrevented)return;f.onPointerGraceIntentChange(null)}})),onKeyDown:Xt(t.onKeyDown,j=>{const O=f.searchRef.current!=="";t.disabled||O&&j.key===" "||IZ[l.dir].includes(j.key)&&(r.onOpenChange(!0),r.content?.focus(),j.preventDefault())})})})});ZD.displayName=dy;var KD="MenuSubContent",XD=I.forwardRef((t,e)=>{const r=ND(ml,t.__scopeMenu),{forceMount:l=r.forceMount,...u}=t,f=ap(ml,t.__scopeMenu),g=h_(ml,t.__scopeMenu),w=WD(KD,t.__scopeMenu),s=I.useRef(null),S=ar(e,s);return v.jsx(Zy.Provider,{scope:t.__scopeMenu,children:v.jsx(Ho,{present:l||f.open,children:v.jsx(Zy.Slot,{scope:t.__scopeMenu,children:v.jsx(WT,{id:w.contentId,"aria-labelledby":w.triggerId,...u,ref:S,align:"start",side:g.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:A=>{g.isUsingKeyboardRef.current&&s.current?.focus(),A.preventDefault()},onCloseAutoFocus:A=>A.preventDefault(),onFocusOutside:Xt(t.onFocusOutside,A=>{A.target!==w.trigger&&f.onOpenChange(!1)}),onEscapeKeyDown:Xt(t.onEscapeKeyDown,A=>{g.onClose(),A.preventDefault()}),onKeyDown:Xt(t.onKeyDown,A=>{const j=A.currentTarget.contains(A.target),O=RZ[g.dir].includes(A.key);j&&O&&(f.onOpenChange(!1),w.trigger?.focus(),A.preventDefault())})})})})})});XD.displayName=KD;function YD(t){return t?"open":"closed"}function o0(t){return t==="indeterminate"}function XT(t){return o0(t)?"indeterminate":t?"checked":"unchecked"}function JZ(t){const e=document.activeElement;for(const r of t)if(r===e||(r.focus(),document.activeElement!==e))return}function QZ(t,e){return t.map((r,l)=>t[(e+l)%t.length])}function eK(t,e,r){const u=e.length>1&&Array.from(e).every(S=>S===e[0])?e[0]:e,f=r?t.indexOf(r):-1;let g=QZ(t,Math.max(f,0));u.length===1&&(g=g.filter(S=>S!==r));const s=g.find(S=>S.toLowerCase().startsWith(u.toLowerCase()));return s!==r?s:void 0}function tK(t,e){const{x:r,y:l}=t;let u=!1;for(let f=0,g=e.length-1;f<e.length;g=f++){const w=e[f],s=e[g],S=w.x,A=w.y,j=s.x,O=s.y;A>l!=O>l&&r<(j-S)*(l-A)/(O-A)+S&&(u=!u)}return u}function nK(t,e){if(!e)return!1;const r={x:t.clientX,y:t.clientY};return tK(r,e)}function Ky(t){return e=>e.pointerType==="mouse"?t(e):void 0}var rK=RD,iK=GT,sK=jD,oK=DD,aK=ZT,lK=LD,cK=nx,uK=zD,dK=FD,hK=UD,fK=GD,pK=HD,mK=qD,gK=ZD,yK=XD,rx="DropdownMenu",[_K]=gl(rx,[MD]),qo=MD(),[vK,JD]=_K(rx),QD=t=>{const{__scopeDropdownMenu:e,children:r,dir:l,open:u,defaultOpen:f,onOpenChange:g,modal:w=!0}=t,s=qo(e),S=I.useRef(null),[A,j]=hh({prop:u,defaultProp:f??!1,onChange:g,caller:rx});return v.jsx(vK,{scope:e,triggerId:Qc(),triggerRef:S,contentId:Qc(),open:A,onOpenChange:j,onOpenToggle:I.useCallback(()=>j(O=>!O),[j]),modal:w,children:v.jsx(rK,{...s,open:A,onOpenChange:j,dir:l,modal:w,children:r})})};QD.displayName=rx;var e3="DropdownMenuTrigger",t3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,disabled:l=!1,...u}=t,f=JD(e3,r),g=qo(r);return v.jsx(iK,{asChild:!0,...g,children:v.jsx(In.button,{type:"button",id:f.triggerId,"aria-haspopup":"menu","aria-expanded":f.open,"aria-controls":f.open?f.contentId:void 0,"data-state":f.open?"open":"closed","data-disabled":l?"":void 0,disabled:l,...u,ref:id(e,f.triggerRef),onPointerDown:Xt(t.onPointerDown,w=>{!l&&w.button===0&&w.ctrlKey===!1&&(f.onOpenToggle(),f.open||w.preventDefault())}),onKeyDown:Xt(t.onKeyDown,w=>{l||(["Enter"," "].includes(w.key)&&f.onOpenToggle(),w.key==="ArrowDown"&&f.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(w.key)&&w.preventDefault())})})})});t3.displayName=e3;var xK="DropdownMenuPortal",n3=t=>{const{__scopeDropdownMenu:e,...r}=t,l=qo(e);return v.jsx(sK,{...l,...r})};n3.displayName=xK;var r3="DropdownMenuContent",i3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=JD(r3,r),f=qo(r),g=I.useRef(!1);return v.jsx(oK,{id:u.contentId,"aria-labelledby":u.triggerId,...f,...l,ref:e,onCloseAutoFocus:Xt(t.onCloseAutoFocus,w=>{g.current||u.triggerRef.current?.focus(),g.current=!1,w.preventDefault()}),onInteractOutside:Xt(t.onInteractOutside,w=>{const s=w.detail.originalEvent,S=s.button===0&&s.ctrlKey===!0,A=s.button===2||S;(!u.modal||A)&&(g.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});i3.displayName=r3;var wK="DropdownMenuGroup",bK=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(aK,{...u,...l,ref:e})});bK.displayName=wK;var TK="DropdownMenuLabel",s3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(lK,{...u,...l,ref:e})});s3.displayName=TK;var SK="DropdownMenuItem",o3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(cK,{...u,...l,ref:e})});o3.displayName=SK;var EK="DropdownMenuCheckboxItem",a3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(uK,{...u,...l,ref:e})});a3.displayName=EK;var CK="DropdownMenuRadioGroup",kK=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(dK,{...u,...l,ref:e})});kK.displayName=CK;var AK="DropdownMenuRadioItem",l3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(hK,{...u,...l,ref:e})});l3.displayName=AK;var PK="DropdownMenuItemIndicator",c3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(fK,{...u,...l,ref:e})});c3.displayName=PK;var MK="DropdownMenuSeparator",u3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(pK,{...u,...l,ref:e})});u3.displayName=MK;var IK="DropdownMenuArrow",RK=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(mK,{...u,...l,ref:e})});RK.displayName=IK;var NK="DropdownMenuSubTrigger",d3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(gK,{...u,...l,ref:e})});d3.displayName=NK;var jK="DropdownMenuSubContent",h3=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:r,...l}=t,u=qo(r);return v.jsx(yK,{...u,...l,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});h3.displayName=jK;var DK=QD,LK=t3,OK=n3,f3=i3,p3=s3,m3=o3,g3=a3,y3=l3,_3=c3,v3=u3,x3=d3,w3=h3;const zK=DK,BK=LK,FK=I.forwardRef(({className:t,inset:e,children:r,...l},u)=>v.jsxs(x3,{ref:u,className:cn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",e&&"pl-8",t),...l,children:[r,v.jsx(UP,{className:"ml-auto h-4 w-4"})]}));FK.displayName=x3.displayName;const VK=I.forwardRef(({className:t,...e},r)=>v.jsx(w3,{ref:r,className:cn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e}));VK.displayName=w3.displayName;const b3=I.forwardRef(({className:t,sideOffset:e=4,...r},l)=>v.jsx(OK,{children:v.jsx(f3,{ref:l,sideOffset:e,className:cn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));b3.displayName=f3.displayName;const hy=I.forwardRef(({className:t,inset:e,...r},l)=>v.jsx(m3,{ref:l,className:cn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e&&"pl-8",t),...r}));hy.displayName=m3.displayName;const UK=I.forwardRef(({className:t,children:e,checked:r,...l},u)=>v.jsxs(g3,{ref:u,className:cn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),checked:r,...l,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(_3,{children:v.jsx(tp,{className:"h-4 w-4"})})}),e]}));UK.displayName=g3.displayName;const $K=I.forwardRef(({className:t,children:e,...r},l)=>v.jsxs(y3,{ref:l,className:cn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...r,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(_3,{children:v.jsx(h5,{className:"h-2 w-2 fill-current"})})}),e]}));$K.displayName=y3.displayName;const T3=I.forwardRef(({className:t,inset:e,...r},l)=>v.jsx(p3,{ref:l,className:cn("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...r}));T3.displayName=p3.displayName;const Mv=I.forwardRef(({className:t,...e},r)=>v.jsx(v3,{ref:r,className:cn("-mx-1 my-1 h-px bg-muted",t),...e}));Mv.displayName=v3.displayName;const GK=({onLoginClick:t,onFavoritesClick:e,onStoresClick:r})=>{const{session:l,signOut:u}=ha(),{language:f}=da(),g=rp(),[w,s]=I.useState(!1),[S,A]=I.useState([]),[j,O]=I.useState(!1),[L,W]=I.useState(null);I.useEffect(()=>{l?.user&&(async()=>{const{data:_e}=await Wt.from("user_stores").select("id, name_vi, address_vi, is_premium").eq("user_id",l.user.id);_e&&A(_e)})()},[l]);const U=(ie,_e)=>{if(!S||S.length===0){alert("Bn cha c ca hng no! Hy to ca hng trc.");return}S.length===1?q(S[0].id,ie,_e):(W({type:ie,packageType:_e}),O(!0))},q=async(ie,_e,Se)=>{s(!0),O(!1);try{const{data:Ie,error:Ue}=await Wt.functions.invoke("create-checkout",{body:{storeId:ie,type:_e,packageType:Se,categoryId:1,returnUrl:window.location.href,cancelUrl:window.location.href}});if(Ue)throw Ue;if(Ie&&Ie.checkoutUrl)window.location.href=Ie.checkoutUrl;else throw new Error("Khng ly c link thanh ton")}catch(Ie){console.error(Ie),alert("Li: "+(Ie.message||"C li xy ra"))}finally{s(!1)}},Q=async()=>{try{await u()}catch(ie){console.warn("Li API ng xut:",ie)}finally{localStorage.clear(),window.location.reload()}};if(!l)return v.jsxs(v.Fragment,{children:[v.jsx(vn,{variant:"outline",size:"icon",onClick:t,className:"md:hidden w-10 h-10 rounded-full border-gray-200 bg-white shadow-sm active:scale-95 transition-all text-gray-700 hover:text-green-600 hover:border-green-600",children:v.jsx(d5,{className:"w-6 h-6"})}),v.jsxs(vn,{onClick:t,variant:"default",className:"hidden md:flex gap-2 shadow-lg rounded-xl font-semibold bg-white text-black hover:bg-gray-100 border border-gray-200",children:[v.jsx(ky,{className:"w-4 h-4"}),f==="vi"?"ng nhp":"Login"]})]});const J=l.user.email,Y=J?J[0].toUpperCase():"U";return v.jsxs(v.Fragment,{children:[v.jsxs(zK,{children:[v.jsx(BK,{asChild:!0,children:v.jsx(vn,{variant:"secondary",className:"relative w-10 h-10 rounded-full p-0 overflow-hidden shadow-lg border-2 border-white cursor-pointer hover:ring-2 hover:ring-green-500 transition-all",children:v.jsxs(LT,{className:"h-full w-full",children:[v.jsx(Aj,{src:l.user.user_metadata.avatar_url}),v.jsx(OT,{className:"bg-green-600 text-white font-bold",children:Y})]})})}),v.jsxs(b3,{align:"end",className:"w-64 rounded-xl p-2 mt-2 bg-white shadow-xl border border-gray-100 z-[200]",children:[v.jsx(T3,{children:v.jsxs("div",{className:"flex flex-col space-y-1",children:[v.jsx("p",{className:"text-sm font-medium leading-none",children:f==="vi"?"Ti khon":"Account"}),v.jsx("p",{className:"text-xs leading-none text-muted-foreground truncate font-normal text-gray-500",children:J})]})}),v.jsx(Mv,{className:"my-1 bg-gray-100"}),v.jsxs("div",{className:"bg-gray-50 rounded-lg p-2 mb-2 border border-gray-100",children:[v.jsx("p",{className:"text-[10px] uppercase text-gray-500 font-bold mb-2 pl-1",children:f==="vi"?"Nng cp ca hng":"Upgrade Store"}),v.jsxs("button",{disabled:w,onClick:()=>U("vip"),className:"w-full flex items-center gap-2 text-xs font-semibold text-yellow-700 bg-yellow-100 hover:bg-yellow-200 p-2 rounded mb-2 transition-colors",children:[w?v.jsx(ls,{className:"w-3 h-3 animate-spin"}):v.jsx(fl,{className:"w-3 h-3 fill-yellow-600"}),"VIP"]}),v.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[v.jsxs("button",{disabled:w,onClick:()=>U("ad","week"),className:"flex flex-col items-center justify-center gap-1 text-[10px] font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 p-1.5 rounded transition-colors",children:[w?v.jsx(ls,{className:"w-3 h-3 animate-spin"}):v.jsx(Iv,{className:"w-3 h-3"}),"QC Tun"]}),v.jsxs("button",{disabled:w,onClick:()=>U("ad","month"),className:"flex flex-col items-center justify-center gap-1 text-[10px] font-medium text-indigo-700 bg-indigo-50 hover:bg-indigo-100 p-1.5 rounded transition-colors",children:[w?v.jsx(ls,{className:"w-3 h-3 animate-spin"}):v.jsx(Iv,{className:"w-3 h-3"}),"QC Thng"]})]})]}),J==="admin@gmail.com"&&v.jsxs(v.Fragment,{children:[v.jsxs(hy,{onClick:()=>g("/admin"),className:"cursor-pointer font-bold text-blue-600 bg-blue-50 focus:bg-blue-100 rounded-lg p-2 mb-1",children:[v.jsx(P5,{className:"mr-2 h-4 w-4"}),v.jsx("span",{children:"Admin Dashboard"})]}),v.jsx(Mv,{className:"my-1 bg-gray-100"})]}),v.jsxs(hy,{onClick:e,className:"cursor-pointer rounded-lg hover:bg-gray-50 p-2",children:[v.jsx(ih,{className:"mr-2 h-4 w-4 text-red-500"}),v.jsx("span",{children:f==="vi"?"a im yu thch":"Favorite Locations"})]}),v.jsxs(hy,{onClick:r,className:"cursor-pointer rounded-lg hover:bg-gray-50 p-2",children:[v.jsx(Yc,{className:"mr-2 h-4 w-4 text-orange-500"}),v.jsx("span",{children:f==="vi"?"Ca hng ca ti":"My Stores"})]}),v.jsx(Mv,{className:"my-1 bg-gray-100"}),v.jsxs(hy,{onClick:Q,className:"cursor-pointer text-red-600 focus:text-red-600 focus:bg-red-50 rounded-lg p-2",children:[v.jsx(Kw,{className:"mr-2 h-4 w-4"}),v.jsx("span",{children:f==="vi"?"ng xut":"Log out"})]})]})]}),j&&v.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:v.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200",children:[v.jsxs("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50",children:[v.jsx("h3",{className:"font-bold text-gray-800",children:"Chn ca hng  nng cp"}),v.jsx("button",{onClick:()=>O(!1),className:"p-1 hover:bg-gray-200 rounded-full",children:v.jsx(xi,{className:"w-5 h-5 text-gray-500"})})]}),v.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto space-y-2",children:S.map(ie=>v.jsxs("button",{onClick:()=>L&&q(ie.id,L.type,L.packageType),className:"w-full text-left p-3 rounded-xl border hover:border-blue-500 hover:bg-blue-50 transition-all group relative",children:[v.jsx("div",{className:"font-bold text-gray-900 group-hover:text-blue-700",children:ie.name_vi}),v.jsx("div",{className:"text-xs text-gray-500 truncate",children:ie.address_vi}),ie.is_premium&&L?.type==="vip"&&v.jsx("span",{className:"absolute top-3 right-3 text-[10px] bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full font-bold",children:" VIP"})]},ie.id))})]})})]})},HK=({compact:t=!1})=>{const{language:e,setLanguage:r}=da(),l=[{code:"vi",label:"VI",labelFull:"Ting Vit",flag:""},{code:"en",label:"EN",labelFull:"English",flag:""}];return t?v.jsx("div",{className:"flex items-center bg-card/90 backdrop-blur-sm rounded-full shadow-md border border-border overflow-hidden",children:l.map(({code:u,flag:f})=>v.jsxs(_r.button,{onClick:()=>r(u),className:cn("relative flex items-center justify-center w-8 h-8 text-sm transition-colors duration-200",e===u?"text-primary-foreground":"text-muted-foreground hover:text-foreground"),whileTap:{scale:.9},children:[e===u&&v.jsx(_r.div,{layoutId:"language-active-bg-compact",className:"absolute inset-0.5 bg-primary rounded-full",initial:!1,transition:{type:"spring",stiffness:400,damping:30}}),v.jsx(_r.span,{className:"relative z-10 text-base",animate:{scale:e===u?1.1:.9},children:f})]},u))}):v.jsx("div",{className:"flex items-center bg-card rounded-2xl shadow-lg border-2 border-border overflow-hidden",children:l.map(({code:u,label:f,labelFull:g,flag:w})=>v.jsxs(_r.button,{onClick:()=>r(u),className:cn("relative flex items-center gap-2 px-4 py-2.5 text-sm font-semibold transition-colors duration-200",e===u?"text-primary-foreground":"text-muted-foreground hover:text-foreground"),title:g,whileTap:{scale:.95},children:[e===u&&v.jsx(_r.div,{layoutId:"language-active-bg",className:"absolute inset-0 bg-primary",initial:!1,transition:{type:"spring",stiffness:400,damping:30}}),v.jsx(_r.span,{className:"relative z-10 text-lg",animate:{scale:e===u?1.1:1,rotate:e===u?[0,-10,10,0]:0},transition:{duration:.3},children:w}),v.jsx("span",{className:"relative z-10 font-bold",children:f})]},u))})},qK=({isOpen:t,onClose:e,data:r})=>{const[l,u]=I.useState(!1),[f,g]=I.useState({phone:"",email:"",role:"Ch s hu",message:""}),[w,s]=I.useState([]);if(I.useEffect(()=>{t&&(g({phone:"",email:"",role:"Ch s hu",message:""}),s([]),(async()=>{const{data:{user:L}}=await Wt.auth.getUser();L?.email&&g(W=>({...W,email:L.email}))})())},[t]),!t||!r)return null;const S=O=>{if(O.target.files){const L=Array.from(O.target.files);if(w.length+L.length>5){Jt.error("Ch c ti ln ti a 5 nh minh chng");return}s(W=>[...W,...L])}},A=O=>{s(L=>L.filter((W,U)=>U!==O))},j=async O=>{if(O.preventDefault(),w.length===0){Jt.error("Vui lng ti ln t nht 1 nh bng chng (Giy php, bin hiu...)");return}u(!0);try{const{data:{user:L}}=await Wt.auth.getUser();if(!L){Jt.error("Vui lng ng nhp  gi yu cu!"),u(!1);return}const W=w.map(async Q=>{const J=Q.name.split(".").pop(),Y=`${L.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${J}`,{error:ie}=await Wt.storage.from("store-proofs").upload(Y,Q);if(ie)throw ie;const{data:{publicUrl:_e}}=Wt.storage.from("store-proofs").getPublicUrl(Y);return _e}),U=await Promise.all(W),{error:q}=await Wt.from("store_claims").insert({user_id:L.id,mapbox_id:String(r.mapboxId),mapbox_name:r.name,mapbox_address:r.address||"",lat:r.lat,lng:r.lng,phone:f.phone,email:f.email,role:f.role,message:f.message,proof_images:U,proof_image_url:U[0],status:"pending"});if(q)throw q;Jt.success(" gi yu cu xc minh!",{description:"Admin s xem xt thng tin v phn hi sm nht."}),e()}catch(L){console.error(L),Jt.error("Gi tht bi",{description:L.message})}finally{u(!1)}};return v.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:v.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]",children:[v.jsxs("div",{className:"px-6 py-4 border-b bg-gray-50 flex justify-between items-center shrink-0",children:[v.jsxs("div",{children:[v.jsx("h3",{className:"font-bold text-lg text-gray-800",children:"Xc nhn ch s hu"}),v.jsxs("p",{className:"text-xs text-gray-500",children:["Gi thng tin xc minh cho: ",v.jsx("span",{className:"font-semibold text-blue-600",children:r.name})]})]}),v.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-200 rounded-full transition-colors",children:v.jsx(xi,{size:20,className:"text-gray-500"})})]}),v.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-5",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Vai tr ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsxs("select",{className:"w-full mt-1 p-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none bg-white",value:f.role,onChange:O=>g({...f,role:O.target.value}),children:[v.jsx("option",{children:"Ch s hu"}),v.jsx("option",{children:"Qun l ca hng"}),v.jsx("option",{children:"Nhn vin i din"})]})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["S in thoi ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx("input",{type:"tel",required:!0,className:"w-full mt-1 p-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"0912xxxxxx",value:f.phone,onChange:O=>g({...f,phone:O.target.value})})]})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Email lin h cng vic ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx("input",{type:"email",required:!0,className:"w-full mt-1 p-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"contact@cuahang.com",value:f.email,onChange:O=>g({...f,email:O.target.value})}),v.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"*Mc nh l email ng nhp, bn c th thay i."})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["nh bng chng (Giy php KD, Menu, Mt tin...) ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[w.map((O,L)=>v.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 group",children:[v.jsx("img",{src:URL.createObjectURL(O),className:"w-full h-full object-cover",alt:"preview"}),v.jsx("button",{type:"button",onClick:()=>A(L),className:"absolute top-1 right-1 bg-red-500/90 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600",children:v.jsx(xi,{size:12})})]},L)),w.length<5&&v.jsxs("label",{className:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors aspect-square",children:[v.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:S,className:"hidden"}),v.jsx(M5,{size:20,className:"text-gray-400 mb-1"}),v.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Thm nh"})]})]}),v.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[" chn ",w.length,"/5 nh. Hy chp r nt."]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Li nhn / Ghi ch"}),v.jsx("textarea",{rows:3,className:"w-full mt-1 p-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"V d: Ti mi sang nhng li qun ny...",value:f.message,onChange:O=>g({...f,message:O.target.value})})]})]}),v.jsxs("div",{className:"p-4 border-t bg-gray-50 flex gap-3 shrink-0",children:[v.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2.5 bg-white border border-gray-300 hover:bg-gray-100 text-gray-700 font-medium rounded-xl text-sm transition-colors",children:"Hy b"}),v.jsx("button",{type:"submit",onClick:j,disabled:l,className:"flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl text-sm flex items-center justify-center gap-2 shadow-lg shadow-blue-600/20 transition-colors",children:l?v.jsx(ls,{className:"animate-spin",size:18}):"Gi xc minh"})]})]})})},WK=KN,ZK=OH,KK=XN,S3=I.forwardRef(({className:t,...e},r)=>v.jsx(U0,{className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e,ref:r}));S3.displayName=U0.displayName;const XK=Jy("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),E3=I.forwardRef(({side:t="right",className:e,children:r,...l},u)=>v.jsxs(KK,{children:[v.jsx(S3,{}),v.jsxs($0,{ref:u,className:cn(XK({side:t}),e),...l,children:[r,v.jsxs(YN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[v.jsx(xi,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));E3.displayName=$0.displayName;const C3=({className:t,...e})=>v.jsx("div",{className:cn("flex flex-col space-y-2 text-center sm:text-left",t),...e});C3.displayName="SheetHeader";const k3=I.forwardRef(({className:t,...e},r)=>v.jsx(G0,{ref:r,className:cn("text-lg font-semibold text-foreground",t),...e}));k3.displayName=G0.displayName;const YK=I.forwardRef(({className:t,...e},r)=>v.jsx(H0,{ref:r,className:cn("text-sm text-muted-foreground",t),...e}));YK.displayName=H0.displayName;const JK=({children:t})=>{const e=rp(),r=[{icon:v.jsx(HP,{className:"w-5 h-5 text-blue-500"}),label:"Bn ",desc:"Trang ch tm kim",path:"/"},{icon:v.jsx(lh,{className:"w-5 h-5 text-green-600"}),label:"Vic lm",desc:"Tm vic & Tuyn dng Free",path:"/jobs"},{icon:v.jsx(g1,{className:"w-5 h-5 text-gray-500"}),label:"Gii thiu",desc:"V ThodiaUni",path:"/about"}];return v.jsxs(WK,{children:[v.jsx(ZK,{asChild:!0,children:t}),v.jsxs(E3,{side:"left",className:"w-[300px] sm:w-[350px] p-0 flex flex-col h-full",children:[v.jsx(C3,{className:"p-6 bg-gradient-to-br from-green-50 to-white border-b",children:v.jsxs(k3,{className:"flex items-center gap-3",children:[v.jsx("img",{src:"/logo.png",className:"w-12 h-12 rounded-xl object-contain bg-white shadow-sm border"}),v.jsxs("div",{className:"text-left",children:[v.jsx("div",{className:"text-green-700 font-black text-xl tracking-tight",children:"ThodiaUni"}),v.jsx("div",{className:"text-xs text-gray-500 font-medium",children:"Menu chnh"})]})]})}),v.jsx("div",{className:"flex-1 overflow-y-auto py-4 px-3 space-y-1",children:r.map((l,u)=>v.jsxs(vn,{variant:"ghost",className:"w-full justify-between h-auto py-3 px-3 hover:bg-green-50 rounded-xl group",onClick:()=>e(l.path),children:[v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-white group-hover:shadow-sm transition-all",children:l.icon}),v.jsxs("div",{className:"text-left",children:[v.jsx("div",{className:"font-bold text-gray-800 text-sm",children:l.label}),v.jsx("div",{className:"text-[10px] text-gray-500 font-normal",children:l.desc})]})]}),v.jsx(UP,{className:"w-4 h-4 text-gray-300 group-hover:text-green-600"})]},u))}),v.jsxs("div",{className:"p-4 bg-gray-50 mt-auto border-t",children:[v.jsxs("div",{className:"bg-white p-4 rounded-xl border border-blue-100 shadow-sm",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v.jsx(Yc,{className:"w-4 h-4 text-blue-600"}),v.jsx("h4",{className:"text-blue-700 font-bold text-sm",children:"Dnh cho Ch Shop"})]}),v.jsxs("p",{className:"text-xs text-gray-600 mb-3 leading-relaxed",children:["ng tin tuyn dng nhn vin hon ton ",v.jsx("strong",{children:"Min ph"})," ngay trn ThodiaUni."]}),v.jsx(vn,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-xs h-8",onClick:()=>e("/jobs"),children:"ng tin ngay"})]}),v.jsx("div",{className:"text-center mt-4 text-[10px] text-gray-400",children:"Ver 1.0.2  Made with "})]})]})]})},QK=(t,e,r,l)=>{const f=(r-t)*Math.PI/180,g=(l-e)*Math.PI/180,w=Math.sin(f/2)*Math.sin(f/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);return 6371e3*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))},eX=(t,e)=>{let r=1/0,l=0;for(let u=0;u<e.length;u++){const f=e[u],g=QK(t[1],t[0],f[1],f[0]);g<r&&(r=g,l=u)}return{distance:r,segmentIndex:l}},tX=({steps:t,routeGeometry:e,isNavigating:r,userLocation:l,onOffRoute:u})=>{const[f,g]=I.useState({currentStepIndex:0,distanceToNextStep:0,isOffRoute:!1,isTracking:!1}),w=50,s=I.useCallback((S,A)=>{const{distance:j,segmentIndex:O}=eX(S,A),L=j>w;let W=0,U=0;for(let Q=0;Q<t.length;Q++){W+=t[Q].distance;const J=O/A.length,Y=W/t.reduce((ie,_e)=>ie+_e.distance,0);if(J<=Y){U=Q;break}U=Q}let q=0;if(U<t.length){let Q=0;for(let Se=0;Se<U;Se++)Q+=t[Se].distance;const J=t[U]?.distance||0,Y=O/A.length,ie=t.reduce((Se,Ie)=>Se+Ie.distance,0),_e=Y*ie;q=Math.max(0,Q+J-_e)}return{currentStepIndex:U,distanceToNextStep:q,isOffRoute:L}},[t,w]);return I.useEffect(()=>{if(!r||!l||!e){g(j=>({...j,isTracking:!1}));return}const S=[l.lng,l.lat],A=s(S,e.coordinates);g(j=>{const O={...j,isTracking:!0,...A};return A.isOffRoute&&!j.isOffRoute&&u&&u(),O})},[r,l?.lat,l?.lng,e,t,u]),f},uP=()=>{const{t,language:e}=da(),{id:r}=HF(),l=rp(),[u,f]=I.useState(null),g=I.useRef(null),[w,s]=I.useState(null),[S,A]=I.useState(null),[j,O]=I.useState(null),[L,W]=I.useState(null),[U,q]=I.useState(["building","food","housing","job","lecture_hall","office","cafe","entertainment","checkin"]),[Q,J]=I.useState(!1),[Y,ie]=I.useState(!1),[_e,Se]=I.useState(!1),[Ie,Ue]=I.useState(!1),[Je,Me]=I.useState(null),[lt,ft]=I.useState(null),[mt,gt]=I.useState(""),[Lt,it]=I.useState(!1),[We,Le]=I.useState(!1),[we,st]=I.useState(!1),[ke,Ve]=I.useState(!1),[bt,wt]=I.useState(!1),[Yt,Mt]=I.useState(null),{favorites:ct}=SN(),{route:Nt,isLoading:xn,getDirections:un,clearDirections:Rn,transportMode:sn,setTransportMode:kr,routePreference:vr,setRoutePreference:Es,origin:Jn,destination:Ar}=RW(),{route:io,waypoints:wi,isLoading:Xr,transportMode:ii,addWaypoint:cs,removeWaypoint:Ki,reorderWaypoints:zs,getMultiStopDirections:Cs,clearRoute:Gr,setTransportMode:us}=DW();I.useEffect(()=>{if(!r){A(null),document.title="ThodiaUni - Bn  i hc";return}const de=CT.find(Te=>String(Te.id)===r);if(de){A(de),W(de),document.title=`${e==="en"?de.name:de.nameVi} | ThodiaUni`;return}if(S&&String(S.id)===r){const Te=e==="en"&&S.name?S.name:S.nameVi;document.title=`${Te} | ThodiaUni`}},[r,e]),I.useEffect(()=>{if(!navigator.geolocation)return;const de=navigator.geolocation.watchPosition(Te=>{const xe={lat:Te.coords.latitude,lng:Te.coords.longitude};f(xe),g.current=xe},Te=>console.warn("Li GPS:",Te),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>navigator.geolocation.clearWatch(de)},[]);const bi=I.useCallback(de=>{s(de)},[]),Bs=I.useCallback(()=>{s(null)},[]),Xi=I.useCallback(()=>{Ue(!0),J(!0),Jt.info(e==="vi"?"Hy chn im n tip theo":"Select the next stop")},[e]),Mi=I.useCallback((de,Te)=>{if(Ie||_e){const xe={coordinates:[de.lng,de.lat],name:e==="en"&&de.name?de.name:de.nameVi,location:de};let ze=[...wi];if(ze.length===0&&lt){const Oe={coordinates:lt,name:mt||"im dng 1"};ze.push(Oe),cs(Oe)}if(ze.push(xe),cs(xe),Ue(!1),J(!1),Y&&(ie(!1),Rn()),Se(!0),g.current){const Be={coordinates:[g.current.lng,g.current.lat],name:e==="vi"?"V tr ca bn":"Your location"};Cs(Be,ze,ii)}return}A(de),W(de),Te&&O(Te),l(`/place/${de.id}`)},[Ie,_e,Y,cs,wi,e,Cs,ii,lt,mt,Rn,l]),ko=I.useCallback(de=>{Mt({mapboxId:String(de.id),name:de.nameVi||de.name||"a im",address:de.address,lat:de.lat,lng:de.lng}),wt(!0)},[]),so=I.useCallback(()=>{l("/"),O(null)},[l]),Ii=I.useCallback((de,Te="walking")=>{l("/"),O(null),Se(!1),Gr();const xe=[de.lng,de.lat];if(ft(xe),g.current){const ze=[g.current.lng,g.current.lat];Me(ze),un(ze,xe,Te),ie(!0)}else Jt.info(e==="vi"?"ang ly v tr...":"Locating..."),navigator.geolocation.getCurrentPosition(ze=>{const Be=[ze.coords.longitude,ze.coords.latitude];Me(Be),un(Be,xe,Te),ie(!0)})},[un,e,Gr,l]),ds=I.useCallback(de=>{const Te=e==="en"&&de.name?de.name:de.nameVi;gt(Te),Ii(de)},[Ii,e]),si=I.useCallback(()=>{Rn(),Me(null),ft(null),ie(!1),Se(!1),Gr()},[Rn,Gr]),Fs=I.useCallback(de=>{q(Te=>Te.includes(de)?Te.filter(xe=>xe!==de):[...Te,de])},[]),{currentStepIndex:oo,distanceToNextStep:Ao,isTracking:be}=tX({steps:Nt?.steps||[],routeGeometry:Nt?.geometry||null,isNavigating:Y,userLocation:u,onOffRoute:()=>{if(g.current&&Ar){Jt.warning(t("offRouteWarning"));const de=[g.current.lng,g.current.lat];Me(de),un(de,Ar,sn,vr)}}}),re=I.useCallback(()=>{Ue(!0),Jt.info(e==="vi"?"Chn im dng tip theo trn bn ":"Select next stop on the map")},[e]),se=I.useCallback(de=>{Ve(!0)},[]);return v.jsxs("div",{className:"relative h-screen w-full overflow-hidden bg-background",children:[v.jsx("div",{className:"absolute inset-0",children:v.jsx(AG,{selectedLocation:S,onSelectLocation:Mi,activeCategories:U,flyToLocation:L,routeInfo:Nt,routeOrigin:Je,routeDestination:lt,onClearRoute:si,multiStopRoute:io,isMultiStopMode:_e})}),v.jsx("div",{className:"absolute inset-x-0 top-0 h-40 bg-gradient-to-b from-background/80 via-background/40 to-transparent pointer-events-none"}),v.jsx("div",{className:"absolute top-0 left-0 right-0 safe-top z-[50]",children:v.jsxs("div",{className:"px-3 pt-3",children:[v.jsxs(_r.div,{className:"flex items-center gap-2 mb-2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.1},children:[v.jsx(JK,{children:v.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer mr-2 group",children:[v.jsx("div",{className:"w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center overflow-hidden border-2 border-green-700 group-hover:scale-105 transition-transform z-10",children:v.jsx("img",{src:"/logo.png",alt:"ThodiaUni Logo",className:"w-full h-full object-cover"})}),v.jsx("span",{className:"text-[9px] font-black text-white bg-green-700 px-2 py-[1px] rounded-sm -mt-2 z-20 shadow-sm tracking-wider border border-white uppercase",children:"Menu"})]})}),v.jsx("div",{className:"flex-1 min-w-0",children:v.jsx(PG,{onLocationSelect:Mi,userLocation:u,onFocus:()=>J(!0),onBlur:()=>J(!1)})}),v.jsxs("button",{onClick:()=>Le(!0),className:"relative w-9 h-9 rounded-xl bg-muted flex items-center justify-center hover:bg-muted/80 transition-colors shadow-sm",children:[v.jsx(ih,{className:"w-5 h-5 text-muted-foreground"}),ct.length>0&&v.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:ct.length>9?"9+":ct.length})]}),v.jsx(GK,{onLoginClick:()=>it(!0),onFavoritesClick:()=>Le(!0),onStoresClick:()=>st(!0)}),v.jsx(HK,{compact:!0})]}),v.jsx(Da,{children:!Q&&!Y&&!_e&&v.jsx(_r.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.2},className:"ml-2",children:v.jsx(MG,{activeCategories:U,onToggleCategory:Fs})})})]})}),v.jsx(Da,{children:_e&&v.jsx(LW,{routeInfo:io,waypoints:wi,isLoading:Xr,transportMode:ii,onClose:si,onChangeTransportMode:de=>{if(us(de),g.current){const Te={coordinates:[g.current.lng,g.current.lat],name:"Your location"};Cs(Te,wi,de)}},onRemoveWaypoint:de=>{Ki(de);const Te=wi.filter((xe,ze)=>ze!==de);if(Te.length===0)si();else if(g.current){const xe={coordinates:[g.current.lng,g.current.lat],name:"Your location"};Cs(xe,Te,ii)}},onReorderWaypoints:zs,onAddStop:re,isAddingStop:Ie})}),v.jsx(Da,{children:Y&&Nt&&!_e&&v.jsx(jW,{routeInfo:Nt,destinationName:mt,isLoading:xn,transportMode:sn,routePreference:vr,currentStepIndex:oo,distanceToNextStep:Ao,isTracking:be,userAccuracy:null,onClose:si,onChangeTransportMode:de=>{kr(de),Jn&&Ar&&un(Jn,Ar,de,vr)},onChangeRoutePreference:de=>{Es(de),Jn&&Ar&&un(Jn,Ar,sn,de)},onAddStop:Xi})}),v.jsx(Da,{children:S&&!_e&&v.jsx(IW,{location:S,department:j,onClose:so,onNavigate:ds,onOpenDetail:bi,onLoginClick:()=>it(!0),onPromoteClick:se,onClaim:ko})}),v.jsx(Da,{children:w&&v.jsx(_D,{location:w,isOpen:!!w,onClose:Bs,onNavigate:()=>ds(w)})}),v.jsx(qK,{isOpen:bt,onClose:()=>wt(!1),data:Yt}),v.jsx(dZ,{isOpen:Lt,onClose:()=>it(!1)}),v.jsx(hZ,{isOpen:We,onClose:()=>Le(!1),onSelectLocation:Mi,onNavigate:ds,onLoginClick:()=>{Le(!1),it(!0)}}),v.jsx(bZ,{isOpen:we,onClose:()=>st(!1),onLoginClick:()=>{st(!1),it(!0)}}),!Y&&v.jsx(yG,{onSelectLocation:Mi,userLocation:u})]})},nX=()=>{const{session:t}=ha(),e=t?.user,[r,l]=I.useState([]),[u,f]=I.useState(!0),[g,w]=I.useState(!1),[s,S]=I.useState("pending"),A=I.useCallback(async()=>{if(!e)return w(!1),!1;try{const{data:W,error:U}=await Wt.from("user_roles").select("role").eq("user_id",e.id).maybeSingle();if(U)throw U;const q=W?.role==="admin";return w(q),q}catch(W){return console.error("Li kim tra admin:",W),w(!1),!1}},[e]),j=I.useCallback(async()=>{if(!e){l([]),f(!1);return}try{let W=Wt.from("user_stores").select("*").order("created_at",{ascending:!1});s!=="all"&&(W=W.eq("status",s));const{data:U,error:q}=await W;if(q)throw q;const Q=[];if(U)for(const J of U){const{data:Y}=await Wt.from("profiles").select("email").eq("id",J.user_id).single();Q.push({...J,user_email:Y?.email||"N/A"})}l(Q)}catch(W){console.error("Li ti danh sch ca hng:",W),Jt.error("Khng th ti danh sch ca hng")}finally{f(!1)}},[e,s]);return I.useEffect(()=>{(async()=>await A()?await j():f(!1))()},[A,j]),{stores:r,isLoading:u,isAdmin:g,filter:s,setFilter:S,fetchStores:j,updateStoreStatus:async(W,U)=>{try{console.log(`ang gi RPC  update store ${W} sang ${U}...`);const{error:q}=await Wt.rpc("approve_store_by_id",{store_id_input:W,new_status:U});if(q)throw console.error("RPC Error:",q),q;l(Q=>Q.map(J=>J.id===W?{...J,status:U}:J)),s==="pending"&&l(Q=>Q.filter(J=>J.id!==W)),Jt.success(U==="approved"?" duyt xong!":" t chi!")}catch(q){console.error("Li Update:",q),Jt.error(`Li: ${q.message||"Khng th kt ni"}`)}},deleteStore:async W=>{try{const{error:U}=await Wt.from("user_stores").delete().eq("id",W);if(U)throw U;return l(q=>q.filter(Q=>Q.id!==W)),Jt.success(" xa ca hng!"),!0}catch(U){return console.error("Error deleting store:",U),Jt.error("Khng th xa ca hng"),!1}}}},rX=Jy("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ep({className:t,variant:e,...r}){return v.jsx("div",{className:cn(rX({variant:e}),t),...r})}const bm=I.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));bm.displayName="Card";const fy=I.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,className:cn("flex flex-col space-y-1.5 p-6",t),...e}));fy.displayName="CardHeader";const py=I.forwardRef(({className:t,...e},r)=>v.jsx("h3",{ref:r,className:cn("text-2xl font-semibold leading-none tracking-tight",t),...e}));py.displayName="CardTitle";const my=I.forwardRef(({className:t,...e},r)=>v.jsx("p",{ref:r,className:cn("text-sm text-muted-foreground",t),...e}));my.displayName="CardDescription";const Tm=I.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,className:cn("p-6 pt-0",t),...e}));Tm.displayName="CardContent";const iX=I.forwardRef(({className:t,...e},r)=>v.jsx("div",{ref:r,className:cn("flex items-center p-6 pt-0",t),...e}));iX.displayName="CardFooter";const sX=({isOpen:t,onClose:e,store:r})=>{const[l,u]=I.useState([]),[f,g]=I.useState([]),[w,s]=I.useState(!1),S=A=>A?new Date(A).toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}):"Khng r";return I.useEffect(()=>{r&&t&&(async()=>{s(!0);const{data:j}=await Wt.from("store_menu_items").select("*").eq("store_id",r.id),{data:O}=await Wt.from("store_vouchers").select("*").eq("store_id",r.id);u(j||[]),g(O||[]),s(!1)})()},[r,t]),r?v.jsx(q0,{open:t,onOpenChange:e,children:v.jsxs(a_,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[v.jsx(W0,{children:v.jsxs(l_,{className:"text-xl font-bold flex items-center gap-2",children:[r.name_vi,v.jsx(ep,{variant:r.status==="approved"?"default":r.status==="rejected"?"destructive":"secondary",children:r.status==="approved"?" duyt":r.status==="rejected"?"B t chi":"Ch duyt"})]})}),v.jsxs(Gy,{defaultValue:"info",className:"w-full",children:[v.jsxs(Fm,{className:"grid w-full grid-cols-3",children:[" ",v.jsxs(as,{value:"info",children:[v.jsx(g1,{className:"w-4 h-4 mr-2"})," Thng tin"]}),v.jsxs(as,{value:"menu",children:[v.jsx(KP,{className:"w-4 h-4 mr-2"})," Menu (",l.length,")"]}),v.jsxs(as,{value:"voucher",children:[v.jsx(fh,{className:"w-4 h-4 mr-2"})," Voucher (",f.length,")"]})]}),v.jsx(Co,{value:"info",className:"space-y-4 py-4",children:v.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[v.jsx("div",{children:v.jsx("img",{src:r.image_url||"https://placehold.co/600x400?text=Store",alt:"Store",className:"w-full h-64 object-cover rounded-xl shadow-sm border",onError:A=>{A.currentTarget.src="https://placehold.co/600x400?text=No+Image"}})}),v.jsxs("div",{className:"space-y-4 text-sm",children:[v.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 text-blue-700 rounded-lg border border-blue-100",children:[v.jsx(o5,{className:"w-5 h-5"}),v.jsxs("div",{children:[v.jsx("span",{className:"font-bold block text-xs uppercase opacity-70",children:"Ngy to ca hng"}),v.jsx("span",{className:"font-bold text-base",children:S(r.created_at)})]})]}),v.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded border border-gray-100",children:[v.jsx(Qy,{className:"w-4 h-4 text-gray-500"}),v.jsx("span",{className:"font-medium text-gray-500",children:"ST:"})," ",r.phone||"Cha cp nht"]}),v.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded border border-gray-100",children:[v.jsx(y1,{className:"w-4 h-4 text-gray-500"}),v.jsx("span",{className:"font-medium text-gray-500",children:"Email ch:"})," ",r.user_email]}),v.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded border border-gray-100",children:[v.jsx(f0,{className:"w-4 h-4 text-gray-500"}),v.jsx("span",{className:"font-medium text-gray-500",children:"Gi m ca:"})," ",r.open_hours_vi||"N/A"]}),v.jsxs("div",{className:"border p-4 rounded-lg bg-gray-50",children:[v.jsx("p",{className:"font-bold mb-2 text-gray-700",children:"M t:"}),v.jsx("p",{className:"text-gray-600 leading-relaxed",children:r.description_vi||"Khng c m t"})]})]})]})}),v.jsx(Co,{value:"menu",className:"py-4",children:w?v.jsx("div",{className:"text-center py-4",children:"ang ti menu..."}):v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[l.length===0&&v.jsx("p",{className:"text-gray-500 italic col-span-full text-center py-8",children:"Ca hng cha ng mn n no."}),l.map(A=>v.jsxs("div",{className:"flex gap-3 p-3 border rounded-lg bg-white hover:shadow-sm transition-all",children:[v.jsx("img",{src:A.image_url||"https://placehold.co/100x100?text=Food",className:"w-16 h-16 rounded object-cover bg-gray-100",onError:j=>{j.currentTarget.src="https://placehold.co/100x100?text=Food"}}),v.jsxs("div",{children:[v.jsx("p",{className:"font-bold text-gray-800",children:A.name_vi}),v.jsxs("p",{className:"text-primary font-bold",children:[new Intl.NumberFormat("vi-VN").format(A.price),""]}),v.jsx("p",{className:"text-xs text-gray-500 line-clamp-1",children:A.description_vi})]})]},A.id))]})}),v.jsx(Co,{value:"voucher",className:"py-4",children:w?v.jsx("div",{className:"text-center py-4",children:"ang ti voucher..."}):v.jsxs("div",{className:"space-y-3",children:[f.length===0&&v.jsx("p",{className:"text-gray-500 italic text-center py-8",children:"Cha c m gim gi no."}),f.map(A=>v.jsxs("div",{className:"flex justify-between items-center p-4 border border-dashed border-primary/40 bg-primary/5 rounded-xl",children:[v.jsxs("div",{className:"flex gap-3 items-center",children:[v.jsx(fh,{className:"w-8 h-8 text-primary opacity-50"}),v.jsxs("div",{children:[v.jsx("p",{className:"font-bold text-lg text-primary",children:A.code}),v.jsx("p",{className:"font-medium text-sm",children:A.title_vi}),v.jsxs("p",{className:"text-xs text-gray-500",children:["Gim: ",A.discount_value,A.discount_type==="percent"?"%":""]})]})]}),v.jsx(ep,{variant:A.is_active?"default":"destructive",children:A.is_active?"ang chy":" dng"})]},A.id))]})})]})]})}):null},oX=()=>{const[t,e]=I.useState([]),[r,l]=I.useState(!0),[u,f]=I.useState(null),g=async()=>{l(!0);const{data:S,error:A}=await Wt.from("store_claims").select("*, profiles:user_id(email)").eq("status","pending").order("created_at",{ascending:!1});if(A){Jt.error("Li ti yu cu: "+A.message),l(!1);return}const j=await Promise.all(S.map(async O=>{const{data:L}=await Wt.from("user_stores").select("id, name_vi, user_id, is_verified, profiles:user_id(email)").eq("mapbox_id",O.mapbox_id).maybeSingle();return{...O,existingStore:L?{id:L.id,name_vi:L.name_vi,owner_email:L.profiles?.email||"Khng r Email",is_verified:L.is_verified}:null}}));e(j),l(!1)};I.useEffect(()=>{g()},[]);const w=async S=>{let A=`Xc nhn duyt quyn s hu cho "${S.mapbox_name}"?`;if(S.existingStore&&(A=` CNH BO QUAN TRNG!

a im ny ang thuc s hu ca: ${S.existingStore.owner_email}

Bn c chc chn mun CHUYN QUYN S HU sang cho: ${S.profiles?.email}?`),!!confirm(A))try{if(Jt.loading("ang x l..."),S.existingStore){const{error:j}=await Wt.from("user_stores").update({user_id:S.user_id,name_vi:S.mapbox_name,is_verified:!0,status:"approved"}).eq("id",S.existingStore.id);if(j)throw j;Jt.info(" chuyn quyn s hu t ch c sang ch mi.")}else{const{error:j}=await Wt.from("user_stores").insert({user_id:S.user_id,mapbox_id:S.mapbox_id,name_vi:S.mapbox_name,address_vi:S.mapbox_address,lat:S.lat,lng:S.lng,category:"checkin",is_verified:!0,status:"approved",description_vi:` xc minh: ${S.role}. LH: ${S.phone}`,image_url:S.proof_image_url});if(j)throw j}await Wt.from("store_claims").update({status:"approved"}).eq("id",S.id),S.mapbox_id&&await Wt.from("store_claims").update({status:"rejected"}).eq("mapbox_id",S.mapbox_id).eq("status","pending").neq("id",S.id),Jt.dismiss(),Jt.success("Duyt thnh cng!"),g()}catch(j){Jt.dismiss(),Jt.error("Li: "+j.message)}},s=async S=>{confirm("T chi yu cu ny?")&&(await Wt.from("store_claims").update({status:"rejected"}).eq("id",S),Jt.success(" t chi."),g())};return r?v.jsx("div",{className:"p-12 flex justify-center",children:v.jsx(ls,{className:"animate-spin text-blue-600 w-8 h-8"})}):v.jsxs("div",{className:"space-y-8",children:[v.jsx("div",{className:"flex items-center justify-between",children:v.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[v.jsx(s5,{className:"text-blue-600"}),"Duyt xc minh ch s hu (",t.length,")"]})}),t.length===0?v.jsx("div",{className:"p-12 text-center bg-gray-50 rounded-xl border border-dashed text-gray-400",children:"Hin khng c yu cu no ang ch x l."}):v.jsx("div",{className:"grid gap-8",children:t.map(S=>v.jsxs("div",{className:"bg-white border rounded-xl shadow-sm overflow-hidden",children:[v.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-b flex justify-between items-start",children:[v.jsxs("div",{children:[v.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[v.jsx(Wi,{className:"text-blue-600 w-5 h-5"})," ",S.mapbox_name]}),v.jsx("p",{className:"text-sm text-gray-500 ml-7",children:S.mapbox_address})]}),v.jsx(ep,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100 border-yellow-200",children:"Pending"})]}),v.jsxs("div",{className:"p-6",children:[v.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[v.jsxs("div",{className:`flex-1 p-4 rounded-lg border-2 ${S.existingStore?"bg-orange-50 border-orange-200":"bg-gray-50 border-dashed border-gray-200"}`,children:[v.jsx("p",{className:"text-xs font-bold uppercase tracking-wider mb-3 text-gray-500",children:S.existingStore?" CH S HU HIN TI":"TNH TRNG: CHA C CH"}),S.existingStore?v.jsxs("div",{className:"space-y-2",children:[v.jsxs("div",{className:"flex items-center gap-2 text-gray-800 font-bold",children:[v.jsx(ky,{size:16})," ",S.existingStore.owner_email]}),v.jsxs("div",{className:"text-sm text-gray-600 pl-6",children:["Tn qun: ",S.existingStore.name_vi]}),S.existingStore.is_verified&&v.jsx(ep,{className:"bg-green-100 text-green-700 border-green-200 ml-6",children:" xc minh"})]}):v.jsxs("div",{className:"flex items-center gap-2 text-gray-400 py-2",children:[v.jsx(Yc,{size:20})," y l a im mi"]})]}),v.jsx("div",{className:"flex items-center justify-center",children:v.jsx("div",{className:"bg-blue-50 p-2 rounded-full text-blue-400",children:v.jsx(u1,{size:24})})}),v.jsxs("div",{className:"flex-1 p-4 rounded-lg border-2 border-blue-200 bg-blue-50/30",children:[v.jsx("p",{className:"text-xs font-bold uppercase tracking-wider mb-3 text-blue-600",children:"NGI YU CU (CH MI)"}),v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex items-center gap-2 font-bold text-gray-900",children:[v.jsx(ky,{size:16,className:"text-blue-500"})," ",S.profiles?.email||"Unknown User",v.jsx("span",{className:"text-gray-400 font-normal text-xs",children:"(Login Account)"})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 pl-6 mt-2",children:[v.jsxs("div",{className:"text-gray-600",children:[v.jsx("span",{className:"font-semibold",children:"Vai tr:"})," ",S.role]}),v.jsxs("div",{className:"text-gray-600",children:[v.jsx("span",{className:"font-semibold",children:"ST:"})," ",S.phone||"---"]}),v.jsxs("div",{className:"text-gray-600 col-span-2",children:[v.jsx("span",{className:"font-semibold",children:"Email LH:"})," ",S.email||"---"]})]}),v.jsxs("div",{className:"mt-3 bg-white p-2.5 rounded border border-blue-100 text-gray-600 italic text-xs",children:['"Li nhn: ',S.message||"Khng c",'"']})]})]})]}),v.jsxs("div",{className:"border-t pt-4",children:[v.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:["NH BNG CHNG (",S.proof_images?.length||(S.proof_image_url?1:0),")"]}),v.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-2",children:[S.proof_images&&S.proof_images.length>0?S.proof_images.map((A,j)=>v.jsxs("div",{className:"w-24 h-24 flex-shrink-0 border rounded-lg overflow-hidden cursor-pointer hover:ring-2 ring-blue-500 relative bg-gray-100 group",onClick:()=>f(A),children:[v.jsx("img",{src:A,className:"w-full h-full object-cover",loading:"lazy",onError:O=>O.currentTarget.style.display="none"}),v.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-300",children:v.jsx(b5,{size:20})}),v.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:v.jsx(T5,{className:"text-white opacity-0 group-hover:opacity-100 w-5 h-5 drop-shadow-md"})})]},j)):S.proof_image_url&&v.jsx("div",{className:"w-24 h-24 flex-shrink-0 border rounded-lg overflow-hidden cursor-pointer bg-gray-100",onClick:()=>f(S.proof_image_url),children:v.jsx("img",{src:S.proof_image_url,className:"w-full h-full object-cover"})}),!S.proof_images?.length&&!S.proof_image_url&&v.jsx("span",{className:"text-sm text-red-400 italic bg-red-50 px-3 py-1 rounded",children:"Ngi dng khng ti ln nh no."})]})]})]}),v.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t flex justify-end gap-3",children:[v.jsxs(vn,{variant:"outline",onClick:()=>s(S.id),className:"text-red-600 border-red-200 hover:bg-red-50",children:[v.jsx(xi,{className:"w-4 h-4 mr-2"})," T chi"]}),v.jsxs(vn,{onClick:()=>w(S),className:"bg-green-600 hover:bg-green-700 text-white shadow-sm min-w-[140px]",children:[v.jsx(tp,{className:"w-4 h-4 mr-2"}),S.existingStore?"Chuyn quyn s hu":"Duyt & To mi"]})]})]},S.id))}),u&&v.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/95 flex items-center justify-center p-4 animate-in fade-in duration-200",onClick:()=>f(null),children:v.jsxs("div",{className:"relative max-w-5xl w-full max-h-screen flex items-center justify-center p-2",children:[v.jsx("img",{src:u,alt:"Full Proof",className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl border border-gray-700"}),v.jsx("button",{onClick:()=>f(null),className:"absolute top-4 right-4 bg-white/20 hover:bg-white/40 text-white p-2 rounded-full backdrop-blur-sm transition-all",children:v.jsx(xi,{size:32})})]})})]})},aX=()=>{const[t,e]=I.useState([]),[r,l]=I.useState(!0),u=async()=>{l(!0);const{data:g,error:w}=await Wt.from("user_stores").select("id, name_vi, image_url, ad_expiry, is_ad, user_id").eq("is_ad",!0).order("ad_expiry",{ascending:!0});if(w){console.error("Ads Load Error:",w),Jt.error("Li ti qung co: "+w.message),l(!1);return}let s=[];if(g&&g.length>0){const S=Array.from(new Set(g.map(O=>O.user_id).filter(Boolean))),{data:A}=await Wt.from("profiles").select("id, email").in("id",S),j={};A?.forEach(O=>{j[O.id]=O.email}),s=g.map(O=>({...O,user_email:j[O.user_id]||"Khng tm thy Email"}))}e(s),l(!1)};I.useEffect(()=>{u()},[]);const f=async g=>{if(!confirm("Bn mun hy qung co ca ca hng ny ngay lp tc?"))return;const{error:w}=await Wt.from("user_stores").update({is_ad:!1,ad_expiry:null}).eq("id",g);w?Jt.error("Li: "+w.message):(Jt.success(" hy qung co"),e(s=>s.filter(S=>S.id!==g)))};return v.jsxs("div",{className:"space-y-4",children:[r?v.jsx("div",{className:"flex justify-center p-8",children:v.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-blue-600 rounded-full border-t-transparent"})}):t.length===0?v.jsx("div",{className:"text-gray-500 text-center py-12 bg-gray-50 rounded-xl border border-dashed",children:"Hin khng c ca hng no chy qung co."}):null,v.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t.map(g=>{const w=new Date(g.ad_expiry),s=new Date,S=Math.ceil((w.getTime()-s.getTime())/(1e3*60*60*24)),A=S<0;return v.jsxs("div",{className:"bg-white border rounded-xl overflow-hidden shadow-sm flex flex-col hover:shadow-md transition-shadow",children:[v.jsxs("div",{className:"h-32 bg-gray-100 relative group",children:[v.jsx("img",{src:g.image_url,className:"w-full h-full object-cover",onError:j=>j.currentTarget.src="https://placehold.co/400x200"}),v.jsxs("div",{className:"absolute top-2 right-2 bg-gradient-to-r from-pink-500 to-red-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md flex items-center gap-1",children:[v.jsx(Iv,{size:12})," ang chy"]})]}),v.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[v.jsx("h4",{className:"font-bold text-gray-800 text-lg mb-1 line-clamp-1",children:g.name_vi}),v.jsxs("p",{className:"text-xs text-gray-500 mb-4 truncate flex items-center gap-1",children:[v.jsx(ZP,{size:12})," ",g.user_email]}),v.jsxs("div",{className:"mt-auto space-y-3",children:[v.jsxs("div",{className:"flex items-center justify-between text-sm bg-blue-50 p-2 rounded text-blue-800 border border-blue-100",children:[v.jsxs("span",{className:"flex items-center gap-1 text-xs",children:[v.jsx(a5,{className:"w-3 h-3"})," Ht hn:"]}),v.jsx("span",{className:"font-bold",children:w.toLocaleDateString("vi-VN")})]}),v.jsx("div",{className:`text-center text-xs font-bold ${A?"text-red-500":"text-green-600"}`,children:A?" ht hn":`Cn li ${S} ngy`}),v.jsxs(vn,{variant:"outline",className:"w-full text-red-600 border-red-200 hover:bg-red-50 h-8 text-xs",onClick:()=>f(g.id),children:[v.jsx(xi,{className:"w-3 h-3 mr-2"})," Dng Qung Co"]})]})]})]},g.id)})})]})},lX=()=>{const[t,e]=I.useState([]),[r,l]=I.useState(!0),u=async()=>{l(!0);const{data:w}=await Wt.from("jobs").select("*").order("created_at",{ascending:!1});e(w||[]),l(!1)};I.useEffect(()=>{u()},[]);const f=async w=>{if(!confirm("Xa tin tuyn dng ny?"))return;const{error:s}=await Wt.from("jobs").delete().eq("id",w);s?Jt.error("Li xa: "+s.message):(Jt.success(" xa tin"),e(S=>S.filter(A=>A.id!==w)))},g=async(w,s)=>{const{error:S}=await Wt.from("jobs").update({status:s}).eq("id",w);S?Jt.error("Li cp nht: "+S.message):(Jt.success(` cp nht: ${s}`),e(A=>A.map(j=>j.id===w?{...j,status:s}:j)))};return v.jsxs("div",{className:"space-y-4",children:[t.length===0&&v.jsx("p",{className:"text-gray-500 text-center py-8",children:"Cha c tin tuyn dng no."}),t.map(w=>v.jsxs("div",{className:"bg-white p-4 rounded-lg border flex flex-col md:flex-row justify-between gap-4 shadow-sm hover:shadow-md transition-shadow",children:[v.jsxs("div",{className:"flex-1",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[v.jsx("h4",{className:"font-bold text-gray-800 text-lg",children:w.title}),v.jsx(ep,{className:w.status==="approved"?"bg-green-100 text-green-700":w.status==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700",children:w.status==="approved"?" duyt":w.status==="rejected"?"T chi":"Ch duyt"})]}),v.jsxs("p",{className:"text-sm font-semibold text-gray-700",children:[w.shop_name," ",v.jsx("span",{className:"text-gray-400",children:"|"})," ",w.salary]}),v.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:w.description}),v.jsxs("p",{className:"text-[10px] text-gray-400 mt-2",children:["Ngy ng: ",new Date(w.created_at).toLocaleDateString("vi-VN")]})]}),v.jsxs("div",{className:"flex items-center gap-2 border-t md:border-t-0 md:border-l pt-3 md:pt-0 md:pl-4",children:[w.status==="pending"&&v.jsxs(v.Fragment,{children:[v.jsxs(vn,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>g(w.id,"approved"),children:[v.jsx(tp,{className:"w-4 h-4 mr-1"})," Duyt"]}),v.jsxs(vn,{size:"sm",variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50",onClick:()=>g(w.id,"rejected"),children:[v.jsx(xi,{className:"w-4 h-4 mr-1"})," B"]})]}),v.jsx(vn,{size:"icon",variant:"ghost",className:"text-red-500 hover:bg-red-50",onClick:()=>f(w.id),children:v.jsx(ch,{className:"w-4 h-4"})})]})]},w.id))]})},cX=()=>{const[t,e]=I.useState([]),[r,l]=I.useState(!0);I.useEffect(()=>{(async()=>{l(!0);const{data:g,error:w}=await Wt.from("profiles").select("*").order("created_at",{ascending:!1});if(w){console.error("Profile Error:",w),l(!1);return}const{data:s}=await Wt.from("user_stores").select("user_id").eq("is_premium",!0),S=new Set(s?.map(j=>j.user_id)),A=g?.map(j=>({...j,isVip:S.has(j.id)}))||[];e(A),l(!1)})()},[]);const u=async f=>{if(!confirm("Cnh bo: Xa user s mt ht d liu lin quan!"))return;const{error:g}=await Wt.from("profiles").delete().eq("id",f);g?Jt.error("Li: "+g.message):(Jt.success(" xa h s"),e(w=>w.filter(s=>s.id!==f)))};return r?v.jsx("div",{className:"p-8 text-center text-gray-500",children:"ang ti danh sch ngi dng..."}):v.jsx("div",{className:"bg-white rounded-lg border overflow-hidden shadow-sm",children:v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"w-full text-sm text-left",children:[v.jsx("thead",{className:"bg-gray-50 border-b",children:v.jsxs("tr",{children:[v.jsx("th",{className:"p-4 text-gray-600 font-bold",children:"User / Email"}),v.jsx("th",{className:"p-4 text-gray-600 font-bold",children:"Trng thi"}),v.jsx("th",{className:"p-4 text-gray-600 font-bold",children:"Ngy tham gia"}),v.jsx("th",{className:"p-4 text-right text-gray-600 font-bold",children:"Hnh ng"})]})}),v.jsx("tbody",{className:"divide-y",children:t.map(f=>v.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[v.jsxs("td",{className:"p-4",children:[v.jsxs("div",{className:"font-bold text-gray-900 flex items-center gap-2",children:[f.email,f.isVip&&v.jsxs("span",{className:"bg-yellow-100 text-yellow-700 text-[10px] px-1.5 py-0.5 rounded border border-yellow-200 flex items-center gap-1 shadow-sm",children:[v.jsx(fl,{className:"w-3 h-3 fill-yellow-600"})," VIP"]})]}),v.jsx("div",{className:"text-xs text-gray-500",children:f.username||"Cha t tn"}),v.jsx("div",{className:"text-[10px] text-gray-400 font-mono mt-0.5",children:f.id})]}),v.jsx("td",{className:"p-4",children:v.jsx(ep,{variant:"outline",className:f.isVip?"border-yellow-500 text-yellow-700 bg-yellow-50":"text-gray-500",children:f.isVip?"Premium User":"Thnh vin"})}),v.jsx("td",{className:"p-4 text-gray-500",children:new Date(f.created_at).toLocaleDateString("vi-VN")}),v.jsx("td",{className:"p-4 text-right",children:v.jsx(vn,{size:"sm",variant:"ghost",className:"text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>u(f.id),children:v.jsx(ch,{className:"w-4 h-4"})})})]},f.id))})]})})})},uX=()=>{const{stores:t,isLoading:e,isAdmin:r,setFilter:l,updateStoreStatus:u,deleteStore:f}=nX(),{signOut:g}=ha(),w=rp(),[s,S]=I.useState(null),[A,j]=I.useState(!1);I.useEffect(()=>{!e&&!r&&w("/")},[r,e,w]);const O=async U=>await u(U,"approved"),L=async U=>await u(U,"rejected"),W=U=>{S(U),j(!0)};return e?v.jsx("div",{className:"flex items-center justify-center min-h-screen",children:v.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full"})}):r?v.jsx("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8 font-sans text-gray-900",children:v.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[v.jsxs("div",{className:"flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border",children:[v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx(vn,{variant:"ghost",size:"icon",onClick:()=>w("/"),children:v.jsx(h0,{className:"w-5 h-5"})}),v.jsxs("div",{children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),v.jsx("p",{className:"text-muted-foreground text-sm",children:"H thng qun l ThodiaUni"})]})]}),v.jsxs(vn,{variant:"destructive",onClick:()=>g(),className:"shadow-red-200 shadow-lg",children:[v.jsx(Kw,{className:"w-4 h-4 mr-2"}),"ng xut"]})]}),v.jsxs(Gy,{defaultValue:"stores",className:"w-full",children:[v.jsxs(Fm,{className:"grid w-full grid-cols-5 mb-8 h-12 bg-white border shadow-sm rounded-lg p-1",children:[v.jsxs(as,{value:"stores",className:"text-sm font-medium data-[state=active]:bg-green-50 data-[state=active]:text-green-700",children:[v.jsx(Yc,{className:"w-4 h-4 mr-2"})," Ca hng"]}),v.jsxs(as,{value:"ads",className:"text-sm font-medium data-[state=active]:bg-pink-50 data-[state=active]:text-pink-700",children:[v.jsx(Iv,{className:"w-4 h-4 mr-2"})," Qung co"]}),v.jsxs(as,{value:"jobs",className:"text-sm font-medium data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700",children:[v.jsx(lh,{className:"w-4 h-4 mr-2"})," Tuyn dng"]}),v.jsxs(as,{value:"users",className:"text-sm font-medium data-[state=active]:bg-purple-50 data-[state=active]:text-purple-700",children:[v.jsx(ZP,{className:"w-4 h-4 mr-2"})," Ngi dng"]}),v.jsxs(as,{value:"claims",className:"text-sm font-medium data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700",children:[v.jsx(A5,{className:"w-4 h-4 mr-2"})," Xc minh"]})]}),v.jsx(Co,{value:"stores",children:v.jsxs(bm,{className:"border-none shadow-md",children:[v.jsxs(fy,{children:[v.jsx(py,{children:"Danh sch ca hng"}),v.jsxs(my,{children:["Hin c ",t.length," ca hng trong h thng."]})]}),v.jsx(Tm,{children:v.jsxs(Gy,{defaultValue:"pending",className:"w-full",onValueChange:U=>l(U),children:[v.jsxs(Fm,{className:"mb-6 bg-gray-100 w-full justify-start overflow-x-auto",children:[v.jsx(as,{value:"pending",children:"Ch duyt"}),v.jsx(as,{value:"approved",children:" duyt"}),v.jsx(as,{value:"rejected",children:"T chi"}),v.jsx(as,{value:"all",children:"Tt c"})]}),v.jsx("div",{className:"grid gap-4",children:t.length===0?v.jsx("p",{className:"text-center py-12 text-muted-foreground",children:"Khng c d liu"}):t.map(U=>v.jsxs("div",{className:"flex flex-col md:flex-row gap-4 bg-white border rounded-xl p-4 hover:shadow-md transition-all",children:[v.jsxs("div",{className:"w-full md:w-32 h-32 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0 relative",children:[v.jsx("img",{src:U.image_url||"https://placehold.co/400x400?text=Store",className:"w-full h-full object-cover",onError:q=>{q.currentTarget.src="https://placehold.co/400x400?text=No+Image"}}),U.is_premium&&v.jsxs("span",{className:"absolute top-2 right-2 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-1.5 rounded flex items-center gap-1 shadow-sm",children:[v.jsx(fl,{className:"w-3 h-3 fill-current"})," VIP"]})]}),v.jsxs("div",{className:"flex-1 space-y-2",children:[v.jsxs("div",{className:"flex justify-between items-start",children:[v.jsx("h3",{className:"font-bold text-lg text-gray-800",children:U.name_vi}),v.jsx(ep,{className:U.status==="approved"?"bg-green-100 text-green-700":U.status==="rejected"?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700",children:U.status==="approved"?"Hot ng":U.status==="rejected"?" kha":"Ch duyt"})]}),v.jsxs("p",{className:"text-sm text-gray-600 flex gap-2",children:[v.jsx(Wi,{className:"w-4 h-4 text-gray-400"})," ",U.address_vi]}),v.jsxs("p",{className:"text-xs text-gray-400",children:["Owner: ",U.user_email]})]}),v.jsxs("div",{className:"flex flex-col gap-2 justify-center border-t md:border-t-0 md:border-l pt-4 md:pt-0 md:pl-4 min-w-[140px]",children:[v.jsxs(vn,{variant:"outline",size:"sm",onClick:()=>W(U),children:[v.jsx(g5,{className:"w-4 h-4 mr-2"})," Chi tit"]}),U.status==="pending"&&v.jsxs(v.Fragment,{children:[v.jsxs(vn,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>O(U.id),children:[v.jsx(tp,{className:"w-4 h-4 mr-2"})," Duyt"]}),v.jsxs(vn,{size:"sm",variant:"destructive",onClick:()=>L(U.id),children:[v.jsx(xi,{className:"w-4 h-4 mr-2"})," T chi"]})]}),U.status!=="pending"&&v.jsxs(vn,{size:"sm",variant:"ghost",onClick:()=>f(U.id),className:"text-red-600 hover:bg-red-50",children:[v.jsx(Kw,{className:"w-4 h-4 mr-2"})," Xa"]})]})]},U.id))})]})})]})}),v.jsx(Co,{value:"ads",children:v.jsxs(bm,{className:"border-none shadow-md",children:[v.jsxs(fy,{children:[v.jsx(py,{children:"Qung co ang chy"}),v.jsx(my,{children:"Qun l cc chin dch qung co ca ca hng."})]}),v.jsx(Tm,{children:v.jsx(aX,{})})]})}),v.jsx(Co,{value:"jobs",children:v.jsxs(bm,{className:"border-none shadow-md",children:[v.jsxs(fy,{children:[v.jsx(py,{children:"Tin tuyn dng"}),v.jsx(my,{children:"Duyt v qun l cc bi ng tm vic lm."})]}),v.jsx(Tm,{children:v.jsx(lX,{})})]})}),v.jsx(Co,{value:"users",children:v.jsxs(bm,{className:"border-none shadow-md",children:[v.jsxs(fy,{children:[v.jsx(py,{children:"Danh sch ngi dng"}),v.jsx(my,{children:"Qun l ti khon trong h thng."})]}),v.jsx(Tm,{children:v.jsx(cX,{})})]})}),v.jsx(Co,{value:"claims",children:v.jsx(bm,{className:"border-none shadow-md",children:v.jsx(Tm,{className:"pt-6",children:v.jsx(oX,{})})})})]}),v.jsx(sX,{isOpen:A,onClose:()=>j(!1),store:s})]})}):null},dX=()=>{const t=C0();return I.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),v.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),v.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),v.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},hX=()=>{const t=rp(),{user:e}=ha(),[r,l]=I.useState(!1),[u,f]=I.useState("Tt c"),[g,w]=I.useState(null),[s,S]=I.useState([]),[A,j]=I.useState(!0),[O,L]=I.useState(!1);I.useEffect(()=>{(async()=>{j(!0);const{data:Q,error:J}=await Wt.from("jobs").select("*").eq("status","approved").order("created_at",{ascending:!1});J?(console.error("Li ly tin:",J),Jt.error("Khng ti c danh sch vic lm.")):S(Q||[]),j(!1)})()},[]);const W=async q=>{if(q.preventDefault(),!e){Jt.error("Vui lng ng nhp  ng tin!");return}L(!0);const Q=new FormData(q.target),J={title:Q.get("title"),shop_name:Q.get("shopName"),address:Q.get("address"),phone:Q.get("phone"),salary:Q.get("salary"),type:Q.get("type"),description:Q.get("description"),user_id:e.id,status:"pending",created_at:new Date().toISOString()},{error:Y}=await Wt.from("jobs").insert([J]);Y?Jt.error("Li ng tin: "+Y.message):(Jt.success("ng tin thnh cng! Tin ca bn ang ch Admin duyt."),l(!1)),L(!1)},U=q=>{w(g===q?null:q)};return v.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24 font-sans text-gray-800",children:[v.jsxs("div",{className:"bg-white sticky top-0 z-40 border-b shadow-sm",children:[v.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx(vn,{variant:"ghost",size:"icon",onClick:()=>t("/"),className:"-ml-2 hover:bg-gray-100 rounded-full",children:v.jsx(h0,{className:"w-5 h-5 text-gray-600"})}),v.jsxs("div",{children:[v.jsx("h1",{className:"font-bold text-lg text-gray-800 leading-none",children:"Vic lm"}),v.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"C hi cho sinh vin"})]})]}),v.jsxs(vn,{onClick:()=>{e?l(!0):Jt.error("Bn cn ng nhp  ng tin")},className:"bg-green-600 hover:bg-green-700 text-white gap-1.5 h-9 px-4 text-xs font-bold rounded-full shadow-lg shadow-green-200 active:scale-95 transition-all",children:[v.jsx(u5,{className:"w-4 h-4"}),"ng tin Free"]})]}),v.jsxs("div",{className:"px-4 pb-3 space-y-3",children:[v.jsxs("div",{className:"relative group",children:[v.jsx(p0,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 group-focus-within:text-green-600 transition-colors"}),v.jsx(fi,{placeholder:"Tm vic (phc v, pha ch...)",className:"pl-9 bg-gray-100 border-transparent h-10 text-sm focus-visible:ring-1 focus-visible:ring-green-500 transition-all"})]}),v.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 no-scrollbar",style:{scrollbarWidth:"none"},children:["Tt c","Part-time","Full-time","Ca ti","Gn trng"].map(q=>v.jsx("button",{onClick:()=>f(q),className:`px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border ${u===q?"bg-green-600 text-white border-green-600 shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-green-400"}`,children:q},q))})]})]}),v.jsxs("div",{className:"p-4 space-y-3",children:[A?v.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-400 gap-2",children:[v.jsx(ls,{className:"w-6 h-6 animate-spin text-green-600"}),v.jsx("span",{className:"text-xs",children:"ang ti tin tuyn dng..."})]}):s.length===0?v.jsxs("div",{className:"text-center py-10 text-gray-400 text-sm bg-white rounded-xl border border-dashed",children:["Cha c tin tuyn dng no c duyt.",v.jsx("br",{}),"Hy l ngi u tin ng tin!"]}):s.map(q=>v.jsxs(_r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:[v.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>U(q.id),children:[v.jsxs("div",{className:"flex justify-between items-start mb-2",children:[v.jsx("h3",{className:"font-bold text-gray-900 text-base line-clamp-1",children:q.title}),v.jsx("span",{className:"text-green-700 font-extrabold text-sm bg-green-50 px-2 py-0.5 rounded ml-2 whitespace-nowrap",children:q.salary})]}),v.jsxs("div",{className:"flex flex-col gap-1 mb-3",children:[v.jsxs("div",{className:"flex items-center gap-1.5 text-gray-700 text-sm font-semibold",children:[v.jsx(Dm,{className:"w-3.5 h-3.5 text-blue-500"}),q.shop_name," "]}),v.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 text-xs",children:[v.jsx(Wi,{className:"w-3.5 h-3.5 text-gray-400"}),q.address]})]}),v.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-500",children:[v.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100",children:[v.jsx(f0,{className:"w-3 h-3 text-orange-500"}),new Date(q.created_at).toLocaleDateString("vi-VN")]}),v.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded border border-gray-100",children:[v.jsx(lh,{className:"w-3 h-3 text-purple-500"}),q.type]})]})]}),v.jsx(Da,{children:g===q.id&&v.jsxs(_r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-gray-50 border-t border-gray-100 px-4 pb-4 pt-2",children:[v.jsxs("div",{className:"mb-4",children:[v.jsxs("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-1 flex items-center gap-1",children:[v.jsx(_5,{className:"w-3 h-3"})," M t cng vic"]}),v.jsx("p",{className:"text-sm text-gray-700 leading-relaxed bg-white p-2 rounded border border-gray-200 whitespace-pre-line",children:q.description})]}),v.jsx("div",{className:"flex gap-3",children:v.jsxs("a",{href:`tel:${q.phone}`,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 rounded-lg flex items-center justify-center gap-2 transition-colors shadow-sm",children:[v.jsx(Qy,{className:"w-4 h-4"}),"Gi in (",q.phone,")"]})})]})}),g!==q.id&&v.jsx("div",{onClick:()=>U(q.id),className:"bg-gray-50 py-1.5 text-center text-[10px] text-gray-500 font-medium border-t border-gray-100 hover:bg-gray-100 cursor-pointer transition-colors",children:" Xem chi tit & Lin h"})]},q.id)),v.jsx("div",{className:"h-10 text-center text-xs text-gray-400",children:"Ht danh sch"})]}),r&&v.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[v.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:()=>l(!1)}),v.jsxs(_r.div,{initial:{scale:.95,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},className:"bg-white rounded-2xl w-full max-w-lg shadow-2xl relative z-10 flex flex-col max-h-[85vh]",children:[v.jsxs("div",{className:"bg-green-600 p-4 rounded-t-2xl text-white flex justify-between items-center sticky top-0 z-20",children:[v.jsxs("div",{children:[v.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[v.jsx(lh,{className:"w-5 h-5"}),"ng tin tuyn dng"]}),v.jsx("p",{className:"text-xs text-green-100 opacity-90",children:"Tip cn hng nghn sinh vin quanh y"})]}),v.jsx("button",{onClick:()=>l(!1),className:"p-1.5 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:v.jsx(xi,{className:"w-5 h-5 text-white"})})]}),v.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:v.jsxs("form",{id:"post-job-form",onSubmit:W,className:"space-y-6",children:[v.jsxs("div",{className:"space-y-3",children:[v.jsxs("h3",{className:"text-sm font-bold text-gray-800 uppercase flex items-center gap-2 border-b pb-1",children:[v.jsx(Dm,{className:"w-4 h-4 text-green-600"}),"Thng tin ca hng"]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["Tn ca hng/qun ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{name:"shopName",placeholder:"VD: Tr sa Gong Cha",required:!0,className:"bg-gray-50"})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["S in thoi lin h ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{name:"phone",placeholder:"09xxxx...",required:!0,className:"bg-gray-50",type:"tel"})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["a ch c th ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{name:"address",placeholder:"S nh, ng...",required:!0,className:"bg-gray-50"})]})]})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("h3",{className:"text-sm font-bold text-gray-800 uppercase flex items-center gap-2 border-b pb-1",children:[v.jsx(lh,{className:"w-4 h-4 text-green-600"}),"Chi tit cng vic"]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["V tr cn tuyn ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{name:"title",placeholder:"VD: Nhn vin phc v ca ti",required:!0,className:"bg-gray-50 font-medium"})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["Mc lng ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(fi,{name:"salary",placeholder:"VD: 25k/h",required:!0,className:"bg-gray-50"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:"Hnh thc"}),v.jsxs("select",{name:"type",className:"w-full h-10 border rounded-md px-2 text-sm bg-gray-50 outline-none focus:ring-1 focus:ring-green-500 border-input",children:[v.jsx("option",{value:"Part-time",children:"Part-time"}),v.jsx("option",{value:"Full-time",children:"Full-time"}),v.jsx("option",{value:"Freelance",children:"Freelance"})]})]})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"text-xs font-semibold text-gray-600 mb-1 block",children:["M t cng vic & Yu cu ",v.jsx("span",{className:"text-red-500",children:"*"})]}),v.jsx(yh,{name:"description",className:"bg-gray-50 min-h-[100px] text-sm leading-relaxed",placeholder:`- Thi gian lm vic...
- Yu cu...`,required:!0})]})]})]})}),v.jsxs("div",{className:"p-4 border-t bg-gray-50 rounded-b-2xl flex gap-3 sticky bottom-0 z-20",children:[v.jsx(vn,{type:"button",variant:"outline",className:"flex-1 border-gray-300",onClick:()=>l(!1),children:"Hy b"}),v.jsxs(vn,{type:"submit",form:"post-job-form",disabled:O,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold shadow-lg shadow-green-200",children:[O?v.jsx(ls,{className:"w-4 h-4 mr-2 animate-spin"}):v.jsx(c5,{className:"w-4 h-4 mr-2"}),"ng tin ngay"]})]})]})]})]})},fX=new tF,pX=()=>{const t=C0();return I.useEffect(()=>{window.gtag&&window.gtag("config","G-ZCMPN5RBRS",{page_path:t.pathname+t.search})},[t]),null},mX=()=>v.jsx(nF,{client:fX,children:v.jsx(d6,{children:v.jsx(MB,{children:v.jsxs(WU,{children:[v.jsx(hO,{}),v.jsx(GO,{}),v.jsxs(u6,{children:[v.jsx(pX,{}),v.jsxs(a6,{children:[v.jsx(Nf,{path:"/",element:v.jsx(uP,{})}),v.jsx(Nf,{path:"/place/:id",element:v.jsx(uP,{})}),v.jsx(Nf,{path:"/about",element:v.jsx(eG,{})}),v.jsx(Nf,{path:"/admin",element:v.jsx(uX,{})}),v.jsx(Nf,{path:"*",element:v.jsx(dX,{})}),v.jsx(Nf,{path:"/jobs",element:v.jsx(hX,{})})]})]})]})})})});ym.createRoot(document.getElementById("root")).render(v.jsx(mX,{}));
